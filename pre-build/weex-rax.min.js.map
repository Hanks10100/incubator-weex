{"version":3,"file":"weex-rax.min.js","sources":["../runtime/shared/utils.js","../runtime/bridge/normalize.js","../runtime/bridge/CallbackManager.js","../runtime/vdom/operation.js","../runtime/vdom/Node.js","../runtime/vdom/WeexElement.js","../runtime/vdom/Element.js","../runtime/bridge/TaskCenter.js","../runtime/bridge/receiver.js","../runtime/api/module.js","../runtime/api/component.js","../runtime/api/service.js","../runtime/vdom/Comment.js","../runtime/bridge/Listener.js","../runtime/bridge/Handler.js","../runtime/vdom/Document.js","../runtime/api/WeexInstance.js","../runtime/api/init.js","../runtime/bridge/debug.js","../runtime/api/config.js","../runtime/api/index.js","../runtime/services/broadcast-channel/message-event.js","../runtime/services/broadcast-channel/index.js","../node_modules/_@ali_weex-rax-framework-yc@0.0.1@@ali/weex-rax-framework-yc/dist/framework.js","../runtime/entries/setup.js","../runtime/entries/rax.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Get a unique id.\n */\nlet nextNodeRef = 1\nexport function uniqueId () {\n  return (nextNodeRef++).toString()\n}\n\nexport function typof (v) {\n  const s = Object.prototype.toString.call(v)\n  return s.substring(8, s.length - 1)\n}\n\nexport function bufferToBase64 (buffer) {\n  if (typeof btoa !== 'function') {\n    return ''\n  }\n  const string = Array.prototype.map.call(\n    new Uint8Array(buffer),\n    code => String.fromCharCode(code)\n  ).join('')\n  return btoa(string) // eslint-disable-line no-undef\n}\n\nexport function base64ToBuffer (base64) {\n  if (typeof atob !== 'function') {\n    return new ArrayBuffer(0)\n  }\n  const string = atob(base64) // eslint-disable-line no-undef\n  const array = new Uint8Array(string.length)\n  Array.prototype.forEach.call(string, (ch, i) => {\n    array[i] = ch.charCodeAt(0)\n  })\n  return array.buffer\n}\n\n/**\n * Detect if the param is falsy or empty\n * @param {any} any\n */\nexport function isEmpty (any) {\n  if (!any || typeof any !== 'object') {\n    return true\n  }\n\n  for (const key in any) {\n    if (Object.prototype.hasOwnProperty.call(any, key)) {\n      return false\n    }\n  }\n  return true\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { typof, bufferToBase64, base64ToBuffer } from '../shared/utils'\n\n/**\n * Normalize a primitive value.\n * @param  {any}        v\n * @return {primitive}\n */\nexport function normalizePrimitive (v) {\n  const type = typof(v)\n\n  switch (type) {\n    case 'Undefined':\n    case 'Null':\n      return ''\n\n    case 'RegExp':\n      return v.toString()\n    case 'Date':\n      return v.toISOString()\n\n    case 'Number':\n    case 'String':\n    case 'Boolean':\n    case 'Array':\n    case 'Object':\n      return v\n\n    case 'ArrayBuffer':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v)\n      }\n\n    case 'Int8Array':\n    case 'Uint8Array':\n    case 'Uint8ClampedArray':\n    case 'Int16Array':\n    case 'Uint16Array':\n    case 'Int32Array':\n    case 'Uint32Array':\n    case 'Float32Array':\n    case 'Float64Array':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v.buffer)\n      }\n\n    default:\n      return JSON.stringify(v)\n  }\n}\n\nexport function decodePrimitive (data) {\n  if (typof(data) === 'Object') {\n    // decode base64 into binary\n    if (data['@type'] && data['@type'] === 'binary') {\n      return base64ToBuffer(data.base64 || '')\n    }\n\n    const realData = {}\n    for (const key in data) {\n      realData[key] = decodePrimitive(data[key])\n    }\n    return realData\n  }\n  if (typof(data) === 'Array') {\n    return data.map(decodePrimitive)\n  }\n  return data\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { decodePrimitive } from './normalize'\n\nfunction getHookKey (componentId, type, hookName) {\n  return `${type}@${hookName}#${componentId}`\n}\n\n/**\n * For general callback management of a certain Weex instance.\n * Because function can not passed into native, so we create callback\n * callback id for each function and pass the callback id into native\n * in fact. And when a callback called from native, we can find the real\n * callback through the callback id we have passed before.\n */\nexport default class CallbackManager {\n  constructor (instanceId) {\n    this.instanceId = String(instanceId)\n    this.lastCallbackId = 0\n    this.callbacks = {}\n    this.hooks = {}\n  }\n  add (callback) {\n    this.lastCallbackId++\n    this.callbacks[this.lastCallbackId] = callback\n    return this.lastCallbackId\n  }\n  remove (callbackId) {\n    const callback = this.callbacks[callbackId]\n    delete this.callbacks[callbackId]\n    return callback\n  }\n  registerHook (componentId, type, hookName, hookFunction) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    if (this.hooks[key]) {\n      console.warn(`[JS Framework] Override an existing component hook \"${key}\".`)\n    }\n    this.hooks[key] = hookFunction\n  }\n  triggerHook (componentId, type, hookName, options = {}) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    const hookFunction = this.hooks[key]\n    if (typeof hookFunction !== 'function') {\n      console.error(`[JS Framework] Invalid hook function type (${typeof hookFunction}) on \"${key}\".`)\n      return null\n    }\n    let result = null\n    try {\n      result = hookFunction.apply(null, options.args || [])\n    }\n    catch (e) {\n      console.error(`[JS Framework] Failed to execute the hook function on \"${key}\".`)\n    }\n    return result\n  }\n  consume (callbackId, data, ifKeepAlive) {\n    const callback = this.callbacks[callbackId]\n    if (typeof ifKeepAlive === 'undefined' || ifKeepAlive === false) {\n      delete this.callbacks[callbackId]\n    }\n    if (typeof callback === 'function') {\n      return callback(decodePrimitive(data))\n    }\n    return new Error(`invalid callback id \"${callbackId}\"`)\n  }\n  close () {\n    this.callbacks = {}\n    this.hooks = {}\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst docMap = {}\n\n/**\n * Add a document object into docMap.\n * @param {string} id\n * @param {object} document\n */\nexport function addDoc (id, doc) {\n  if (id) {\n    docMap[id] = doc\n  }\n}\n\n/**\n * Get the document object by id.\n * @param {string} id\n */\nexport function getDoc (id) {\n  return docMap[id]\n}\n\n/**\n * Remove the document from docMap by id.\n * @param {string} id\n */\nexport function removeDoc (id) {\n  delete docMap[id]\n}\n\n/**\n * @deprecated\n * Get listener by document id.\n * @param {string} id\n * @return {object} listener\n */\nexport function getListener (id) {\n  const doc = docMap[id]\n  if (doc && doc.listener) {\n    return doc.listener\n  }\n  return null\n}\n\n/**\n * Get TaskCenter instance by id.\n * @param {string} id\n * @return {object} TaskCenter\n */\nexport function getTaskCenter (id) {\n  const doc = docMap[id]\n  if (doc && doc.taskCenter) {\n    return doc.taskCenter\n  }\n  return null\n}\n\n/**\n * Append body node to documentElement.\n * @param {object} document\n * @param {object} node\n * @param {object} before\n */\nexport function appendBody (doc, node, before) {\n  const { documentElement } = doc\n\n  if (documentElement.pureChildren.length > 0 || node.parentNode) {\n    return\n  }\n  const children = documentElement.children\n  const beforeIndex = children.indexOf(before)\n  if (beforeIndex < 0) {\n    children.push(node)\n  }\n  else {\n    children.splice(beforeIndex, 0, node)\n  }\n\n  if (node.nodeType === 1) {\n    if (node.role === 'body') {\n      node.docId = doc.id\n      node.ownerDocument = doc\n      node.parentNode = documentElement\n      linkParent(node, documentElement)\n    }\n    else {\n      node.children.forEach(child => {\n        child.parentNode = node\n      })\n      setBody(doc, node)\n      node.docId = doc.id\n      node.ownerDocument = doc\n      linkParent(node, documentElement)\n      delete doc.nodeMap[node.nodeId]\n    }\n    documentElement.pureChildren.push(node)\n    sendBody(doc, node)\n  }\n  else {\n    node.parentNode = documentElement\n    doc.nodeMap[node.ref] = node\n  }\n}\n\nfunction sendBody (doc, node) {\n  const body = node.toJSON()\n  if (doc && doc.taskCenter && typeof doc.taskCenter.send === 'function') {\n    doc.taskCenter.send('dom', { action: 'createBody' }, [body])\n  }\n}\n\n/**\n * Set up body node.\n * @param {object} document\n * @param {object} element\n */\nexport function setBody (doc, el) {\n  el.role = 'body'\n  el.depth = 1\n  delete doc.nodeMap[el.nodeId]\n  el.ref = '_root'\n  doc.nodeMap._root = el\n  doc.body = el\n}\n\n/**\n * Establish the connection between parent and child node.\n * @param {object} child node\n * @param {object} parent node\n */\nexport function linkParent (node, parent) {\n  node.parentNode = parent\n  if (parent.docId) {\n    node.docId = parent.docId\n    node.ownerDocument = parent.ownerDocument\n    node.ownerDocument.nodeMap[node.nodeId] = node\n    node.depth = parent.depth + 1\n  }\n  node.children.forEach(child => {\n    linkParent(child, node)\n  })\n}\n\n/**\n * Get the next sibling element.\n * @param {object} node\n */\nexport function nextElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.nextSibling\n  }\n}\n\n/**\n * Get the previous sibling element.\n * @param {object} node\n */\nexport function previousElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.previousSibling\n  }\n}\n\n/**\n * Insert a node into list at the specified index.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function insertIndex (target, list, newIndex, changeSibling) {\n  /* istanbul ignore next */\n  if (newIndex < 0) {\n    newIndex = 0\n  }\n  const before = list[newIndex - 1]\n  const after = list[newIndex]\n  list.splice(newIndex, 0, target)\n  if (changeSibling) {\n    before && (before.nextSibling = target)\n    target.previousSibling = before\n    target.nextSibling = after\n    after && (after.previousSibling = target)\n  }\n  return newIndex\n}\n\n/**\n * Move the node to a new index in list.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function moveIndex (target, list, newIndex, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return -1\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n  let newIndexAfter = newIndex\n  if (index <= newIndex) {\n    newIndexAfter = newIndex - 1\n  }\n  const beforeNew = list[newIndexAfter - 1]\n  const afterNew = list[newIndexAfter]\n  list.splice(newIndexAfter, 0, target)\n  if (changeSibling) {\n    beforeNew && (beforeNew.nextSibling = target)\n    target.previousSibling = beforeNew\n    target.nextSibling = afterNew\n    afterNew && (afterNew.previousSibling = target)\n  }\n  if (index === newIndexAfter) {\n    return -1\n  }\n  return newIndex\n}\n\n/**\n * Remove the node from list.\n * @param {object} target node\n * @param {array} list\n * @param {boolean} changeSibling\n */\nexport function removeIndex (target, list, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { uniqueId } from '../shared/utils'\nimport { getDoc } from './operation'\n\nexport default class Node {\n  constructor () {\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.children = []\n    this.pureChildren = []\n    this.parentNode = null\n    this.nextSibling = null\n    this.previousSibling = null\n  }\n\n  /**\n  * Destroy current node, and remove itself form nodeMap.\n  */\n  destroy () {\n    const doc = getDoc(this.docId)\n    if (doc) {\n      delete this.docId\n      delete doc.nodeMap[this.nodeId]\n    }\n    this.children.forEach(child => {\n      child.destroy()\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getTaskCenter } from './operation'\n\nlet Element\n\nexport function setElement (El) {\n  Element = El\n}\n\n/**\n * A map which stores all type of elements.\n * @type {Object}\n */\nconst registeredElements = {}\n\n/**\n * Register an extended element type with component methods.\n * @param  {string} type    component type\n * @param  {array}  methods a list of method names\n */\nexport function registerElement (type, methods) {\n  // Skip when no special component methods.\n  if (!methods || !methods.length) {\n    return\n  }\n\n  // Init constructor.\n  class WeexElement extends Element {}\n\n  // Add methods to prototype.\n  methods.forEach(methodName => {\n    WeexElement.prototype[methodName] = function (...args) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        return taskCenter.send('component', {\n          ref: this.ref,\n          component: type,\n          method: methodName\n        }, args)\n      }\n    }\n  })\n\n  // Add to element type map.\n  registeredElements[type] = WeexElement\n}\n\nexport function unregisterElement (type) {\n  delete registeredElements[type]\n}\n\nexport function getWeexElement (type) {\n  return registeredElements[type]\n}\n\nexport function isWeexElement (type) {\n  return !!registeredElements[type]\n}\n\n/**\n * Clear all element types. Only for testing.\n */\nexport function clearWeexElements () {\n  for (const type in registeredElements) {\n    unregisterElement(type)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport {\n  getDoc,\n  getTaskCenter,\n  linkParent,\n  nextElement,\n  previousElement,\n  insertIndex,\n  moveIndex,\n  removeIndex\n} from './operation'\nimport { uniqueId, isEmpty } from '../shared/utils'\nimport { getWeexElement, setElement } from './WeexElement'\n\nconst DEFAULT_TAG_NAME = 'div'\nconst BUBBLE_EVENTS = [\n  'click', 'longpress', 'touchstart', 'touchmove', 'touchend',\n  'panstart', 'panmove', 'panend', 'horizontalpan', 'verticalpan', 'swipe'\n]\n\nfunction registerNode (docId, node) {\n  const doc = getDoc(docId)\n  doc.nodeMap[node.nodeId] = node\n}\n\nexport default class Element extends Node {\n  constructor (type = DEFAULT_TAG_NAME, props, isExtended) {\n    super()\n\n    const WeexElement = getWeexElement(type)\n    if (WeexElement && !isExtended) {\n      return new WeexElement(type, props, true)\n    }\n\n    props = props || {}\n    this.nodeType = 1\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = type\n    this.attr = props.attr || {}\n    this.style = props.style || {}\n    this.classStyle = props.classStyle || {}\n    this.classList = props.classList || []\n    this.event = {}\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n   * Append a child node.\n   * @param {object} node\n   * @return {undefined | number} the signal sent by native\n   */\n  appendChild (node) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    /* istanbul ignore else */\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.length, true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        insertIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), -1]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.length, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node before specified node.\n   * @param {object} node\n   * @param {object} before\n   * @return {undefined | number} the signal sent by native\n   */\n  insertBefore (node, before) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === before || (node.nextSibling && node.nextSibling === before)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(before), true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(before), true)\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        /* istanbul ignore next */\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node after specified node.\n   * @param {object} node\n   * @param {object} after\n   * @return {undefined | number} the signal sent by native\n   */\n  insertAfter (node, after) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === after || (node.previousSibling && node.previousSibling === after)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      /* istanbul ignore else */\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        /* istanbul ignore else */\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove a child node, and decide whether it should be destroyed.\n   * @param {object} node\n   * @param {boolean} preserved\n   */\n  removeChild (node, preserved) {\n    if (node.parentNode) {\n      removeIndex(node, this.children, true)\n      if (node.nodeType === 1) {\n        removeIndex(node, this.pureChildren)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          taskCenter.send(\n            'dom',\n            { action: 'removeElement' },\n            [node.ref]\n          )\n        }\n      }\n    }\n    if (!preserved) {\n      node.destroy()\n    }\n  }\n\n  /**\n   * Clear all child nodes.\n   */\n  clear () {\n    const taskCenter = getTaskCenter(this.docId)\n    /* istanbul ignore else */\n    if (taskCenter) {\n      this.pureChildren.forEach(node => {\n        taskCenter.send(\n          'dom',\n          { action: 'removeElement' },\n          [node.ref]\n        )\n      })\n    }\n    this.children.forEach(node => {\n      node.destroy()\n    })\n    this.children.length = 0\n    this.pureChildren.length = 0\n  }\n\n  /**\n   * Set an attribute, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setAttr (key, value, silent) {\n    if (this.attr[key] === value && silent !== false) {\n      return\n    }\n    this.attr[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateAttrs' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched attributes.\n   * @param {object} batchedAttrs\n   * @param {boolean} silent\n   */\n  setAttrs (batchedAttrs, silent) {\n    if (isEmpty(batchedAttrs)) return\n    const mutations = {}\n    for (const key in batchedAttrs) {\n      if (this.attr[key] !== batchedAttrs[key]) {\n        this.attr[key] = batchedAttrs[key]\n        mutations[key] = batchedAttrs[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateAttrs' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * Set a style property, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setStyle (key, value, silent) {\n    if (this.style[key] === value && silent !== false) {\n      return\n    }\n    this.style[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched style properties.\n   * @param {object} batchedStyles\n   * @param {boolean} silent\n   */\n  setStyles (batchedStyles, silent) {\n    if (isEmpty(batchedStyles)) return\n    const mutations = {}\n    for (const key in batchedStyles) {\n      if (this.style[key] !== batchedStyles[key]) {\n        this.style[key] = batchedStyles[key]\n        mutations[key] = batchedStyles[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateStyle' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * TODO: deprecated\n   * Set style properties from class.\n   * @param {object} classStyle\n   */\n  setClassStyle (classStyle) {\n    // reset previous class style to empty string\n    for (const key in this.classStyle) {\n      this.classStyle[key] = ''\n    }\n\n    Object.assign(this.classStyle, classStyle)\n    const taskCenter = getTaskCenter(this.docId)\n    if (taskCenter) {\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, this.toStyle()]\n      )\n    }\n  }\n\n  /**\n   * Set class list.\n   * @param {array} classList\n   */\n  // setClassList (classList) {\n  //   const classes = typeof classList === 'string'\n  //     ? classList.split(/\\s+/)\n  //     : Array.from(classList)\n  //   if (Array.isArray(classes) && classes.length > 0) {\n  //     this.classList = classes\n  //     const taskCenter = getTaskCenter(this.docId)\n  //     if (taskCenter) {\n  //       taskCenter.send(\n  //         'dom',\n  //         { action: 'updateClassList' },\n  //         [this.ref, this.classList.slice()]\n  //       )\n  //     }\n  //   }\n  // }\n\n  /**\n   * Add an event handler.\n   * @param {string} event type\n   * @param {function} event handler\n   */\n  addEvent (type, handler, params) {\n    if (!this.event) {\n      this.event = {}\n    }\n    if (!this.event[type]) {\n      this.event[type] = { handler, params }\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'addEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Remove an event handler.\n   * @param {string} event type\n   */\n  removeEvent (type) {\n    if (this.event && this.event[type]) {\n      delete this.event[type]\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'removeEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Fire an event manually.\n   * @param {string} type type\n   * @param {function} event handler\n   * @param {boolean} isBubble whether or not event bubble\n   * @param {boolean} options\n   * @return {} anything returned by handler function\n   */\n  fireEvent (type, event, isBubble, options) {\n    let result = null\n    let isStopPropagation = false\n    const eventDesc = this.event[type]\n    if (eventDesc && event) {\n      const handler = eventDesc.handler\n      event.stopPropagation = () => {\n        isStopPropagation = true\n      }\n      if (options && options.params) {\n        result = handler.call(this, ...options.params, event)\n      }\n      else {\n        result = handler.call(this, event)\n      }\n    }\n\n    if (!isStopPropagation\n      && isBubble\n      && (BUBBLE_EVENTS.indexOf(type) !== -1)\n      && this.parentNode\n      && this.parentNode.fireEvent) {\n      event.currentTarget = this.parentNode\n      this.parentNode.fireEvent(type, event, isBubble) // no options\n    }\n\n    return result\n  }\n\n  /**\n   * Get all styles of current element.\n   * @return {object} style\n   */\n  toStyle () {\n    return Object.assign({}, this.classStyle, this.style)\n  }\n\n  /**\n   * Convert current element to JSON like object.\n   * @return {object} element\n   */\n  toJSON () {\n    const result = {\n      ref: this.ref.toString(),\n      type: this.type\n    }\n    if (!isEmpty(this.attr)) {\n      result.attr = this.attr\n    }\n    if (this.classList.length > 0) {\n      result.classList = this.classList.slice()\n    }\n    const style = this.toStyle()\n    if (!isEmpty(style)) {\n      result.style = style\n    }\n    const event = []\n    for (const type in this.event) {\n      const { params } = this.event[type]\n      if (!params) {\n        event.push(type)\n      }\n      else {\n        event.push({ type, params })\n      }\n    }\n    if (event.length) {\n      result.event = event\n    }\n    if (this.pureChildren.length) {\n      result.children = this.pureChildren.map((child) => child.toJSON())\n    }\n    return result\n  }\n\n  /**\n   * Convert to HTML element tag string.\n   * @return {stirng} html\n   */\n  toString () {\n    return '<' + this.type +\n    ' attr=' + JSON.stringify(this.attr) +\n    ' style=' + JSON.stringify(this.toStyle()) + '>' +\n    this.pureChildren.map((child) => child.toString()).join('') +\n    '</' + this.type + '>'\n  }\n}\n\nsetElement(Element)\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CallbackManager from './CallbackManager'\nimport Element from '../vdom/Element'\nimport { typof } from '../shared/utils'\nimport { normalizePrimitive } from './normalize'\n\nlet fallback = function () {}\n\n// The API of TaskCenter would be re-design.\nexport class TaskCenter {\n  constructor (id, sendTasks) {\n    Object.defineProperty(this, 'instanceId', {\n      enumerable: true,\n      value: String(id)\n    })\n    Object.defineProperty(this, 'callbackManager', {\n      enumerable: true,\n      value: new CallbackManager(id)\n    })\n    fallback = sendTasks || function () {}\n  }\n\n  callback (callbackId, data, ifKeepAlive) {\n    return this.callbackManager.consume(callbackId, data, ifKeepAlive)\n  }\n\n  registerHook (...args) {\n    return this.callbackManager.registerHook(...args)\n  }\n\n  triggerHook (...args) {\n    return this.callbackManager.triggerHook(...args)\n  }\n\n  updateData (componentId, newData, callback) {\n    this.send('module', {\n      module: 'dom',\n      method: 'updateComponentData'\n    }, [componentId, newData, callback])\n  }\n\n  destroyCallback () {\n    return this.callbackManager.close()\n  }\n\n  /**\n   * Normalize a value. Specially, if the value is a function, then generate a function id\n   * and save it to `CallbackManager`, at last return the function id.\n   * @param  {any}        v\n   * @return {primitive}\n   */\n  normalize (v) {\n    const type = typof(v)\n    if (v && v instanceof Element) {\n      return v.ref\n    }\n    if (v && v._isVue && v.$el instanceof Element) {\n      return v.$el.ref\n    }\n    if (type === 'Function') {\n      return this.callbackManager.add(v).toString()\n    }\n    return normalizePrimitive(v)\n  }\n\n  send (type, params, args, options) {\n    const { action, component, ref, module, method } = params\n\n    args = args.map(arg => this.normalize(arg))\n\n    switch (type) {\n      case 'dom':\n        return this[action](this.instanceId, args)\n      case 'component':\n        return this.componentHandler(this.instanceId, ref, method, args, Object.assign({ component }, options))\n      default:\n        return this.moduleHandler(this.instanceId, module, method, args, options)\n    }\n  }\n\n  callDOM (action, args) {\n    return this[action](this.instanceId, args)\n  }\n\n  callComponent (ref, method, args, options) {\n    return this.componentHandler(this.instanceId, ref, method, args, options)\n  }\n\n  callModule (module, method, args, options) {\n    return this.moduleHandler(this.instanceId, module, method, args, options)\n  }\n}\n\nexport function init () {\n  const DOM_METHODS = {\n    createFinish: global.callCreateFinish,\n    updateFinish: global.callUpdateFinish,\n    refreshFinish: global.callRefreshFinish,\n\n    createBody: global.callCreateBody,\n    registerStyleSheets: global.callRegisterStyleSheets,\n    addElement: global.callAddElement,\n    removeElement: global.callRemoveElement,\n    moveElement: global.callMoveElement,\n    updateAttrs: global.callUpdateAttrs,\n    updateStyle: global.callUpdateStyle,\n    updateClassList: global.callUpdateClassList,\n\n    addEvent: global.callAddEvent,\n    removeEvent: global.callRemoveEvent\n  }\n  const proto = TaskCenter.prototype\n\n  for (const name in DOM_METHODS) {\n    const method = DOM_METHODS[name]\n    proto[name] = method ?\n      (id, args) => method(id, ...args) :\n      (id, args) => fallback(id, [{ module: 'dom', method: name, args }], '-1')\n  }\n\n  proto.componentHandler = global.callNativeComponent ||\n    ((id, ref, method, args, options) =>\n      fallback(id, [{ component: options.component, ref, method, args }]))\n\n  proto.moduleHandler = global.callNativeModule ||\n    ((id, module, method, args) =>\n      fallback(id, [{ module, method, args }]))\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getDoc } from '../vdom/operation'\n\nfunction fireEvent (document, nodeId, type, event, domChanges, params) {\n  const el = document.getRef(nodeId)\n  if (el) {\n    return document.fireEvent(el, type, event, domChanges, params)\n  }\n  return new Error(`invalid element reference \"${nodeId}\"`)\n}\n\nfunction callback (document, callbackId, data, ifKeepAlive) {\n  return document.taskCenter.callback(callbackId, data, ifKeepAlive)\n}\n\nfunction componentHook (document, componentId, type, hook, options) {\n  if (!document || !document.taskCenter) {\n    console.error(`[JS Framework] Can't find \"document\" or \"taskCenter\".`)\n    return null\n  }\n  let result = null\n  try {\n    result = document.taskCenter.triggerHook(componentId, type, hook, options)\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to trigger the \"${type}@${hook}\" hook on ${componentId}.`)\n  }\n  return result\n}\n\n/**\n * Accept calls from native (event or callback).\n *\n * @param  {string} id\n * @param  {array} tasks list with `method` and `args`\n */\nexport function receiveTasks (id, tasks) {\n  const document = getDoc(id)\n  if (!document) {\n    return new Error(`[JS Framework] Failed to receiveTasks, `\n      + `instance (${id}) is not available.`)\n  }\n  if (Array.isArray(tasks)) {\n    return tasks.map(task => {\n      switch (task.method) {\n        case 'callback': return callback(document, ...task.args)\n        case 'fireEventSync':\n        case 'fireEvent': return fireEvent(document, ...task.args)\n        case 'componentHook': return componentHook(document, ...task.args)\n      }\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst weexModules = {}\n\n/**\n * Register native modules information.\n * @param {object} newModules\n */\nexport function registerModules (newModules) {\n  for (const name in newModules) {\n    if (!weexModules[name]) {\n      weexModules[name] = {}\n    }\n    newModules[name].forEach(method => {\n      if (typeof method === 'string') {\n        weexModules[name][method] = true\n      }\n      else {\n        weexModules[name][method.name] = method.args\n      }\n    })\n  }\n}\n\n/**\n * Check whether the module or the method has been registered.\n * @param {String} module name\n * @param {String} method name (optional)\n */\nexport function isRegisteredModule (name, method) {\n  if (typeof method === 'string') {\n    return !!(weexModules[name] && weexModules[name][method])\n  }\n  return !!weexModules[name]\n}\n\nexport function getModuleDescription (name) {\n  return weexModules[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { registerElement } from '../vdom/WeexElement'\n\nconst weexComponents = {}\n\n/**\n * Register native components information.\n * @param {array} newComponents\n */\nexport function registerComponents (newComponents) {\n  if (Array.isArray(newComponents)) {\n    newComponents.forEach(component => {\n      if (!component) {\n        return\n      }\n      if (typeof component === 'string') {\n        weexComponents[component] = true\n      }\n      else if (typeof component === 'object' && typeof component.type === 'string') {\n        weexComponents[component.type] = component\n        registerElement(component.type, component.methods)\n      }\n    })\n  }\n}\n\n/**\n * Check whether the component has been registered.\n * @param {String} component name\n */\nexport function isRegisteredComponent (name) {\n  return !!weexComponents[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// JS Services\n\nexport const services = []\n\n/**\n * Register a JavaScript service.\n * A JavaScript service options could have a set of lifecycle methods\n * for each Weex instance. For example: create, refresh, destroy.\n * For the JS framework maintainer if you want to supply some features\n * which need to work well in different Weex instances, even in different\n * frameworks separately. You can make a JavaScript service to init\n * its variables or classes for each Weex instance when it's created\n * and recycle them when it's destroyed.\n * @param {object} options Could have { create, refresh, destroy }\n *                         lifecycle methods. In create method it should\n *                         return an object of what variables or classes\n *                         would be injected into the Weex instance.\n */\nexport function register (name, options) {\n  if (has(name)) {\n    console.warn(`Service \"${name}\" has been registered already!`)\n  }\n  else {\n    options = Object.assign({}, options)\n    services.push({ name, options })\n  }\n}\n\n/**\n * Unregister a JavaScript service by name\n * @param {string} name\n */\nexport function unregister (name) {\n  services.some((service, index) => {\n    if (service.name === name) {\n      services.splice(index, 1)\n      return true\n    }\n  })\n}\n\n/**\n * Check if a JavaScript service with a certain name existed.\n * @param  {string}  name\n * @return {Boolean}\n */\nexport function has (name) {\n  return indexOf(name) >= 0\n}\n\n/**\n * Find the index of a JavaScript service by name\n * @param  {string} name\n * @return {number}\n */\nfunction indexOf (name) {\n  return services.map(service => service.name).indexOf(name)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport { uniqueId } from '../shared/utils'\n\nexport default class Comment extends Node {\n  constructor (value) {\n    super()\n\n    this.nodeType = 8\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = 'comment'\n    this.value = value\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n  * Convert to HTML comment string.\n  * @return {stirng} html\n  */\n  toString () {\n    return '<!-- ' + this.value + ' -->'\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n* Create the action object.\n* @param {string} name\n* @param {array} arguments\n* @return {object} action\n*/\nfunction createAction (name, args = []) {\n  return { module: 'dom', method: name, args: args }\n}\n\nexport default class Listener {\n  constructor (id, handler) {\n    this.id = id\n    this.batched = false\n    this.updates = []\n    if (typeof handler === 'function') {\n      Object.defineProperty(this, 'handler', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: handler\n      })\n    }\n    else {\n      console.error('[JS Runtime] invalid parameter, handler must be a function')\n    }\n  }\n\n  /**\n   * Send the \"createFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  createFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('createFinish')], callback)\n  }\n\n  /**\n   * Send the \"updateFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  updateFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('updateFinish')], callback)\n  }\n\n  /**\n   * Send the \"refreshFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  refreshFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('refreshFinish')], callback)\n  }\n\n  /**\n   * Send the \"createBody\" signal.\n   * @param {object} element\n   * @return {undefined | number} the signal sent by native\n   */\n  createBody (element) {\n    const body = element.toJSON()\n    const children = body.children\n    delete body.children\n    const actions = [createAction('createBody', [body])]\n    if (children) {\n      actions.push.apply(actions, children.map(child => {\n        return createAction('addElement', [body.ref, child, -1])\n      }))\n    }\n    return this.addActions(actions)\n  }\n\n  /**\n   * Send the \"addElement\" signal.\n   * @param {object} element\n   * @param {stirng} reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  addElement (element, ref, index) {\n    if (!(index >= 0)) {\n      index = -1\n    }\n    return this.addActions(createAction('addElement', [ref, element.toJSON(), index]))\n  }\n\n  /**\n   * Send the \"removeElement\" signal.\n   * @param {stirng} reference id\n   * @return {undefined | number} the signal sent by native\n   */\n  removeElement (ref) {\n    if (Array.isArray(ref)) {\n      const actions = ref.map((r) => createAction('removeElement', [r]))\n      return this.addActions(actions)\n    }\n    return this.addActions(createAction('removeElement', [ref]))\n  }\n\n  /**\n   * Send the \"moveElement\" signal.\n   * @param {stirng} target reference id\n   * @param {stirng} parent reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  moveElement (targetRef, parentRef, index) {\n    return this.addActions(createAction('moveElement', [targetRef, parentRef, index]))\n  }\n\n  /**\n   * Send the \"updateAttrs\" signal.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setAttr (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateAttrs', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal, update a sole style.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyle (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateStyle', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal.\n   * @param {stirng} reference id\n   * @param {object} style\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyles (ref, style) {\n    return this.addActions(createAction('updateStyle', [ref, style]))\n  }\n\n  /**\n   * Send the \"addEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  addEvent (ref, type) {\n    return this.addActions(createAction('addEvent', [ref, type]))\n  }\n\n  /**\n   * Send the \"removeEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  removeEvent (ref, type) {\n    return this.addActions(createAction('removeEvent', [ref, type]))\n  }\n\n  /**\n   * Default handler.\n   * @param {object | array} actions\n   * @param {function} callback\n   * @return {} anything returned by callback function\n   */\n  handler (actions, cb) {\n    return cb && cb()\n  }\n\n  /**\n   * Add actions into updates.\n   * @param {object | array} actions\n   * @return {undefined | number} the signal sent by native\n   */\n  addActions (actions) {\n    const updates = this.updates\n    const handler = this.handler\n\n    if (!Array.isArray(actions)) {\n      actions = [actions]\n    }\n\n    if (this.batched) {\n      updates.push.apply(updates, actions)\n    }\n    else {\n      return handler(actions)\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * Task handler for communication between javascript and native.\n */\n\nconst handlerMap = {\n  createBody: 'callCreateBody',\n  addElement: 'callAddElement',\n  removeElement: 'callRemoveElement',\n  moveElement: 'callMoveElement',\n  updateAttrs: 'callUpdateAttrs',\n  updateStyle: 'callUpdateStyle',\n  addEvent: 'callAddEvent',\n  removeEvent: 'callRemoveEvent'\n}\n\n/**\n * Create a task handler.\n * @param {string} id\n * @param {function} handler\n * @return {function} taskHandler\n */\nexport function createHandler (id, handler) {\n  const defaultHandler = handler || global.callNative\n\n  /* istanbul ignore if */\n  if (typeof defaultHandler !== 'function') {\n    console.error('[JS Runtime] no default handler')\n  }\n\n  return function taskHandler (tasks) {\n    /* istanbul ignore if */\n    if (!Array.isArray(tasks)) {\n      tasks = [tasks]\n    }\n    for (let i = 0; i < tasks.length; i++) {\n      const returnValue = dispatchTask(id, tasks[i], defaultHandler)\n      if (returnValue === -1) {\n        return returnValue\n      }\n    }\n  }\n}\n\n/**\n * Check if there is a corresponding available handler in the environment.\n * @param {string} module\n * @param {string} method\n * @return {boolean}\n */\nfunction hasAvailableHandler (module, method) {\n  return module === 'dom'\n    && handlerMap[method]\n    && typeof global[handlerMap[method]] === 'function'\n}\n\n/**\n * Dispatch the task to the specified handler.\n * @param {string} id\n * @param {object} task\n * @param {function} defaultHandler\n * @return {number} signal returned from native\n */\nfunction dispatchTask (id, task, defaultHandler) {\n  const { module, method, args } = task\n\n  if (hasAvailableHandler(module, method)) {\n    return global[handlerMap[method]](id, ...args, '-1')\n  }\n\n  return defaultHandler(id, [task], '-1')\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Comment from './Comment'\nimport Element from './Element'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\nimport { createHandler } from '../bridge/Handler'\nimport { addDoc, removeDoc, appendBody, setBody } from './operation'\n\n/**\n * Update all changes for an element.\n * @param {object} element\n * @param {object} changes\n */\nfunction updateElement (el, changes) {\n  const attrs = changes.attrs || {}\n  for (const name in attrs) {\n    el.setAttr(name, attrs[name], true)\n  }\n  const style = changes.style || {}\n  for (const name in style) {\n    el.setStyle(name, style[name], true)\n  }\n}\n\nexport default class Document {\n  constructor (id, url, handler) {\n    id = id ? id.toString() : ''\n    this.id = id\n    this.URL = url\n\n    addDoc(id, this)\n    this.nodeMap = {}\n    const L = Document.Listener || Listener\n    this.listener = new L(id, handler || createHandler(id, Document.handler)) // deprecated\n    this.taskCenter = new TaskCenter(id, handler ? (id, ...args) => handler(...args) : Document.handler)\n    this.createDocumentElement()\n  }\n\n  /**\n  * Get the node from nodeMap.\n  * @param {string} reference id\n  * @return {object} node\n  */\n  getRef (ref) {\n    return this.nodeMap[ref]\n  }\n\n  /**\n  * Turn on batched updates.\n  */\n  open () {\n    this.listener.batched = false\n  }\n\n  /**\n  * Turn off batched updates.\n  */\n  close () {\n    this.listener.batched = true\n  }\n\n  /**\n  * Create the document element.\n  * @return {object} documentElement\n  */\n  createDocumentElement () {\n    if (!this.documentElement) {\n      const el = new Element('document')\n      el.docId = this.id\n      el.ownerDocument = this\n      el.role = 'documentElement'\n      el.depth = 0\n      el.ref = '_documentElement'\n      this.nodeMap._documentElement = el\n      this.documentElement = el\n\n      Object.defineProperty(el, 'appendChild', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node) => {\n          appendBody(this, node)\n        }\n      })\n\n      Object.defineProperty(el, 'insertBefore', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node, before) => {\n          appendBody(this, node, before)\n        }\n      })\n    }\n\n    return this.documentElement\n  }\n\n  /**\n  * Create the body element.\n  * @param {string} type\n  * @param {objct} props\n  * @return {object} body element\n  */\n  createBody (type, props) {\n    if (!this.body) {\n      const el = new Element(type, props)\n      setBody(this, el)\n    }\n\n    return this.body\n  }\n\n  /**\n  * Create an element.\n  * @param {string} tagName\n  * @param {objct} props\n  * @return {object} element\n  */\n  createElement (tagName, props) {\n    return new Element(tagName, props)\n  }\n\n  /**\n  * Create an comment.\n  * @param {string} text\n  * @return {object} comment\n  */\n  createComment (text) {\n    return new Comment(text)\n  }\n\n  /**\n  * Register StyleSheets.\n  * @param {string} scopeId\n  * @return {array<object>} styleSheets\n  */\n  // registerStyleSheets (scopeId, styleSheets) {\n  //   const sheets = Array.isArray(styleSheets) ? styleSheets : [styleSheets]\n  //   if (this.taskCenter && sheets.length) {\n  //     return this.taskCenter.send(\n  //       'dom',\n  //       { action: 'registerStyleSheets' },\n  //       [scopeId, sheets]\n  //     )\n  //   }\n  // }\n\n  /**\n  * Fire an event on specified element manually.\n  * @param {object} element\n  * @param {string} event type\n  * @param {object} event object\n  * @param {object} dom changes\n  * @param {object} options\n  * @return {} anything returned by handler function\n  */\n  fireEvent (el, type, event, domChanges, options) {\n    if (!el) {\n      return\n    }\n    event = event || {}\n    event.type = event.type || type\n    event.target = el\n    event.currentTarget = el\n    event.timestamp = Date.now()\n    if (domChanges) {\n      updateElement(el, domChanges)\n    }\n    const isBubble = this.getRef('_root').attr['bubble'] === 'true'\n    return el.fireEvent(type, event, isBubble, options)\n  }\n\n  /**\n  * Destroy current document, and remove itself form docMap.\n  */\n  destroy () {\n    this.taskCenter.destroyCallback()\n    delete this.listener\n    delete this.nodeMap\n    delete this.taskCenter\n    removeDoc(this.id)\n  }\n}\n\n// default task handler\nDocument.handler = null\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Document from '../vdom/Document'\nimport { isRegisteredModule, getModuleDescription } from './module'\nimport { isRegisteredComponent } from './component'\nimport { getTaskCenter } from '../vdom/operation'\n\nconst moduleProxies = {}\n\nfunction setId (weex, id) {\n  Object.defineProperty(weex, '[[CurrentInstanceId]]', { value: id })\n}\n\nfunction getId (weex) {\n  return weex['[[CurrentInstanceId]]']\n}\n\nfunction moduleGetter (id, module, method) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  return (...args) => taskCenter.send('module', { module, method }, args)\n}\n\nfunction moduleSetter (id, module, method, fn) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  if (typeof fn !== 'function') {\n    console.error(`[JS Framework] ${module}.${method} must be assigned as a function.`)\n    return null\n  }\n  return fn => taskCenter.send('module', { module, method }, [fn])\n}\n\nexport default class WeexInstance {\n  constructor (id, config) {\n    setId(this, String(id))\n    this.config = config || {}\n    this.document = new Document(id, this.config.bundleUrl)\n    this.requireModule = this.requireModule.bind(this)\n    this.isRegisteredModule = isRegisteredModule\n    this.isRegisteredComponent = isRegisteredComponent\n  }\n\n  requireModule (moduleName) {\n    const id = getId(this)\n    if (!(id && this.document && this.document.taskCenter)) {\n      console.error(`[JS Framework] Failed to requireModule(\"${moduleName}\"), `\n        + `instance (${id}) doesn't exist anymore.`)\n      return\n    }\n\n    // warn for unknown module\n    if (!isRegisteredModule(moduleName)) {\n      console.warn(`[JS Framework] using unregistered weex module \"${moduleName}\"`)\n      return\n    }\n\n    // create new module proxy\n    const proxyName = `${moduleName}#${id}`\n    if (!moduleProxies[proxyName]) {\n      // create registered module apis\n      const moduleDefine = getModuleDescription(moduleName)\n      const moduleApis = {}\n      for (const methodName in moduleDefine) {\n        Object.defineProperty(moduleApis, methodName, {\n          enumerable: true,\n          configurable: true,\n          get: () => moduleGetter(id, moduleName, methodName),\n          set: fn => moduleSetter(id, moduleName, methodName, fn)\n        })\n      }\n\n      // create module Proxy\n      if (typeof Proxy === 'function') {\n        moduleProxies[proxyName] = new Proxy(moduleApis, {\n          get (target, methodName) {\n            if (methodName in target) {\n              return target[methodName]\n            }\n            console.warn(`[JS Framework] using unregistered method \"${moduleName}.${methodName}\"`)\n            return moduleGetter(id, moduleName, methodName)\n          }\n        })\n      }\n      else {\n        moduleProxies[proxyName] = moduleApis\n      }\n    }\n\n    return moduleProxies[proxyName]\n  }\n\n  supports (condition) {\n    if (typeof condition !== 'string') return null\n\n    const res = condition.match(/^@(\\w+)\\/(\\w+)(\\.(\\w+))?$/i)\n    if (res) {\n      const type = res[1]\n      const name = res[2]\n      const method = res[4]\n      switch (type) {\n        case 'module': return isRegisteredModule(name, method)\n        case 'component': return isRegisteredComponent(name)\n      }\n    }\n\n    return null\n  }\n\n  // registerStyleSheet (styles) {\n  //   if (this.document) {\n  //     this.document.registerStyleSheet(styles)\n  //   }\n  // }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { init as initTaskHandler } from '../bridge/TaskCenter'\nimport { receiveTasks } from '../bridge/receiver'\nimport { registerModules } from './module'\nimport { registerComponents } from './component'\nimport { services, register, unregister } from './service'\nimport { track } from '../bridge/debug'\nimport WeexInstance from './WeexInstance'\nimport { getDoc } from '../vdom/operation'\n\nlet frameworks\nlet runtimeConfig\n\nconst versionRegExp = /^\\s*\\/\\/ *(\\{[^}]*\\}) *\\r?\\n/\n\n/**\n * Detect a JS Bundle code and make sure which framework it's based to. Each JS\n * Bundle should make sure that it starts with a line of JSON comment and is\n * more that one line.\n * @param  {string} code\n * @return {object}\n */\nfunction getBundleType (code) {\n  const result = versionRegExp.exec(code)\n  if (result) {\n    try {\n      const info = JSON.parse(result[1])\n      return info.framework\n    }\n    catch (e) {}\n  }\n\n  // default bundle type\n  return 'Weex'\n}\n\nfunction createServices (id, env, config) {\n  // Init JavaScript services for this instance.\n  const serviceMap = Object.create(null)\n  serviceMap.service = Object.create(null)\n  services.forEach(({ name, options }) => {\n    if (process.env.NODE_ENV === 'development') {\n      console.debug(`[JS Runtime] create service ${name}.`)\n    }\n    const create = options.create\n    if (create) {\n      try {\n        const result = create(id, env, config)\n        Object.assign(serviceMap.service, result)\n        Object.assign(serviceMap, result.instance)\n      }\n      catch (e) {\n        console.error(`[JS Runtime] Failed to create service ${name}.`)\n      }\n    }\n  })\n  delete serviceMap.service.instance\n  Object.freeze(serviceMap.service)\n  return serviceMap\n}\n\nconst instanceTypeMap = {}\nfunction getFrameworkType (id) {\n  return instanceTypeMap[id]\n}\n\nfunction createInstanceContext (id, options = {}, data) {\n  const weex = new WeexInstance(id, options)\n  Object.freeze(weex)\n\n  const bundleType = options.bundleType || 'Vue'\n  instanceTypeMap[id] = bundleType\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  track(id, 'bundleType', bundleType)\n\n  // prepare js service\n  const services = createServices(id, {\n    weex,\n    config: options,\n    created: Date.now(),\n    framework: bundleType,\n    bundleType\n  }, runtimeConfig)\n  Object.freeze(services)\n\n  // prepare runtime context\n  const runtimeContext = Object.create(null)\n  Object.assign(runtimeContext, services, {\n    weex,\n    services // Temporary compatible with some legacy APIs in Rax\n  })\n  Object.freeze(runtimeContext)\n\n  // prepare instance context\n  const instanceContext = Object.assign({}, runtimeContext)\n  if (typeof framework.createInstanceContext === 'function') {\n    Object.assign(instanceContext, framework.createInstanceContext(id, runtimeContext, data))\n  }\n  Object.freeze(instanceContext)\n  return instanceContext\n}\n\n/**\n * Check which framework a certain JS Bundle code based to. And create instance\n * by this framework.\n * @param {string} id\n * @param {string} code\n * @param {object} config\n * @param {object} data\n */\nfunction createInstance (id, code, config, data) {\n  if (instanceTypeMap[id]) {\n    return new Error(`The instance id \"${id}\" has already been used!`)\n  }\n\n  // Init instance info.\n  const bundleType = getBundleType(code)\n  instanceTypeMap[id] = bundleType\n\n  // Init instance config.\n  config = JSON.parse(JSON.stringify(config || {}))\n  config.env = JSON.parse(JSON.stringify(global.WXEnvironment || {}))\n  config.bundleType = bundleType\n\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  if (bundleType === 'Weex') {\n    console.error(`[JS Framework] COMPATIBILITY WARNING: `\n      + `Weex DSL 1.0 (.we) framework is no longer supported! `\n      + `It will be removed in the next version of WeexSDK, `\n      + `your page would be crash if you still using the \".we\" framework. `\n      + `Please upgrade it to Vue.js or Rax.`)\n  }\n\n  const instanceContext = createInstanceContext(id, config, data)\n  if (typeof framework.createInstance === 'function') {\n    // Temporary compatible with some legacy APIs in Rax,\n    // some Rax page is using the legacy \".we\" framework.\n    if (bundleType === 'Rax' || bundleType === 'Weex') {\n      const raxInstanceContext = Object.assign({\n        config,\n        created: Date.now(),\n        framework: bundleType\n      }, instanceContext)\n      return framework.createInstance(id, code, config, data, raxInstanceContext)\n    }\n    return framework.createInstance(id, code, config, data, instanceContext)\n  }\n  // console.error(`[JS Framework] Can't find available \"createInstance\" method in ${bundleType}!`)\n  runInContext(code, instanceContext)\n}\n\n/**\n * Run js code in a specific context.\n * @param {string} code\n * @param {object} context\n */\nfunction runInContext (code, context) {\n  const keys = []\n  const args = []\n  for (const key in context) {\n    keys.push(key)\n    args.push(context[key])\n  }\n\n  const bundle = `\n    (function (global) {\n      ${code}\n    })(Object.create(this))\n  `\n\n  return (new Function(...keys, bundle))(...args)\n}\n\n/**\n * Get the JSON object of the root element.\n * @param {string} instanceId\n */\nfunction getRoot (instanceId) {\n  const document = getDoc(instanceId)\n  try {\n    if (document && document.body) {\n      return document.body.toJSON()\n    }\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to get the virtual dom tree.`)\n    return\n  }\n}\n\nconst methods = {\n  createInstance,\n  createInstanceContext,\n  getRoot,\n  getDocument: getDoc,\n  registerService: register,\n  unregisterService: unregister,\n  callJS (id, tasks) {\n    const framework = frameworks[getFrameworkType(id)]\n    if (framework && typeof framework.receiveTasks === 'function') {\n      return framework.receiveTasks(id, tasks)\n    }\n    return receiveTasks(id, tasks)\n  }\n}\n\n/**\n * Register methods which will be called for each instance.\n * @param {string} methodName\n */\nfunction genInstance (methodName) {\n  methods[methodName] = function (...args) {\n    const id = args[0]\n    const type = getFrameworkType(id)\n    if (type && frameworks[type]) {\n      const result = frameworks[type][methodName](...args)\n      const info = { framework: type }\n\n      // Lifecycle methods\n      if (methodName === 'refreshInstance') {\n        services.forEach(service => {\n          const refresh = service.options.refresh\n          if (refresh) {\n            refresh(id, { info, runtime: runtimeConfig })\n          }\n        })\n      }\n      else if (methodName === 'destroyInstance') {\n        services.forEach(service => {\n          const destroy = service.options.destroy\n          if (destroy) {\n            destroy(id, { info, runtime: runtimeConfig })\n          }\n        })\n        delete instanceTypeMap[id]\n      }\n\n      return result\n    }\n    return new Error(`[JS Framework] Using invalid instance id `\n      + `\"${id}\" when calling ${methodName}.`)\n  }\n}\n\n/**\n * Register methods which init each frameworks.\n * @param {string} methodName\n * @param {function} sharedMethod\n */\nfunction adaptMethod (methodName, sharedMethod) {\n  methods[methodName] = function (...args) {\n    if (typeof sharedMethod === 'function') {\n      sharedMethod(...args)\n    }\n\n    // TODO: deprecated\n    for (const name in runtimeConfig.frameworks) {\n      const framework = runtimeConfig.frameworks[name]\n      if (framework && framework[methodName]) {\n        framework[methodName](...args)\n      }\n    }\n  }\n}\n\nexport default function init (config) {\n  runtimeConfig = config || {}\n  frameworks = runtimeConfig.frameworks || {}\n  initTaskHandler()\n\n  // Init each framework by `init` method and `config` which contains three\n  // virtual-DOM Class: `Document`, `Element` & `Comment`, and a JS bridge method:\n  // `sendTasks(...args)`.\n  for (const name in frameworks) {\n    const framework = frameworks[name]\n    if (typeof framework.init === 'function') {\n      try {\n        framework.init(config)\n      }\n      catch (e) {}\n    }\n  }\n\n  adaptMethod('registerComponents', registerComponents)\n  adaptMethod('registerModules', registerModules)\n  adaptMethod('registerMethods')\n\n  ; ['destroyInstance', 'refreshInstance'].forEach(genInstance)\n\n  return methods\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getTaskCenter } from '../vdom/operation'\nimport { isRegisteredModule } from '../api/module'\n\nexport function track (id, type, value) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to create tracker!`)\n    return\n  }\n  if (!type || !value) {\n    console.warn(`[JS Framework] Invalid track type (${type}) or value (${value})`)\n    return\n  }\n  const label = `jsfm.${type}.${value}`\n  try {\n    if (isRegisteredModule('userTrack', 'addPerfPoint')) {\n      const message = Object.create(null)\n      message[label] = '4'\n      taskCenter.send('module', {\n        module: 'userTrack',\n        method: 'addPerfPoint'\n      }, [message])\n    }\n  }\n  catch (err) {\n    console.error(`[JS Framework] Failed to trace \"${label}\"!`)\n  }\n}\n\nexport function error (...messages) {\n  if (typeof console.error === 'function') {\n    console.error(`[JS Framework] `, ...messages)\n  }\n}\n\nexport function handleException (err) {\n  if (typeof console.error === 'function') {\n    try {\n      console.error(err.toString())\n    }\n    catch (e) {}\n  }\n  if (process.env.NODE_ENV !== 'production') {\n    throw err\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Document, Element, Comment } from '../vdom'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\n\nconst config = {\n  Document, Element, Comment, Listener,\n  TaskCenter,\n  sendTasks (...args) {\n    if (typeof callNative === 'function') {\n      return callNative(...args)\n    }\n    return (global.callNative || (() => {}))(...args)\n  }\n}\n\nDocument.handler = config.sendTasks\n\nexport default config\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport init from './init'\nimport config from './config'\nimport { register, unregister, has } from './service'\n\n/* istanbul ignore next */\nfunction freezePrototype () {\n  // Object.freeze(config.Element)\n  Object.freeze(config.Comment)\n  Object.freeze(config.Listener)\n  Object.freeze(config.Document.prototype)\n  // Object.freeze(config.Element.prototype)\n  Object.freeze(config.Comment.prototype)\n  Object.freeze(config.Listener.prototype)\n}\n\nexport default {\n  service: { register, unregister, has },\n  freezePrototype,\n  init,\n  config\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Mock MessageEvent type\n * @param {string} type\n * @param {object} dict { data, origin, source, ports }\n *\n * This type has been simplified.\n * https://html.spec.whatwg.org/multipage/comms.html#messageevent\n * https://dom.spec.whatwg.org/#interface-event\n */\nexport function MessageEvent (type, dict = {}) {\n  this.type = type || 'message'\n\n  this.data = dict.data || null\n  this.origin = dict.origin || ''\n  this.source = dict.source || null\n  this.ports = dict.ports || []\n\n  // inherit properties\n  this.target = null\n  this.timeStamp = Date.now()\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * The polyfill of BroadcastChannel API.\n * This api can be used to achieve inter-instance communications.\n *\n * https://html.spec.whatwg.org/multipage/comms.html#broadcasting-to-other-browsing-contexts\n */\n\nimport { MessageEvent } from './message-event'\n\nconst channels = {}\nconst instances = {}\n\n/**\n * An empty constructor for BroadcastChannel polyfill.\n * The real constructor will be defined when a Weex instance created because\n * we need to track the channel by Weex instance id.\n */\nfunction BroadcastChannel () {}\n\n/**\n * Sends the given message to other BroadcastChannel objects set up for this channel.\n * @param {any} message\n */\nBroadcastChannel.prototype.postMessage = function (message) {\n  if (this._closed) {\n    throw new Error(`BroadcastChannel \"${this.name}\" is closed.`)\n  }\n\n  const subscribers = channels[this.name]\n  if (subscribers && subscribers.length) {\n    for (let i = 0; i < subscribers.length; ++i) {\n      const member = subscribers[i]\n\n      if (member._closed || member === this) continue\n\n      if (typeof member.onmessage === 'function') {\n        member.onmessage(new MessageEvent('message', { data: message }))\n      }\n    }\n  }\n}\n\n/**\n * Closes the BroadcastChannel object, opening it up to garbage collection.\n */\nBroadcastChannel.prototype.close = function () {\n  if (this._closed) {\n    return\n  }\n\n  this._closed = true\n\n  // remove itself from channels.\n  if (channels[this.name]) {\n    const subscribers = channels[this.name].filter(x => x !== this)\n    if (subscribers.length) {\n      channels[this.name] = subscribers\n    }\n    else {\n      delete channels[this.name]\n    }\n  }\n}\n\nexport default {\n  create: (id, env, config) => {\n    instances[id] = []\n    if (typeof global.BroadcastChannel === 'function') {\n      return {}\n    }\n    const serviceObject = {\n      /**\n       * Returns a new BroadcastChannel object via which messages for the given\n       * channel name can be sent and received.\n       * @param {string} name\n       */\n      BroadcastChannel: function (name) {\n        // the name property is readonly\n        Object.defineProperty(this, 'name', {\n          configurable: false,\n          enumerable: true,\n          writable: false,\n          value: String(name)\n        })\n\n        this._closed = false\n        this.onmessage = null\n\n        if (!channels[this.name]) {\n          channels[this.name] = []\n        }\n        channels[this.name].push(this)\n        instances[id].push(this)\n      }\n    }\n    serviceObject.BroadcastChannel.prototype = BroadcastChannel.prototype\n    return {\n      instance: serviceObject\n    }\n  },\n  destroy: (id, env) => {\n    instances[id].forEach(channel => channel.close())\n    delete instances[id]\n  }\n}\n","module.exports = /******/ (function(modules) { // webpackBootstrap\n/******/  // The module cache\n/******/  var installedModules = {};\n/******/\n/******/  // The require function\n/******/  function __webpack_require__(moduleId) {\n/******/\n/******/    // Check if module is in cache\n/******/    if(installedModules[moduleId]) {\n/******/      return installedModules[moduleId].exports;\n/******/    }\n/******/    // Create a new module (and put it into the cache)\n/******/    var module = installedModules[moduleId] = {\n/******/      i: moduleId,\n/******/      l: false,\n/******/      exports: {}\n/******/    };\n/******/\n/******/    // Execute the module function\n/******/    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/    // Flag the module as loaded\n/******/    module.l = true;\n/******/\n/******/    // Return the exports of the module\n/******/    return module.exports;\n/******/  }\n/******/\n/******/\n/******/  // expose the modules object (__webpack_modules__)\n/******/  __webpack_require__.m = modules;\n/******/\n/******/  // expose the module cache\n/******/  __webpack_require__.c = installedModules;\n/******/\n/******/  // define getter function for harmony exports\n/******/  __webpack_require__.d = function(exports, name, getter) {\n/******/    if(!__webpack_require__.o(exports, name)) {\n/******/      Object.defineProperty(exports, name, {\n/******/        configurable: false,\n/******/        enumerable: true,\n/******/        get: getter\n/******/      });\n/******/    }\n/******/  };\n/******/\n/******/  // getDefaultExport function for compatibility with non-harmony modules\n/******/  __webpack_require__.n = function(module) {\n/******/    var getter = module && module.__esModule ?\n/******/      function getDefault() { return module['default']; } :\n/******/      function getModuleExports() { return module; };\n/******/    __webpack_require__.d(getter, 'a', getter);\n/******/    return getter;\n/******/  };\n/******/\n/******/  // Object.prototype.hasOwnProperty.call\n/******/  __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/  // __webpack_public_path__\n/******/  __webpack_require__.p = \"\";\n/******/\n/******/  // Load entry module and return exports\n/******/  return __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/*!**************************************************!*\\\n  !*** ./packages/weex-rax-framework/src/index.js ***!\n  \\**************************************************/\n/*! dynamic exports provided */\n/*! all exports used */\n/*! ModuleConcatenation bailout: Module is not an ECMAScript module */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getInstance = getInstance;\nexports.init = init;\nexports.createInstanceContext = createInstanceContext;\nexports.refreshInstance = refreshInstance;\nexports.destroyInstance = destroyInstance;\nvar Document = void 0;\nvar Element = void 0;\nvar Comment = void 0;\n\n// Instance hub\nvar instances = {};\n\nfunction getInstance(instanceId) {\n  var instance = instances[instanceId];\n  if (!instance) {\n    throw new Error('Invalid instance id \"' + instanceId + '\"');\n  }\n  return instance;\n}\n\n// TODO: delete (future)\nfunction init(config) {\n  Document = config.Document;\n  Element = config.Element;\n  Comment = config.Comment;\n}\n\n/**\n * create a Weex instance\n *\n * @param  {string} instanceId\n * @param  {object} [__weex_options__] {bundleUrl, debug}\n * @param  {object} __weex_data__\n */\n// export function createInstance(instanceId, __weex_code__, __weex_options__, __weex_data__, __weex_config__) {\nfunction createInstanceContext(instanceId, __weex_options__, __weex_data__) {\n  var instance = instances[instanceId];\n  if (instance == undefined) {\n\n    var bundleUrl = __weex_options__.weex.document.URL || 'about:blank';\n    var document = new Document(instanceId, bundleUrl);\n    // const documentURL = new URL(bundleUrl);\n    // 待确认这块从哪里获取\n    var modules = {};\n\n    instance = instances[instanceId] = {\n      document: document,\n      instanceId: instanceId,\n      bundleUrl: bundleUrl,\n      __weex_data__: __weex_data__,\n      modules: modules,\n      // origin: documentURL.origin,\n      uid: 0\n    };\n\n    // Extend document\n    // require('./document.weex')(__weex_require__, document);\n\n    var instanceContext = {\n      instanceId: instanceId,\n      bundleUrl: bundleUrl,\n      document: document,\n      __weex_document__: document,\n      __weex_options__: __weex_options__,\n      __weex_data__: __weex_data__,\n      __weex_config__: __weex_options__\n    };\n\n    return instanceContext;\n\n    // instance.window = window.self = window.window = window;\n\n  } else {\n    throw new Error('Instance id \"' + instanceId + '\" existed when create instance');\n  }\n}\n\n/**\n * refresh a Weex instance\n *\n * @param  {string} instanceId\n * @param  {object} data\n */\nfunction refreshInstance(instanceId, data) {\n  var instance = getInstance(instanceId);\n  var document = instance.document;\n  document.documentElement.fireEvent('refresh', {\n    timestamp: Date.now(),\n    data: data\n  });\n  document.taskCenter.send('dom', { action: 'refreshFinish' }, []);\n}\n\n/**\n * destroy a Weex instance\n * @param  {string} instanceId\n */\nfunction destroyInstance(instanceId) {\n  var instance = getInstance(instanceId);\n  var bundleCode = instance.bundleCode;\n  // instance.window.closed = true;\n\n  var document = instance.document;\n  document.documentElement.fireEvent('destory', {\n    timestamp: Date.now()\n  });\n\n  if (document.destroy) {\n    document.destroy();\n  }\n\n  if (document.taskCenter && document.taskCenter.destroyCallback) {\n    document.taskCenter.destroyCallback();\n  }\n\n  delete instances[instanceId];\n}\n\n// FIXME: Hack for rollup build \"import Rax from 'weex-rax-framework'\", in rollup if `module.exports` has `__esModule` key must return by export default\nexports.default = exports;\n\n/***/ })\n/******/ ]);;\n//# sourceMappingURL=framework.weex.map","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { subversion } from '../../package.json'\nimport runtime from '../api'\nimport services from '../services'\n\n/**\n * Setup frameworks with runtime.\n * You can package more frameworks by\n *  passing them as arguments.\n */\nexport default function (frameworks) {\n  const { init, config } = runtime\n  config.frameworks = frameworks\n  const { native, transformer } = subversion\n\n  for (const serviceName in services) {\n    runtime.service.register(serviceName, services[serviceName])\n  }\n\n  runtime.freezePrototype()\n\n  // register framework meta info\n  global.frameworkVersion = native\n  global.transformerVersion = transformer\n\n  // init frameworks\n  const globalMethods = init(config)\n\n  // set global methods\n  for (const methodName in globalMethods) {\n    global[methodName] = (...args) => {\n      const ret = globalMethods[methodName](...args)\n      if (ret instanceof Error) {\n        console.error(ret.toString())\n      }\n      return ret\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport setup from './setup'\nimport * as Rax from '@ali/weex-rax-framework-yc'\n\nsetup({ Rax })\n"],"names":["nextNodeRef","uniqueId","toString","typof","v","const","s","Object","prototype","call","substring","length","bufferToBase64","buffer","btoa","string","Array","map","Uint8Array","code","String","fromCharCode","join","isEmpty","any","key","hasOwnProperty","decodePrimitive","data","base64","atob","ArrayBuffer","array","forEach","ch","i","charCodeAt","base64ToBuffer","realData","getHookKey","componentId","type","hookName","CallbackManager","instanceId","this","lastCallbackId","callbacks","hooks","add","callback","remove","callbackId","registerHook","hookFunction","console","warn","triggerHook","options","error","result","apply","args","e","consume","ifKeepAlive","Error","close","docMap","getDoc","id","getTaskCenter","doc","taskCenter","appendBody","node","before","documentElement","pureChildren","parentNode","children","beforeIndex","indexOf","push","splice","nodeType","role","docId","ownerDocument","linkParent","child","setBody","nodeMap","nodeId","body","toJSON","send","action","sendBody","ref","el","depth","_root","parent","nextElement","nextSibling","previousElement","previousSibling","insertIndex","target","list","newIndex","changeSibling","after","moveIndex","index","let","newIndexAfter","beforeNew","afterNew","removeIndex","Node","destroy","Element","registeredElements","DEFAULT_TAG_NAME","BUBBLE_EVENTS","registerNode","props","isExtended","super","WeexElement","attr","style","classStyle","classList","event","appendChild","insertBefore","pureBefore","insertAfter","removeChild","preserved","clear","setAttr","value","silent","setAttrs","batchedAttrs","mutations","setStyle","setStyles","batchedStyles","setClassStyle","assign","toStyle","addEvent","handler","params","removeEvent","fireEvent","isBubble","isStopPropagation","eventDesc","stopPropagation","currentTarget","slice","JSON","stringify","fallback","TaskCenter","sendTasks","defineProperty","enumerable","callbackManager","updateData","newData","module","method","destroyCallback","normalize","_isVue","$el","toISOString","@type","dataType","normalizePrimitive","component","arg","componentHandler","moduleHandler","callDOM","callComponent","callModule","receiveTasks","tasks","document","isArray","task","domChanges","getRef","hook","weexModules","registerModules","newModules","name","isRegisteredModule","weexComponents","registerComponents","newComponents","methods","methodName","registerElement","isRegisteredComponent","services","register","has","unregister","some","service","Comment","createAction","Listener","batched","updates","configurable","writable","createFinish","updateFinish","refreshFinish","createBody","element","actions","addActions","addElement","removeElement","r","moveElement","targetRef","parentRef","cb","handlerMap","updateAttrs","updateStyle","dispatchTask","defaultHandler","global","Document","url","URL","L","listener","callNative","returnValue","createHandler","createDocumentElement","open","_documentElement","createElement","tagName","createComment","text","timestamp","Date","now","changes","attrs","updateElement","moduleProxies","moduleGetter","WeexInstance","config","weex","bundleUrl","requireModule","bind","moduleName","proxyName","moduleDefine","moduleApis","get","set","fn","moduleSetter","Proxy","supports","condition","res","match","frameworks","runtimeConfig","versionRegExp","instanceTypeMap","getFrameworkType","createInstanceContext","freeze","bundleType","framework","label","message","create","err","track","env","serviceMap","instance","createServices","created","runtimeContext","instanceContext","exec","parse","getBundleType","WXEnvironment","createInstance","raxInstanceContext","context","keys","bundle","Function","runInContext","getDocument","registerService","unregisterService","callJS","genInstance","info","refresh","runtime","adaptMethod","sharedMethod","DOM_METHODS","callCreateFinish","callUpdateFinish","callRefreshFinish","callCreateBody","registerStyleSheets","callRegisterStyleSheets","callAddElement","callRemoveElement","callMoveElement","callUpdateAttrs","callUpdateStyle","updateClassList","callUpdateClassList","callAddEvent","callRemoveEvent","proto","callNativeComponent","callNativeModule","initTaskHandler","init","MessageEvent","dict","origin","source","ports","timeStamp","channels","instances","BroadcastChannel","postMessage","_closed","subscribers","member","onmessage","filter","x","serviceObject","channel","modules","installedModules","__webpack_require__","moduleId","exports","l","m","c","d","getter","o","n","__esModule","object","property","p","getInstance","__weex_options__","__weex_data__","undefined","uid","__weex_document__","__weex_config__","refreshInstance","destroyInstance","bundleCode","default","native","transformer","serviceName","freezePrototype","frameworkVersion","transformerVersion","globalMethods","ret","setup"],"mappings":"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"}