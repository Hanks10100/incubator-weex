{"version":3,"file":"weex-legacy.min.js","sources":["../runtime/shared/utils.js","../runtime/bridge/normalize.js","../runtime/bridge/CallbackManager.js","../runtime/vdom/operation.js","../runtime/vdom/Node.js","../runtime/vdom/WeexElement.js","../runtime/vdom/Element.js","../runtime/bridge/TaskCenter.js","../runtime/bridge/receiver.js","../runtime/api/module.js","../runtime/api/component.js","../runtime/api/service.js","../runtime/vdom/Comment.js","../runtime/bridge/Listener.js","../runtime/bridge/Handler.js","../runtime/vdom/Document.js","../runtime/api/WeexInstance.js","../runtime/api/init.js","../runtime/bridge/debug.js","../runtime/api/config.js","../runtime/api/index.js","../runtime/services/broadcast-channel/message-event.js","../runtime/services/broadcast-channel/index.js","../runtime/frameworks/legacy/api/methods.js","../runtime/frameworks/legacy/util/shared.js","../runtime/frameworks/legacy/util/index.js","../runtime/frameworks/legacy/core/dep.js","../runtime/frameworks/legacy/core/watcher.js","../runtime/frameworks/legacy/core/array.js","../runtime/frameworks/legacy/core/observer.js","../runtime/frameworks/legacy/core/state.js","../runtime/frameworks/legacy/config.js","../runtime/frameworks/legacy/vm/directive.js","../runtime/frameworks/legacy/vm/dom-helper.js","../runtime/frameworks/legacy/vm/compiler.js","../runtime/frameworks/legacy/vm/events.js","../runtime/frameworks/legacy/vm/index.js","../runtime/frameworks/legacy/app/register.js","../node_modules/semver/semver.js","../runtime/frameworks/legacy/app/downgrade.js","../runtime/frameworks/legacy/app/bundle/bootstrap.js","../runtime/frameworks/legacy/app/viewport.js","../runtime/frameworks/legacy/app/bundle/define.js","../runtime/frameworks/legacy/app/ctrl/misc.js","../runtime/frameworks/legacy/app/ctrl/init.js","../runtime/frameworks/legacy/app/differ.js","../runtime/frameworks/legacy/app/instance.js","../runtime/frameworks/legacy/app/index.js","../runtime/frameworks/legacy/static/map.js","../runtime/frameworks/legacy/static/register.js","../runtime/frameworks/legacy/static/bridge.js","../runtime/frameworks/legacy/index.js","../runtime/entries/setup.js","../runtime/entries/legacy.js","../runtime/frameworks/legacy/static/create.js","../runtime/frameworks/legacy/static/life.js","../runtime/frameworks/legacy/static/misc.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Get a unique id.\n */\nlet nextNodeRef = 1\nexport function uniqueId () {\n  return (nextNodeRef++).toString()\n}\n\nexport function typof (v) {\n  const s = Object.prototype.toString.call(v)\n  return s.substring(8, s.length - 1)\n}\n\nexport function bufferToBase64 (buffer) {\n  if (typeof btoa !== 'function') {\n    return ''\n  }\n  const string = Array.prototype.map.call(\n    new Uint8Array(buffer),\n    code => String.fromCharCode(code)\n  ).join('')\n  return btoa(string) // eslint-disable-line no-undef\n}\n\nexport function base64ToBuffer (base64) {\n  if (typeof atob !== 'function') {\n    return new ArrayBuffer(0)\n  }\n  const string = atob(base64) // eslint-disable-line no-undef\n  const array = new Uint8Array(string.length)\n  Array.prototype.forEach.call(string, (ch, i) => {\n    array[i] = ch.charCodeAt(0)\n  })\n  return array.buffer\n}\n\n/**\n * Detect if the param is falsy or empty\n * @param {any} any\n */\nexport function isEmpty (any) {\n  if (!any || typeof any !== 'object') {\n    return true\n  }\n\n  for (const key in any) {\n    if (Object.prototype.hasOwnProperty.call(any, key)) {\n      return false\n    }\n  }\n  return true\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { typof, bufferToBase64, base64ToBuffer } from '../shared/utils'\n\n/**\n * Normalize a primitive value.\n * @param  {any}        v\n * @return {primitive}\n */\nexport function normalizePrimitive (v) {\n  const type = typof(v)\n\n  switch (type) {\n    case 'Undefined':\n    case 'Null':\n      return ''\n\n    case 'RegExp':\n      return v.toString()\n    case 'Date':\n      return v.toISOString()\n\n    case 'Number':\n    case 'String':\n    case 'Boolean':\n    case 'Array':\n    case 'Object':\n      return v\n\n    case 'ArrayBuffer':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v)\n      }\n\n    case 'Int8Array':\n    case 'Uint8Array':\n    case 'Uint8ClampedArray':\n    case 'Int16Array':\n    case 'Uint16Array':\n    case 'Int32Array':\n    case 'Uint32Array':\n    case 'Float32Array':\n    case 'Float64Array':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v.buffer)\n      }\n\n    default:\n      return JSON.stringify(v)\n  }\n}\n\nexport function decodePrimitive (data) {\n  if (typof(data) === 'Object') {\n    // decode base64 into binary\n    if (data['@type'] && data['@type'] === 'binary') {\n      return base64ToBuffer(data.base64 || '')\n    }\n\n    const realData = {}\n    for (const key in data) {\n      realData[key] = decodePrimitive(data[key])\n    }\n    return realData\n  }\n  if (typof(data) === 'Array') {\n    return data.map(decodePrimitive)\n  }\n  return data\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { decodePrimitive } from './normalize'\n\nfunction getHookKey (componentId, type, hookName) {\n  return `${type}@${hookName}#${componentId}`\n}\n\n/**\n * For general callback management of a certain Weex instance.\n * Because function can not passed into native, so we create callback\n * callback id for each function and pass the callback id into native\n * in fact. And when a callback called from native, we can find the real\n * callback through the callback id we have passed before.\n */\nexport default class CallbackManager {\n  constructor (instanceId) {\n    this.instanceId = String(instanceId)\n    this.lastCallbackId = 0\n    this.callbacks = {}\n    this.hooks = {}\n  }\n  add (callback) {\n    this.lastCallbackId++\n    this.callbacks[this.lastCallbackId] = callback\n    return this.lastCallbackId\n  }\n  remove (callbackId) {\n    const callback = this.callbacks[callbackId]\n    delete this.callbacks[callbackId]\n    return callback\n  }\n  registerHook (componentId, type, hookName, hookFunction) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    if (this.hooks[key]) {\n      console.warn(`[JS Framework] Override an existing component hook \"${key}\".`)\n    }\n    this.hooks[key] = hookFunction\n  }\n  triggerHook (componentId, type, hookName, options = {}) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    const hookFunction = this.hooks[key]\n    if (typeof hookFunction !== 'function') {\n      console.error(`[JS Framework] Invalid hook function type (${typeof hookFunction}) on \"${key}\".`)\n      return null\n    }\n    let result = null\n    try {\n      result = hookFunction.apply(null, options.args || [])\n    }\n    catch (e) {\n      console.error(`[JS Framework] Failed to execute the hook function on \"${key}\".`)\n    }\n    return result\n  }\n  consume (callbackId, data, ifKeepAlive) {\n    const callback = this.callbacks[callbackId]\n    if (typeof ifKeepAlive === 'undefined' || ifKeepAlive === false) {\n      delete this.callbacks[callbackId]\n    }\n    if (typeof callback === 'function') {\n      return callback(decodePrimitive(data))\n    }\n    return new Error(`invalid callback id \"${callbackId}\"`)\n  }\n  close () {\n    this.callbacks = {}\n    this.hooks = {}\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst docMap = {}\n\n/**\n * Add a document object into docMap.\n * @param {string} id\n * @param {object} document\n */\nexport function addDoc (id, doc) {\n  if (id) {\n    docMap[id] = doc\n  }\n}\n\n/**\n * Get the document object by id.\n * @param {string} id\n */\nexport function getDoc (id) {\n  return docMap[id]\n}\n\n/**\n * Remove the document from docMap by id.\n * @param {string} id\n */\nexport function removeDoc (id) {\n  delete docMap[id]\n}\n\n/**\n * @deprecated\n * Get listener by document id.\n * @param {string} id\n * @return {object} listener\n */\nexport function getListener (id) {\n  const doc = docMap[id]\n  if (doc && doc.listener) {\n    return doc.listener\n  }\n  return null\n}\n\n/**\n * Get TaskCenter instance by id.\n * @param {string} id\n * @return {object} TaskCenter\n */\nexport function getTaskCenter (id) {\n  const doc = docMap[id]\n  if (doc && doc.taskCenter) {\n    return doc.taskCenter\n  }\n  return null\n}\n\n/**\n * Append body node to documentElement.\n * @param {object} document\n * @param {object} node\n * @param {object} before\n */\nexport function appendBody (doc, node, before) {\n  const { documentElement } = doc\n\n  if (documentElement.pureChildren.length > 0 || node.parentNode) {\n    return\n  }\n  const children = documentElement.children\n  const beforeIndex = children.indexOf(before)\n  if (beforeIndex < 0) {\n    children.push(node)\n  }\n  else {\n    children.splice(beforeIndex, 0, node)\n  }\n\n  if (node.nodeType === 1) {\n    if (node.role === 'body') {\n      node.docId = doc.id\n      node.ownerDocument = doc\n      node.parentNode = documentElement\n      linkParent(node, documentElement)\n    }\n    else {\n      node.children.forEach(child => {\n        child.parentNode = node\n      })\n      setBody(doc, node)\n      node.docId = doc.id\n      node.ownerDocument = doc\n      linkParent(node, documentElement)\n      delete doc.nodeMap[node.nodeId]\n    }\n    documentElement.pureChildren.push(node)\n    sendBody(doc, node)\n  }\n  else {\n    node.parentNode = documentElement\n    doc.nodeMap[node.ref] = node\n  }\n}\n\nfunction sendBody (doc, node) {\n  const body = node.toJSON()\n  if (doc && doc.taskCenter && typeof doc.taskCenter.send === 'function') {\n    doc.taskCenter.send('dom', { action: 'createBody' }, [body])\n  }\n}\n\n/**\n * Set up body node.\n * @param {object} document\n * @param {object} element\n */\nexport function setBody (doc, el) {\n  el.role = 'body'\n  el.depth = 1\n  delete doc.nodeMap[el.nodeId]\n  el.ref = '_root'\n  doc.nodeMap._root = el\n  doc.body = el\n}\n\n/**\n * Establish the connection between parent and child node.\n * @param {object} child node\n * @param {object} parent node\n */\nexport function linkParent (node, parent) {\n  node.parentNode = parent\n  if (parent.docId) {\n    node.docId = parent.docId\n    node.ownerDocument = parent.ownerDocument\n    node.ownerDocument.nodeMap[node.nodeId] = node\n    node.depth = parent.depth + 1\n  }\n  node.children.forEach(child => {\n    linkParent(child, node)\n  })\n}\n\n/**\n * Get the next sibling element.\n * @param {object} node\n */\nexport function nextElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.nextSibling\n  }\n}\n\n/**\n * Get the previous sibling element.\n * @param {object} node\n */\nexport function previousElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.previousSibling\n  }\n}\n\n/**\n * Insert a node into list at the specified index.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function insertIndex (target, list, newIndex, changeSibling) {\n  /* istanbul ignore next */\n  if (newIndex < 0) {\n    newIndex = 0\n  }\n  const before = list[newIndex - 1]\n  const after = list[newIndex]\n  list.splice(newIndex, 0, target)\n  if (changeSibling) {\n    before && (before.nextSibling = target)\n    target.previousSibling = before\n    target.nextSibling = after\n    after && (after.previousSibling = target)\n  }\n  return newIndex\n}\n\n/**\n * Move the node to a new index in list.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function moveIndex (target, list, newIndex, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return -1\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n  let newIndexAfter = newIndex\n  if (index <= newIndex) {\n    newIndexAfter = newIndex - 1\n  }\n  const beforeNew = list[newIndexAfter - 1]\n  const afterNew = list[newIndexAfter]\n  list.splice(newIndexAfter, 0, target)\n  if (changeSibling) {\n    beforeNew && (beforeNew.nextSibling = target)\n    target.previousSibling = beforeNew\n    target.nextSibling = afterNew\n    afterNew && (afterNew.previousSibling = target)\n  }\n  if (index === newIndexAfter) {\n    return -1\n  }\n  return newIndex\n}\n\n/**\n * Remove the node from list.\n * @param {object} target node\n * @param {array} list\n * @param {boolean} changeSibling\n */\nexport function removeIndex (target, list, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { uniqueId } from '../shared/utils'\nimport { getDoc } from './operation'\n\nexport default class Node {\n  constructor () {\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.children = []\n    this.pureChildren = []\n    this.parentNode = null\n    this.nextSibling = null\n    this.previousSibling = null\n  }\n\n  /**\n  * Destroy current node, and remove itself form nodeMap.\n  */\n  destroy () {\n    const doc = getDoc(this.docId)\n    if (doc) {\n      delete this.docId\n      delete doc.nodeMap[this.nodeId]\n    }\n    this.children.forEach(child => {\n      child.destroy()\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getTaskCenter } from './operation'\n\nlet Element\n\nexport function setElement (El) {\n  Element = El\n}\n\n/**\n * A map which stores all type of elements.\n * @type {Object}\n */\nconst registeredElements = {}\n\n/**\n * Register an extended element type with component methods.\n * @param  {string} type    component type\n * @param  {array}  methods a list of method names\n */\nexport function registerElement (type, methods) {\n  // Skip when no special component methods.\n  if (!methods || !methods.length) {\n    return\n  }\n\n  // Init constructor.\n  class WeexElement extends Element {}\n\n  // Add methods to prototype.\n  methods.forEach(methodName => {\n    WeexElement.prototype[methodName] = function (...args) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        return taskCenter.send('component', {\n          ref: this.ref,\n          component: type,\n          method: methodName\n        }, args)\n      }\n    }\n  })\n\n  // Add to element type map.\n  registeredElements[type] = WeexElement\n}\n\nexport function unregisterElement (type) {\n  delete registeredElements[type]\n}\n\nexport function getWeexElement (type) {\n  return registeredElements[type]\n}\n\nexport function isWeexElement (type) {\n  return !!registeredElements[type]\n}\n\n/**\n * Clear all element types. Only for testing.\n */\nexport function clearWeexElements () {\n  for (const type in registeredElements) {\n    unregisterElement(type)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport {\n  getDoc,\n  getTaskCenter,\n  linkParent,\n  nextElement,\n  previousElement,\n  insertIndex,\n  moveIndex,\n  removeIndex\n} from './operation'\nimport { uniqueId, isEmpty } from '../shared/utils'\nimport { getWeexElement, setElement } from './WeexElement'\n\nconst DEFAULT_TAG_NAME = 'div'\nconst BUBBLE_EVENTS = [\n  'click', 'longpress', 'touchstart', 'touchmove', 'touchend',\n  'panstart', 'panmove', 'panend', 'horizontalpan', 'verticalpan', 'swipe'\n]\n\nfunction registerNode (docId, node) {\n  const doc = getDoc(docId)\n  doc.nodeMap[node.nodeId] = node\n}\n\nexport default class Element extends Node {\n  constructor (type = DEFAULT_TAG_NAME, props, isExtended) {\n    super()\n\n    const WeexElement = getWeexElement(type)\n    if (WeexElement && !isExtended) {\n      return new WeexElement(type, props, true)\n    }\n\n    props = props || {}\n    this.nodeType = 1\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = type\n    this.attr = props.attr || {}\n    this.style = props.style || {}\n    this.classStyle = props.classStyle || {}\n    this.event = {}\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n   * Append a child node.\n   * @param {object} node\n   * @return {undefined | number} the signal sent by native\n   */\n  appendChild (node) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    /* istanbul ignore else */\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.length, true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        insertIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), -1]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.length, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node before specified node.\n   * @param {object} node\n   * @param {object} before\n   * @return {undefined | number} the signal sent by native\n   */\n  insertBefore (node, before) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === before || (node.nextSibling && node.nextSibling === before)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(before), true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(before), true)\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        /* istanbul ignore next */\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node after specified node.\n   * @param {object} node\n   * @param {object} after\n   * @return {undefined | number} the signal sent by native\n   */\n  insertAfter (node, after) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === after || (node.previousSibling && node.previousSibling === after)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      /* istanbul ignore else */\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        /* istanbul ignore else */\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove a child node, and decide whether it should be destroyed.\n   * @param {object} node\n   * @param {boolean} preserved\n   */\n  removeChild (node, preserved) {\n    if (node.parentNode) {\n      removeIndex(node, this.children, true)\n      if (node.nodeType === 1) {\n        removeIndex(node, this.pureChildren)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          taskCenter.send(\n            'dom',\n            { action: 'removeElement' },\n            [node.ref]\n          )\n        }\n      }\n    }\n    if (!preserved) {\n      node.destroy()\n    }\n  }\n\n  /**\n   * Clear all child nodes.\n   */\n  clear () {\n    const taskCenter = getTaskCenter(this.docId)\n    /* istanbul ignore else */\n    if (taskCenter) {\n      this.pureChildren.forEach(node => {\n        taskCenter.send(\n          'dom',\n          { action: 'removeElement' },\n          [node.ref]\n        )\n      })\n    }\n    this.children.forEach(node => {\n      node.destroy()\n    })\n    this.children.length = 0\n    this.pureChildren.length = 0\n  }\n\n  /**\n   * Set an attribute, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setAttr (key, value, silent) {\n    if (this.attr[key] === value && silent !== false) {\n      return\n    }\n    this.attr[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateAttrs' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched attributes.\n   * @param {object} batchedAttrs\n   * @param {boolean} silent\n   */\n  setAttrs (batchedAttrs, silent) {\n    if (isEmpty(batchedAttrs)) return\n    const mutations = {}\n    for (const key in batchedAttrs) {\n      if (this.attr[key] !== batchedAttrs[key]) {\n        this.attr[key] = batchedAttrs[key]\n        mutations[key] = batchedAttrs[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateAttrs' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * Set a style property, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setStyle (key, value, silent) {\n    if (this.style[key] === value && silent !== false) {\n      return\n    }\n    this.style[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched style properties.\n   * @param {object} batchedStyles\n   * @param {boolean} silent\n   */\n  setStyles (batchedStyles, silent) {\n    if (isEmpty(batchedStyles)) return\n    const mutations = {}\n    for (const key in batchedStyles) {\n      if (this.style[key] !== batchedStyles[key]) {\n        this.style[key] = batchedStyles[key]\n        mutations[key] = batchedStyles[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateStyle' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * Set style properties from class.\n   * @param {object} classStyle\n   */\n  setClassStyle (classStyle) {\n    // reset previous class style to empty string\n    for (const key in this.classStyle) {\n      this.classStyle[key] = ''\n    }\n\n    Object.assign(this.classStyle, classStyle)\n    const taskCenter = getTaskCenter(this.docId)\n    if (taskCenter) {\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, this.toStyle()]\n      )\n    }\n  }\n\n  /**\n   * Add an event handler.\n   * @param {string} event type\n   * @param {function} event handler\n   */\n  addEvent (type, handler, params) {\n    if (!this.event) {\n      this.event = {}\n    }\n    if (!this.event[type]) {\n      this.event[type] = { handler, params }\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'addEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Remove an event handler.\n   * @param {string} event type\n   */\n  removeEvent (type) {\n    if (this.event && this.event[type]) {\n      delete this.event[type]\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'removeEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Fire an event manually.\n   * @param {string} type type\n   * @param {function} event handler\n   * @param {boolean} isBubble whether or not event bubble\n   * @param {boolean} options\n   * @return {} anything returned by handler function\n   */\n  fireEvent (type, event, isBubble, options) {\n    let result = null\n    let isStopPropagation = false\n    const eventDesc = this.event[type]\n    if (eventDesc && event) {\n      const handler = eventDesc.handler\n      event.stopPropagation = () => {\n        isStopPropagation = true\n      }\n      if (options && options.params) {\n        result = handler.call(this, ...options.params, event)\n      }\n      else {\n        result = handler.call(this, event)\n      }\n    }\n\n    if (!isStopPropagation\n      && isBubble\n      && (BUBBLE_EVENTS.indexOf(type) !== -1)\n      && this.parentNode\n      && this.parentNode.fireEvent) {\n      event.currentTarget = this.parentNode\n      this.parentNode.fireEvent(type, event, isBubble) // no options\n    }\n\n    return result\n  }\n\n  /**\n   * Get all styles of current element.\n   * @return {object} style\n   */\n  toStyle () {\n    return Object.assign({}, this.classStyle, this.style)\n  }\n\n  /**\n   * Convert current element to JSON like object.\n   * @return {object} element\n   */\n  toJSON () {\n    const result = {\n      ref: this.ref.toString(),\n      type: this.type,\n      attr: this.attr,\n      style: this.toStyle()\n    }\n    const event = []\n    for (const type in this.event) {\n      const { params } = this.event[type]\n      if (!params) {\n        event.push(type)\n      }\n      else {\n        event.push({ type, params })\n      }\n    }\n    if (event.length) {\n      result.event = event\n    }\n    if (this.pureChildren.length) {\n      result.children = this.pureChildren.map((child) => child.toJSON())\n    }\n    return result\n  }\n\n  /**\n   * Convert to HTML element tag string.\n   * @return {stirng} html\n   */\n  toString () {\n    return '<' + this.type +\n    ' attr=' + JSON.stringify(this.attr) +\n    ' style=' + JSON.stringify(this.toStyle()) + '>' +\n    this.pureChildren.map((child) => child.toString()).join('') +\n    '</' + this.type + '>'\n  }\n}\n\nsetElement(Element)\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CallbackManager from './CallbackManager'\nimport Element from '../vdom/Element'\nimport { typof } from '../shared/utils'\nimport { normalizePrimitive } from './normalize'\n\nlet fallback = function () {}\n\n// The API of TaskCenter would be re-design.\nexport class TaskCenter {\n  constructor (id, sendTasks) {\n    Object.defineProperty(this, 'instanceId', {\n      enumerable: true,\n      value: String(id)\n    })\n    Object.defineProperty(this, 'callbackManager', {\n      enumerable: true,\n      value: new CallbackManager(id)\n    })\n    fallback = sendTasks || function () {}\n  }\n\n  callback (callbackId, data, ifKeepAlive) {\n    return this.callbackManager.consume(callbackId, data, ifKeepAlive)\n  }\n\n  registerHook (...args) {\n    return this.callbackManager.registerHook(...args)\n  }\n\n  triggerHook (...args) {\n    return this.callbackManager.triggerHook(...args)\n  }\n\n  updateData (componentId, newData, callback) {\n    this.send('module', {\n      module: 'dom',\n      method: 'updateComponentData'\n    }, [componentId, newData, callback])\n  }\n\n  destroyCallback () {\n    return this.callbackManager.close()\n  }\n\n  /**\n   * Normalize a value. Specially, if the value is a function, then generate a function id\n   * and save it to `CallbackManager`, at last return the function id.\n   * @param  {any}        v\n   * @return {primitive}\n   */\n  normalize (v) {\n    const type = typof(v)\n    if (v && v instanceof Element) {\n      return v.ref\n    }\n    if (v && v._isVue && v.$el instanceof Element) {\n      return v.$el.ref\n    }\n    if (type === 'Function') {\n      return this.callbackManager.add(v).toString()\n    }\n    return normalizePrimitive(v)\n  }\n\n  send (type, params, args, options) {\n    const { action, component, ref, module, method } = params\n\n    args = args.map(arg => this.normalize(arg))\n\n    switch (type) {\n      case 'dom':\n        return this[action](this.instanceId, args)\n      case 'component':\n        return this.componentHandler(this.instanceId, ref, method, args, Object.assign({ component }, options))\n      default:\n        return this.moduleHandler(this.instanceId, module, method, args, options)\n    }\n  }\n\n  callDOM (action, args) {\n    return this[action](this.instanceId, args)\n  }\n\n  callComponent (ref, method, args, options) {\n    return this.componentHandler(this.instanceId, ref, method, args, options)\n  }\n\n  callModule (module, method, args, options) {\n    return this.moduleHandler(this.instanceId, module, method, args, options)\n  }\n}\n\nexport function init () {\n  const DOM_METHODS = {\n    createFinish: global.callCreateFinish,\n    updateFinish: global.callUpdateFinish,\n    refreshFinish: global.callRefreshFinish,\n\n    createBody: global.callCreateBody,\n\n    addElement: global.callAddElement,\n    removeElement: global.callRemoveElement,\n    moveElement: global.callMoveElement,\n    updateAttrs: global.callUpdateAttrs,\n    updateStyle: global.callUpdateStyle,\n\n    addEvent: global.callAddEvent,\n    removeEvent: global.callRemoveEvent\n  }\n  const proto = TaskCenter.prototype\n\n  for (const name in DOM_METHODS) {\n    const method = DOM_METHODS[name]\n    proto[name] = method ?\n      (id, args) => method(id, ...args) :\n      (id, args) => fallback(id, [{ module: 'dom', method: name, args }], '-1')\n  }\n\n  proto.componentHandler = global.callNativeComponent ||\n    ((id, ref, method, args, options) =>\n      fallback(id, [{ component: options.component, ref, method, args }]))\n\n  proto.moduleHandler = global.callNativeModule ||\n    ((id, module, method, args) =>\n      fallback(id, [{ module, method, args }]))\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getDoc } from '../vdom/operation'\n\nfunction fireEvent (document, nodeId, type, event, domChanges, params) {\n  const el = document.getRef(nodeId)\n  if (el) {\n    return document.fireEvent(el, type, event, domChanges, params)\n  }\n  return new Error(`invalid element reference \"${nodeId}\"`)\n}\n\nfunction callback (document, callbackId, data, ifKeepAlive) {\n  return document.taskCenter.callback(callbackId, data, ifKeepAlive)\n}\n\nfunction componentHook (document, componentId, type, hook, options) {\n  if (!document || !document.taskCenter) {\n    console.error(`[JS Framework] Can't find \"document\" or \"taskCenter\".`)\n    return null\n  }\n  let result = null\n  try {\n    result = document.taskCenter.triggerHook(componentId, type, hook, options)\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to trigger the \"${type}@${hook}\" hook on ${componentId}.`)\n  }\n  return result\n}\n\n/**\n * Accept calls from native (event or callback).\n *\n * @param  {string} id\n * @param  {array} tasks list with `method` and `args`\n */\nexport function receiveTasks (id, tasks) {\n  const document = getDoc(id)\n  if (!document) {\n    return new Error(`[JS Framework] Failed to receiveTasks, `\n      + `instance (${id}) is not available.`)\n  }\n  if (Array.isArray(tasks)) {\n    return tasks.map(task => {\n      switch (task.method) {\n        case 'callback': return callback(document, ...task.args)\n        case 'fireEventSync':\n        case 'fireEvent': return fireEvent(document, ...task.args)\n        case 'componentHook': return componentHook(document, ...task.args)\n      }\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst weexModules = {}\n\n/**\n * Register native modules information.\n * @param {object} newModules\n */\nexport function registerModules (newModules) {\n  for (const name in newModules) {\n    if (!weexModules[name]) {\n      weexModules[name] = {}\n    }\n    newModules[name].forEach(method => {\n      if (typeof method === 'string') {\n        weexModules[name][method] = true\n      }\n      else {\n        weexModules[name][method.name] = method.args\n      }\n    })\n  }\n}\n\n/**\n * Check whether the module or the method has been registered.\n * @param {String} module name\n * @param {String} method name (optional)\n */\nexport function isRegisteredModule (name, method) {\n  if (typeof method === 'string') {\n    return !!(weexModules[name] && weexModules[name][method])\n  }\n  return !!weexModules[name]\n}\n\nexport function getModuleDescription (name) {\n  return weexModules[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { registerElement } from '../vdom/WeexElement'\n\nconst weexComponents = {}\n\n/**\n * Register native components information.\n * @param {array} newComponents\n */\nexport function registerComponents (newComponents) {\n  if (Array.isArray(newComponents)) {\n    newComponents.forEach(component => {\n      if (!component) {\n        return\n      }\n      if (typeof component === 'string') {\n        weexComponents[component] = true\n      }\n      else if (typeof component === 'object' && typeof component.type === 'string') {\n        weexComponents[component.type] = component\n        registerElement(component.type, component.methods)\n      }\n    })\n  }\n}\n\n/**\n * Check whether the component has been registered.\n * @param {String} component name\n */\nexport function isRegisteredComponent (name) {\n  return !!weexComponents[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// JS Services\n\nexport const services = []\n\n/**\n * Register a JavaScript service.\n * A JavaScript service options could have a set of lifecycle methods\n * for each Weex instance. For example: create, refresh, destroy.\n * For the JS framework maintainer if you want to supply some features\n * which need to work well in different Weex instances, even in different\n * frameworks separately. You can make a JavaScript service to init\n * its variables or classes for each Weex instance when it's created\n * and recycle them when it's destroyed.\n * @param {object} options Could have { create, refresh, destroy }\n *                         lifecycle methods. In create method it should\n *                         return an object of what variables or classes\n *                         would be injected into the Weex instance.\n */\nexport function register (name, options) {\n  if (has(name)) {\n    console.warn(`Service \"${name}\" has been registered already!`)\n  }\n  else {\n    options = Object.assign({}, options)\n    services.push({ name, options })\n  }\n}\n\n/**\n * Unregister a JavaScript service by name\n * @param {string} name\n */\nexport function unregister (name) {\n  services.some((service, index) => {\n    if (service.name === name) {\n      services.splice(index, 1)\n      return true\n    }\n  })\n}\n\n/**\n * Check if a JavaScript service with a certain name existed.\n * @param  {string}  name\n * @return {Boolean}\n */\nexport function has (name) {\n  return indexOf(name) >= 0\n}\n\n/**\n * Find the index of a JavaScript service by name\n * @param  {string} name\n * @return {number}\n */\nfunction indexOf (name) {\n  return services.map(service => service.name).indexOf(name)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport { uniqueId } from '../shared/utils'\n\nexport default class Comment extends Node {\n  constructor (value) {\n    super()\n\n    this.nodeType = 8\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = 'comment'\n    this.value = value\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n  * Convert to HTML comment string.\n  * @return {stirng} html\n  */\n  toString () {\n    return '<!-- ' + this.value + ' -->'\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n* Create the action object.\n* @param {string} name\n* @param {array} arguments\n* @return {object} action\n*/\nfunction createAction (name, args = []) {\n  return { module: 'dom', method: name, args: args }\n}\n\nexport default class Listener {\n  constructor (id, handler) {\n    this.id = id\n    this.batched = false\n    this.updates = []\n    if (typeof handler === 'function') {\n      Object.defineProperty(this, 'handler', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: handler\n      })\n    }\n    else {\n      console.error('[JS Runtime] invalid parameter, handler must be a function')\n    }\n  }\n\n  /**\n   * Send the \"createFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  createFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('createFinish')], callback)\n  }\n\n  /**\n   * Send the \"updateFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  updateFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('updateFinish')], callback)\n  }\n\n  /**\n   * Send the \"refreshFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  refreshFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('refreshFinish')], callback)\n  }\n\n  /**\n   * Send the \"createBody\" signal.\n   * @param {object} element\n   * @return {undefined | number} the signal sent by native\n   */\n  createBody (element) {\n    const body = element.toJSON()\n    const children = body.children\n    delete body.children\n    const actions = [createAction('createBody', [body])]\n    if (children) {\n      actions.push.apply(actions, children.map(child => {\n        return createAction('addElement', [body.ref, child, -1])\n      }))\n    }\n    return this.addActions(actions)\n  }\n\n  /**\n   * Send the \"addElement\" signal.\n   * @param {object} element\n   * @param {stirng} reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  addElement (element, ref, index) {\n    if (!(index >= 0)) {\n      index = -1\n    }\n    return this.addActions(createAction('addElement', [ref, element.toJSON(), index]))\n  }\n\n  /**\n   * Send the \"removeElement\" signal.\n   * @param {stirng} reference id\n   * @return {undefined | number} the signal sent by native\n   */\n  removeElement (ref) {\n    if (Array.isArray(ref)) {\n      const actions = ref.map((r) => createAction('removeElement', [r]))\n      return this.addActions(actions)\n    }\n    return this.addActions(createAction('removeElement', [ref]))\n  }\n\n  /**\n   * Send the \"moveElement\" signal.\n   * @param {stirng} target reference id\n   * @param {stirng} parent reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  moveElement (targetRef, parentRef, index) {\n    return this.addActions(createAction('moveElement', [targetRef, parentRef, index]))\n  }\n\n  /**\n   * Send the \"updateAttrs\" signal.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setAttr (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateAttrs', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal, update a sole style.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyle (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateStyle', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal.\n   * @param {stirng} reference id\n   * @param {object} style\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyles (ref, style) {\n    return this.addActions(createAction('updateStyle', [ref, style]))\n  }\n\n  /**\n   * Send the \"addEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  addEvent (ref, type) {\n    return this.addActions(createAction('addEvent', [ref, type]))\n  }\n\n  /**\n   * Send the \"removeEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  removeEvent (ref, type) {\n    return this.addActions(createAction('removeEvent', [ref, type]))\n  }\n\n  /**\n   * Default handler.\n   * @param {object | array} actions\n   * @param {function} callback\n   * @return {} anything returned by callback function\n   */\n  handler (actions, cb) {\n    return cb && cb()\n  }\n\n  /**\n   * Add actions into updates.\n   * @param {object | array} actions\n   * @return {undefined | number} the signal sent by native\n   */\n  addActions (actions) {\n    const updates = this.updates\n    const handler = this.handler\n\n    if (!Array.isArray(actions)) {\n      actions = [actions]\n    }\n\n    if (this.batched) {\n      updates.push.apply(updates, actions)\n    }\n    else {\n      return handler(actions)\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * Task handler for communication between javascript and native.\n */\n\nconst handlerMap = {\n  createBody: 'callCreateBody',\n  addElement: 'callAddElement',\n  removeElement: 'callRemoveElement',\n  moveElement: 'callMoveElement',\n  updateAttrs: 'callUpdateAttrs',\n  updateStyle: 'callUpdateStyle',\n  addEvent: 'callAddEvent',\n  removeEvent: 'callRemoveEvent'\n}\n\n/**\n * Create a task handler.\n * @param {string} id\n * @param {function} handler\n * @return {function} taskHandler\n */\nexport function createHandler (id, handler) {\n  const defaultHandler = handler || global.callNative\n\n  /* istanbul ignore if */\n  if (typeof defaultHandler !== 'function') {\n    console.error('[JS Runtime] no default handler')\n  }\n\n  return function taskHandler (tasks) {\n    /* istanbul ignore if */\n    if (!Array.isArray(tasks)) {\n      tasks = [tasks]\n    }\n    for (let i = 0; i < tasks.length; i++) {\n      const returnValue = dispatchTask(id, tasks[i], defaultHandler)\n      if (returnValue === -1) {\n        return returnValue\n      }\n    }\n  }\n}\n\n/**\n * Check if there is a corresponding available handler in the environment.\n * @param {string} module\n * @param {string} method\n * @return {boolean}\n */\nfunction hasAvailableHandler (module, method) {\n  return module === 'dom'\n    && handlerMap[method]\n    && typeof global[handlerMap[method]] === 'function'\n}\n\n/**\n * Dispatch the task to the specified handler.\n * @param {string} id\n * @param {object} task\n * @param {function} defaultHandler\n * @return {number} signal returned from native\n */\nfunction dispatchTask (id, task, defaultHandler) {\n  const { module, method, args } = task\n\n  if (hasAvailableHandler(module, method)) {\n    return global[handlerMap[method]](id, ...args, '-1')\n  }\n\n  return defaultHandler(id, [task], '-1')\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Comment from './Comment'\nimport Element from './Element'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\nimport { createHandler } from '../bridge/Handler'\nimport { addDoc, removeDoc, appendBody, setBody } from './operation'\n\n/**\n * Update all changes for an element.\n * @param {object} element\n * @param {object} changes\n */\nfunction updateElement (el, changes) {\n  const attrs = changes.attrs || {}\n  for (const name in attrs) {\n    el.setAttr(name, attrs[name], true)\n  }\n  const style = changes.style || {}\n  for (const name in style) {\n    el.setStyle(name, style[name], true)\n  }\n}\n\nexport default class Document {\n  constructor (id, url, handler) {\n    id = id ? id.toString() : ''\n    this.id = id\n    this.URL = url\n\n    addDoc(id, this)\n    this.nodeMap = {}\n    const L = Document.Listener || Listener\n    this.listener = new L(id, handler || createHandler(id, Document.handler)) // deprecated\n    this.taskCenter = new TaskCenter(id, handler ? (id, ...args) => handler(...args) : Document.handler)\n    this.createDocumentElement()\n  }\n\n  /**\n  * Get the node from nodeMap.\n  * @param {string} reference id\n  * @return {object} node\n  */\n  getRef (ref) {\n    return this.nodeMap[ref]\n  }\n\n  /**\n  * Turn on batched updates.\n  */\n  open () {\n    this.listener.batched = false\n  }\n\n  /**\n  * Turn off batched updates.\n  */\n  close () {\n    this.listener.batched = true\n  }\n\n  /**\n  * Create the document element.\n  * @return {object} documentElement\n  */\n  createDocumentElement () {\n    if (!this.documentElement) {\n      const el = new Element('document')\n      el.docId = this.id\n      el.ownerDocument = this\n      el.role = 'documentElement'\n      el.depth = 0\n      el.ref = '_documentElement'\n      this.nodeMap._documentElement = el\n      this.documentElement = el\n\n      Object.defineProperty(el, 'appendChild', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node) => {\n          appendBody(this, node)\n        }\n      })\n\n      Object.defineProperty(el, 'insertBefore', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node, before) => {\n          appendBody(this, node, before)\n        }\n      })\n    }\n\n    return this.documentElement\n  }\n\n  /**\n  * Create the body element.\n  * @param {string} type\n  * @param {objct} props\n  * @return {object} body element\n  */\n  createBody (type, props) {\n    if (!this.body) {\n      const el = new Element(type, props)\n      setBody(this, el)\n    }\n\n    return this.body\n  }\n\n  /**\n  * Create an element.\n  * @param {string} tagName\n  * @param {objct} props\n  * @return {object} element\n  */\n  createElement (tagName, props) {\n    return new Element(tagName, props)\n  }\n\n  /**\n  * Create an comment.\n  * @param {string} text\n  * @return {object} comment\n  */\n  createComment (text) {\n    return new Comment(text)\n  }\n\n  /**\n  * Fire an event on specified element manually.\n  * @param {object} element\n  * @param {string} event type\n  * @param {object} event object\n  * @param {object} dom changes\n  * @param {object} options\n  * @return {} anything returned by handler function\n  */\n  fireEvent (el, type, event, domChanges, options) {\n    if (!el) {\n      return\n    }\n    event = event || {}\n    event.type = event.type || type\n    event.target = el\n    event.currentTarget = el\n    event.timestamp = Date.now()\n    if (domChanges) {\n      updateElement(el, domChanges)\n    }\n    const isBubble = this.getRef('_root').attr['bubble'] === 'true'\n    return el.fireEvent(type, event, isBubble, options)\n  }\n\n  /**\n  * Destroy current document, and remove itself form docMap.\n  */\n  destroy () {\n    this.taskCenter.destroyCallback()\n    delete this.listener\n    delete this.nodeMap\n    delete this.taskCenter\n    removeDoc(this.id)\n  }\n}\n\n// default task handler\nDocument.handler = null\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Document from '../vdom/Document'\nimport { isRegisteredModule, getModuleDescription } from './module'\nimport { isRegisteredComponent } from './component'\nimport { getTaskCenter } from '../vdom/operation'\n\nconst moduleProxies = {}\n\nfunction setId (weex, id) {\n  Object.defineProperty(weex, '[[CurrentInstanceId]]', { value: id })\n}\n\nfunction getId (weex) {\n  return weex['[[CurrentInstanceId]]']\n}\n\nfunction moduleGetter (id, module, method) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  return (...args) => taskCenter.send('module', { module, method }, args)\n}\n\nfunction moduleSetter (id, module, method, fn) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  if (typeof fn !== 'function') {\n    console.error(`[JS Framework] ${module}.${method} must be assigned as a function.`)\n    return null\n  }\n  return fn => taskCenter.send('module', { module, method }, [fn])\n}\n\nexport default class WeexInstance {\n  constructor (id, config) {\n    setId(this, String(id))\n    this.config = config || {}\n    this.document = new Document(id, this.config.bundleUrl)\n    this.requireModule = this.requireModule.bind(this)\n    this.isRegisteredModule = isRegisteredModule\n    this.isRegisteredComponent = isRegisteredComponent\n  }\n\n  requireModule (moduleName) {\n    const id = getId(this)\n    if (!(id && this.document && this.document.taskCenter)) {\n      console.error(`[JS Framework] Failed to requireModule(\"${moduleName}\"), `\n        + `instance (${id}) doesn't exist anymore.`)\n      return\n    }\n\n    // warn for unknown module\n    if (!isRegisteredModule(moduleName)) {\n      console.warn(`[JS Framework] using unregistered weex module \"${moduleName}\"`)\n      return\n    }\n\n    // create new module proxy\n    const proxyName = `${moduleName}#${id}`\n    if (!moduleProxies[proxyName]) {\n      // create registered module apis\n      const moduleDefine = getModuleDescription(moduleName)\n      const moduleApis = {}\n      for (const methodName in moduleDefine) {\n        Object.defineProperty(moduleApis, methodName, {\n          enumerable: true,\n          configurable: true,\n          get: () => moduleGetter(id, moduleName, methodName),\n          set: fn => moduleSetter(id, moduleName, methodName, fn)\n        })\n      }\n\n      // create module Proxy\n      if (typeof Proxy === 'function') {\n        moduleProxies[proxyName] = new Proxy(moduleApis, {\n          get (target, methodName) {\n            if (methodName in target) {\n              return target[methodName]\n            }\n            console.warn(`[JS Framework] using unregistered method \"${moduleName}.${methodName}\"`)\n            return moduleGetter(id, moduleName, methodName)\n          }\n        })\n      }\n      else {\n        moduleProxies[proxyName] = moduleApis\n      }\n    }\n\n    return moduleProxies[proxyName]\n  }\n\n  supports (condition) {\n    if (typeof condition !== 'string') return null\n\n    const res = condition.match(/^@(\\w+)\\/(\\w+)(\\.(\\w+))?$/i)\n    if (res) {\n      const type = res[1]\n      const name = res[2]\n      const method = res[4]\n      switch (type) {\n        case 'module': return isRegisteredModule(name, method)\n        case 'component': return isRegisteredComponent(name)\n      }\n    }\n\n    return null\n  }\n\n  // registerStyleSheet (styles) {\n  //   if (this.document) {\n  //     this.document.registerStyleSheet(styles)\n  //   }\n  // }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { init as initTaskHandler } from '../bridge/TaskCenter'\nimport { receiveTasks } from '../bridge/receiver'\nimport { registerModules } from './module'\nimport { registerComponents } from './component'\nimport { services, register, unregister } from './service'\nimport { track } from '../bridge/debug'\nimport WeexInstance from './WeexInstance'\nimport { getDoc } from '../vdom/operation'\n\nlet frameworks\nlet runtimeConfig\n\nconst versionRegExp = /^\\s*\\/\\/ *(\\{[^}]*\\}) *\\r?\\n/\n\n/**\n * Detect a JS Bundle code and make sure which framework it's based to. Each JS\n * Bundle should make sure that it starts with a line of JSON comment and is\n * more that one line.\n * @param  {string} code\n * @return {object}\n */\nfunction getBundleType (code) {\n  const result = versionRegExp.exec(code)\n  if (result) {\n    try {\n      const info = JSON.parse(result[1])\n      return info.framework\n    }\n    catch (e) {}\n  }\n\n  // default bundle type\n  return 'Weex'\n}\n\nfunction createServices (id, env, config) {\n  // Init JavaScript services for this instance.\n  const serviceMap = Object.create(null)\n  serviceMap.service = Object.create(null)\n  services.forEach(({ name, options }) => {\n    if (process.env.NODE_ENV === 'development') {\n      console.debug(`[JS Runtime] create service ${name}.`)\n    }\n    const create = options.create\n    if (create) {\n      try {\n        const result = create(id, env, config)\n        Object.assign(serviceMap.service, result)\n        Object.assign(serviceMap, result.instance)\n      }\n      catch (e) {\n        console.error(`[JS Runtime] Failed to create service ${name}.`)\n      }\n    }\n  })\n  delete serviceMap.service.instance\n  Object.freeze(serviceMap.service)\n  return serviceMap\n}\n\nconst instanceTypeMap = {}\nfunction getFrameworkType (id) {\n  return instanceTypeMap[id]\n}\n\nfunction createInstanceContext (id, options = {}, data) {\n  const weex = new WeexInstance(id, options)\n  Object.freeze(weex)\n\n  const bundleType = options.bundleType || 'Vue'\n  instanceTypeMap[id] = bundleType\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  track(id, 'bundleType', bundleType)\n\n  // prepare js service\n  const services = createServices(id, {\n    weex,\n    config: options,\n    created: Date.now(),\n    framework: bundleType,\n    bundleType\n  }, runtimeConfig)\n  Object.freeze(services)\n\n  // prepare runtime context\n  const runtimeContext = Object.create(null)\n  Object.assign(runtimeContext, services, {\n    weex,\n    services // Temporary compatible with some legacy APIs in Rax\n  })\n  Object.freeze(runtimeContext)\n\n  // prepare instance context\n  const instanceContext = Object.assign({}, runtimeContext)\n  if (typeof framework.createInstanceContext === 'function') {\n    Object.assign(instanceContext, framework.createInstanceContext(id, runtimeContext, data))\n  }\n  Object.freeze(instanceContext)\n  return instanceContext\n}\n\n/**\n * Check which framework a certain JS Bundle code based to. And create instance\n * by this framework.\n * @param {string} id\n * @param {string} code\n * @param {object} config\n * @param {object} data\n */\nfunction createInstance (id, code, config, data) {\n  if (instanceTypeMap[id]) {\n    return new Error(`The instance id \"${id}\" has already been used!`)\n  }\n\n  // Init instance info.\n  const bundleType = getBundleType(code)\n  instanceTypeMap[id] = bundleType\n\n  // Init instance config.\n  config = JSON.parse(JSON.stringify(config || {}))\n  config.env = JSON.parse(JSON.stringify(global.WXEnvironment || {}))\n  config.bundleType = bundleType\n\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  if (bundleType === 'Weex') {\n    console.error(`[JS Framework] COMPATIBILITY WARNING: `\n      + `Weex DSL 1.0 (.we) framework is no longer supported! `\n      + `It will be removed in the next version of WeexSDK, `\n      + `your page would be crash if you still using the \".we\" framework. `\n      + `Please upgrade it to Vue.js or Rax.`)\n  }\n\n  const instanceContext = createInstanceContext(id, config, data)\n  if (typeof framework.createInstance === 'function') {\n    // Temporary compatible with some legacy APIs in Rax,\n    // some Rax page is using the legacy \".we\" framework.\n    if (bundleType === 'Rax' || bundleType === 'Weex') {\n      const raxInstanceContext = Object.assign({\n        config,\n        created: Date.now(),\n        framework: bundleType\n      }, instanceContext)\n      return framework.createInstance(id, code, config, data, raxInstanceContext)\n    }\n    return framework.createInstance(id, code, config, data, instanceContext)\n  }\n  // console.error(`[JS Framework] Can't find available \"createInstance\" method in ${bundleType}!`)\n  runInContext(code, instanceContext)\n}\n\n/**\n * Run js code in a specific context.\n * @param {string} code\n * @param {object} context\n */\nfunction runInContext (code, context) {\n  const keys = []\n  const args = []\n  for (const key in context) {\n    keys.push(key)\n    args.push(context[key])\n  }\n\n  const bundle = `\n    (function (global) {\n      ${code}\n    })(Object.create(this))\n  `\n\n  return (new Function(...keys, bundle))(...args)\n}\n\n/**\n * Get the JSON object of the root element.\n * @param {string} instanceId\n */\nfunction getRoot (instanceId) {\n  const document = getDoc(instanceId)\n  try {\n    if (document && document.body) {\n      return document.body.toJSON()\n    }\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to get the virtual dom tree.`)\n    return\n  }\n}\n\nconst methods = {\n  createInstance,\n  createInstanceContext,\n  getRoot,\n  getDocument: getDoc,\n  registerService: register,\n  unregisterService: unregister,\n  callJS (id, tasks) {\n    const framework = frameworks[getFrameworkType(id)]\n    if (framework && typeof framework.receiveTasks === 'function') {\n      return framework.receiveTasks(id, tasks)\n    }\n    return receiveTasks(id, tasks)\n  }\n}\n\n/**\n * Register methods which will be called for each instance.\n * @param {string} methodName\n */\nfunction genInstance (methodName) {\n  methods[methodName] = function (...args) {\n    const id = args[0]\n    const type = getFrameworkType(id)\n    if (type && frameworks[type]) {\n      const result = frameworks[type][methodName](...args)\n      const info = { framework: type }\n\n      // Lifecycle methods\n      if (methodName === 'refreshInstance') {\n        services.forEach(service => {\n          const refresh = service.options.refresh\n          if (refresh) {\n            refresh(id, { info, runtime: runtimeConfig })\n          }\n        })\n      }\n      else if (methodName === 'destroyInstance') {\n        services.forEach(service => {\n          const destroy = service.options.destroy\n          if (destroy) {\n            destroy(id, { info, runtime: runtimeConfig })\n          }\n        })\n        delete instanceTypeMap[id]\n      }\n\n      return result\n    }\n    return new Error(`[JS Framework] Using invalid instance id `\n      + `\"${id}\" when calling ${methodName}.`)\n  }\n}\n\n/**\n * Register methods which init each frameworks.\n * @param {string} methodName\n * @param {function} sharedMethod\n */\nfunction adaptMethod (methodName, sharedMethod) {\n  methods[methodName] = function (...args) {\n    if (typeof sharedMethod === 'function') {\n      sharedMethod(...args)\n    }\n\n    // TODO: deprecated\n    for (const name in runtimeConfig.frameworks) {\n      const framework = runtimeConfig.frameworks[name]\n      if (framework && framework[methodName]) {\n        framework[methodName](...args)\n      }\n    }\n  }\n}\n\nexport default function init (config) {\n  runtimeConfig = config || {}\n  frameworks = runtimeConfig.frameworks || {}\n  initTaskHandler()\n\n  // Init each framework by `init` method and `config` which contains three\n  // virtual-DOM Class: `Document`, `Element` & `Comment`, and a JS bridge method:\n  // `sendTasks(...args)`.\n  for (const name in frameworks) {\n    const framework = frameworks[name]\n    if (typeof framework.init === 'function') {\n      try {\n        framework.init(config)\n      }\n      catch (e) {}\n    }\n  }\n\n  adaptMethod('registerComponents', registerComponents)\n  adaptMethod('registerModules', registerModules)\n  adaptMethod('registerMethods')\n\n  ; ['destroyInstance', 'refreshInstance'].forEach(genInstance)\n\n  return methods\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getTaskCenter } from '../vdom/operation'\nimport { isRegisteredModule } from '../api/module'\n\nexport function track (id, type, value) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to create tracker!`)\n    return\n  }\n  if (!type || !value) {\n    console.warn(`[JS Framework] Invalid track type (${type}) or value (${value})`)\n    return\n  }\n  const label = `jsfm.${type}.${value}`\n  try {\n    if (isRegisteredModule('userTrack', 'addPerfPoint')) {\n      const message = Object.create(null)\n      message[label] = '4'\n      taskCenter.send('module', {\n        module: 'userTrack',\n        method: 'addPerfPoint'\n      }, [message])\n    }\n  }\n  catch (err) {\n    console.error(`[JS Framework] Failed to trace \"${label}\"!`)\n  }\n}\n\nexport function error (...messages) {\n  if (typeof console.error === 'function') {\n    console.error(`[JS Framework] `, ...messages)\n  }\n}\n\nexport function handleException (err) {\n  if (typeof console.error === 'function') {\n    try {\n      console.error(err.toString())\n    }\n    catch (e) {}\n  }\n  if (process.env.NODE_ENV !== 'production') {\n    throw err\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Document, Element, Comment } from '../vdom'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\n\nconst config = {\n  Document, Element, Comment, Listener,\n  TaskCenter,\n  sendTasks (...args) {\n    if (typeof callNative === 'function') {\n      return callNative(...args)\n    }\n    return (global.callNative || (() => {}))(...args)\n  }\n}\n\nDocument.handler = config.sendTasks\n\nexport default config\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport init from './init'\nimport config from './config'\nimport { register, unregister, has } from './service'\n\n/* istanbul ignore next */\nfunction freezePrototype () {\n  // Object.freeze(config.Element)\n  Object.freeze(config.Comment)\n  Object.freeze(config.Listener)\n  Object.freeze(config.Document.prototype)\n  // Object.freeze(config.Element.prototype)\n  Object.freeze(config.Comment.prototype)\n  Object.freeze(config.Listener.prototype)\n}\n\nexport default {\n  service: { register, unregister, has },\n  freezePrototype,\n  init,\n  config\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Mock MessageEvent type\n * @param {string} type\n * @param {object} dict { data, origin, source, ports }\n *\n * This type has been simplified.\n * https://html.spec.whatwg.org/multipage/comms.html#messageevent\n * https://dom.spec.whatwg.org/#interface-event\n */\nexport function MessageEvent (type, dict = {}) {\n  this.type = type || 'message'\n\n  this.data = dict.data || null\n  this.origin = dict.origin || ''\n  this.source = dict.source || null\n  this.ports = dict.ports || []\n\n  // inherit properties\n  this.target = null\n  this.timeStamp = Date.now()\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * The polyfill of BroadcastChannel API.\n * This api can be used to achieve inter-instance communications.\n *\n * https://html.spec.whatwg.org/multipage/comms.html#broadcasting-to-other-browsing-contexts\n */\n\nimport { MessageEvent } from './message-event'\n\nconst channels = {}\nconst instances = {}\n\n/**\n * An empty constructor for BroadcastChannel polyfill.\n * The real constructor will be defined when a Weex instance created because\n * we need to track the channel by Weex instance id.\n */\nfunction BroadcastChannel () {}\n\n/**\n * Sends the given message to other BroadcastChannel objects set up for this channel.\n * @param {any} message\n */\nBroadcastChannel.prototype.postMessage = function (message) {\n  if (this._closed) {\n    throw new Error(`BroadcastChannel \"${this.name}\" is closed.`)\n  }\n\n  const subscribers = channels[this.name]\n  if (subscribers && subscribers.length) {\n    for (let i = 0; i < subscribers.length; ++i) {\n      const member = subscribers[i]\n\n      if (member._closed || member === this) continue\n\n      if (typeof member.onmessage === 'function') {\n        member.onmessage(new MessageEvent('message', { data: message }))\n      }\n    }\n  }\n}\n\n/**\n * Closes the BroadcastChannel object, opening it up to garbage collection.\n */\nBroadcastChannel.prototype.close = function () {\n  if (this._closed) {\n    return\n  }\n\n  this._closed = true\n\n  // remove itself from channels.\n  if (channels[this.name]) {\n    const subscribers = channels[this.name].filter(x => x !== this)\n    if (subscribers.length) {\n      channels[this.name] = subscribers\n    }\n    else {\n      delete channels[this.name]\n    }\n  }\n}\n\nexport default {\n  create: (id, env, config) => {\n    instances[id] = []\n    if (typeof global.BroadcastChannel === 'function') {\n      return {}\n    }\n    const serviceObject = {\n      /**\n       * Returns a new BroadcastChannel object via which messages for the given\n       * channel name can be sent and received.\n       * @param {string} name\n       */\n      BroadcastChannel: function (name) {\n        // the name property is readonly\n        Object.defineProperty(this, 'name', {\n          configurable: false,\n          enumerable: true,\n          writable: false,\n          value: String(name)\n        })\n\n        this._closed = false\n        this.onmessage = null\n\n        if (!channels[this.name]) {\n          channels[this.name] = []\n        }\n        channels[this.name].push(this)\n        instances[id].push(this)\n      }\n    }\n    serviceObject.BroadcastChannel.prototype = BroadcastChannel.prototype\n    return {\n      instance: serviceObject\n    }\n  },\n  destroy: (id, env) => {\n    instances[id].forEach(channel => channel.close())\n    delete instances[id]\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview The api for invoking with \"$\" prefix\n */\n\n/**\n * @deprecated use $vm instead\n * find the vm by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Vm}\n */\nexport function $ (id) {\n  console.warn('[JS Framework] Vm#$ is deprecated, please use Vm#$vm instead')\n  const info = this._ids[id]\n  if (info) {\n    return info.vm\n  }\n}\n\n/**\n * find the element by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Element}\n */\nexport function $el (id) {\n  const info = this._ids[id]\n  if (info) {\n    return info.el\n  }\n}\n\n/**\n * find the vm of the custom component by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Vm}\n */\nexport function $vm (id) {\n  const info = this._ids[id]\n  if (info) {\n    return info.vm\n  }\n}\n\n/**\n * Fire when differ rendering finished\n *\n * @param  {Function} fn\n */\nexport function $renderThen (fn) {\n  const app = this._app\n  const differ = app.differ\n  return differ.then(() => {\n    fn()\n  })\n}\n\n/**\n * scroll an element specified by id into view,\n * moreover specify a number of offset optionally\n * @param  {string} id\n * @param  {number} offset\n */\nexport function $scrollTo (id, offset) {\n  console.warn('[JS Framework] Vm#$scrollTo is deprecated, ' +\n          'please use \"require(\\'@weex-module/dom\\')' +\n          '.scrollTo(el, options)\" instead')\n  const el = this.$el(id)\n  if (el) {\n    const dom = this._app.requireModule('dom')\n    dom.scrollToElement(el.ref, { offset: offset })\n  }\n}\n\n/**\n * perform transition animation on an element specified by id\n * @param  {string}   id\n * @param  {object}   options\n * @param  {object}   options.styles\n * @param  {object}   options.duration(ms)\n * @param  {object}   [options.timingFunction]\n * @param  {object}   [options.delay=0(ms)]\n * @param  {Function} callback\n */\nexport function $transition (id, options, callback) {\n  const el = this.$el(id)\n  if (el && options && options.styles) {\n    const animation = this._app.requireModule('animation')\n    animation.transition(el.ref, options, (...args) => {\n      this._setStyle(el, options.styles)\n      callback && callback(...args)\n    })\n  }\n}\n\n/**\n * get some config\n * @return {object} some config for app instance\n * @property {string} bundleUrl\n * @property {boolean} debug\n * @property {object} env\n * @property {string} env.weexVersion(ex. 1.0.0)\n * @property {string} env.appName(ex. TB/TM)\n * @property {string} env.appVersion(ex. 5.0.0)\n * @property {string} env.platform(ex. iOS/Android)\n * @property {string} env.osVersion(ex. 7.0.0)\n * @property {string} env.deviceModel **native only**\n * @property {number} env.[deviceWidth=750]\n * @property {number} env.deviceHeight\n */\nexport function $getConfig (callback) {\n  const config = this._app.options\n  if (typeof callback === 'function') {\n    console.warn('[JS Framework] the callback of Vm#$getConfig(callback) is deprecated, ' +\n      'this api now can directly RETURN config info.')\n    callback(config)\n  }\n  return config\n}\n\n/**\n * @deprecated\n * request network via http protocol\n * @param  {object}   params\n * @param  {Function} callback\n */\nexport function $sendHttp (params, callback) {\n  console.warn('[JS Framework] Vm#$sendHttp is deprecated, ' +\n          'please use \"require(\\'@weex-module/stream\\')' +\n          '.sendHttp(params, callback)\" instead')\n  const stream = this._app.requireModule('stream')\n  stream.sendHttp(params, callback)\n}\n\n/**\n * @deprecated\n * open a url\n * @param  {string} url\n */\nexport function $openURL (url) {\n  console.warn('[JS Framework] Vm#$openURL is deprecated, ' +\n          'please use \"require(\\'@weex-module/event\\')' +\n          '.openURL(url)\" instead')\n  const event = this._app.requireModule('event')\n  event.openURL(url)\n}\n\n/**\n * @deprecated\n * set a title for page\n * @param  {string} title\n */\nexport function $setTitle (title) {\n  console.warn('[JS Framework] Vm#$setTitle is deprecated, ' +\n          'please use \"require(\\'@weex-module/pageInfo\\')' +\n          '.setTitle(title)\" instead')\n  const pageInfo = this._app.requireModule('pageInfo')\n  pageInfo.setTitle(title)\n}\n\n/**\n * @deprecated use \"require('@weex-module/moduleName') instead\"\n * invoke a native method by specifing the name of module and method\n * @param  {string} moduleName\n * @param  {string} methodName\n * @param  {...*} the rest arguments\n */\nexport function $call (moduleName, methodName, ...args) {\n  console.warn('[JS Framework] Vm#$call is deprecated, ' +\n    'please use \"require(\\'@weex-module/moduleName\\')\" instead')\n  const module = this._app.requireModule(moduleName)\n  if (module && module[methodName]) {\n    module[methodName](...args)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * Mix properties into target object.\n *\n * @param {Object} to\n * @param {Object} from\n */\n\nfunction extend (target, ...src) {\n  /* istanbul ignore else */\n  if (typeof Object.assign === 'function') {\n    Object.assign(target, ...src)\n  }\n  else {\n    const first = src.shift()\n    for (const key in first) {\n      target[key] = first[key]\n    }\n    if (src.length) {\n      extend(target, ...src)\n    }\n  }\n  return target\n}\n\n/**\n * Define a property.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n * @param {Boolean} [enumerable]\n */\n\nfunction def (obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}\n\n/**\n * Remove an item from an array\n *\n * @param {Array} arr\n * @param {*} item\n */\n\nfunction remove (arr, item) {\n  if (arr.length) {\n    const index = arr.indexOf(item)\n    if (index > -1) {\n      return arr.splice(index, 1)\n    }\n  }\n}\n\n/**\n * Check whether the object has the property.\n *\n * @param {Object} obj\n * @param {String} key\n * @return {Boolean}\n */\nconst hasOwnProperty = Object.prototype.hasOwnProperty\nfunction hasOwn (obj, key) {\n  return hasOwnProperty.call(obj, key)\n}\n\n/**\n * Simple bind, faster than native\n *\n * @param {Function} fn\n * @param {Object} ctx\n * @return {Function}\n */\n\nfunction bind (fn, ctx) {\n  return function (a) {\n    const l = arguments.length\n    return l\n      ? l > 1\n        ? fn.apply(ctx, arguments)\n        : fn.call(ctx, a)\n      : fn.call(ctx)\n  }\n}\n\n/**\n * Convert an Array-like object to a real Array.\n *\n * @param {Array-like} list\n * @param {Number} [start] - start index\n * @return {Array}\n */\n\nfunction toArray (list, start) {\n  start = start || 0\n  let i = list.length - start\n  const ret = new Array(i)\n  while (i--) {\n    ret[i] = list[i + start]\n  }\n  return ret\n}\n\n/**\n * Quick object check - this is primarily used to tell\n * Objects from primitive values when we know the value\n * is a JSON-compliant type.\n *\n * @param {*} obj\n * @return {Boolean}\n */\n\nfunction isObject (obj) {\n  return obj !== null && typeof obj === 'object'\n}\n\n/**\n * Strict object type check. Only returns true\n * for plain JavaScript objects.\n *\n * @param {*} obj\n * @return {Boolean}\n */\n\nconst toString = Object.prototype.toString\nconst OBJECT_STRING = '[object Object]'\nfunction isPlainObject (obj) {\n  return toString.call(obj) === OBJECT_STRING\n}\n\nexport {\n  extend,\n  def,\n  remove,\n  hasOwn,\n  bind,\n  toArray,\n  isObject,\n  isPlainObject\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport {\n  extend,\n  def,\n  remove,\n  hasOwn,\n  bind,\n  toArray,\n  isObject,\n  isPlainObject\n} from './shared'\n\n/**\n * Check if a string starts with $ or _\n *\n * @param {String} str\n * @return {Boolean}\n */\n\nexport function isReserved (str) {\n  const c = (str + '').charCodeAt(0)\n  return c === 0x24 || c === 0x5F\n}\n\n// can we use __proto__?\nexport const hasProto = '__proto__' in {}\n\nlet _Set\n/* istanbul ignore next */\nif (typeof Set !== 'undefined' && Set.toString().match(/native code/)) {\n  // use native Set when available.\n  _Set = Set\n}\nelse {\n  // a non-standard Set polyfill that only works with primitive keys.\n  _Set = function () {\n    this.set = Object.create(null)\n  }\n  _Set.prototype.has = function (key) {\n    return this.set[key] !== undefined\n  }\n  _Set.prototype.add = function (key) {\n    if (key == null || this.set[key]) {\n      return\n    }\n    this.set[key] = 1\n  }\n  _Set.prototype.clear = function () {\n    this.set = Object.create(null)\n  }\n}\n\nexport { _Set }\n\n/**\n * Polyfill in iOS7 by native because the JavaScript polyfill has memory problem.\n * @return {object}\n */\n\nexport function createNewSet () {\n  /* istanbul ignore next */\n  /* eslint-disable */\n  if (typeof nativeSet === 'object') {\n    return nativeSet.create()\n  }\n  /* eslint-enable */\n  return new _Set()\n}\n\n/**\n * Create a cached version of a pure function.\n *\n * @param {Function} fn\n * @return {Function}\n */\n\nexport function cached (fn) {\n  const cache = Object.create(null)\n  return function cachedFn (str) {\n    const hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  }\n}\n\n/**\n * Camelize a hyphen-delmited string.\n *\n * @param {String} str\n * @return {String}\n */\n\nconst camelizeRE = /-(\\w)/g\nexport const camelize = cached(str => {\n  return str.replace(camelizeRE, toUpper)\n})\n\nfunction toUpper (_, c) {\n  return c ? c.toUpperCase() : ''\n}\n\n/**\n * Hyphenate a camelCase string.\n *\n * @param {String} str\n * @return {String}\n */\n\nconst hyphenateRE = /([a-z\\d])([A-Z])/g\nexport const hyphenate = cached(str => {\n  return str\n    .replace(hyphenateRE, '$1-$2')\n    .toLowerCase()\n})\n\nexport function typof (v) {\n  const s = Object.prototype.toString.call(v)\n  return s.substring(8, s.length - 1).toLowerCase()\n}\n\n// weex name rules\n\nconst WEEX_COMPONENT_REG = /^@weex-component\\//\nconst WEEX_MODULE_REG = /^@weex-module\\//\nconst NORMAL_MODULE_REG = /^\\.{1,2}\\//\nconst JS_SURFIX_REG = /\\.js$/\n\nexport const isWeexComponent = name => !!name.match(WEEX_COMPONENT_REG)\nexport const isWeexModule = name => !!name.match(WEEX_MODULE_REG)\nexport const isNormalModule = name => !!name.match(NORMAL_MODULE_REG)\nexport const isNpmModule = name => !isWeexComponent(name) && !isWeexModule(name) && !isNormalModule(name)\n\nexport function removeWeexPrefix (str) {\n  const result = str.replace(WEEX_COMPONENT_REG, '').replace(WEEX_MODULE_REG, '')\n  return result\n}\n\nexport function removeJSSurfix (str) {\n  return str.replace(JS_SURFIX_REG, '')\n}\n","/* eslint-disable */\n\n\nimport { remove } from '../util/index'\n\nlet uid = 0\n\n/**\n * A dep is an observable that can have multiple\n * directives subscribing to it.\n *\n * @constructor\n */\n\nexport default function Dep () {\n  this.id = uid++\n  this.subs = []\n}\n\n// the current target watcher being evaluated.\n// this is globally unique because there could be only one\n// watcher being evaluated at any time.\nDep.target = null\nlet targetStack = []\n\nexport function pushTarget (_target) {\n  if (Dep.target) targetStack.push(Dep.target)\n  Dep.target = _target\n}\n\nexport function popTarget () {\n  Dep.target = targetStack.pop()\n}\n\nexport function resetTarget () {\n  Dep.target = null\n  targetStack = []\n}\n\n/**\n * Add a directive subscriber.\n *\n * @param {Directive} sub\n */\n\nDep.prototype.addSub = function (sub) {\n  this.subs.push(sub)\n}\n\n/**\n * Remove a directive subscriber.\n *\n * @param {Directive} sub\n */\n\nDep.prototype.removeSub = function (sub) {\n  remove(this.subs, sub)\n}\n\n/**\n * Add self as a dependency to the target watcher.\n */\n\nDep.prototype.depend = function () {\n  if (Dep.target) {\n    Dep.target.addDep(this)\n  }\n}\n\n/**\n * Notify all subscribers of a new value.\n */\n\nDep.prototype.notify = function () {\n  // stablize the subscriber list first\n  const subs = this.subs.slice()\n  for (let i = 0, l = subs.length; i < l; i++) {\n    subs[i].update()\n  }\n}\n","/* eslint-disable */\n\n\nimport Dep, { pushTarget, popTarget } from './dep'\n// import { pushWatcher } from './batcher'\nimport {\n  remove,\n  extend,\n  isObject,\n  createNewSet\n  // _Set as Set\n} from '../util/index'\n\nlet uid = 0\n\n/**\n * A watcher parses an expression, collects dependencies,\n * and fires callback when the expression value changes.\n * This is used for both the $watch() api and directives.\n *\n * @param {Vue} vm\n * @param {String|Function} expOrFn\n * @param {Function} cb\n * @param {Object} options\n *                 - {Array} filters\n *                 - {Boolean} twoWay\n *                 - {Boolean} deep\n *                 - {Boolean} user\n *                 - {Boolean} sync\n *                 - {Boolean} lazy\n *                 - {Function} [preProcess]\n *                 - {Function} [postProcess]\n * @constructor\n */\n\nexport default function Watcher (vm, expOrFn, cb, options) {\n  // mix in options\n  if (options) {\n    extend(this, options)\n  }\n  const isFn = typeof expOrFn === 'function'\n  this.vm = vm\n  vm._watchers.push(this)\n  this.expression = expOrFn\n  this.cb = cb\n  this.id = ++uid // uid for batching\n  this.active = true\n  this.dirty = this.lazy // for lazy watchers\n  this.deps = []\n  this.newDeps = []\n  this.depIds = createNewSet() // new Set()\n  this.newDepIds = createNewSet() // new Set()\n  // parse expression for getter\n  if (isFn) {\n    this.getter = expOrFn\n  }\n  this.value = this.lazy\n    ? undefined\n    : this.get()\n  // state for avoiding false triggers for deep and Array\n  // watchers during vm._digest()\n  this.queued = this.shallow = false\n}\n\n/**\n * Evaluate the getter, and re-collect dependencies.\n */\n\nWatcher.prototype.get = function () {\n  pushTarget(this)\n  const value = this.getter.call(this.vm, this.vm)\n  // \"touch\" every property so they are all tracked as\n  // dependencies for deep watching\n  if (this.deep) {\n    traverse(value)\n  }\n  popTarget()\n  this.cleanupDeps()\n  return value\n}\n\n/**\n * Add a dependency to this directive.\n *\n * @param {Dep} dep\n */\n\nWatcher.prototype.addDep = function (dep) {\n  const id = dep.id\n  if (!this.newDepIds.has(id)) {\n    this.newDepIds.add(id)\n    this.newDeps.push(dep)\n    if (!this.depIds.has(id)) {\n      dep.addSub(this)\n    }\n  }\n}\n\n/**\n * Clean up for dependency collection.\n */\n\nWatcher.prototype.cleanupDeps = function () {\n  let i = this.deps.length\n  while (i--) {\n    const dep = this.deps[i]\n    if (!this.newDepIds.has(dep.id)) {\n      dep.removeSub(this)\n    }\n  }\n  let tmp = this.depIds\n  this.depIds = this.newDepIds\n  this.newDepIds = tmp\n  this.newDepIds.clear()\n  tmp = this.deps\n  this.deps = this.newDeps\n  this.newDeps = tmp\n  this.newDeps.length = 0\n}\n\n/**\n * Subscriber interface.\n * Will be called when a dependency changes.\n *\n * @param {Boolean} shallow\n */\n\nWatcher.prototype.update = function (shallow) {\n  if (this.lazy) {\n    this.dirty = true\n  } else {\n    this.run()\n  }\n  // } else if (this.sync) {\n  //   this.run()\n  // } else {\n  //   // if queued, only overwrite shallow with non-shallow,\n  //   // but not the other way around.\n  //   this.shallow = this.queued\n  //     ? shallow\n  //       ? this.shallow\n  //       : false\n  //     : !!shallow\n  //   this.queued = true\n  //   pushWatcher(this)\n  // }\n}\n\n/**\n * Batcher job interface.\n * Will be called by the batcher.\n */\n\nWatcher.prototype.run = function () {\n  if (this.active) {\n    const value = this.get()\n    if (\n      value !== this.value ||\n      // Deep watchers and watchers on Object/Arrays should fire even\n      // when the value is the same, because the value may\n      // have mutated; but only do so if this is a\n      // non-shallow update (caused by a vm digest).\n      ((isObject(value) || this.deep) && !this.shallow)\n    ) {\n      // set new value\n      const oldValue = this.value\n      this.value = value\n      this.cb.call(this.vm, value, oldValue)\n    }\n    this.queued = this.shallow = false\n  }\n}\n\n/**\n * Evaluate the value of the watcher.\n * This only gets called for lazy watchers.\n */\n\nWatcher.prototype.evaluate = function () {\n  this.value = this.get()\n  this.dirty = false\n}\n\n/**\n * Depend on all deps collected by this watcher.\n */\n\nWatcher.prototype.depend = function () {\n  let i = this.deps.length\n  while (i--) {\n    this.deps[i].depend()\n  }\n}\n\n/**\n * Remove self from all dependencies' subcriber list.\n */\n\nWatcher.prototype.teardown = function () {\n  if (this.active) {\n    // remove self from vm's watcher list\n    // this is a somewhat expensive operation so we skip it\n    // if the vm is being destroyed or is performing a v-for\n    // re-render (the watcher list is then filtered by v-for).\n    if (!this.vm._isBeingDestroyed && !this.vm._vForRemoving) {\n      remove(this.vm._watchers, this)\n    }\n    let i = this.deps.length\n    while (i--) {\n      this.deps[i].removeSub(this)\n    }\n    this.active = false\n    this.vm = this.cb = this.value = null\n  }\n}\n\n/**\n * Recrusively traverse an object to evoke all converted\n * getters, so that every nested property inside the object\n * is collected as a \"deep\" dependency.\n *\n * @param {*} val\n * @param {Set} seen\n */\n\nconst seenObjects = createNewSet() // new Set()\n/* istanbul ignore next */\nfunction traverse (val, seen) {\n  let i, keys, isA, isO\n  if (!seen) {\n    seen = seenObjects\n    seen.clear()\n  }\n  isA = Array.isArray(val)\n  isO = isObject(val)\n  if (isA || isO) {\n    if (val.__ob__) {\n      const depId = val.__ob__.dep.id\n      if (seen.has(depId)) {\n        return\n      } else {\n        seen.add(depId)\n      }\n    }\n    if (isA) {\n      i = val.length\n      while (i--) traverse(val[i], seen)\n    } else if (isO) {\n      keys = Object.keys(val)\n      i = keys.length\n      while (i--) traverse(val[keys[i]], seen)\n    }\n  }\n}\n","/* eslint-disable */\n\n\nimport { def } from '../util/index'\n\nconst arrayProto = Array.prototype\nexport const arrayMethods = Object.create(arrayProto)\n\n/**\n * Intercept mutating methods and emit events\n */\n\n;[\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n]\n.forEach(function (method) {\n  // cache original method\n  const original = arrayProto[method]\n  def(arrayMethods, method, function mutator () {\n    // avoid leaking arguments:\n    // http://jsperf.com/closure-with-arguments\n    let i = arguments.length\n    const args = new Array(i)\n    while (i--) {\n      args[i] = arguments[i]\n    }\n    const result = original.apply(this, args)\n    const ob = this.__ob__\n    let inserted\n    switch (method) {\n      case 'push':\n        inserted = args\n        break\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n    }\n    if (inserted) ob.observeArray(inserted)\n    // notify change\n    ob.dep.notify()\n    return result\n  })\n})\n\n/**\n * Swap the element at the given index with a new value\n * and emits corresponding event.\n *\n * @param {Number} index\n * @param {*} val\n * @return {*} - replaced element\n */\n\ndef(\n  arrayProto,\n  '$set',\n  function $set (index, val) {\n    console.warn(`[JS Framework] \"Array.prototype.$set\" is not a standard API,`\n      + ` it will be removed in the next version.`)\n    if (index >= this.length) {\n      this.length = index + 1\n    }\n    return this.splice(index, 1, val)[0]\n  }\n)\n\n/**\n * Convenience method to remove the element at given index.\n *\n * @param {Number} index\n * @param {*} val\n */\n\ndef(\n  arrayProto,\n  '$remove',\n  function $remove (index) {\n    console.warn(`[JS Framework] \"Array.prototype.$remove\" is not a standard API,`\n      + ` it will be removed in the next version.`)\n    /* istanbul ignore if */\n    if (!this.length) return\n    /* istanbul ignore else */\n    if (typeof index !== 'number') {\n      index = this.indexOf(index)\n    }\n    /* istanbul ignore else */\n    if (index > -1) {\n      this.splice(index, 1)\n    }\n  }\n)\n","/* eslint-disable */\n\n\nimport Dep from './dep'\nimport { arrayMethods } from './array'\nimport {\n  def,\n  remove,\n  isObject,\n  isPlainObject,\n  hasProto,\n  hasOwn,\n  isReserved\n} from '../util/index'\n\nconst arrayKeys = Object.getOwnPropertyNames(arrayMethods)\n\n/**\n * Observer class that are attached to each observed\n * object. Once attached, the observer converts target\n * object's property keys into getter/setters that\n * collect dependencies and dispatches updates.\n *\n * @param {Array|Object} value\n * @constructor\n */\n\nexport function Observer (value) {\n  this.value = value\n  this.dep = new Dep()\n  def(value, '__ob__', this)\n  if (Array.isArray(value)) {\n    const augment = hasProto\n      ? protoAugment\n      : copyAugment\n    augment(value, arrayMethods, arrayKeys)\n    this.observeArray(value)\n  } else {\n    this.walk(value)\n  }\n}\n\n// Instance methods\n\n/**\n * Walk through each property and convert them into\n * getter/setters. This method should only be called when\n * value type is Object.\n *\n * @param {Object} obj\n */\n\nObserver.prototype.walk = function (obj) {\n  for (let key in obj) {\n    this.convert(key, obj[key])\n  }\n}\n\n/**\n * Observe a list of Array items.\n *\n * @param {Array} items\n */\n\nObserver.prototype.observeArray = function (items) {\n  for (let i = 0, l = items.length; i < l; i++) {\n    observe(items[i])\n  }\n}\n\n/**\n * Convert a property into getter/setter so we can emit\n * the events when the property is accessed/changed.\n *\n * @param {String} key\n * @param {*} val\n */\n\nObserver.prototype.convert = function (key, val) {\n  defineReactive(this.value, key, val)\n}\n\n/**\n * Add an owner vm, so that when $set/$delete mutations\n * happen we can notify owner vms to proxy the keys and\n * digest the watchers. This is only called when the object\n * is observed as an instance's root $data.\n *\n * @param {Vue} vm\n */\n\nObserver.prototype.addVm = function (vm) {\n  (this.vms || (this.vms = [])).push(vm)\n}\n\n/**\n * Remove an owner vm. This is called when the object is\n * swapped out as an instance's $data object.\n *\n * @param {Vue} vm\n */\n\n/* istanbul ignore next */\nObserver.prototype.removeVm = function (vm) {\n  remove(this.vms, vm)\n}\n\n// helpers\n\n/**\n * Augment an target Object or Array by intercepting\n * the prototype chain using __proto__\n *\n * @param {Object|Array} target\n * @param {Object} src\n */\n\nfunction protoAugment (target, src) {\n  /* eslint-disable no-proto */\n  target.__proto__ = src\n  /* eslint-enable no-proto */\n}\n\n/**\n * Augment an target Object or Array by defining\n * hidden properties.\n *\n * @param {Object|Array} target\n * @param {Object} proto\n */\n\n/* istanbul ignore next */\nfunction copyAugment (target, src, keys) {\n  for (let i = 0, l = keys.length; i < l; i++) {\n    const key = keys[i]\n    def(target, key, src[key])\n  }\n}\n\n/**\n * Attempt to create an observer instance for a value,\n * returns the new observer if successfully observed,\n * or the existing observer if the value already has one.\n *\n * @param {*} value\n * @param {Vue} [vm]\n * @return {Observer|undefined}\n * @static\n */\n\nexport function observe (value, vm) {\n  if (!isObject(value)) {\n    return\n  }\n  let ob\n  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {\n    ob = value.__ob__\n  } else if (\n    (Array.isArray(value) || isPlainObject(value)) &&\n    Object.isExtensible(value) &&\n    !value._isVue\n  ) {\n    ob = new Observer(value)\n  }\n  if (ob && vm) {\n    ob.addVm(vm)\n  }\n  return ob\n}\n\n/**\n * Define a reactive property on an Object.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n */\n\nexport function defineReactive (obj, key, val) {\n  const dep = new Dep()\n\n  const property = Object.getOwnPropertyDescriptor(obj, key)\n  if (property && property.configurable === false) {\n    return\n  }\n\n  // cater for pre-defined getter/setters\n  const getter = property && property.get\n  const setter = property && property.set\n\n  let childOb = observe(val)\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      if (Dep.target) {\n        dep.depend()\n        if (childOb) {\n          childOb.dep.depend()\n        }\n        if (Array.isArray(value)) {\n          for (let e, i = 0, l = value.length; i < l; i++) {\n            e = value[i]\n            e && e.__ob__ && e.__ob__.dep.depend()\n          }\n        }\n      }\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      const value = getter ? getter.call(obj) : val\n      if (newVal === value) {\n        return\n      }\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      childOb = observe(newVal)\n      dep.notify()\n    }\n  })\n}\n\n/**\n * Set a property on an object. Adds the new property and\n * triggers change notification if the property doesn't\n * already exist.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n * @public\n */\n\n/* istanbul ignore next */\nexport function set (obj, key, val) {\n  if (Array.isArray(obj)) {\n    return obj.splice(key, 1, val)\n  }\n  if (hasOwn(obj, key)) {\n    obj[key] = val\n    return\n  }\n  if (obj._isVue) {\n    set(obj._data, key, val)\n    return\n  }\n  const ob = obj.__ob__\n  if (!ob) {\n    obj[key] = val\n    return\n  }\n  ob.convert(key, val)\n  ob.dep.notify()\n  if (ob.vms) {\n    let i = ob.vms.length\n    while (i--) {\n      const vm = ob.vms[i]\n      proxy(vm, key)\n      // vm.$forceUpdate()\n    }\n  }\n  return val\n}\n\n/**\n * Delete a property and trigger change if necessary.\n *\n * @param {Object} obj\n * @param {String} key\n */\n\n/* istanbul ignore next */\nexport function del (obj, key) {\n  if (!hasOwn(obj, key)) {\n    return\n  }\n  delete obj[key]\n  const ob = obj.__ob__\n\n  if (!ob) {\n    if (obj._isVue) {\n      delete obj._data[key]\n      // obj.$forceUpdate()\n    }\n    return\n  }\n  ob.dep.notify()\n  if (ob.vms) {\n    let i = ob.vms.length\n    while (i--) {\n      const vm = ob.vms[i]\n      unproxy(vm, key)\n      // vm.$forceUpdate()\n    }\n  }\n}\n\nconst KEY_WORDS = ['$index', '$value', '$event']\nexport function proxy (vm, key) {\n  if (KEY_WORDS.indexOf(key) > -1 || !isReserved(key)) {\n    Object.defineProperty(vm, key, {\n      configurable: true,\n      enumerable: true,\n      get: function proxyGetter () {\n        return vm._data[key]\n      },\n      set: function proxySetter (val) {\n        vm._data[key] = val\n      }\n    })\n  }\n}\n\n/* istanbul ignore next */\nexport function unproxy (vm, key) {\n  if (!isReserved(key)) {\n    delete vm[key]\n  }\n}\n","/* eslint-disable */\n\n\nimport Watcher from './watcher'\nimport Dep from './dep'\nimport {\n  observe,\n  proxy,\n  unproxy\n} from './observer'\nimport {\n  isPlainObject,\n  bind\n} from '../util/index'\n\nexport function initState (vm) {\n  vm._watchers = []\n  initData(vm)\n  initComputed(vm)\n  initMethods(vm)\n}\n\nexport function initData (vm) {\n  let data = vm._data\n\n  if (!isPlainObject(data)) {\n    data = {}\n  }\n  // proxy data on instance\n  const keys = Object.keys(data)\n  let i = keys.length\n  while (i--) {\n    proxy(vm, keys[i])\n  }\n  // observe data\n  observe(data, vm)\n}\n\n/* istanbul ignore next */\nfunction noop () {\n}\n\nexport function initComputed (vm) {\n  const computed = vm._computed\n  if (computed) {\n    for (let key in computed) {\n      const userDef = computed[key]\n      const def = {\n        enumerable: true,\n        configurable: true\n      }\n      if (typeof userDef === 'function') {\n        def.get = makeComputedGetter(userDef, vm)\n        def.set = noop\n      } else {\n        def.get = userDef.get\n          ? userDef.cache !== false\n            ? makeComputedGetter(userDef.get, vm)\n            : bind(userDef.get, vm)\n          : noop\n        def.set = userDef.set\n          ? bind(userDef.set, vm)\n          : noop\n      }\n      Object.defineProperty(vm, key, def)\n    }\n  }\n}\n\nfunction makeComputedGetter (getter, owner) {\n  const watcher = new Watcher(owner, getter, null, {\n    lazy: true\n  })\n  return function computedGetter () {\n    if (watcher.dirty) {\n      watcher.evaluate()\n    }\n    if (Dep.target) {\n      watcher.depend()\n    }\n    return watcher.value\n  }\n}\n\nexport function initMethods (vm) {\n  const methods = vm._methods\n  if (methods) {\n    for (let key in methods) {\n      vm[key] = methods[key]\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// @todo: It should be registered by native from `registerComponents()`.\n\nexport default {\n  nativeComponentMap: {\n    text: true,\n    image: true,\n    container: true,\n    slider: {\n      type: 'slider',\n      append: 'tree'\n    },\n    cell: {\n      type: 'cell',\n      append: 'tree'\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Directive Parser\n */\n\nimport { bind, typof } from '../util/index'\nimport Watcher from '../core/watcher'\nimport config from '../config'\n\nconst { nativeComponentMap } = config\n\nconst SETTERS = {\n  attr: 'setAttr',\n  style: 'setStyle',\n  event: 'addEvent'\n}\n\n/**\n * apply the native component's options(specified by template.type)\n * to the template\n */\nexport function applyNaitveComponentOptions (template) {\n  const { type } = template\n  const options = nativeComponentMap[type]\n\n  if (typeof options === 'object') {\n    for (const key in options) {\n      if (template[key] == null) {\n        template[key] = options[key]\n      }\n      else if (typof(template[key]) === 'object' &&\n        typof(options[key]) === 'object') {\n        for (const subkey in options[key]) {\n          if (template[key][subkey] == null) {\n            template[key][subkey] = options[key][subkey]\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * bind all id, attr, classnames, style, events to an element\n */\nexport function bindElement (vm, el, template) {\n  setId(vm, el, template.id, vm)\n  setAttr(vm, el, template.attr)\n  setClass(vm, el, template.classList)\n  setStyle(vm, el, template.style)\n  bindEvents(vm, el, template.events)\n}\n\n/**\n * bind all props to sub vm and bind all style, events to the root element\n * of the sub vm if it doesn't have a replaced multi-node fragment\n */\nexport function bindSubVm (vm, subVm, template, repeatItem) {\n  subVm = subVm || {}\n  template = template || {}\n\n  const options = subVm._options || {}\n\n  // bind props\n  let props = options.props\n\n  if (Array.isArray(props)) {\n    props = props.reduce((result, value) => {\n      result[value] = true\n      return result\n    }, {})\n  }\n\n  mergeProps(repeatItem, props, vm, subVm)\n  mergeProps(template.attr, props, vm, subVm)\n}\n\n/**\n * merge class and styles from vm to sub vm.\n */\nexport function bindSubVmAfterInitialized (vm, subVm, template, target = {}) {\n  mergeClassStyle(template.classList, vm, subVm)\n  mergeStyle(template.style, vm, subVm)\n\n  // bind subVm to the target element\n  if (target.children) {\n    target.children[target.children.length - 1]._vm = subVm\n  }\n  else {\n    target._vm = subVm\n  }\n}\n\n/**\n * Bind props from vm to sub vm and watch their updates.\n */\nfunction mergeProps (target, props, vm, subVm) {\n  if (!target) {\n    return\n  }\n  for (const key in target) {\n    if (!props || props[key]) {\n      const value = target[key]\n      if (typeof value === 'function') {\n        const returnValue = watch(vm, value, function (v) {\n          subVm[key] = v\n        })\n        subVm[key] = returnValue\n      }\n      else {\n        subVm[key] = value\n      }\n    }\n  }\n}\n\n/**\n * Bind style from vm to sub vm and watch their updates.\n */\nfunction mergeStyle (target, vm, subVm) {\n  for (const key in target) {\n    const value = target[key]\n    if (typeof value === 'function') {\n      const returnValue = watch(vm, value, function (v) {\n        if (subVm._rootEl) {\n          subVm._rootEl.setStyle(key, v)\n        }\n      })\n      subVm._rootEl.setStyle(key, returnValue)\n    }\n    else {\n      if (subVm._rootEl) {\n        subVm._rootEl.setStyle(key, value)\n      }\n    }\n  }\n}\n\n/**\n * Bind class & style from vm to sub vm and watch their updates.\n */\nfunction mergeClassStyle (target, vm, subVm) {\n  const css = vm._options && vm._options.style || {}\n\n  /* istanbul ignore if */\n  if (!subVm._rootEl) {\n    return\n  }\n\n  const className = '@originalRootEl'\n  css[className] = subVm._rootEl.classStyle\n\n  function addClassName (list, name) {\n    if (typof(list) === 'array') {\n      list.unshift(name)\n    }\n  }\n\n  if (typeof target === 'function') {\n    const value = watch(vm, target, v => {\n      addClassName(v, className)\n      setClassStyle(subVm._rootEl, css, v)\n    })\n    addClassName(value, className)\n    setClassStyle(subVm._rootEl, css, value)\n  }\n  else if (target != null) {\n    addClassName(target, className)\n    setClassStyle(subVm._rootEl, css, target)\n  }\n}\n\n/**\n * bind id to an element\n * each id is unique in a whole vm\n */\nexport function setId (vm, el, id, target) {\n  const map = Object.create(null)\n\n  Object.defineProperties(map, {\n    vm: {\n      value: target,\n      writable: false,\n      configurable: false\n    },\n    el: {\n      get: () => el || target._rootEl,\n      configurable: false\n    }\n  })\n\n  if (typeof id === 'function') {\n    const handler = id\n    id = handler.call(vm)\n    if (id || id === 0) {\n      vm._ids[id] = map\n    }\n    watch(vm, handler, (newId) => {\n      if (newId) {\n        vm._ids[newId] = map\n      }\n    })\n  }\n  else if (id && typeof id === 'string') {\n    vm._ids[id] = map\n  }\n}\n\n/**\n * bind attr to an element\n */\nfunction setAttr (vm, el, attr) {\n  bindDir(vm, el, 'attr', attr)\n}\n\nfunction setClassStyle (el, css, classList) {\n  if (typeof classList === 'string') {\n    classList = classList.split(/\\s+/)\n  }\n  classList.forEach((name, i) => {\n    classList.splice(i, 1, ...name.split(/\\s+/))\n  })\n  const classStyle = {}\n  const length = classList.length\n\n  for (let i = 0; i < length; i++) {\n    const style = css[classList[i]]\n    if (style) {\n      Object.keys(style).forEach((key) => {\n        classStyle[key] = style[key]\n      })\n    }\n  }\n  el.setClassStyle(classStyle)\n}\n\n/**\n * bind classnames to an element\n */\nfunction setClass (vm, el, classList) {\n  if (typeof classList !== 'function' && !Array.isArray(classList)) {\n    return\n  }\n  if (Array.isArray(classList) && !classList.length) {\n    el.setClassStyle({})\n    return\n  }\n\n  const style = vm._options && vm._options.style || {}\n  if (typeof classList === 'function') {\n    const value = watch(vm, classList, v => {\n      setClassStyle(el, style, v)\n    })\n    setClassStyle(el, style, value)\n  }\n  else {\n    setClassStyle(el, style, classList)\n  }\n}\n\n/**\n * bind style to an element\n */\nfunction setStyle (vm, el, style) {\n  bindDir(vm, el, 'style', style)\n}\n\n/**\n * add an event type and handler to an element and generate a dom update\n */\nfunction setEvent (vm, el, type, handler) {\n  el.addEvent(type, bind(handler, vm))\n}\n\n/**\n * add all events of an element\n */\nfunction bindEvents (vm, el, events) {\n  if (!events) {\n    return\n  }\n  const keys = Object.keys(events)\n  let i = keys.length\n  while (i--) {\n    const key = keys[i]\n    let handler = events[key]\n    if (typeof handler === 'string') {\n      handler = vm[handler]\n      /* istanbul ignore if */\n      if (!handler) {\n        console.warn(`[JS Framework] The event handler \"${handler}\" is not defined.`)\n      }\n    }\n    setEvent(vm, el, key, handler)\n  }\n}\n\n/**\n * set a series of members as a kind of an element\n * for example: style, attr, ...\n * if the value is a function then bind the data changes\n */\nfunction bindDir (vm, el, name, data) {\n  if (!data) {\n    return\n  }\n  const keys = Object.keys(data)\n  let i = keys.length\n  while (i--) {\n    const key = keys[i]\n    const value = data[key]\n    if (typeof value === 'function') {\n      bindKey(vm, el, name, key, value)\n    }\n    else {\n      el[SETTERS[name]](key, value)\n    }\n  }\n}\n\n/**\n * bind data changes to a certain key to a name series in an element\n */\nfunction bindKey (vm, el, name, key, calc) {\n  const methodName = SETTERS[name]\n  // watch the calc, and returns a value by calc.call()\n  const value = watch(vm, calc, (value) => {\n    function handler () {\n      el[methodName](key, value)\n    }\n    const differ = vm && vm._app && vm._app.differ\n    if (differ) {\n      differ.append('element', el.depth || 0, el.ref, handler)\n    }\n    else {\n      handler()\n    }\n  })\n\n  el[methodName](key, value)\n}\n\n/**\n * watch a calc function and callback if the calc value changes\n */\nexport function watch (vm, calc, callback) {\n  if (vm._static) {\n    return calc.call(vm, vm)\n  }\n  const watcher = new Watcher(vm, calc, function (value, oldValue) {\n    /* istanbul ignore if */\n    if (typeof value !== 'object' && value === oldValue) {\n      return\n    }\n    callback(value)\n  })\n\n  return watcher.value\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview Document & Element Helpers.\n *\n * required:\n * Document#: createElement, createComment, getRef\n * Element#: appendChild, insertBefore, removeChild, nextSibling\n */\n\n/**\n * Create a body by type\n * Using this._app.doc\n *\n * @param  {string} type\n */\nexport function createBody (vm, type) {\n  const doc = vm._app.doc\n  return doc.createBody(type)\n}\n\n/**\n * Create an element by type\n * Using this._app.doc\n *\n * @param  {string} type\n */\nexport function createElement (vm, type) {\n  const doc = vm._app.doc\n  return doc.createElement(type)\n}\n\n/**\n * Create and return a frag block for an element.\n * The frag block has a starter, ender and the element itself.\n *\n * @param  {object} element\n */\nexport function createBlock (vm, element) {\n  const start = createBlockStart(vm)\n  const end = createBlockEnd(vm)\n  const blockId = lastestBlockId++\n  if (element.element) {\n    let updateMark = element.updateMark\n    if (updateMark) {\n      if (updateMark.element) {\n        updateMark = updateMark.end\n      }\n      element.element.insertAfter(end, updateMark)\n      element.element.insertAfter(start, updateMark)\n      element.updateMark = end\n    }\n    else {\n      element.element.insertBefore(start, element.end)\n      element.element.insertBefore(end, element.end)\n    }\n    element = element.element\n  }\n  else {\n    element.appendChild(start)\n    element.appendChild(end)\n  }\n  return { start, end, element, blockId }\n}\n\nlet lastestBlockId = 1\n\n/**\n * Create and return a block starter.\n * Using this._app.doc\n */\nfunction createBlockStart (vm) {\n  const doc = vm._app.doc\n  const anchor = doc.createComment('start')\n  return anchor\n}\n\n/**\n * Create and return a block ender.\n * Using this._app.doc\n */\nfunction createBlockEnd (vm) {\n  const doc = vm._app.doc\n  const anchor = doc.createComment('end')\n  return anchor\n}\n\n/**\n * Attach target to a certain dest using appendChild by default.\n * If the dest is a frag block then insert before the ender.\n * If the target is a frag block then attach the starter and ender in order.\n *\n * @param  {object} target\n * @param  {object} dest\n */\nexport function attachTarget (vm, target, dest) {\n  if (dest.element) {\n    const before = dest.end\n    const after = dest.updateMark\n    // push new target for watch list update later\n    if (dest.children) {\n      dest.children.push(target)\n    }\n    // for check repeat case\n    if (after) {\n      const signal = moveTarget(vm, target, after)\n      dest.updateMark = target.element ? target.end : target\n      return signal\n    }\n    else if (target.element) {\n      dest.element.insertBefore(target.start, before)\n      dest.element.insertBefore(target.end, before)\n    }\n    else {\n      return dest.element.insertBefore(target, before)\n    }\n  }\n  else {\n    if (target.element) {\n      dest.appendChild(target.start)\n      dest.appendChild(target.end)\n    }\n    else {\n      return dest.appendChild(target)\n    }\n  }\n}\n\n/**\n * Move target before a certain element. The target maybe block or element.\n *\n * @param  {object} target\n * @param  {object} before\n */\nexport function moveTarget (vm, target, after) {\n  if (target.element) {\n    return moveBlock(target, after)\n  }\n  return moveElement(target, after)\n}\n\n/**\n * Move element before a certain element.\n *\n * @param  {object} element\n * @param  {object} before\n */\nfunction moveElement (element, after) {\n  const parent = after.parentNode\n  if (parent) {\n    return parent.insertAfter(element, after)\n  }\n}\n\n/**\n * Move all elements of the block before a certain element.\n *\n * @param  {object} fragBlock\n * @param  {object} before\n */\nfunction moveBlock (fragBlock, after) {\n  const parent = after.parentNode\n\n  if (parent) {\n    let el = fragBlock.start\n    let signal\n    const group = [el]\n\n    while (el && el !== fragBlock.end) {\n      el = el.nextSibling\n      group.push(el)\n    }\n\n    let temp = after\n    group.every((el) => {\n      signal = parent.insertAfter(el, temp)\n      temp = el\n      return signal !== -1\n    })\n\n    return signal\n  }\n}\n\n/**\n * Remove target from DOM tree.\n * If the target is a frag block then call _removeBlock\n *\n * @param  {object} target\n */\nexport function removeTarget (vm, target, preserveBlock = false) {\n  if (target.element) {\n    removeBlock(target, preserveBlock)\n  }\n  else {\n    removeElement(target)\n  }\n  if (target._vm) {\n    target._vm.$emit('hook:destroyed')\n  }\n}\n\n/**\n * Remove a certain element.\n * Using this._app.doc\n *\n * @param  {object} target\n */\nfunction removeElement (target) {\n  const parent = target.parentNode\n\n  if (parent) {\n    parent.removeChild(target)\n  }\n}\n\n/**\n * Remove a frag block.\n * The second param decides whether the block self should be removed too.\n *\n * @param  {object}  fragBlock\n * @param  {Boolean} preserveBlock=false\n */\nfunction removeBlock (fragBlock, preserveBlock = false) {\n  const result = []\n  let el = fragBlock.start.nextSibling\n\n  while (el && el !== fragBlock.end) {\n    result.push(el)\n    el = el.nextSibling\n  }\n\n  if (!preserveBlock) {\n    removeElement(fragBlock.start)\n  }\n  result.forEach((el) => {\n    removeElement(el)\n  })\n  if (!preserveBlock) {\n    removeElement(fragBlock.end)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * ViewModel template parser & data-binding process\n */\n\nimport {\n  extend,\n  isObject,\n  bind\n} from '../util/index'\nimport {\n  initData,\n  initComputed\n} from '../core/state'\nimport {\n  bindElement,\n  setId,\n  bindSubVm,\n  bindSubVmAfterInitialized,\n  applyNaitveComponentOptions,\n  watch\n} from './directive'\nimport {\n  createBlock,\n  createBody,\n  createElement,\n  attachTarget,\n  moveTarget,\n  removeTarget\n} from './dom-helper'\n\n/**\n * build()\n *   compile(template, parentNode)\n *     if (type is content) create contentNode\n *     else if (dirs have v-for) foreach -> create context\n *       -> compile(templateWithoutFor, parentNode): diff(list) onchange\n *     else if (dirs have v-if) assert\n *       -> compile(templateWithoutIf, parentNode): toggle(shown) onchange\n *     else if (type is dynamic)\n *       -> compile(templateWithoutDynamicType, parentNode): watch(type) onchange\n *     else if (type is custom)\n *       addChildVm(vm, parentVm)\n *       build(externalDirs)\n *       foreach childNodes -> compile(childNode, template)\n *     else if (type is native)\n *       set(dirs): update(id/attr/style/class) onchange\n *       append(template, parentNode)\n *       foreach childNodes -> compile(childNode, template)\n */\nexport function build (vm) {\n  const opt = vm._options || {}\n  const template = opt.template || {}\n\n  if (opt.replace) {\n    if (template.children && template.children.length === 1) {\n      compile(vm, template.children[0], vm._parentEl)\n    }\n    else {\n      compile(vm, template.children, vm._parentEl)\n    }\n  }\n  else {\n    compile(vm, template, vm._parentEl)\n  }\n\n  console.debug(`[JS Framework] \"ready\" lifecycle in Vm(${vm._type})`)\n  vm.$emit('hook:ready')\n  vm._ready = true\n}\n\n/**\n * Generate elements by child or children and append to parent elements.\n * Root element info would be merged if has. The first argument may be an array\n * if the root element with options.replace has not only one child.\n *\n * @param {object|array} target\n * @param {object}       dest\n * @param {object}       meta\n */\nfunction compile (vm, target, dest, meta) {\n  const app = vm._app || {}\n\n  if (app.lastSignal === -1) {\n    return\n  }\n\n  if (target.attr && target.attr.hasOwnProperty('static')) {\n    vm._static = true\n  }\n\n  if (targetIsFragment(target)) {\n    compileFragment(vm, target, dest, meta)\n    return\n  }\n  meta = meta || {}\n  if (targetIsContent(target)) {\n    console.debug('[JS Framework] compile \"content\" block by', target)\n    vm._content = createBlock(vm, dest)\n    return\n  }\n\n  if (targetNeedCheckRepeat(target, meta)) {\n    console.debug('[JS Framework] compile \"repeat\" logic by', target)\n    if (dest.type === 'document') {\n      console.warn('[JS Framework] The root element does\\'t support `repeat` directive!')\n    }\n    else {\n      compileRepeat(vm, target, dest)\n    }\n    return\n  }\n  if (targetNeedCheckShown(target, meta)) {\n    console.debug('[JS Framework] compile \"if\" logic by', target)\n    if (dest.type === 'document') {\n      console.warn('[JS Framework] The root element does\\'t support `if` directive!')\n    }\n    else {\n      compileShown(vm, target, dest, meta)\n    }\n    return\n  }\n  const typeGetter = meta.type || target.type\n  if (targetNeedCheckType(typeGetter, meta)) {\n    compileType(vm, target, dest, typeGetter, meta)\n    return\n  }\n  const type = typeGetter\n  const component = targetIsComposed(vm, target, type)\n  if (component) {\n    console.debug('[JS Framework] compile composed component by', target)\n    compileCustomComponent(vm, component, target, dest, type, meta)\n    return\n  }\n  console.debug('[JS Framework] compile native component by', target)\n  compileNativeComponent(vm, target, dest, type)\n}\n\n/**\n * Check if target is a fragment (an array).\n *\n * @param  {object}  target\n * @return {boolean}\n */\nfunction targetIsFragment (target) {\n  return Array.isArray(target)\n}\n\n/**\n * Check if target type is content/slot.\n *\n * @param  {object}  target\n * @return {boolean}\n */\nfunction targetIsContent (target) {\n  return target.type === 'content' || target.type === 'slot'\n}\n\n/**\n * Check if target need to compile by a list.\n *\n * @param  {object}  target\n * @param  {object}  meta\n * @return {boolean}\n */\nfunction targetNeedCheckRepeat (target, meta) {\n  return !meta.hasOwnProperty('repeat') && target.repeat\n}\n\n/**\n * Check if target need to compile by a boolean value.\n *\n * @param  {object}  target\n * @param  {object}  meta\n * @return {boolean}\n */\nfunction targetNeedCheckShown (target, meta) {\n  return !meta.hasOwnProperty('shown') && target.shown\n}\n\n/**\n * Check if target need to compile by a dynamic type.\n *\n * @param  {string|function} typeGetter\n * @param  {object}          meta\n * @return {boolean}\n */\nfunction targetNeedCheckType (typeGetter, meta) {\n  return (typeof typeGetter === 'function') && !meta.hasOwnProperty('type')\n}\n\n/**\n * Check if this kind of component is composed.\n *\n * @param  {string}  type\n * @return {boolean}\n */\nfunction targetIsComposed (vm, target, type) {\n  let component\n  if (vm._app && vm._app.customComponentMap) {\n    component = vm._app.customComponentMap[type]\n  }\n  if (vm._options && vm._options.components) {\n    component = vm._options.components[type]\n  }\n  if (target.component) {\n    component = component || {}\n  }\n  return component\n}\n\n/**\n * Compile a list of targets.\n *\n * @param {object} target\n * @param {object} dest\n * @param {object} meta\n */\nfunction compileFragment (vm, target, dest, meta) {\n  const fragBlock = createBlock(vm, dest)\n  target.forEach((child) => {\n    compile(vm, child, fragBlock, meta)\n  })\n}\n\n/**\n * Compile a target with repeat directive.\n *\n * @param {object} target\n * @param {object} dest\n */\nfunction compileRepeat (vm, target, dest) {\n  const repeat = target.repeat\n  const oldStyle = typeof repeat === 'function'\n  let getter = repeat.getter || repeat.expression || repeat\n  if (typeof getter !== 'function') {\n    getter = function () { return [] }\n  }\n  const key = repeat.key || '$index'\n  const value = repeat.value || '$value'\n  const trackBy = repeat.trackBy || target.trackBy ||\n    (target.attr && target.attr.trackBy)\n\n  const fragBlock = createBlock(vm, dest)\n  fragBlock.children = []\n  fragBlock.data = []\n  fragBlock.vms = []\n\n  bindRepeat(vm, target, fragBlock, { getter, key, value, trackBy, oldStyle })\n}\n\n/**\n * Compile a target with if directive.\n *\n * @param {object} target\n * @param {object} dest\n * @param {object} meta\n */\nfunction compileShown (vm, target, dest, meta) {\n  const newMeta = { shown: true }\n  const fragBlock = createBlock(vm, dest)\n\n  if (dest.element && dest.children) {\n    dest.children.push(fragBlock)\n  }\n\n  if (meta.repeat) {\n    newMeta.repeat = meta.repeat\n  }\n\n  bindShown(vm, target, fragBlock, newMeta)\n}\n\n/**\n * Compile a target with dynamic component type.\n *\n * @param {object}   target\n * @param {object}   dest\n * @param {function} typeGetter\n */\nfunction compileType (vm, target, dest, typeGetter, meta) {\n  const type = typeGetter.call(vm)\n  const newMeta = extend({ type }, meta)\n  const fragBlock = createBlock(vm, dest)\n\n  if (dest.element && dest.children) {\n    dest.children.push(fragBlock)\n  }\n\n  watch(vm, typeGetter, (value) => {\n    const newMeta = extend({ type: value }, meta)\n    removeTarget(vm, fragBlock, true)\n    compile(vm, target, fragBlock, newMeta)\n  })\n\n  compile(vm, target, fragBlock, newMeta)\n}\n\n/**\n * Compile a composed component.\n *\n * @param {object} target\n * @param {object} dest\n * @param {string} type\n */\nfunction compileCustomComponent (vm, component, target, dest, type, meta) {\n  const Ctor = vm.constructor\n  const subVm = new Ctor(type, component, vm, dest, undefined, {\n    'hook:init': function () {\n      if (vm._static) {\n        this._static = vm._static\n      }\n      setId(vm, null, target.id, this)\n      // bind template earlier because of lifecycle issues\n      this._externalBinding = {\n        parent: vm,\n        template: target\n      }\n    },\n    'hook:created': function () {\n      bindSubVm(vm, this, target, meta.repeat)\n    },\n    'hook:ready': function () {\n      if (this._content) {\n        compileChildren(vm, target, this._content)\n      }\n    }\n  })\n  bindSubVmAfterInitialized(vm, subVm, target, dest)\n}\n\n/**\n * Generate element from template and attach to the dest if needed.\n * The time to attach depends on whether the mode status is node or tree.\n *\n * @param {object} template\n * @param {object} dest\n * @param {string} type\n */\nfunction compileNativeComponent (vm, template, dest, type) {\n  applyNaitveComponentOptions(template)\n\n  let element\n  if (dest.ref === '_documentElement') {\n    // if its parent is documentElement then it's a body\n    console.debug(`[JS Framework] compile to create body for ${type}`)\n    element = createBody(vm, type)\n  }\n  else {\n    console.debug(`[JS Framework] compile to create element for ${type}`)\n    element = createElement(vm, type)\n  }\n\n  if (!vm._rootEl) {\n    vm._rootEl = element\n    // bind event earlier because of lifecycle issues\n    const binding = vm._externalBinding || {}\n    const target = binding.template\n    const parentVm = binding.parent\n    if (target && target.events && parentVm && element) {\n      for (const type in target.events) {\n        const handler = parentVm[target.events[type]]\n        if (handler) {\n          element.addEvent(type, bind(handler, parentVm))\n        }\n      }\n    }\n  }\n\n  bindElement(vm, element, template)\n\n  if (template.attr && template.attr.append) { // backward, append prop in attr\n    template.append = template.attr.append\n  }\n\n  if (template.append) { // give the append attribute for ios adaptation\n    element.attr = element.attr || {}\n    element.attr.append = template.append\n  }\n\n  const treeMode = template.append === 'tree'\n  const app = vm._app || {}\n  if (app.lastSignal !== -1 && !treeMode) {\n    console.debug('[JS Framework] compile to append single node for', element)\n    app.lastSignal = attachTarget(vm, element, dest)\n  }\n  if (app.lastSignal !== -1) {\n    compileChildren(vm, template, element)\n  }\n  if (app.lastSignal !== -1 && treeMode) {\n    console.debug('[JS Framework] compile to append whole tree for', element)\n    app.lastSignal = attachTarget(vm, element, dest)\n  }\n}\n\n/**\n * Set all children to a certain parent element.\n *\n * @param {object} template\n * @param {object} dest\n */\nfunction compileChildren (vm, template, dest) {\n  const app = vm._app || {}\n  const children = template.children\n  if (children && children.length) {\n    children.every((child) => {\n      compile(vm, child, dest)\n      return app.lastSignal !== -1\n    })\n  }\n}\n\n/**\n * Watch the list update and refresh the changes.\n *\n * @param {object} target\n * @param {object} fragBlock {vms, data, children}\n * @param {object} info      {getter, key, value, trackBy, oldStyle}\n */\nfunction bindRepeat (vm, target, fragBlock, info) {\n  const vms = fragBlock.vms\n  const children = fragBlock.children\n  const { getter, trackBy, oldStyle } = info\n  const keyName = info.key\n  const valueName = info.value\n\n  function compileItem (item, index, context) {\n    let mergedData\n    if (oldStyle) {\n      mergedData = item\n      if (isObject(item)) {\n        mergedData[keyName] = index\n        if (!mergedData.hasOwnProperty('INDEX')) {\n          Object.defineProperty(mergedData, 'INDEX', {\n            value: () => {\n              console.warn('[JS Framework] \"INDEX\" in repeat is deprecated, ' +\n                'please use \"$index\" instead')\n            }\n          })\n        }\n      }\n      else {\n        console.warn('[JS Framework] Each list item must be an object in old-style repeat, '\n          + 'please use `repeat={{v in list}}` instead.')\n        mergedData = {}\n        mergedData[keyName] = index\n        mergedData[valueName] = item\n      }\n    }\n    else {\n      mergedData = {}\n      mergedData[keyName] = index\n      mergedData[valueName] = item\n    }\n    const newContext = mergeContext(context, mergedData)\n    vms.push(newContext)\n    compile(newContext, target, fragBlock, { repeat: item })\n  }\n\n  const list = watchBlock(vm, fragBlock, getter, 'repeat',\n    (data) => {\n      console.debug('[JS Framework] the \"repeat\" item has changed', data)\n      if (!fragBlock || !data) {\n        return\n      }\n\n      const oldChildren = children.slice()\n      const oldVms = vms.slice()\n      const oldData = fragBlock.data.slice()\n      // 1. collect all new refs track by\n      const trackMap = {}\n      const reusedMap = {}\n      data.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        /* istanbul ignore if */\n        if (key == null || key === '') {\n          return\n        }\n        trackMap[key] = item\n      })\n\n      // 2. remove unused element foreach old item\n      const reusedList = []\n      oldData.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        if (trackMap.hasOwnProperty(key)) {\n          reusedMap[key] = {\n            item, index, key,\n            target: oldChildren[index],\n            vm: oldVms[index]\n          }\n          reusedList.push(item)\n        }\n        else {\n          removeTarget(vm, oldChildren[index])\n        }\n      })\n\n      // 3. create new element foreach new item\n      children.length = 0\n      vms.length = 0\n      fragBlock.data = data.slice()\n      fragBlock.updateMark = fragBlock.start\n\n      data.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        const reused = reusedMap[key]\n        if (reused) {\n          if (reused.item === reusedList[0]) {\n            reusedList.shift()\n          }\n          else {\n            reusedList.$remove(reused.item)\n            moveTarget(vm, reused.target, fragBlock.updateMark, true)\n          }\n          children.push(reused.target)\n          vms.push(reused.vm)\n          if (oldStyle) {\n            reused.vm = item\n          }\n          else {\n            reused.vm[valueName] = item\n          }\n          reused.vm[keyName] = index\n          fragBlock.updateMark = reused.target\n        }\n        else {\n          compileItem(item, index, vm)\n        }\n      })\n\n      delete fragBlock.updateMark\n    }\n  )\n\n  fragBlock.data = list.slice(0)\n  list.forEach((item, index) => {\n    compileItem(item, index, vm)\n  })\n}\n\n/**\n * Watch the display update and add/remove the element.\n *\n * @param  {object} target\n * @param  {object} fragBlock\n * @param  {object} context\n */\nfunction bindShown (vm, target, fragBlock, meta) {\n  const display = watchBlock(vm, fragBlock, target.shown, 'shown',\n    (display) => {\n      console.debug('[JS Framework] the \"if\" item was changed', display)\n\n      if (!fragBlock || !!fragBlock.display === !!display) {\n        return\n      }\n      fragBlock.display = !!display\n      if (display) {\n        compile(vm, target, fragBlock, meta)\n      }\n      else {\n        removeTarget(vm, fragBlock, true)\n      }\n    }\n  )\n\n  fragBlock.display = !!display\n  if (display) {\n    compile(vm, target, fragBlock, meta)\n  }\n}\n\n/**\n * Watch calc value changes and append certain type action to differ.\n * It is used for if or repeat data-binding generator.\n *\n * @param  {object}   fragBlock\n * @param  {function} calc\n * @param  {string}   type\n * @param  {function} handler\n * @return {any}      init value of calc\n */\nfunction watchBlock (vm, fragBlock, calc, type, handler) {\n  const differ = vm && vm._app && vm._app.differ\n  const config = {}\n  const depth = (fragBlock.element.depth || 0) + 1\n\n  return watch(vm, calc, (value) => {\n    config.latestValue = value\n    if (differ && !config.recorded) {\n      differ.append(type, depth, fragBlock.blockId, () => {\n        const latestValue = config.latestValue\n        handler(latestValue)\n        config.recorded = false\n        config.latestValue = undefined\n      })\n    }\n    config.recorded = true\n  })\n}\n\n/**\n * Clone a context and merge certain data.\n *\n * @param  {object} mergedData\n * @return {object}\n */\nfunction mergeContext (context, mergedData) {\n  const newContext = Object.create(context)\n  newContext._data = mergedData\n  initData(newContext)\n  initComputed(newContext)\n  newContext._realParent = context\n  if (context._static) {\n    newContext._static = context._static\n  }\n  return newContext\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Everything about component event which includes event object, event listener,\n * event emitter and lifecycle hooks.\n */\n\n/**\n * Event object definition. An event object has `type`, `timestamp` and\n * `detail` from which a component emit. The event object could be dispatched to\n * parents or broadcasted to children except `this.stop()` is called.\n * @param {string} type\n * @param {any}    detail\n */\nfunction Evt (type, detail) {\n  if (detail instanceof Evt) {\n    return detail\n  }\n\n  this.timestamp = Date.now()\n  this.detail = detail\n  this.type = type\n\n  let shouldStop = false\n\n  /**\n   * stop dispatch and broadcast\n   */\n  this.stop = function () {\n    shouldStop = true\n  }\n\n  /**\n   * check if it can't be dispatched or broadcasted\n   */\n  this.hasStopped = function () {\n    return shouldStop\n  }\n}\n\n/**\n * Emit an event but not broadcast down or dispatch up.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $emit (type, detail) {\n  const events = this._vmEvents\n  const handlerList = events[type]\n  if (handlerList) {\n    const evt = new Evt(type, detail)\n    handlerList.forEach((handler) => {\n      handler.call(this, evt)\n    })\n  }\n}\n\n/**\n * Emit an event and dispatch it up.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $dispatch (type, detail) {\n  const evt = new Evt(type, detail)\n  this.$emit(type, evt)\n\n  if (!evt.hasStopped() && this._parent && this._parent.$dispatch) {\n    this._parent.$dispatch(type, evt)\n  }\n}\n\n/**\n * Emit an event and broadcast it down.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $broadcast (type, detail) {\n  const evt = new Evt(type, detail)\n  this.$emit(type, evt)\n\n  if (!evt.hasStopped() && this._childrenVms) {\n    this._childrenVms.forEach((subVm) => {\n      subVm.$broadcast(type, evt)\n    })\n  }\n}\n\n/**\n * Add event listener.\n * @param  {string}   type\n * @param  {function} handler\n */\nexport function $on (type, handler) {\n  if (!type || typeof handler !== 'function') {\n    return\n  }\n  const events = this._vmEvents\n  const handlerList = events[type] || []\n  handlerList.push(handler)\n  events[type] = handlerList\n\n  // fixed old version lifecycle design\n  /* istanbul ignore if */\n  if (type === 'hook:ready' && this._ready) {\n    this.$emit('hook:ready')\n  }\n}\n\n/**\n * Remove event listener.\n * @param  {string}   type\n * @param  {function} handler\n */\nexport function $off (type, handler) {\n  if (!type) {\n    return\n  }\n  const events = this._vmEvents\n  if (!handler) {\n    delete events[type]\n    return\n  }\n  const handlerList = events[type]\n  if (!handlerList) {\n    return\n  }\n  handlerList.$remove(handler)\n}\n\nconst LIFE_CYCLE_TYPES = ['init', 'created', 'ready', 'destroyed']\n\n/**\n * Init events:\n * 1. listen `events` in component options & `externalEvents`.\n * 2. bind lifecycle hooks.\n * @param  {Vm}     vm\n * @param  {object} externalEvents\n */\nexport function initEvents (vm, externalEvents) {\n  const options = vm._options || {}\n  const events = options.events || {}\n  for (const type1 in events) {\n    vm.$on(type1, events[type1])\n  }\n  for (const type2 in externalEvents) {\n    vm.$on(type2, externalEvents[type2])\n  }\n  LIFE_CYCLE_TYPES.forEach((type) => {\n    vm.$on(`hook:${type}`, options[type])\n  })\n}\n\n/**\n * Bind event related methods to ViewModel instance.\n * @param  {Vm} vm\n */\nexport function mixinEvents (vm) {\n  vm.$emit = $emit\n  vm.$dispatch = $dispatch\n  vm.$broadcast = $broadcast\n  vm.$on = $on\n  vm.$off = $off\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * ViewModel Constructor & definition\n */\n\nimport { extend } from '../util/index'\nimport {\n  initState\n} from '../core/state'\nimport {\n  build\n} from './compiler'\nimport {\n  set,\n  del\n} from '../core/observer'\nimport {\n  watch\n} from './directive'\nimport {\n  initEvents,\n  mixinEvents\n} from './events'\n\n/**\n * ViewModel constructor\n *\n * @param {string} type\n * @param {object} options    component options\n * @param {object} parentVm   which contains _app\n * @param {object} parentEl   root element or frag block\n * @param {object} mergedData external data\n * @param {object} externalEvents external events\n */\nexport default function Vm (\n  type,\n  options,\n  parentVm,\n  parentEl,\n  mergedData,\n  externalEvents\n) {\n  parentVm = parentVm || {}\n  this._parent = parentVm._realParent ? parentVm._realParent : parentVm\n  this._app = parentVm._app || {}\n  parentVm._childrenVms && parentVm._childrenVms.push(this)\n\n  if (!options && this._app.customComponentMap) {\n    options = this._app.customComponentMap[type]\n  }\n  options = options || {}\n\n  const data = options.data || {}\n\n  this._options = options\n  this._methods = options.methods || {}\n  this._computed = options.computed || {}\n  this._css = options.style || {}\n  this._ids = {}\n  this._vmEvents = {}\n  this._childrenVms = []\n  this._type = type\n\n  // bind events and lifecycles\n  initEvents(this, externalEvents)\n\n  console.debug(`[JS Framework] \"init\" lifecycle in Vm(${this._type})`)\n  this.$emit('hook:init')\n  this._inited = true\n\n  // proxy data and methods\n  // observe data and add this to vms\n  this._data = typeof data === 'function' ? data() : data\n  if (mergedData) {\n    extend(this._data, mergedData)\n  }\n  initState(this)\n\n  console.debug(`[JS Framework] \"created\" lifecycle in Vm(${this._type})`)\n  this.$emit('hook:created')\n  this._created = true\n\n  // backward old ready entry\n  if (options.methods && options.methods.ready) {\n    console.warn('\"exports.methods.ready\" is deprecated, ' +\n      'please use \"exports.created\" instead')\n    options.methods.ready.call(this)\n  }\n\n  if (!this._app.doc) {\n    return\n  }\n\n  // if no parentElement then specify the documentElement\n  this._parentEl = parentEl || this._app.doc.documentElement\n  build(this)\n}\n\nmixinEvents(Vm.prototype)\n\n/**\n * Watch an function and bind all the data appeared in it. When the related\n * data changes, the callback will be called with new value as 1st param.\n *\n * @param {Function} fn\n * @param {Function} callback\n */\nVm.prototype.$watch = function (fn, callback) {\n  watch(this, fn, callback)\n}\n\nVm.set = set\nVm.delete = del\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nlet nativeModules = {}\n\n// for testing\n\n/**\n * for testing\n */\nexport function getModule (moduleName) {\n  return nativeModules[moduleName]\n}\n\n/**\n * for testing\n */\nexport function clearModules () {\n  nativeModules = {}\n}\n\n// for framework\n\n/**\n * init modules for an app instance\n * the second param determines whether to replace an existed method\n */\nexport function initModules (modules, ifReplace) {\n  for (const moduleName in modules) {\n    // init `modules[moduleName][]`\n    let methods = nativeModules[moduleName]\n    if (!methods) {\n      methods = {}\n      nativeModules[moduleName] = methods\n    }\n\n    // push each non-existed new method\n    modules[moduleName].forEach(function (method) {\n      if (typeof method === 'string') {\n        method = {\n          name: method\n        }\n      }\n\n      if (!methods[method.name] || ifReplace) {\n        methods[method.name] = method\n      }\n    })\n  }\n}\n\n/**\n * init app methods\n */\nexport function initMethods (Vm, apis) {\n  const p = Vm.prototype\n\n  for (const apiName in apis) {\n    if (!p.hasOwnProperty(apiName)) {\n      p[apiName] = apis[apiName]\n    }\n  }\n}\n\n/**\n * get a module of methods for an app instance\n */\nexport function requireModule (app, name) {\n  const methods = nativeModules[name]\n  const target = {}\n  for (const methodName in methods) {\n    Object.defineProperty(target, methodName, {\n      configurable: true,\n      enumerable: true,\n      get: function moduleGetter () {\n        return (...args) => app.callTasks({\n          module: name,\n          method: methodName,\n          args: args\n        })\n      },\n      set: function moduleSetter (value) {\n        if (typeof value === 'function') {\n          return app.callTasks({\n            module: name,\n            method: methodName,\n            args: [value]\n          })\n        }\n      }\n    })\n  }\n  return target\n}\n\n/**\n * get a custom component options\n */\nexport function requireCustomComponent (app, name) {\n  const { customComponentMap } = app\n  return customComponentMap[name]\n}\n\n/**\n * register a custom component options\n */\nexport function registerCustomComponent (app, name, def) {\n  const { customComponentMap } = app\n\n  if (customComponentMap[name]) {\n    console.error(`[JS Framework] define a component(${name}) that already exists`)\n    return\n  }\n\n  customComponentMap[name] = def\n}\n","exports = module.exports = SemVer;\n\n// The debug function is excluded entirely from the minified version.\n/* nomin */ var debug;\n/* nomin */ if (typeof process === 'object' &&\n    /* nomin */ process.env &&\n    /* nomin */ process.env.NODE_DEBUG &&\n    /* nomin */ /\\bsemver\\b/i.test(process.env.NODE_DEBUG))\n  /* nomin */ debug = function() {\n    /* nomin */ var args = Array.prototype.slice.call(arguments, 0);\n    /* nomin */ args.unshift('SEMVER');\n    /* nomin */ console.log.apply(console, args);\n    /* nomin */ };\n/* nomin */ else\n  /* nomin */ debug = function() {};\n\n// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nexports.SEMVER_SPEC_VERSION = '2.0.0';\n\nvar MAX_LENGTH = 256;\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\n\n// The actual regexps go on exports.re\nvar re = exports.re = [];\nvar src = exports.src = [];\nvar R = 0;\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\nvar NUMERICIDENTIFIER = R++;\nsrc[NUMERICIDENTIFIER] = '0|[1-9]\\\\d*';\nvar NUMERICIDENTIFIERLOOSE = R++;\nsrc[NUMERICIDENTIFIERLOOSE] = '[0-9]+';\n\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\nvar NONNUMERICIDENTIFIER = R++;\nsrc[NONNUMERICIDENTIFIER] = '\\\\d*[a-zA-Z-][a-zA-Z0-9-]*';\n\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\nvar MAINVERSION = R++;\nsrc[MAINVERSION] = '(' + src[NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[NUMERICIDENTIFIER] + ')';\n\nvar MAINVERSIONLOOSE = R++;\nsrc[MAINVERSIONLOOSE] = '(' + src[NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[NUMERICIDENTIFIERLOOSE] + ')';\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n\nvar PRERELEASEIDENTIFIER = R++;\nsrc[PRERELEASEIDENTIFIER] = '(?:' + src[NUMERICIDENTIFIER] +\n                            '|' + src[NONNUMERICIDENTIFIER] + ')';\n\nvar PRERELEASEIDENTIFIERLOOSE = R++;\nsrc[PRERELEASEIDENTIFIERLOOSE] = '(?:' + src[NUMERICIDENTIFIERLOOSE] +\n                                 '|' + src[NONNUMERICIDENTIFIER] + ')';\n\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\nvar PRERELEASE = R++;\nsrc[PRERELEASE] = '(?:-(' + src[PRERELEASEIDENTIFIER] +\n                  '(?:\\\\.' + src[PRERELEASEIDENTIFIER] + ')*))';\n\nvar PRERELEASELOOSE = R++;\nsrc[PRERELEASELOOSE] = '(?:-?(' + src[PRERELEASEIDENTIFIERLOOSE] +\n                       '(?:\\\\.' + src[PRERELEASEIDENTIFIERLOOSE] + ')*))';\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\nvar BUILDIDENTIFIER = R++;\nsrc[BUILDIDENTIFIER] = '[0-9A-Za-z-]+';\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\nvar BUILD = R++;\nsrc[BUILD] = '(?:\\\\+(' + src[BUILDIDENTIFIER] +\n             '(?:\\\\.' + src[BUILDIDENTIFIER] + ')*))';\n\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\nvar FULL = R++;\nvar FULLPLAIN = 'v?' + src[MAINVERSION] +\n                src[PRERELEASE] + '?' +\n                src[BUILD] + '?';\n\nsrc[FULL] = '^' + FULLPLAIN + '$';\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\nvar LOOSEPLAIN = '[v=\\\\s]*' + src[MAINVERSIONLOOSE] +\n                 src[PRERELEASELOOSE] + '?' +\n                 src[BUILD] + '?';\n\nvar LOOSE = R++;\nsrc[LOOSE] = '^' + LOOSEPLAIN + '$';\n\nvar GTLT = R++;\nsrc[GTLT] = '((?:<|>)?=?)';\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\nvar XRANGEIDENTIFIERLOOSE = R++;\nsrc[XRANGEIDENTIFIERLOOSE] = src[NUMERICIDENTIFIERLOOSE] + '|x|X|\\\\*';\nvar XRANGEIDENTIFIER = R++;\nsrc[XRANGEIDENTIFIER] = src[NUMERICIDENTIFIER] + '|x|X|\\\\*';\n\nvar XRANGEPLAIN = R++;\nsrc[XRANGEPLAIN] = '[v=\\\\s]*(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:' + src[PRERELEASE] + ')?' +\n                   src[BUILD] + '?' +\n                   ')?)?';\n\nvar XRANGEPLAINLOOSE = R++;\nsrc[XRANGEPLAINLOOSE] = '[v=\\\\s]*(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:' + src[PRERELEASELOOSE] + ')?' +\n                        src[BUILD] + '?' +\n                        ')?)?';\n\nvar XRANGE = R++;\nsrc[XRANGE] = '^' + src[GTLT] + '\\\\s*' + src[XRANGEPLAIN] + '$';\nvar XRANGELOOSE = R++;\nsrc[XRANGELOOSE] = '^' + src[GTLT] + '\\\\s*' + src[XRANGEPLAINLOOSE] + '$';\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\nvar LONETILDE = R++;\nsrc[LONETILDE] = '(?:~>?)';\n\nvar TILDETRIM = R++;\nsrc[TILDETRIM] = '(\\\\s*)' + src[LONETILDE] + '\\\\s+';\nre[TILDETRIM] = new RegExp(src[TILDETRIM], 'g');\nvar tildeTrimReplace = '$1~';\n\nvar TILDE = R++;\nsrc[TILDE] = '^' + src[LONETILDE] + src[XRANGEPLAIN] + '$';\nvar TILDELOOSE = R++;\nsrc[TILDELOOSE] = '^' + src[LONETILDE] + src[XRANGEPLAINLOOSE] + '$';\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\nvar LONECARET = R++;\nsrc[LONECARET] = '(?:\\\\^)';\n\nvar CARETTRIM = R++;\nsrc[CARETTRIM] = '(\\\\s*)' + src[LONECARET] + '\\\\s+';\nre[CARETTRIM] = new RegExp(src[CARETTRIM], 'g');\nvar caretTrimReplace = '$1^';\n\nvar CARET = R++;\nsrc[CARET] = '^' + src[LONECARET] + src[XRANGEPLAIN] + '$';\nvar CARETLOOSE = R++;\nsrc[CARETLOOSE] = '^' + src[LONECARET] + src[XRANGEPLAINLOOSE] + '$';\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\nvar COMPARATORLOOSE = R++;\nsrc[COMPARATORLOOSE] = '^' + src[GTLT] + '\\\\s*(' + LOOSEPLAIN + ')$|^$';\nvar COMPARATOR = R++;\nsrc[COMPARATOR] = '^' + src[GTLT] + '\\\\s*(' + FULLPLAIN + ')$|^$';\n\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\nvar COMPARATORTRIM = R++;\nsrc[COMPARATORTRIM] = '(\\\\s*)' + src[GTLT] +\n                      '\\\\s*(' + LOOSEPLAIN + '|' + src[XRANGEPLAIN] + ')';\n\n// this one has to use the /g flag\nre[COMPARATORTRIM] = new RegExp(src[COMPARATORTRIM], 'g');\nvar comparatorTrimReplace = '$1$2$3';\n\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\nvar HYPHENRANGE = R++;\nsrc[HYPHENRANGE] = '^\\\\s*(' + src[XRANGEPLAIN] + ')' +\n                   '\\\\s+-\\\\s+' +\n                   '(' + src[XRANGEPLAIN] + ')' +\n                   '\\\\s*$';\n\nvar HYPHENRANGELOOSE = R++;\nsrc[HYPHENRANGELOOSE] = '^\\\\s*(' + src[XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s+-\\\\s+' +\n                        '(' + src[XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s*$';\n\n// Star ranges basically just allow anything at all.\nvar STAR = R++;\nsrc[STAR] = '(<|>)?=?\\\\s*\\\\*';\n\n// Compile to actual regexp objects.\n// All are flag-free, unless they were created above with a flag.\nfor (var i = 0; i < R; i++) {\n  debug(i, src[i]);\n  if (!re[i])\n    re[i] = new RegExp(src[i]);\n}\n\nexports.parse = parse;\nfunction parse(version, loose) {\n  if (version instanceof SemVer)\n    return version;\n\n  if (typeof version !== 'string')\n    return null;\n\n  if (version.length > MAX_LENGTH)\n    return null;\n\n  var r = loose ? re[LOOSE] : re[FULL];\n  if (!r.test(version))\n    return null;\n\n  try {\n    return new SemVer(version, loose);\n  } catch (er) {\n    return null;\n  }\n}\n\nexports.valid = valid;\nfunction valid(version, loose) {\n  var v = parse(version, loose);\n  return v ? v.version : null;\n}\n\n\nexports.clean = clean;\nfunction clean(version, loose) {\n  var s = parse(version.trim().replace(/^[=v]+/, ''), loose);\n  return s ? s.version : null;\n}\n\nexports.SemVer = SemVer;\n\nfunction SemVer(version, loose) {\n  if (version instanceof SemVer) {\n    if (version.loose === loose)\n      return version;\n    else\n      version = version.version;\n  } else if (typeof version !== 'string') {\n    throw new TypeError('Invalid Version: ' + version);\n  }\n\n  if (version.length > MAX_LENGTH)\n    throw new TypeError('version is longer than ' + MAX_LENGTH + ' characters')\n\n  if (!(this instanceof SemVer))\n    return new SemVer(version, loose);\n\n  debug('SemVer', version, loose);\n  this.loose = loose;\n  var m = version.trim().match(loose ? re[LOOSE] : re[FULL]);\n\n  if (!m)\n    throw new TypeError('Invalid Version: ' + version);\n\n  this.raw = version;\n\n  // these are actually numbers\n  this.major = +m[1];\n  this.minor = +m[2];\n  this.patch = +m[3];\n\n  if (this.major > MAX_SAFE_INTEGER || this.major < 0)\n    throw new TypeError('Invalid major version')\n\n  if (this.minor > MAX_SAFE_INTEGER || this.minor < 0)\n    throw new TypeError('Invalid minor version')\n\n  if (this.patch > MAX_SAFE_INTEGER || this.patch < 0)\n    throw new TypeError('Invalid patch version')\n\n  // numberify any prerelease numeric ids\n  if (!m[4])\n    this.prerelease = [];\n  else\n    this.prerelease = m[4].split('.').map(function(id) {\n      if (/^[0-9]+$/.test(id)) {\n        var num = +id;\n        if (num >= 0 && num < MAX_SAFE_INTEGER)\n          return num;\n      }\n      return id;\n    });\n\n  this.build = m[5] ? m[5].split('.') : [];\n  this.format();\n}\n\nSemVer.prototype.format = function() {\n  this.version = this.major + '.' + this.minor + '.' + this.patch;\n  if (this.prerelease.length)\n    this.version += '-' + this.prerelease.join('.');\n  return this.version;\n};\n\nSemVer.prototype.toString = function() {\n  return this.version;\n};\n\nSemVer.prototype.compare = function(other) {\n  debug('SemVer.compare', this.version, this.loose, other);\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  return this.compareMain(other) || this.comparePre(other);\n};\n\nSemVer.prototype.compareMain = function(other) {\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  return compareIdentifiers(this.major, other.major) ||\n         compareIdentifiers(this.minor, other.minor) ||\n         compareIdentifiers(this.patch, other.patch);\n};\n\nSemVer.prototype.comparePre = function(other) {\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  // NOT having a prerelease is > having one\n  if (this.prerelease.length && !other.prerelease.length)\n    return -1;\n  else if (!this.prerelease.length && other.prerelease.length)\n    return 1;\n  else if (!this.prerelease.length && !other.prerelease.length)\n    return 0;\n\n  var i = 0;\n  do {\n    var a = this.prerelease[i];\n    var b = other.prerelease[i];\n    debug('prerelease compare', i, a, b);\n    if (a === undefined && b === undefined)\n      return 0;\n    else if (b === undefined)\n      return 1;\n    else if (a === undefined)\n      return -1;\n    else if (a === b)\n      continue;\n    else\n      return compareIdentifiers(a, b);\n  } while (++i);\n};\n\n// preminor will bump the version up to the next minor release, and immediately\n// down to pre-release. premajor and prepatch work the same way.\nSemVer.prototype.inc = function(release, identifier) {\n  switch (release) {\n    case 'premajor':\n      this.prerelease.length = 0;\n      this.patch = 0;\n      this.minor = 0;\n      this.major++;\n      this.inc('pre', identifier);\n      break;\n    case 'preminor':\n      this.prerelease.length = 0;\n      this.patch = 0;\n      this.minor++;\n      this.inc('pre', identifier);\n      break;\n    case 'prepatch':\n      // If this is already a prerelease, it will bump to the next version\n      // drop any prereleases that might already exist, since they are not\n      // relevant at this point.\n      this.prerelease.length = 0;\n      this.inc('patch', identifier);\n      this.inc('pre', identifier);\n      break;\n    // If the input is a non-prerelease version, this acts the same as\n    // prepatch.\n    case 'prerelease':\n      if (this.prerelease.length === 0)\n        this.inc('patch', identifier);\n      this.inc('pre', identifier);\n      break;\n\n    case 'major':\n      // If this is a pre-major version, bump up to the same major version.\n      // Otherwise increment major.\n      // 1.0.0-5 bumps to 1.0.0\n      // 1.1.0 bumps to 2.0.0\n      if (this.minor !== 0 || this.patch !== 0 || this.prerelease.length === 0)\n        this.major++;\n      this.minor = 0;\n      this.patch = 0;\n      this.prerelease = [];\n      break;\n    case 'minor':\n      // If this is a pre-minor version, bump up to the same minor version.\n      // Otherwise increment minor.\n      // 1.2.0-5 bumps to 1.2.0\n      // 1.2.1 bumps to 1.3.0\n      if (this.patch !== 0 || this.prerelease.length === 0)\n        this.minor++;\n      this.patch = 0;\n      this.prerelease = [];\n      break;\n    case 'patch':\n      // If this is not a pre-release version, it will increment the patch.\n      // If it is a pre-release it will bump up to the same patch version.\n      // 1.2.0-5 patches to 1.2.0\n      // 1.2.0 patches to 1.2.1\n      if (this.prerelease.length === 0)\n        this.patch++;\n      this.prerelease = [];\n      break;\n    // This probably shouldn't be used publicly.\n    // 1.0.0 \"pre\" would become 1.0.0-0 which is the wrong direction.\n    case 'pre':\n      if (this.prerelease.length === 0)\n        this.prerelease = [0];\n      else {\n        var i = this.prerelease.length;\n        while (--i >= 0) {\n          if (typeof this.prerelease[i] === 'number') {\n            this.prerelease[i]++;\n            i = -2;\n          }\n        }\n        if (i === -1) // didn't increment anything\n          this.prerelease.push(0);\n      }\n      if (identifier) {\n        // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n        // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n        if (this.prerelease[0] === identifier) {\n          if (isNaN(this.prerelease[1]))\n            this.prerelease = [identifier, 0];\n        } else\n          this.prerelease = [identifier, 0];\n      }\n      break;\n\n    default:\n      throw new Error('invalid increment argument: ' + release);\n  }\n  this.format();\n  this.raw = this.version;\n  return this;\n};\n\nexports.inc = inc;\nfunction inc(version, release, loose, identifier) {\n  if (typeof(loose) === 'string') {\n    identifier = loose;\n    loose = undefined;\n  }\n\n  try {\n    return new SemVer(version, loose).inc(release, identifier).version;\n  } catch (er) {\n    return null;\n  }\n}\n\nexports.diff = diff;\nfunction diff(version1, version2) {\n  if (eq(version1, version2)) {\n    return null;\n  } else {\n    var v1 = parse(version1);\n    var v2 = parse(version2);\n    if (v1.prerelease.length || v2.prerelease.length) {\n      for (var key in v1) {\n        if (key === 'major' || key === 'minor' || key === 'patch') {\n          if (v1[key] !== v2[key]) {\n            return 'pre'+key;\n          }\n        }\n      }\n      return 'prerelease';\n    }\n    for (var key in v1) {\n      if (key === 'major' || key === 'minor' || key === 'patch') {\n        if (v1[key] !== v2[key]) {\n          return key;\n        }\n      }\n    }\n  }\n}\n\nexports.compareIdentifiers = compareIdentifiers;\n\nvar numeric = /^[0-9]+$/;\nfunction compareIdentifiers(a, b) {\n  var anum = numeric.test(a);\n  var bnum = numeric.test(b);\n\n  if (anum && bnum) {\n    a = +a;\n    b = +b;\n  }\n\n  return (anum && !bnum) ? -1 :\n         (bnum && !anum) ? 1 :\n         a < b ? -1 :\n         a > b ? 1 :\n         0;\n}\n\nexports.rcompareIdentifiers = rcompareIdentifiers;\nfunction rcompareIdentifiers(a, b) {\n  return compareIdentifiers(b, a);\n}\n\nexports.major = major;\nfunction major(a, loose) {\n  return new SemVer(a, loose).major;\n}\n\nexports.minor = minor;\nfunction minor(a, loose) {\n  return new SemVer(a, loose).minor;\n}\n\nexports.patch = patch;\nfunction patch(a, loose) {\n  return new SemVer(a, loose).patch;\n}\n\nexports.compare = compare;\nfunction compare(a, b, loose) {\n  return new SemVer(a, loose).compare(new SemVer(b, loose));\n}\n\nexports.compareLoose = compareLoose;\nfunction compareLoose(a, b) {\n  return compare(a, b, true);\n}\n\nexports.rcompare = rcompare;\nfunction rcompare(a, b, loose) {\n  return compare(b, a, loose);\n}\n\nexports.sort = sort;\nfunction sort(list, loose) {\n  return list.sort(function(a, b) {\n    return exports.compare(a, b, loose);\n  });\n}\n\nexports.rsort = rsort;\nfunction rsort(list, loose) {\n  return list.sort(function(a, b) {\n    return exports.rcompare(a, b, loose);\n  });\n}\n\nexports.gt = gt;\nfunction gt(a, b, loose) {\n  return compare(a, b, loose) > 0;\n}\n\nexports.lt = lt;\nfunction lt(a, b, loose) {\n  return compare(a, b, loose) < 0;\n}\n\nexports.eq = eq;\nfunction eq(a, b, loose) {\n  return compare(a, b, loose) === 0;\n}\n\nexports.neq = neq;\nfunction neq(a, b, loose) {\n  return compare(a, b, loose) !== 0;\n}\n\nexports.gte = gte;\nfunction gte(a, b, loose) {\n  return compare(a, b, loose) >= 0;\n}\n\nexports.lte = lte;\nfunction lte(a, b, loose) {\n  return compare(a, b, loose) <= 0;\n}\n\nexports.cmp = cmp;\nfunction cmp(a, op, b, loose) {\n  var ret;\n  switch (op) {\n    case '===':\n      if (typeof a === 'object') a = a.version;\n      if (typeof b === 'object') b = b.version;\n      ret = a === b;\n      break;\n    case '!==':\n      if (typeof a === 'object') a = a.version;\n      if (typeof b === 'object') b = b.version;\n      ret = a !== b;\n      break;\n    case '': case '=': case '==': ret = eq(a, b, loose); break;\n    case '!=': ret = neq(a, b, loose); break;\n    case '>': ret = gt(a, b, loose); break;\n    case '>=': ret = gte(a, b, loose); break;\n    case '<': ret = lt(a, b, loose); break;\n    case '<=': ret = lte(a, b, loose); break;\n    default: throw new TypeError('Invalid operator: ' + op);\n  }\n  return ret;\n}\n\nexports.Comparator = Comparator;\nfunction Comparator(comp, loose) {\n  if (comp instanceof Comparator) {\n    if (comp.loose === loose)\n      return comp;\n    else\n      comp = comp.value;\n  }\n\n  if (!(this instanceof Comparator))\n    return new Comparator(comp, loose);\n\n  debug('comparator', comp, loose);\n  this.loose = loose;\n  this.parse(comp);\n\n  if (this.semver === ANY)\n    this.value = '';\n  else\n    this.value = this.operator + this.semver.version;\n\n  debug('comp', this);\n}\n\nvar ANY = {};\nComparator.prototype.parse = function(comp) {\n  var r = this.loose ? re[COMPARATORLOOSE] : re[COMPARATOR];\n  var m = comp.match(r);\n\n  if (!m)\n    throw new TypeError('Invalid comparator: ' + comp);\n\n  this.operator = m[1];\n  if (this.operator === '=')\n    this.operator = '';\n\n  // if it literally is just '>' or '' then allow anything.\n  if (!m[2])\n    this.semver = ANY;\n  else\n    this.semver = new SemVer(m[2], this.loose);\n};\n\nComparator.prototype.toString = function() {\n  return this.value;\n};\n\nComparator.prototype.test = function(version) {\n  debug('Comparator.test', version, this.loose);\n\n  if (this.semver === ANY)\n    return true;\n\n  if (typeof version === 'string')\n    version = new SemVer(version, this.loose);\n\n  return cmp(version, this.operator, this.semver, this.loose);\n};\n\nComparator.prototype.intersects = function(comp, loose) {\n  if (!(comp instanceof Comparator)) {\n    throw new TypeError('a Comparator is required');\n  }\n\n  var rangeTmp;\n\n  if (this.operator === '') {\n    rangeTmp = new Range(comp.value, loose);\n    return satisfies(this.value, rangeTmp, loose);\n  } else if (comp.operator === '') {\n    rangeTmp = new Range(this.value, loose);\n    return satisfies(comp.semver, rangeTmp, loose);\n  }\n\n  var sameDirectionIncreasing =\n    (this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '>=' || comp.operator === '>');\n  var sameDirectionDecreasing =\n    (this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '<=' || comp.operator === '<');\n  var sameSemVer = this.semver.version === comp.semver.version;\n  var differentDirectionsInclusive =\n    (this.operator === '>=' || this.operator === '<=') &&\n    (comp.operator === '>=' || comp.operator === '<=');\n  var oppositeDirectionsLessThan =\n    cmp(this.semver, '<', comp.semver, loose) &&\n    ((this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '<=' || comp.operator === '<'));\n  var oppositeDirectionsGreaterThan =\n    cmp(this.semver, '>', comp.semver, loose) &&\n    ((this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '>=' || comp.operator === '>'));\n\n  return sameDirectionIncreasing || sameDirectionDecreasing ||\n    (sameSemVer && differentDirectionsInclusive) ||\n    oppositeDirectionsLessThan || oppositeDirectionsGreaterThan;\n};\n\n\nexports.Range = Range;\nfunction Range(range, loose) {\n  if (range instanceof Range) {\n    if (range.loose === loose) {\n      return range;\n    } else {\n      return new Range(range.raw, loose);\n    }\n  }\n\n  if (range instanceof Comparator) {\n    return new Range(range.value, loose);\n  }\n\n  if (!(this instanceof Range))\n    return new Range(range, loose);\n\n  this.loose = loose;\n\n  // First, split based on boolean or ||\n  this.raw = range;\n  this.set = range.split(/\\s*\\|\\|\\s*/).map(function(range) {\n    return this.parseRange(range.trim());\n  }, this).filter(function(c) {\n    // throw out any that are not relevant for whatever reason\n    return c.length;\n  });\n\n  if (!this.set.length) {\n    throw new TypeError('Invalid SemVer Range: ' + range);\n  }\n\n  this.format();\n}\n\nRange.prototype.format = function() {\n  this.range = this.set.map(function(comps) {\n    return comps.join(' ').trim();\n  }).join('||').trim();\n  return this.range;\n};\n\nRange.prototype.toString = function() {\n  return this.range;\n};\n\nRange.prototype.parseRange = function(range) {\n  var loose = this.loose;\n  range = range.trim();\n  debug('range', range, loose);\n  // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n  var hr = loose ? re[HYPHENRANGELOOSE] : re[HYPHENRANGE];\n  range = range.replace(hr, hyphenReplace);\n  debug('hyphen replace', range);\n  // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n  range = range.replace(re[COMPARATORTRIM], comparatorTrimReplace);\n  debug('comparator trim', range, re[COMPARATORTRIM]);\n\n  // `~ 1.2.3` => `~1.2.3`\n  range = range.replace(re[TILDETRIM], tildeTrimReplace);\n\n  // `^ 1.2.3` => `^1.2.3`\n  range = range.replace(re[CARETTRIM], caretTrimReplace);\n\n  // normalize spaces\n  range = range.split(/\\s+/).join(' ');\n\n  // At this point, the range is completely trimmed and\n  // ready to be split into comparators.\n\n  var compRe = loose ? re[COMPARATORLOOSE] : re[COMPARATOR];\n  var set = range.split(' ').map(function(comp) {\n    return parseComparator(comp, loose);\n  }).join(' ').split(/\\s+/);\n  if (this.loose) {\n    // in loose mode, throw out any that are not valid comparators\n    set = set.filter(function(comp) {\n      return !!comp.match(compRe);\n    });\n  }\n  set = set.map(function(comp) {\n    return new Comparator(comp, loose);\n  });\n\n  return set;\n};\n\nRange.prototype.intersects = function(range, loose) {\n  if (!(range instanceof Range)) {\n    throw new TypeError('a Range is required');\n  }\n\n  return this.set.some(function(thisComparators) {\n    return thisComparators.every(function(thisComparator) {\n      return range.set.some(function(rangeComparators) {\n        return rangeComparators.every(function(rangeComparator) {\n          return thisComparator.intersects(rangeComparator, loose);\n        });\n      });\n    });\n  });\n};\n\n// Mostly just for testing and legacy API reasons\nexports.toComparators = toComparators;\nfunction toComparators(range, loose) {\n  return new Range(range, loose).set.map(function(comp) {\n    return comp.map(function(c) {\n      return c.value;\n    }).join(' ').trim().split(' ');\n  });\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nfunction parseComparator(comp, loose) {\n  debug('comp', comp);\n  comp = replaceCarets(comp, loose);\n  debug('caret', comp);\n  comp = replaceTildes(comp, loose);\n  debug('tildes', comp);\n  comp = replaceXRanges(comp, loose);\n  debug('xrange', comp);\n  comp = replaceStars(comp, loose);\n  debug('stars', comp);\n  return comp;\n}\n\nfunction isX(id) {\n  return !id || id.toLowerCase() === 'x' || id === '*';\n}\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0\nfunction replaceTildes(comp, loose) {\n  return comp.trim().split(/\\s+/).map(function(comp) {\n    return replaceTilde(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceTilde(comp, loose) {\n  var r = loose ? re[TILDELOOSE] : re[TILDE];\n  return comp.replace(r, function(_, M, m, p, pr) {\n    debug('tilde', comp, _, M, m, p, pr);\n    var ret;\n\n    if (isX(M))\n      ret = '';\n    else if (isX(m))\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    else if (isX(p))\n      // ~1.2 == >=1.2.0 <1.3.0\n      ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n    else if (pr) {\n      debug('replaceTilde pr', pr);\n      if (pr.charAt(0) !== '-')\n        pr = '-' + pr;\n      ret = '>=' + M + '.' + m + '.' + p + pr +\n            ' <' + M + '.' + (+m + 1) + '.0';\n    } else\n      // ~1.2.3 == >=1.2.3 <1.3.0\n      ret = '>=' + M + '.' + m + '.' + p +\n            ' <' + M + '.' + (+m + 1) + '.0';\n\n    debug('tilde return', ret);\n    return ret;\n  });\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0\n// ^1.2.3 --> >=1.2.3 <2.0.0\n// ^1.2.0 --> >=1.2.0 <2.0.0\nfunction replaceCarets(comp, loose) {\n  return comp.trim().split(/\\s+/).map(function(comp) {\n    return replaceCaret(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceCaret(comp, loose) {\n  debug('caret', comp, loose);\n  var r = loose ? re[CARETLOOSE] : re[CARET];\n  return comp.replace(r, function(_, M, m, p, pr) {\n    debug('caret', comp, _, M, m, p, pr);\n    var ret;\n\n    if (isX(M))\n      ret = '';\n    else if (isX(m))\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    else if (isX(p)) {\n      if (M === '0')\n        ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n      else\n        ret = '>=' + M + '.' + m + '.0 <' + (+M + 1) + '.0.0';\n    } else if (pr) {\n      debug('replaceCaret pr', pr);\n      if (pr.charAt(0) !== '-')\n        pr = '-' + pr;\n      if (M === '0') {\n        if (m === '0')\n          ret = '>=' + M + '.' + m + '.' + p + pr +\n                ' <' + M + '.' + m + '.' + (+p + 1);\n        else\n          ret = '>=' + M + '.' + m + '.' + p + pr +\n                ' <' + M + '.' + (+m + 1) + '.0';\n      } else\n        ret = '>=' + M + '.' + m + '.' + p + pr +\n              ' <' + (+M + 1) + '.0.0';\n    } else {\n      debug('no pr');\n      if (M === '0') {\n        if (m === '0')\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + m + '.' + (+p + 1);\n        else\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + (+m + 1) + '.0';\n      } else\n        ret = '>=' + M + '.' + m + '.' + p +\n              ' <' + (+M + 1) + '.0.0';\n    }\n\n    debug('caret return', ret);\n    return ret;\n  });\n}\n\nfunction replaceXRanges(comp, loose) {\n  debug('replaceXRanges', comp, loose);\n  return comp.split(/\\s+/).map(function(comp) {\n    return replaceXRange(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceXRange(comp, loose) {\n  comp = comp.trim();\n  var r = loose ? re[XRANGELOOSE] : re[XRANGE];\n  return comp.replace(r, function(ret, gtlt, M, m, p, pr) {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr);\n    var xM = isX(M);\n    var xm = xM || isX(m);\n    var xp = xm || isX(p);\n    var anyX = xp;\n\n    if (gtlt === '=' && anyX)\n      gtlt = '';\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0';\n      } else {\n        // nothing is forbidden\n        ret = '*';\n      }\n    } else if (gtlt && anyX) {\n      // replace X with 0\n      if (xm)\n        m = 0;\n      if (xp)\n        p = 0;\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        // >1.2.3 => >= 1.2.4\n        gtlt = '>=';\n        if (xm) {\n          M = +M + 1;\n          m = 0;\n          p = 0;\n        } else if (xp) {\n          m = +m + 1;\n          p = 0;\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<';\n        if (xm)\n          M = +M + 1;\n        else\n          m = +m + 1;\n      }\n\n      ret = gtlt + M + '.' + m + '.' + p;\n    } else if (xm) {\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    } else if (xp) {\n      ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n    }\n\n    debug('xRange return', ret);\n\n    return ret;\n  });\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nfunction replaceStars(comp, loose) {\n  debug('replaceStars', comp, loose);\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp.trim().replace(re[STAR], '');\n}\n\n// This function is passed to string.replace(re[HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0\nfunction hyphenReplace($0,\n                       from, fM, fm, fp, fpr, fb,\n                       to, tM, tm, tp, tpr, tb) {\n\n  if (isX(fM))\n    from = '';\n  else if (isX(fm))\n    from = '>=' + fM + '.0.0';\n  else if (isX(fp))\n    from = '>=' + fM + '.' + fm + '.0';\n  else\n    from = '>=' + from;\n\n  if (isX(tM))\n    to = '';\n  else if (isX(tm))\n    to = '<' + (+tM + 1) + '.0.0';\n  else if (isX(tp))\n    to = '<' + tM + '.' + (+tm + 1) + '.0';\n  else if (tpr)\n    to = '<=' + tM + '.' + tm + '.' + tp + '-' + tpr;\n  else\n    to = '<=' + to;\n\n  return (from + ' ' + to).trim();\n}\n\n\n// if ANY of the sets match ALL of its comparators, then pass\nRange.prototype.test = function(version) {\n  if (!version)\n    return false;\n\n  if (typeof version === 'string')\n    version = new SemVer(version, this.loose);\n\n  for (var i = 0; i < this.set.length; i++) {\n    if (testSet(this.set[i], version))\n      return true;\n  }\n  return false;\n};\n\nfunction testSet(set, version) {\n  for (var i = 0; i < set.length; i++) {\n    if (!set[i].test(version))\n      return false;\n  }\n\n  if (version.prerelease.length) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (var i = 0; i < set.length; i++) {\n      debug(set[i].semver);\n      if (set[i].semver === ANY)\n        continue;\n\n      if (set[i].semver.prerelease.length > 0) {\n        var allowed = set[i].semver;\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch)\n          return true;\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false;\n  }\n\n  return true;\n}\n\nexports.satisfies = satisfies;\nfunction satisfies(version, range, loose) {\n  try {\n    range = new Range(range, loose);\n  } catch (er) {\n    return false;\n  }\n  return range.test(version);\n}\n\nexports.maxSatisfying = maxSatisfying;\nfunction maxSatisfying(versions, range, loose) {\n  var max = null;\n  var maxSV = null;\n  try {\n    var rangeObj = new Range(range, loose);\n  } catch (er) {\n    return null;\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) { // satisfies(v, range, loose)\n      if (!max || maxSV.compare(v) === -1) { // compare(max, v, true)\n        max = v;\n        maxSV = new SemVer(max, loose);\n      }\n    }\n  })\n  return max;\n}\n\nexports.minSatisfying = minSatisfying;\nfunction minSatisfying(versions, range, loose) {\n  var min = null;\n  var minSV = null;\n  try {\n    var rangeObj = new Range(range, loose);\n  } catch (er) {\n    return null;\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) { // satisfies(v, range, loose)\n      if (!min || minSV.compare(v) === 1) { // compare(min, v, true)\n        min = v;\n        minSV = new SemVer(min, loose);\n      }\n    }\n  })\n  return min;\n}\n\nexports.validRange = validRange;\nfunction validRange(range, loose) {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, loose).range || '*';\n  } catch (er) {\n    return null;\n  }\n}\n\n// Determine if version is less than all the versions possible in the range\nexports.ltr = ltr;\nfunction ltr(version, range, loose) {\n  return outside(version, range, '<', loose);\n}\n\n// Determine if version is greater than all the versions possible in the range.\nexports.gtr = gtr;\nfunction gtr(version, range, loose) {\n  return outside(version, range, '>', loose);\n}\n\nexports.outside = outside;\nfunction outside(version, range, hilo, loose) {\n  version = new SemVer(version, loose);\n  range = new Range(range, loose);\n\n  var gtfn, ltefn, ltfn, comp, ecomp;\n  switch (hilo) {\n    case '>':\n      gtfn = gt;\n      ltefn = lte;\n      ltfn = lt;\n      comp = '>';\n      ecomp = '>=';\n      break;\n    case '<':\n      gtfn = lt;\n      ltefn = gte;\n      ltfn = gt;\n      comp = '<';\n      ecomp = '<=';\n      break;\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"');\n  }\n\n  // If it satisifes the range it is not outside\n  if (satisfies(version, range, loose)) {\n    return false;\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (var i = 0; i < range.set.length; ++i) {\n    var comparators = range.set[i];\n\n    var high = null;\n    var low = null;\n\n    comparators.forEach(function(comparator) {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator;\n      low = low || comparator;\n      if (gtfn(comparator.semver, high.semver, loose)) {\n        high = comparator;\n      } else if (ltfn(comparator.semver, low.semver, loose)) {\n        low = comparator;\n      }\n    });\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false;\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false;\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexports.prerelease = prerelease;\nfunction prerelease(version, loose) {\n  var parsed = parse(version, loose);\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null;\n}\n\nexports.intersects = intersects;\nfunction intersects(r1, r2, loose) {\n  r1 = new Range(r1, loose)\n  r2 = new Range(r2, loose)\n  return r1.intersects(r2)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport semver from 'semver'\nimport { isPlainObject, typof } from '../util/index'\n\n/**\n * Normalize a version string.\n * @param  {String} Version. ie: 1, 1.0, 1.0.0\n * @return {String} Version\n */\nexport function normalizeVersion (v) {\n  const isValid = semver.valid(v)\n  if (isValid) {\n    return v\n  }\n\n  v = typeof (v) === 'string' ? v : ''\n  const split = v.split('.')\n  let i = 0\n  const result = []\n\n  while (i < 3) {\n    const s = typeof (split[i]) === 'string' && split[i] ? split[i] : '0'\n    result.push(s)\n    i++\n  }\n\n  return result.join('.')\n}\n\n/**\n * Get informations from different error key. Like:\n * - code\n * - errorMessage\n * - errorType\n * - isDowngrade\n * @param  {string} key\n * @param  {string} val\n * @param  {string} criteria\n * @return {object}\n */\nexport function getError (key, val, criteria) {\n  const result = {\n    isDowngrade: true,\n    errorType: 1,\n    code: 1000\n  }\n  const getMsg = function (key, val, criteria) {\n    return 'Downgrade[' + key + '] :: deviceInfo '\n      + val + ' matched criteria ' + criteria\n  }\n  const _key = key.toLowerCase()\n\n  result.errorMessage = getMsg(key, val, criteria)\n\n  if (_key.indexOf('osversion') >= 0) {\n    result.code = 1001\n  }\n  else if (_key.indexOf('appversion') >= 0) {\n    result.code = 1002\n  }\n  else if (_key.indexOf('weexversion') >= 0) {\n    result.code = 1003\n  }\n  else if (_key.indexOf('devicemodel') >= 0) {\n    result.code = 1004\n  }\n\n  return result\n}\n\n/**\n * WEEX framework input(deviceInfo)\n * {\n *   platform: 'iOS' or 'android'\n *   osVersion: '1.0.0' or '1.0' or '1'\n *   appVersion: '1.0.0' or '1.0' or '1'\n *   weexVersion: '1.0.0' or '1.0' or '1'\n *   dDeviceModel: 'MODEL_NAME'\n * }\n *\n * downgrade config(config)\n * {\n *   ios: {\n *     osVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     appVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     weexVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     deviceModel: ['modelA', 'modelB', ...]\n *   },\n *   android: {\n *     osVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     appVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     weexVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     deviceModel: ['modelA', 'modelB', ...]\n *   }\n * }\n *\n *\n * @param  {object} deviceInfo Weex SDK framework input\n * @param  {object} config     user input\n * @return {Object}            { isDowngrade: true/false, errorMessage... }\n */\nexport function check (config, deviceInfo) {\n  deviceInfo = deviceInfo || global.WXEnvironment\n  deviceInfo = isPlainObject(deviceInfo) ? deviceInfo : {}\n\n  let result = {\n    isDowngrade: false // defautl is pass\n  }\n\n  if (typof(config) === 'function') {\n    let customDowngrade = config.call(this, deviceInfo, {\n      semver: semver,\n      normalizeVersion\n    })\n\n    customDowngrade = !!customDowngrade\n\n    result = customDowngrade ? getError('custom', '', 'custom params') : result\n  }\n  else {\n    config = isPlainObject(config) ? config : {}\n\n    const platform = deviceInfo.platform || 'unknow'\n    const dPlatform = platform.toLowerCase()\n    const cObj = config[dPlatform] || {}\n\n    for (const i in deviceInfo) {\n      const key = i\n      const keyLower = key.toLowerCase()\n      const val = deviceInfo[i]\n      const isVersion = keyLower.indexOf('version') >= 0\n      const isDeviceModel = keyLower.indexOf('devicemodel') >= 0\n      const criteria = cObj[i]\n\n      if (criteria && isVersion) {\n        const c = normalizeVersion(criteria)\n        const d = normalizeVersion(deviceInfo[i])\n\n        if (semver.satisfies(d, c)) {\n          result = getError(key, val, criteria)\n          break\n        }\n      }\n      else if (isDeviceModel) {\n        const _criteria = typof(criteria) === 'array' ? criteria : [criteria]\n        if (_criteria.indexOf(val) >= 0) {\n          result = getError(key, val, criteria)\n          break\n        }\n      }\n    }\n  }\n\n  return result\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport semver from 'semver'\nimport Vm from '../../vm/index'\nimport * as downgrade from '../downgrade'\nimport { setViewport } from '../viewport'\nimport {\n  requireCustomComponent\n} from '../register'\nimport {\n  isPlainObject,\n  isWeexComponent,\n  isNpmModule,\n  removeWeexPrefix,\n  removeJSSurfix\n} from '../../util/index'\n\n/**\n * bootstrap app from a certain custom component with config & data\n */\nexport function bootstrap (app, name, config, data) {\n  console.debug(`[JS Framework] bootstrap for ${name}`)\n\n  // 1. validate custom component name first\n  let cleanName\n  if (isWeexComponent(name)) {\n    cleanName = removeWeexPrefix(name)\n  }\n  else if (isNpmModule(name)) {\n    cleanName = removeJSSurfix(name)\n    // check if define by old 'define' method\n    /* istanbul ignore if */\n    if (!requireCustomComponent(app, cleanName)) {\n      return new Error(`It's not a component: ${name}`)\n    }\n  }\n  else {\n    return new Error(`Wrong component name: ${name}`)\n  }\n\n  // 2. validate configuration\n  config = isPlainObject(config) ? config : {}\n  // 2.1 transformer version check\n  if (typeof config.transformerVersion === 'string' &&\n    typeof global.transformerVersion === 'string' &&\n    !semver.satisfies(config.transformerVersion,\n      global.transformerVersion)) {\n    return new Error(`JS Bundle version: ${config.transformerVersion} ` +\n      `not compatible with ${global.transformerVersion}`)\n  }\n  // 2.2 downgrade version check\n  const downgradeResult = downgrade.check(config.downgrade)\n  /* istanbul ignore if */\n  if (downgradeResult.isDowngrade) {\n    app.callTasks([{\n      module: 'instanceWrap',\n      method: 'error',\n      args: [\n        downgradeResult.errorType,\n        downgradeResult.code,\n        downgradeResult.errorMessage\n      ]\n    }])\n    return new Error(`Downgrade[${downgradeResult.code}]: ${downgradeResult.errorMessage}`)\n  }\n\n  // set viewport\n  if (config.viewport) {\n    setViewport(app, config.viewport)\n  }\n\n  // 3. create a new Vm with custom component name and data\n  app.vm = new Vm(cleanName, null, { _app: app }, null, data)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport function setViewport (app, configs = {}) {\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV === 'development') {\n    console.debug(`[JS Framework] Set viewport (width: ${configs.width}) for app#${app.id}.`)\n    validateViewport(configs)\n  }\n\n  // Send viewport configs to native\n  if (app && app.callTasks) {\n    return app.callTasks([{\n      module: 'meta',\n      method: 'setViewport',\n      args: [configs]\n    }])\n  }\n\n  /* istanbul ignore next */\n  else if (process.env.NODE_ENV === 'development') {\n    console.warn(`[JS Framework] Can't find \"callTasks\" method on current app.`)\n  }\n}\n\n/**\n * Validate the viewport config.\n * @param {Object} configs\n */\nexport function validateViewport (configs = {}) {\n  const { width } = configs\n  if (width) {\n    if (typeof width !== 'number' && width !== 'device-width') {\n      console.warn(`[JS Framework] Not support to use ${width} as viewport width.`)\n      return false\n    }\n    return true\n  }\n  console.warn('[JS Framework] the viewport config should contain the \"width\" property.')\n  return false\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isWeexComponent,\n  isWeexModule,\n  isNormalModule,\n  isNpmModule,\n  removeWeexPrefix,\n  removeJSSurfix\n} from '../../util/index'\nimport {\n  registerCustomComponent,\n  requireCustomComponent,\n  initModules\n} from '../register'\n\n/**\n * define(name, factory) for primary usage\n * or\n * define(name, deps, factory) for compatibility\n * Notice: DO NOT use function define() {},\n * it will cause error after builded by webpack\n */\nexport const defineFn = function (app, name, ...args) {\n  console.debug(`[JS Framework] define a component ${name}`)\n\n  // adapt args:\n  // 1. name, deps[], factory()\n  // 2. name, factory()\n  // 3. name, definition{}\n  let factory, definition\n  if (args.length > 1) {\n    definition = args[1]\n  }\n  else {\n    definition = args[0]\n  }\n  if (typeof definition === 'function') {\n    factory = definition\n    definition = null\n  }\n\n  // resolve definition from factory\n  if (factory) {\n    const r = (name) => {\n      if (isWeexComponent(name)) {\n        const cleanName = removeWeexPrefix(name)\n        return requireCustomComponent(app, cleanName)\n      }\n      if (isWeexModule(name)) {\n        const cleanName = removeWeexPrefix(name)\n        return app.requireModule(cleanName)\n      }\n      if (isNormalModule(name) || isNpmModule(name)) {\n        const cleanName = removeJSSurfix(name)\n        return app.commonModules[cleanName]\n      }\n    }\n    const m = { exports: {}}\n    factory(r, m.exports, m)\n    definition = m.exports\n  }\n\n  // apply definition\n  if (isWeexComponent(name)) {\n    const cleanName = removeWeexPrefix(name)\n    registerCustomComponent(app, cleanName, definition)\n  }\n  else if (isWeexModule(name)) {\n    const cleanName = removeWeexPrefix(name)\n    initModules({ [cleanName]: definition })\n  }\n  else if (isNormalModule(name)) {\n    const cleanName = removeJSSurfix(name)\n    app.commonModules[cleanName] = definition\n  }\n  else if (isNpmModule(name)) {\n    const cleanName = removeJSSurfix(name)\n    if (definition.template ||\n        definition.style ||\n        definition.methods) {\n      // downgrade to old define method (define('componentName', factory))\n      // the exports contain one key of template, style or methods\n      // but it has risk!!!\n      registerCustomComponent(app, cleanName, definition)\n    }\n    else {\n      app.commonModules[cleanName] = definition\n    }\n  }\n}\n\n/**\n * @deprecated\n */\nexport function register (app, type, options) {\n  console.warn('[JS Framework] Register is deprecated, please install lastest transformer.')\n  registerCustomComponent(app, type, options)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * instance controls from native\n *\n * - fire event\n * - callback\n * - refresh\n * - destroy\n *\n * corresponded with the API of instance manager (framework.js)\n */\nimport { extend, typof } from '../../util/index'\n\n/**\n * Refresh an app with data to its root component options.\n * @param  {object} app\n * @param  {any}    data\n */\nexport function refresh (app, data) {\n  console.debug(`[JS Framework] Refresh with`, data, `in instance[${app.id}]`)\n  const vm = app.vm\n  if (vm && data) {\n    if (typeof vm.refreshData === 'function') {\n      vm.refreshData(data)\n    }\n    else {\n      extend(vm, data)\n    }\n    app.differ.flush()\n    app.doc.taskCenter.send('dom', { action: 'refreshFinish' }, [])\n    return\n  }\n  return new Error(`invalid data \"${data}\"`)\n}\n\n/**\n * Destroy an app.\n * @param  {object} app\n */\nexport function destroy (app) {\n  console.debug(`[JS Framework] Destory an instance(${app.id})`)\n\n  if (app.vm) {\n    destroyVm(app.vm)\n  }\n\n  app.id = ''\n  app.options = null\n  app.blocks = null\n  app.vm = null\n  app.doc.taskCenter.destroyCallback()\n  app.doc.destroy()\n  app.doc = null\n  app.customComponentMap = null\n  app.commonModules = null\n}\n\n/**\n * Destroy an Vm.\n * @param {object} vm\n */\nexport function destroyVm (vm) {\n  delete vm._app\n  delete vm._computed\n  delete vm._css\n  delete vm._data\n  delete vm._ids\n  delete vm._methods\n  delete vm._options\n  delete vm._parent\n  delete vm._parentEl\n  delete vm._rootEl\n\n  // remove all watchers\n  if (vm._watchers) {\n    let watcherCount = vm._watchers.length\n    while (watcherCount--) {\n      vm._watchers[watcherCount].teardown()\n    }\n    delete vm._watchers\n  }\n\n  // destroy child vms recursively\n  if (vm._childrenVms) {\n    let vmCount = vm._childrenVms.length\n    while (vmCount--) {\n      destroyVm(vm._childrenVms[vmCount])\n    }\n    delete vm._childrenVms\n  }\n\n  console.debug(`[JS Framework] \"destroyed\" lifecycle in Vm(${vm._type})`)\n  vm.$emit('hook:destroyed')\n\n  delete vm._type\n  delete vm._vmEvents\n}\n\n/**\n * Get a JSON object to describe the document body.\n * @param  {object} app\n * @return {object}\n */\nexport function getRootElement (app) {\n  const doc = app.doc || {}\n  const body = doc.body || {}\n  return body.toJSON ? body.toJSON() : {}\n}\n\n/**\n * Fire an event from renderer. The event has type, an event object and an\n * element ref. If the event comes with some virtual-DOM changes, it should\n * have one more parameter to describe the changes.\n * @param  {object} app\n * @param  {string} ref\n * @param  {type}   type\n * @param  {object} e\n * @param  {object} domChanges\n */\nexport function fireEvent (app, ref, type, e, domChanges) {\n  console.debug(`[JS Framework] Fire a \"${type}\" event on an element(${ref}) in instance(${app.id})`)\n  if (Array.isArray(ref)) {\n    ref.some((ref) => {\n      return fireEvent(app, ref, type, e) !== false\n    })\n    return\n  }\n  const el = app.doc.getRef(ref)\n  if (el) {\n    const result = app.doc.fireEvent(el, type, e, domChanges)\n    app.differ.flush()\n    app.doc.taskCenter.send('dom', { action: 'updateFinish' }, [])\n    return result\n  }\n  return new Error(`invalid element reference \"${ref}\"`)\n}\n\n/**\n * Make a callback for a certain app.\n * @param  {object}   app\n * @param  {number}   callbackId\n * @param  {any}      data\n * @param  {boolean}  ifKeepAlive\n */\nexport function callback (app, callbackId, data, ifKeepAlive) {\n  console.debug(`[JS Framework] Invoke a callback(${callbackId}) with`, data, `in instance(${app.id})`)\n  const result = app.doc.taskCenter.callback(callbackId, data, ifKeepAlive)\n  updateActions(app)\n  app.doc.taskCenter.send('dom', { action: 'updateFinish' }, [])\n  return result\n}\n\n/**\n * Collect all virtual-DOM mutations together and send them to renderer.\n * @param  {object} app\n */\nexport function updateActions (app) {\n  app.differ.flush()\n}\n\n/**\n * Call all tasks from an app to renderer (native).\n * @param  {object} app\n * @param  {array}  tasks\n */\nexport function callTasks (app, tasks) {\n  let result\n\n  /* istanbul ignore next */\n  if (typof(tasks) !== 'array') {\n    tasks = [tasks]\n  }\n\n  tasks.forEach(task => {\n    result = app.doc.taskCenter.send(\n      'module',\n      {\n        module: task.module,\n        method: task.method\n      },\n      task.args\n    )\n  })\n\n  return result\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * instance controls from native\n *\n * - init bundle\n *\n * corresponded with the API of instance manager (framework.js)\n */\n\nimport Vm from '../../vm/index'\nimport { removeWeexPrefix } from '../../util/index'\nimport {\n  defineFn,\n  bootstrap,\n  register\n} from '../bundle/index'\nimport { updateActions } from './misc'\n\n/**\n * Init an app by run code witgh data\n * @param  {object} app\n * @param  {string} code\n * @param  {object} data\n */\nexport function init (app, code, data, services) {\n  console.debug('[JS Framework] Intialize an instance with:\\n', data)\n  let result\n\n  // prepare app env methods\n  const bundleDefine = (...args) => defineFn(app, ...args)\n  const bundleBootstrap = (name, config, _data) => {\n    result = bootstrap(app, name, config, _data || data)\n    updateActions(app)\n    app.doc.listener.createFinish()\n    console.debug(`[JS Framework] After intialized an instance(${app.id})`)\n  }\n  const bundleVm = Vm\n  /* istanbul ignore next */\n  const bundleRegister = (...args) => register(app, ...args)\n  /* istanbul ignore next */\n  const bundleRender = (name, _data) => {\n    result = bootstrap(app, name, {}, _data)\n  }\n  /* istanbul ignore next */\n  const bundleRequire = name => _data => {\n    result = bootstrap(app, name, {}, _data)\n  }\n  const bundleDocument = app.doc\n  /* istanbul ignore next */\n  const bundleRequireModule = name => app.requireModule(removeWeexPrefix(name))\n\n  const weexGlobalObject = {\n    config: app.options,\n    define: bundleDefine,\n    bootstrap: bundleBootstrap,\n    requireModule: bundleRequireModule,\n    document: bundleDocument,\n    Vm: bundleVm\n  }\n\n  Object.freeze(weexGlobalObject)\n\n  // prepare code\n  let functionBody\n  /* istanbul ignore if */\n  if (typeof code === 'function') {\n    // `function () {...}` -> `{...}`\n    // not very strict\n    functionBody = code.toString().substr(12)\n  }\n  /* istanbul ignore next */\n  else if (code) {\n    functionBody = code.toString()\n  }\n  // wrap IFFE and use strict mode\n  functionBody = `(function(global){\\n\\n\"use strict\";\\n\\n ${functionBody} \\n\\n})(Object.create(this))`\n\n  // run code and get result\n  const { WXEnvironment } = global\n  const timerAPIs = {}\n\n  /* istanbul ignore if */\n  if (WXEnvironment && WXEnvironment.platform !== 'Web') {\n    // timer APIs polyfill in native\n    const timer = app.requireModule('timer')\n    Object.assign(timerAPIs, {\n      setTimeout: (...args) => {\n        const handler = function () {\n          args[0](...args.slice(2))\n        }\n        timer.setTimeout(handler, args[1])\n        return app.doc.taskCenter.callbackManager.lastCallbackId.toString()\n      },\n      setInterval: (...args) => {\n        const handler = function () {\n          args[0](...args.slice(2))\n        }\n        timer.setInterval(handler, args[1])\n        return app.doc.taskCenter.callbackManager.lastCallbackId.toString()\n      },\n      clearTimeout: (n) => {\n        timer.clearTimeout(n)\n      },\n      clearInterval: (n) => {\n        timer.clearInterval(n)\n      }\n    })\n  }\n  // run code and get result\n  const globalObjects = Object.assign({\n    define: bundleDefine,\n    require: bundleRequire,\n    bootstrap: bundleBootstrap,\n    register: bundleRegister,\n    render: bundleRender,\n    __weex_define__: bundleDefine, // alias for define\n    __weex_bootstrap__: bundleBootstrap, // alias for bootstrap\n    __weex_document__: bundleDocument,\n    __weex_require__: bundleRequireModule,\n    __weex_viewmodel__: bundleVm,\n    weex: weexGlobalObject\n  }, timerAPIs, services)\n  if (!callFunctionNative(globalObjects, functionBody)) {\n    // If failed to compile functionBody on native side,\n    // fallback to callFunction.\n    callFunction(globalObjects, functionBody)\n  }\n\n  return result\n}\n\n/**\n * Call a new function body with some global objects.\n * @param  {object} globalObjects\n * @param  {string} code\n * @return {any}\n */\nfunction callFunction (globalObjects, body) {\n  const globalKeys = []\n  const globalValues = []\n  for (const key in globalObjects) {\n    globalKeys.push(key)\n    globalValues.push(globalObjects[key])\n  }\n  globalKeys.push(body)\n\n  const result = new Function(...globalKeys)\n  return result(...globalValues)\n}\n\n/**\n * Call a new function generated on the V8 native side.\n * @param  {object} globalObjects\n * @param  {string} body\n * @return {boolean} return true if no error occurred.\n */\nfunction callFunctionNative (globalObjects, body) {\n  if (typeof compileAndRunBundle !== 'function') {\n    return false\n  }\n\n  let fn = void 0\n  let isNativeCompileOk = false\n  let script = '(function ('\n  const globalKeys = []\n  const globalValues = []\n  for (const key in globalObjects) {\n    globalKeys.push(key)\n    globalValues.push(globalObjects[key])\n  }\n  for (let i = 0; i < globalKeys.length - 1; ++i) {\n    script += globalKeys[i]\n    script += ','\n  }\n  script += globalKeys[globalKeys.length - 1]\n  script += ') {'\n  script += body\n  script += '} )'\n\n  try {\n    const weex = globalObjects.weex || {}\n    const config = weex.config || {}\n    fn = compileAndRunBundle(script, config.bundleUrl, config.bundleDigest, config.codeCachePath)\n    if (fn && typeof fn === 'function') {\n      fn(...globalValues)\n      isNativeCompileOk = true\n    }\n  }\n  catch (e) {\n    console.error(e)\n  }\n\n  return isNativeCompileOk\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default class Differ {\n  constructor (id) {\n    this.id = id\n    this.map = []\n    this.hooks = []\n  }\n  isEmpty () {\n    return this.map.length === 0\n  }\n  append (type, depth = 0, ref, handler) {\n    if (!this.hasTimer) {\n      this.hasTimer = true\n      setTimeout(() => {\n        this.hasTimer = false\n        this.flush(true)\n      }, 0)\n    }\n    const map = this.map\n    if (!map[depth]) {\n      map[depth] = {}\n    }\n    const group = map[depth]\n    if (!group[type]) {\n      group[type] = {}\n    }\n    if (type === 'element') {\n      if (!group[type][ref]) {\n        group[type][ref] = []\n      }\n      group[type][ref].push(handler)\n    }\n    else {\n      group[type][ref] = handler\n    }\n  }\n  flush (isTimeout) {\n    const map = this.map.slice()\n    this.map.length = 0\n    map.forEach((group) => {\n      callTypeMap(group, 'repeat')\n      callTypeMap(group, 'shown')\n      callTypeList(group, 'element')\n    })\n\n    const hooks = this.hooks.slice()\n    this.hooks.length = 0\n    hooks.forEach((fn) => {\n      fn()\n    })\n\n    if (!this.isEmpty()) {\n      this.flush()\n    }\n  }\n  then (fn) {\n    this.hooks.push(fn)\n  }\n}\n\nfunction callTypeMap (group, type) {\n  const map = group[type]\n  for (const ref in map) {\n    map[ref]()\n  }\n}\n\nfunction callTypeList (group, type) {\n  const map = group[type]\n  for (const ref in map) {\n    const list = map[ref]\n    list.forEach((handler) => { handler() })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Weex App constructor & definition\n */\n\nimport Differ from './differ'\nimport renderer from '../config'\n\n/**\n * App constructor for Weex framework.\n * @param {string} id\n * @param {object} options\n */\nexport default function App (id, options) {\n  this.id = id\n  this.options = options || {}\n  this.vm = null\n  this.customComponentMap = {}\n  this.commonModules = {}\n\n  // document\n  this.doc = new renderer.Document(\n    id,\n    this.options.bundleUrl,\n    null,\n    renderer.Listener\n  )\n  this.differ = new Differ(id)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Weex instance constructor & definition\n */\n\nimport { requireModule } from './register'\nimport { updateActions, callTasks } from './ctrl/index'\nimport App from './instance'\n\n/**\n * @deprecated\n */\nApp.prototype.requireModule = function (name) {\n  return requireModule(this, name)\n}\n\n/**\n * @deprecated\n */\nApp.prototype.updateActions = function () {\n  return updateActions(this)\n}\n\n/**\n * @deprecated\n */\nApp.prototype.callTasks = function (tasks) {\n  return callTasks(this, tasks)\n}\n\n/**\n * Prevent modification of App and App.prototype\n */\nObject.freeze(App)\nObject.freeze(App.prototype)\n\nexport default App\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const instanceMap = {}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Vm from '../vm/index'\nimport config from '../config'\nimport {\n  initModules,\n  initMethods\n} from '../app/register'\n\nconst {\n  nativeComponentMap\n} = config\n\n/**\n * Register the name of each native component.\n * @param  {array} components array of name\n */\nexport function registerComponents (components) {\n  if (Array.isArray(components)) {\n    components.forEach(function register (name) {\n      /* istanbul ignore if */\n      if (!name) {\n        return\n      }\n      if (typeof name === 'string') {\n        nativeComponentMap[name] = true\n      }\n      /* istanbul ignore else */\n      else if (typeof name === 'object' && typeof name.type === 'string') {\n        nativeComponentMap[name.type] = name\n      }\n    })\n  }\n}\n\n/**\n * Register the name and methods of each module.\n * @param  {object} modules a object of modules\n */\nexport function registerModules (modules) {\n  /* istanbul ignore else */\n  if (typeof modules === 'object') {\n    initModules(modules)\n  }\n}\n\n/**\n * Register the name and methods of each api.\n * @param  {object} apis a object of apis\n */\nexport function registerMethods (methods) {\n  /* istanbul ignore else */\n  if (typeof methods === 'object') {\n    initMethods(Vm, methods)\n  }\n}\n\n// @todo: Hack for this framework only. Will be re-designed or removed later.\nglobal.registerMethods = registerMethods\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { instanceMap } from './map'\nimport {\n  fireEvent,\n  callback\n} from '../app/ctrl/index'\n\nconst jsHandlers = {\n  fireEvent: (id, ...args) => {\n    return fireEvent(instanceMap[id], ...args)\n  },\n  callback: (id, ...args) => {\n    return callback(instanceMap[id], ...args)\n  }\n}\n\n/**\n * Accept calls from native (event or callback).\n *\n * @param  {string} id\n * @param  {array} tasks list with `method` and `args`\n */\nexport function receiveTasks (id, tasks) {\n  const instance = instanceMap[id]\n  if (instance && Array.isArray(tasks)) {\n    const results = []\n    tasks.forEach((task) => {\n      const handler = jsHandlers[task.method]\n      const args = [...task.args]\n      /* istanbul ignore else */\n      if (typeof handler === 'function') {\n        args.unshift(id)\n        results.push(handler(...args))\n      }\n    })\n    return results\n  }\n  return new Error(`invalid instance id \"${id}\" or tasks`)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview Weex framework entry.\n */\n\nimport * as methods from './api/methods'\n\nimport Vm from './vm'\nexport { createInstance } from './static/create'\nexport { init, refreshInstance, destroyInstance } from './static/life'\nimport { registerComponents, registerModules, registerMethods } from './static/register'\nexport { receiveTasks } from './static/bridge'\nexport { getRoot } from './static/misc'\n\n// register special methods for Weex framework\nregisterMethods(methods)\n\n/**\n * Prevent modification of Vm and Vm.prototype\n */\nObject.freeze(Vm)\n\nexport { registerComponents, registerModules, registerMethods }\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { subversion } from '../../package.json'\nimport runtime from '../api'\nimport services from '../services'\n\n/**\n * Setup frameworks with runtime.\n * You can package more frameworks by\n *  passing them as arguments.\n */\nexport default function (frameworks) {\n  const { init, config } = runtime\n  config.frameworks = frameworks\n  const { native, transformer } = subversion\n\n  for (const serviceName in services) {\n    runtime.service.register(serviceName, services[serviceName])\n  }\n\n  runtime.freezePrototype()\n\n  // register framework meta info\n  global.frameworkVersion = native\n  global.transformerVersion = transformer\n\n  // init frameworks\n  const globalMethods = init(config)\n\n  // set global methods\n  for (const methodName in globalMethods) {\n    global[methodName] = (...args) => {\n      const ret = globalMethods[methodName](...args)\n      if (ret instanceof Error) {\n        console.error(ret.toString())\n      }\n      return ret\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport setup from './setup'\nimport * as Weex from '../frameworks/legacy/index'\n\nsetup({ Weex })\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport App from '../app/index'\nimport { instanceMap } from './map'\nimport { init as initApp } from '../app/ctrl/index'\nimport { resetTarget } from '../core/dep'\n\n/**\n * Create a Weex instance.\n *\n * @param  {string} id\n * @param  {string} code\n * @param  {object} options\n *         option `HAS_LOG` enable print log\n * @param  {object} data\n * @param  {object} info { created, ... services }\n */\nexport function createInstance (id, code, options, data, info) {\n  const { services } = info || {}\n  resetTarget()\n  let instance = instanceMap[id]\n  /* istanbul ignore else */\n  options = options || {}\n  let result\n  /* istanbul ignore else */\n  if (!instance) {\n    instance = new App(id, options)\n    instanceMap[id] = instance\n    result = initApp(instance, code, data, services)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return (result instanceof Error) ? result : instance\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport config from '../config'\nimport {\n  refresh,\n  destroy\n} from '../app/ctrl/index'\nimport { instanceMap } from './map'\nimport { resetTarget } from '../core/dep'\n\n/**\n * Init config informations for Weex framework\n * @param  {object} cfg\n */\nexport function init (cfg) {\n  config.Document = cfg.Document\n  config.Element = cfg.Element\n  config.Comment = cfg.Comment\n  config.sendTasks = cfg.sendTasks\n  config.Listener = cfg.Listener\n}\n\n/**\n * Refresh a Weex instance with data.\n *\n * @param  {string} id\n * @param  {object} data\n */\nexport function refreshInstance (id, data) {\n  const instance = instanceMap[id]\n  let result\n  /* istanbul ignore else */\n  if (instance) {\n    result = refresh(instance, data)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return result\n}\n\n/**\n * Destroy a Weex instance.\n * @param  {string} id\n */\nexport function destroyInstance (id) {\n  // Markup some global state in native side\n  if (typeof markupState === 'function') {\n    markupState()\n  }\n\n  resetTarget()\n  const instance = instanceMap[id]\n  /* istanbul ignore else */\n  if (!instance) {\n    return new Error(`invalid instance id \"${id}\"`)\n  }\n  destroy(instance)\n  delete instanceMap[id]\n  // notifyContextDisposed is used to tell v8 to do a full GC,\n  // but this would have a negative performance impact on weex,\n  // because all the inline cache in v8 would get cleared\n  // during a full GC.\n  // To take care of both memory and performance, just tell v8\n  // to do a full GC every eighteen times.\n  const idNum = Math.round(id)\n  const round = 18\n  if (idNum > 0) {\n    const remainder = idNum % round\n    if (!remainder && typeof notifyTrimMemory === 'function') {\n      notifyTrimMemory()\n    }\n  }\n  return instanceMap\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { instanceMap } from './map'\nimport {\n  getRootElement\n} from '../app/ctrl/index'\n\n/**\n * Get a whole element tree of an instance for debugging.\n * @param  {string} id\n * @return {object} a virtual dom tree\n */\nexport function getRoot (id) {\n  const instance = instanceMap[id]\n  let result\n  /* istanbul ignore else */\n  if (instance) {\n    result = getRootElement(instance)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return result\n}\n"],"names":["nextNodeRef","uniqueId","toString","typof","v","const","s","Object","prototype","call","substring","length","bufferToBase64","buffer","btoa","string","Array","map","Uint8Array","code","String","fromCharCode","join","isEmpty","any","key","hasOwnProperty","decodePrimitive","data","base64","atob","ArrayBuffer","array","forEach","ch","i","charCodeAt","base64ToBuffer","realData","getHookKey","componentId","type","hookName","CallbackManager","instanceId","this","lastCallbackId","callbacks","hooks","add","callback","remove","callbackId","registerHook","hookFunction","console","warn","triggerHook","options","error","result","apply","args","e","consume","ifKeepAlive","Error","close","docMap","getDoc","id","getTaskCenter","doc","taskCenter","appendBody","node","before","documentElement","pureChildren","parentNode","children","beforeIndex","indexOf","push","splice","nodeType","role","docId","ownerDocument","linkParent","child","setBody","nodeMap","nodeId","body","toJSON","send","action","sendBody","ref","el","depth","_root","parent","nextElement","nextSibling","previousElement","previousSibling","insertIndex","target","list","newIndex","changeSibling","after","moveIndex","index","let","newIndexAfter","beforeNew","afterNew","removeIndex","Node","destroy","Element","registeredElements","DEFAULT_TAG_NAME","BUBBLE_EVENTS","registerNode","props","isExtended","super","WeexElement","attr","style","classStyle","event","appendChild","insertBefore","pureBefore","insertAfter","removeChild","preserved","clear","setAttr","value","silent","setAttrs","batchedAttrs","mutations","setStyle","setStyles","batchedStyles","setClassStyle","assign","toStyle","addEvent","handler","params","removeEvent","fireEvent","isBubble","isStopPropagation","eventDesc","stopPropagation","currentTarget","JSON","stringify","fallback","TaskCenter","sendTasks","defineProperty","enumerable","callbackManager","updateData","newData","module","method","destroyCallback","normalize","_isVue","$el","toISOString","@type","dataType","normalizePrimitive","component","arg","componentHandler","moduleHandler","callDOM","callComponent","callModule","receiveTasks","tasks","document","isArray","task","domChanges","getRef","hook","weexModules","registerModules","newModules","name","isRegisteredModule","weexComponents","registerComponents","newComponents","methods","methodName","registerElement","isRegisteredComponent","services","register","has","unregister","some","service","Comment","createAction","Listener","batched","updates","configurable","writable","createFinish","updateFinish","refreshFinish","createBody","element","actions","addActions","addElement","removeElement","r","moveElement","targetRef","parentRef","cb","handlerMap","updateAttrs","updateStyle","dispatchTask","defaultHandler","global","Document","url","URL","L","listener","callNative","returnValue","createHandler","createDocumentElement","open","_documentElement","createElement","tagName","createComment","text","timestamp","Date","now","changes","attrs","updateElement","moduleProxies","moduleGetter","WeexInstance","config","weex","bundleUrl","requireModule","bind","moduleName","proxyName","moduleDefine","moduleApis","get","set","fn","moduleSetter","Proxy","supports","condition","res","match","frameworks","runtimeConfig","versionRegExp","instanceTypeMap","getFrameworkType","createInstanceContext","freeze","bundleType","framework","label","message","create","err","track","env","serviceMap","instance","createServices","created","runtimeContext","instanceContext","exec","parse","getBundleType","WXEnvironment","createInstance","raxInstanceContext","context","keys","bundle","Function","runInContext","getDocument","registerService","unregisterService","callJS","genInstance","info","refresh","runtime","adaptMethod","sharedMethod","DOM_METHODS","callCreateFinish","callUpdateFinish","callRefreshFinish","callCreateBody","callAddElement","callRemoveElement","callMoveElement","callUpdateAttrs","callUpdateStyle","callAddEvent","callRemoveEvent","proto","callNativeComponent","callNativeModule","initTaskHandler","init","MessageEvent","dict","origin","source","ports","timeStamp","channels","instances","BroadcastChannel","postMessage","_closed","subscribers","member","onmessage","filter","x","serviceObject","channel","_ids","vm","_app","differ","then","offset","scrollToElement","styles","transition","_setStyle","sendHttp","openURL","title","setTitle","extend","src","first","shift","def","obj","val","arr","item","hasOwn","ctx","a","l","arguments","isObject","OBJECT_STRING","isPlainObject","isReserved","str","c","_Set","hasProto","Set","undefined","createNewSet","nativeSet","toLowerCase","WEEX_COMPONENT_REG","WEEX_MODULE_REG","NORMAL_MODULE_REG","JS_SURFIX_REG","isWeexComponent","isWeexModule","isNormalModule","isNpmModule","removeWeexPrefix","replace","removeJSSurfix","uid","Dep","subs","targetStack","resetTarget","addSub","sub","removeSub","depend","addDep","notify","slice","update","Watcher","expOrFn","isFn","_watchers","expression","active","dirty","lazy","deps","newDeps","depIds","newDepIds","getter","queued","shallow","_target","deep","traverse","seen","isA","isO","seenObjects","__ob__","depId","dep","pop","cleanupDeps","tmp","run","oldValue","evaluate","teardown","_isBeingDestroyed","_vForRemoving","arrayProto","arrayMethods","original","inserted","ob","observeArray","arrayKeys","getOwnPropertyNames","Observer","protoAugment","copyAugment","walk","convert","items","observe","property","getOwnPropertyDescriptor","setter","childOb","newVal","defineReactive","addVm","vms","removeVm","__proto__","isExtensible","KEY_WORDS","proxy","_data","initData","noop","initComputed","computed","_computed","userDef","makeComputedGetter","cache","owner","watcher","nativeComponentMap","image","container","slider","append","cell","SETTERS","bindElement","template","setId","bindDir","classList","_options","watch","setClass","events","bindEvents","bindSubVmAfterInitialized","subVm","css","_rootEl","className","addClassName","unshift","mergeClassStyle","mergeStyle","_vm","mergeProps","defineProperties","newId","split","bindKey","calc","_static","createBlock","start","end","blockId","lastestBlockId","updateMark","attachTarget","dest","signal","moveTarget","fragBlock","group","temp","every","moveBlock","removeTarget","preserveBlock","removeBlock","$emit","compile","meta","lastSignal","compileFragment","debug","_content","repeat","oldStyle","trackBy","keyName","valueName","compileItem","mergedData","newContext","_realParent","mergeContext","watchBlock","oldChildren","oldVms","oldData","trackMap","reusedMap","reusedList","reused","$remove","bindRepeat","compileRepeat","shown","newMeta","display","bindShown","compileShown","typeGetter","customComponentMap","components","targetIsComposed","Ctor","constructor","hook:init","_externalBinding","hook:created","repeatItem","reduce","bindSubVm","hook:ready","compileChildren","compileCustomComponent","subkey","applyNaitveComponentOptions","binding","parentVm","treeMode","app","compileNativeComponent","compileType","latestValue","recorded","Evt","detail","shouldStop","stop","hasStopped","handlerList","_vmEvents","evt","$dispatch","_parent","$broadcast","_childrenVms","$on","_ready","$off","LIFE_CYCLE_TYPES","Vm","parentEl","externalEvents","_methods","_css","_type","type1","type2","initEvents","_inited","initMethods","_created","ready","_parentEl","opt","build","$watch","delete","nativeModules","initModules","modules","ifReplace","requireCustomComponent","registerCustomComponent","exports","SemVer","process","MAX_LENGTH","MAX_SAFE_INTEGER","Number","re","R","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","MAINVERSION","MAINVERSIONLOOSE","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","PRERELEASE","PRERELEASELOOSE","BUILDIDENTIFIER","BUILD","FULL","FULLPLAIN","LOOSEPLAIN","LOOSE","GTLT","XRANGEIDENTIFIERLOOSE","XRANGEIDENTIFIER","XRANGEPLAIN","XRANGEPLAINLOOSE","XRANGE","XRANGELOOSE","LONETILDE","TILDETRIM","RegExp","TILDE","TILDELOOSE","LONECARET","CARETTRIM","CARET","CARETLOOSE","COMPARATORLOOSE","COMPARATOR","COMPARATORTRIM","HYPHENRANGE","HYPHENRANGELOOSE","STAR","version","loose","test","er","trim","TypeError","m","raw","major","minor","patch","prerelease","num","format","compare","other","compareMain","comparePre","compareIdentifiers","b","inc","release","identifier","isNaN","version1","version2","eq","v1","v2","numeric","anum","bnum","sort","rcompare","gt","lt","neq","gte","lte","cmp","op","ret","Comparator","comp","semver","ANY","operator","intersects","rangeTmp","Range","satisfies","sameDirectionIncreasing","sameDirectionDecreasing","sameSemVer","differentDirectionsInclusive","oppositeDirectionsLessThan","oppositeDirectionsGreaterThan","range","parseRange","comps","hr","hyphenReplace","compRe","_","M","p","pr","isX","charAt","replaceCaret","replaceTilde","gtlt","xM","xm","xp","anyX","replaceXRange","parseComparator","thisComparators","thisComparator","rangeComparators","rangeComparator","$0","from","fM","fm","fp","fpr","fb","to","tM","tm","tp","tpr","tb","testSet","allowed","versions","max","maxSV","rangeObj","min","minSV","outside","hilo","gtfn","ltefn","ltfn","ecomp","high","low","comparator","parsed","r1","r2","normalizeVersion","valid","getError","criteria","isDowngrade","errorType","_key","errorMessage","bootstrap","cleanName","transformerVersion","downgradeResult","deviceInfo","customDowngrade","cObj","platform","keyLower","isVersion","isDeviceModel","d","downgrade.check","downgrade","callTasks","viewport","configs","setViewport","defineFn","factory","definition","commonModules","destroyVm","watcherCount","vmCount","blocks","updateActions","flush","bundleDefine","bundleBootstrap","bundleVm","bundleDocument","bundleRequireModule","weexGlobalObject","define","functionBody","substr","timerAPIs","timer","setTimeout","setInterval","clearTimeout","n","clearInterval","globalObjects","require","render","__weex_define__","__weex_bootstrap__","__weex_document__","__weex_require__","__weex_viewmodel__","compileAndRunBundle","isNativeCompileOk","script","globalKeys","globalValues","bundleDigest","codeCachePath","callFunctionNative","callFunction","Differ","hasTimer","this$1","isTimeout","callTypeMap","callTypeList","App","renderer","instanceMap","registerMethods","apis","apiName","jsHandlers","native","transformer","serviceName","freezePrototype","frameworkVersion","globalMethods","setup","initApp","cfg","refreshData","markupState","idNum","Math","round","notifyTrimMemory","results","getRootElement"],"mappings":"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"}