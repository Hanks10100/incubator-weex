{"version":3,"file":"weex-legacy.es6.min.js","sources":["../runtime/shared/utils.js","../runtime/bridge/normalize.js","../runtime/bridge/CallbackManager.js","../runtime/vdom/operation.js","../runtime/vdom/Node.js","../runtime/vdom/WeexElement.js","../runtime/vdom/Element.js","../runtime/bridge/TaskCenter.js","../runtime/bridge/receiver.js","../runtime/api/module.js","../runtime/api/component.js","../runtime/api/service.js","../runtime/vdom/Comment.js","../runtime/bridge/Listener.js","../runtime/bridge/Handler.js","../runtime/vdom/Document.js","../runtime/api/WeexInstance.js","../runtime/api/init.js","../runtime/bridge/debug.js","../runtime/api/config.js","../runtime/api/index.js","../runtime/services/broadcast-channel/message-event.js","../runtime/services/broadcast-channel/index.js","../runtime/frameworks/legacy/api/methods.js","../runtime/frameworks/legacy/util/shared.js","../runtime/frameworks/legacy/util/index.js","../runtime/frameworks/legacy/core/dep.js","../runtime/frameworks/legacy/core/watcher.js","../runtime/frameworks/legacy/core/array.js","../runtime/frameworks/legacy/core/observer.js","../runtime/frameworks/legacy/core/state.js","../runtime/frameworks/legacy/config.js","../runtime/frameworks/legacy/vm/directive.js","../runtime/frameworks/legacy/vm/dom-helper.js","../runtime/frameworks/legacy/vm/compiler.js","../runtime/frameworks/legacy/vm/events.js","../runtime/frameworks/legacy/vm/index.js","../runtime/frameworks/legacy/app/register.js","../node_modules/semver/semver.js","../runtime/frameworks/legacy/app/downgrade.js","../runtime/frameworks/legacy/app/bundle/bootstrap.js","../runtime/frameworks/legacy/app/viewport.js","../runtime/frameworks/legacy/app/bundle/define.js","../runtime/frameworks/legacy/app/ctrl/misc.js","../runtime/frameworks/legacy/app/ctrl/init.js","../runtime/frameworks/legacy/app/differ.js","../runtime/frameworks/legacy/app/instance.js","../runtime/frameworks/legacy/app/index.js","../runtime/frameworks/legacy/static/map.js","../runtime/frameworks/legacy/static/register.js","../runtime/frameworks/legacy/static/bridge.js","../runtime/frameworks/legacy/index.js","../runtime/entries/setup.js","../runtime/entries/legacy.js","../runtime/frameworks/legacy/static/create.js","../runtime/frameworks/legacy/static/life.js","../runtime/frameworks/legacy/static/misc.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Get a unique id.\n */\nlet nextNodeRef = 1\nexport function uniqueId () {\n  return (nextNodeRef++).toString()\n}\n\nexport function typof (v) {\n  const s = Object.prototype.toString.call(v)\n  return s.substring(8, s.length - 1)\n}\n\nexport function bufferToBase64 (buffer) {\n  if (typeof btoa !== 'function') {\n    return ''\n  }\n  const string = Array.prototype.map.call(\n    new Uint8Array(buffer),\n    code => String.fromCharCode(code)\n  ).join('')\n  return btoa(string) // eslint-disable-line no-undef\n}\n\nexport function base64ToBuffer (base64) {\n  if (typeof atob !== 'function') {\n    return new ArrayBuffer(0)\n  }\n  const string = atob(base64) // eslint-disable-line no-undef\n  const array = new Uint8Array(string.length)\n  Array.prototype.forEach.call(string, (ch, i) => {\n    array[i] = ch.charCodeAt(0)\n  })\n  return array.buffer\n}\n\n/**\n * Detect if the param is falsy or empty\n * @param {any} any\n */\nexport function isEmpty (any) {\n  if (!any || typeof any !== 'object') {\n    return true\n  }\n\n  for (const key in any) {\n    if (Object.prototype.hasOwnProperty.call(any, key)) {\n      return false\n    }\n  }\n  return true\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { typof, bufferToBase64, base64ToBuffer } from '../shared/utils'\n\n/**\n * Normalize a primitive value.\n * @param  {any}        v\n * @return {primitive}\n */\nexport function normalizePrimitive (v) {\n  const type = typof(v)\n\n  switch (type) {\n    case 'Undefined':\n    case 'Null':\n      return ''\n\n    case 'RegExp':\n      return v.toString()\n    case 'Date':\n      return v.toISOString()\n\n    case 'Number':\n    case 'String':\n    case 'Boolean':\n    case 'Array':\n    case 'Object':\n      return v\n\n    case 'ArrayBuffer':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v)\n      }\n\n    case 'Int8Array':\n    case 'Uint8Array':\n    case 'Uint8ClampedArray':\n    case 'Int16Array':\n    case 'Uint16Array':\n    case 'Int32Array':\n    case 'Uint32Array':\n    case 'Float32Array':\n    case 'Float64Array':\n      return {\n        '@type': 'binary',\n        dataType: type,\n        base64: bufferToBase64(v.buffer)\n      }\n\n    default:\n      return JSON.stringify(v)\n  }\n}\n\nexport function decodePrimitive (data) {\n  if (typof(data) === 'Object') {\n    // decode base64 into binary\n    if (data['@type'] && data['@type'] === 'binary') {\n      return base64ToBuffer(data.base64 || '')\n    }\n\n    const realData = {}\n    for (const key in data) {\n      realData[key] = decodePrimitive(data[key])\n    }\n    return realData\n  }\n  if (typof(data) === 'Array') {\n    return data.map(decodePrimitive)\n  }\n  return data\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { decodePrimitive } from './normalize'\n\nfunction getHookKey (componentId, type, hookName) {\n  return `${type}@${hookName}#${componentId}`\n}\n\n/**\n * For general callback management of a certain Weex instance.\n * Because function can not passed into native, so we create callback\n * callback id for each function and pass the callback id into native\n * in fact. And when a callback called from native, we can find the real\n * callback through the callback id we have passed before.\n */\nexport default class CallbackManager {\n  constructor (instanceId) {\n    this.instanceId = String(instanceId)\n    this.lastCallbackId = 0\n    this.callbacks = {}\n    this.hooks = {}\n  }\n  add (callback) {\n    this.lastCallbackId++\n    this.callbacks[this.lastCallbackId] = callback\n    return this.lastCallbackId\n  }\n  remove (callbackId) {\n    const callback = this.callbacks[callbackId]\n    delete this.callbacks[callbackId]\n    return callback\n  }\n  registerHook (componentId, type, hookName, hookFunction) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    if (this.hooks[key]) {\n      console.warn(`[JS Framework] Override an existing component hook \"${key}\".`)\n    }\n    this.hooks[key] = hookFunction\n  }\n  triggerHook (componentId, type, hookName, options = {}) {\n    // TODO: validate arguments\n    const key = getHookKey(componentId, type, hookName)\n    const hookFunction = this.hooks[key]\n    if (typeof hookFunction !== 'function') {\n      console.error(`[JS Framework] Invalid hook function type (${typeof hookFunction}) on \"${key}\".`)\n      return null\n    }\n    let result = null\n    try {\n      result = hookFunction.apply(null, options.args || [])\n    }\n    catch (e) {\n      console.error(`[JS Framework] Failed to execute the hook function on \"${key}\".`)\n    }\n    return result\n  }\n  consume (callbackId, data, ifKeepAlive) {\n    const callback = this.callbacks[callbackId]\n    if (typeof ifKeepAlive === 'undefined' || ifKeepAlive === false) {\n      delete this.callbacks[callbackId]\n    }\n    if (typeof callback === 'function') {\n      return callback(decodePrimitive(data))\n    }\n    return new Error(`invalid callback id \"${callbackId}\"`)\n  }\n  close () {\n    this.callbacks = {}\n    this.hooks = {}\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst docMap = {}\n\n/**\n * Add a document object into docMap.\n * @param {string} id\n * @param {object} document\n */\nexport function addDoc (id, doc) {\n  if (id) {\n    docMap[id] = doc\n  }\n}\n\n/**\n * Get the document object by id.\n * @param {string} id\n */\nexport function getDoc (id) {\n  return docMap[id]\n}\n\n/**\n * Remove the document from docMap by id.\n * @param {string} id\n */\nexport function removeDoc (id) {\n  delete docMap[id]\n}\n\n/**\n * @deprecated\n * Get listener by document id.\n * @param {string} id\n * @return {object} listener\n */\nexport function getListener (id) {\n  const doc = docMap[id]\n  if (doc && doc.listener) {\n    return doc.listener\n  }\n  return null\n}\n\n/**\n * Get TaskCenter instance by id.\n * @param {string} id\n * @return {object} TaskCenter\n */\nexport function getTaskCenter (id) {\n  const doc = docMap[id]\n  if (doc && doc.taskCenter) {\n    return doc.taskCenter\n  }\n  return null\n}\n\n/**\n * Append body node to documentElement.\n * @param {object} document\n * @param {object} node\n * @param {object} before\n */\nexport function appendBody (doc, node, before) {\n  const { documentElement } = doc\n\n  if (documentElement.pureChildren.length > 0 || node.parentNode) {\n    return\n  }\n  const children = documentElement.children\n  const beforeIndex = children.indexOf(before)\n  if (beforeIndex < 0) {\n    children.push(node)\n  }\n  else {\n    children.splice(beforeIndex, 0, node)\n  }\n\n  if (node.nodeType === 1) {\n    if (node.role === 'body') {\n      node.docId = doc.id\n      node.ownerDocument = doc\n      node.parentNode = documentElement\n      linkParent(node, documentElement)\n    }\n    else {\n      node.children.forEach(child => {\n        child.parentNode = node\n      })\n      setBody(doc, node)\n      node.docId = doc.id\n      node.ownerDocument = doc\n      linkParent(node, documentElement)\n      delete doc.nodeMap[node.nodeId]\n    }\n    documentElement.pureChildren.push(node)\n    sendBody(doc, node)\n  }\n  else {\n    node.parentNode = documentElement\n    doc.nodeMap[node.ref] = node\n  }\n}\n\nfunction sendBody (doc, node) {\n  const body = node.toJSON()\n  if (doc && doc.taskCenter && typeof doc.taskCenter.send === 'function') {\n    doc.taskCenter.send('dom', { action: 'createBody' }, [body])\n  }\n}\n\n/**\n * Set up body node.\n * @param {object} document\n * @param {object} element\n */\nexport function setBody (doc, el) {\n  el.role = 'body'\n  el.depth = 1\n  delete doc.nodeMap[el.nodeId]\n  el.ref = '_root'\n  doc.nodeMap._root = el\n  doc.body = el\n}\n\n/**\n * Establish the connection between parent and child node.\n * @param {object} child node\n * @param {object} parent node\n */\nexport function linkParent (node, parent) {\n  node.parentNode = parent\n  if (parent.docId) {\n    node.docId = parent.docId\n    node.ownerDocument = parent.ownerDocument\n    node.ownerDocument.nodeMap[node.nodeId] = node\n    node.depth = parent.depth + 1\n  }\n  node.children.forEach(child => {\n    linkParent(child, node)\n  })\n}\n\n/**\n * Get the next sibling element.\n * @param {object} node\n */\nexport function nextElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.nextSibling\n  }\n}\n\n/**\n * Get the previous sibling element.\n * @param {object} node\n */\nexport function previousElement (node) {\n  while (node) {\n    if (node.nodeType === 1) {\n      return node\n    }\n    node = node.previousSibling\n  }\n}\n\n/**\n * Insert a node into list at the specified index.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function insertIndex (target, list, newIndex, changeSibling) {\n  /* istanbul ignore next */\n  if (newIndex < 0) {\n    newIndex = 0\n  }\n  const before = list[newIndex - 1]\n  const after = list[newIndex]\n  list.splice(newIndex, 0, target)\n  if (changeSibling) {\n    before && (before.nextSibling = target)\n    target.previousSibling = before\n    target.nextSibling = after\n    after && (after.previousSibling = target)\n  }\n  return newIndex\n}\n\n/**\n * Move the node to a new index in list.\n * @param {object} target node\n * @param {array} list\n * @param {number} newIndex\n * @param {boolean} changeSibling\n * @return {number} newIndex\n */\nexport function moveIndex (target, list, newIndex, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return -1\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n  let newIndexAfter = newIndex\n  if (index <= newIndex) {\n    newIndexAfter = newIndex - 1\n  }\n  const beforeNew = list[newIndexAfter - 1]\n  const afterNew = list[newIndexAfter]\n  list.splice(newIndexAfter, 0, target)\n  if (changeSibling) {\n    beforeNew && (beforeNew.nextSibling = target)\n    target.previousSibling = beforeNew\n    target.nextSibling = afterNew\n    afterNew && (afterNew.previousSibling = target)\n  }\n  if (index === newIndexAfter) {\n    return -1\n  }\n  return newIndex\n}\n\n/**\n * Remove the node from list.\n * @param {object} target node\n * @param {array} list\n * @param {boolean} changeSibling\n */\nexport function removeIndex (target, list, changeSibling) {\n  const index = list.indexOf(target)\n  /* istanbul ignore next */\n  if (index < 0) {\n    return\n  }\n  if (changeSibling) {\n    const before = list[index - 1]\n    const after = list[index + 1]\n    before && (before.nextSibling = after)\n    after && (after.previousSibling = before)\n  }\n  list.splice(index, 1)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { uniqueId } from '../shared/utils'\nimport { getDoc } from './operation'\n\nexport default class Node {\n  constructor () {\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.children = []\n    this.pureChildren = []\n    this.parentNode = null\n    this.nextSibling = null\n    this.previousSibling = null\n  }\n\n  /**\n  * Destroy current node, and remove itself form nodeMap.\n  */\n  destroy () {\n    const doc = getDoc(this.docId)\n    if (doc) {\n      delete this.docId\n      delete doc.nodeMap[this.nodeId]\n    }\n    this.children.forEach(child => {\n      child.destroy()\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getTaskCenter } from './operation'\n\nlet Element\n\nexport function setElement (El) {\n  Element = El\n}\n\n/**\n * A map which stores all type of elements.\n * @type {Object}\n */\nconst registeredElements = {}\n\n/**\n * Register an extended element type with component methods.\n * @param  {string} type    component type\n * @param  {array}  methods a list of method names\n */\nexport function registerElement (type, methods) {\n  // Skip when no special component methods.\n  if (!methods || !methods.length) {\n    return\n  }\n\n  // Init constructor.\n  class WeexElement extends Element {}\n\n  // Add methods to prototype.\n  methods.forEach(methodName => {\n    WeexElement.prototype[methodName] = function (...args) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        return taskCenter.send('component', {\n          ref: this.ref,\n          component: type,\n          method: methodName\n        }, args)\n      }\n    }\n  })\n\n  // Add to element type map.\n  registeredElements[type] = WeexElement\n}\n\nexport function unregisterElement (type) {\n  delete registeredElements[type]\n}\n\nexport function getWeexElement (type) {\n  return registeredElements[type]\n}\n\nexport function isWeexElement (type) {\n  return !!registeredElements[type]\n}\n\n/**\n * Clear all element types. Only for testing.\n */\nexport function clearWeexElements () {\n  for (const type in registeredElements) {\n    unregisterElement(type)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport {\n  getDoc,\n  getTaskCenter,\n  linkParent,\n  nextElement,\n  previousElement,\n  insertIndex,\n  moveIndex,\n  removeIndex\n} from './operation'\nimport { uniqueId, isEmpty } from '../shared/utils'\nimport { getWeexElement, setElement } from './WeexElement'\n\nconst DEFAULT_TAG_NAME = 'div'\nconst BUBBLE_EVENTS = [\n  'click', 'longpress', 'touchstart', 'touchmove', 'touchend',\n  'panstart', 'panmove', 'panend', 'horizontalpan', 'verticalpan', 'swipe'\n]\n\nfunction registerNode (docId, node) {\n  const doc = getDoc(docId)\n  doc.nodeMap[node.nodeId] = node\n}\n\nexport default class Element extends Node {\n  constructor (type = DEFAULT_TAG_NAME, props, isExtended) {\n    super()\n\n    const WeexElement = getWeexElement(type)\n    if (WeexElement && !isExtended) {\n      return new WeexElement(type, props, true)\n    }\n\n    props = props || {}\n    this.nodeType = 1\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = type\n    this.attr = props.attr || {}\n    this.style = props.style || {}\n    this.classStyle = props.classStyle || {}\n    this.event = {}\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n   * Append a child node.\n   * @param {object} node\n   * @return {undefined | number} the signal sent by native\n   */\n  appendChild (node) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    /* istanbul ignore else */\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.length, true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        insertIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), -1]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.length, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(node, this.pureChildren, this.pureChildren.length)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node before specified node.\n   * @param {object} node\n   * @param {object} before\n   * @return {undefined | number} the signal sent by native\n   */\n  insertBefore (node, before) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === before || (node.nextSibling && node.nextSibling === before)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(before), true)\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(before), true)\n      if (node.nodeType === 1) {\n        const pureBefore = nextElement(before)\n        /* istanbul ignore next */\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          pureBefore\n            ? this.pureChildren.indexOf(pureBefore)\n            : this.pureChildren.length\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Insert a node after specified node.\n   * @param {object} node\n   * @param {object} after\n   * @return {undefined | number} the signal sent by native\n   */\n  insertAfter (node, after) {\n    if (node.parentNode && node.parentNode !== this) {\n      return\n    }\n    if (node === after || (node.previousSibling && node.previousSibling === after)) {\n      return\n    }\n    if (!node.parentNode) {\n      linkParent(node, this)\n      insertIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      /* istanbul ignore else */\n      if (this.docId) {\n        registerNode(this.docId, node)\n      }\n      if (node.nodeType === 1) {\n        const index = insertIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        /* istanbul ignore else */\n        if (taskCenter) {\n          return taskCenter.send(\n            'dom',\n            { action: 'addElement' },\n            [this.ref, node.toJSON(), index]\n          )\n        }\n      }\n    }\n    else {\n      moveIndex(node, this.children, this.children.indexOf(after) + 1, true)\n      if (node.nodeType === 1) {\n        const index = moveIndex(\n          node,\n          this.pureChildren,\n          this.pureChildren.indexOf(previousElement(after)) + 1\n        )\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter && index >= 0) {\n          return taskCenter.send(\n            'dom',\n            { action: 'moveElement' },\n            [node.ref, this.ref, index]\n          )\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove a child node, and decide whether it should be destroyed.\n   * @param {object} node\n   * @param {boolean} preserved\n   */\n  removeChild (node, preserved) {\n    if (node.parentNode) {\n      removeIndex(node, this.children, true)\n      if (node.nodeType === 1) {\n        removeIndex(node, this.pureChildren)\n        const taskCenter = getTaskCenter(this.docId)\n        if (taskCenter) {\n          taskCenter.send(\n            'dom',\n            { action: 'removeElement' },\n            [node.ref]\n          )\n        }\n      }\n    }\n    if (!preserved) {\n      node.destroy()\n    }\n  }\n\n  /**\n   * Clear all child nodes.\n   */\n  clear () {\n    const taskCenter = getTaskCenter(this.docId)\n    /* istanbul ignore else */\n    if (taskCenter) {\n      this.pureChildren.forEach(node => {\n        taskCenter.send(\n          'dom',\n          { action: 'removeElement' },\n          [node.ref]\n        )\n      })\n    }\n    this.children.forEach(node => {\n      node.destroy()\n    })\n    this.children.length = 0\n    this.pureChildren.length = 0\n  }\n\n  /**\n   * Set an attribute, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setAttr (key, value, silent) {\n    if (this.attr[key] === value && silent !== false) {\n      return\n    }\n    this.attr[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateAttrs' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched attributes.\n   * @param {object} batchedAttrs\n   * @param {boolean} silent\n   */\n  setAttrs (batchedAttrs, silent) {\n    if (isEmpty(batchedAttrs)) return\n    const mutations = {}\n    for (const key in batchedAttrs) {\n      if (this.attr[key] !== batchedAttrs[key]) {\n        this.attr[key] = batchedAttrs[key]\n        mutations[key] = batchedAttrs[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateAttrs' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * Set a style property, and decide whether the task should be send to native.\n   * @param {string} key\n   * @param {string | number} value\n   * @param {boolean} silent\n   */\n  setStyle (key, value, silent) {\n    if (this.style[key] === value && silent !== false) {\n      return\n    }\n    this.style[key] = value\n    const taskCenter = getTaskCenter(this.docId)\n    if (!silent && taskCenter) {\n      const result = {}\n      result[key] = value\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, result]\n      )\n    }\n  }\n\n  /**\n   * Set batched style properties.\n   * @param {object} batchedStyles\n   * @param {boolean} silent\n   */\n  setStyles (batchedStyles, silent) {\n    if (isEmpty(batchedStyles)) return\n    const mutations = {}\n    for (const key in batchedStyles) {\n      if (this.style[key] !== batchedStyles[key]) {\n        this.style[key] = batchedStyles[key]\n        mutations[key] = batchedStyles[key]\n      }\n    }\n    if (!isEmpty(mutations)) {\n      const taskCenter = getTaskCenter(this.docId)\n      if (!silent && taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'updateStyle' },\n          [this.ref, mutations]\n        )\n      }\n    }\n  }\n\n  /**\n   * Set style properties from class.\n   * @param {object} classStyle\n   */\n  setClassStyle (classStyle) {\n    // reset previous class style to empty string\n    for (const key in this.classStyle) {\n      this.classStyle[key] = ''\n    }\n\n    Object.assign(this.classStyle, classStyle)\n    const taskCenter = getTaskCenter(this.docId)\n    if (taskCenter) {\n      taskCenter.send(\n        'dom',\n        { action: 'updateStyle' },\n        [this.ref, this.toStyle()]\n      )\n    }\n  }\n\n  /**\n   * Add an event handler.\n   * @param {string} event type\n   * @param {function} event handler\n   */\n  addEvent (type, handler, params) {\n    if (!this.event) {\n      this.event = {}\n    }\n    if (!this.event[type]) {\n      this.event[type] = { handler, params }\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'addEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Remove an event handler.\n   * @param {string} event type\n   */\n  removeEvent (type) {\n    if (this.event && this.event[type]) {\n      delete this.event[type]\n      const taskCenter = getTaskCenter(this.docId)\n      if (taskCenter) {\n        taskCenter.send(\n          'dom',\n          { action: 'removeEvent' },\n          [this.ref, type]\n        )\n      }\n    }\n  }\n\n  /**\n   * Fire an event manually.\n   * @param {string} type type\n   * @param {function} event handler\n   * @param {boolean} isBubble whether or not event bubble\n   * @param {boolean} options\n   * @return {} anything returned by handler function\n   */\n  fireEvent (type, event, isBubble, options) {\n    let result = null\n    let isStopPropagation = false\n    const eventDesc = this.event[type]\n    if (eventDesc && event) {\n      const handler = eventDesc.handler\n      event.stopPropagation = () => {\n        isStopPropagation = true\n      }\n      if (options && options.params) {\n        result = handler.call(this, ...options.params, event)\n      }\n      else {\n        result = handler.call(this, event)\n      }\n    }\n\n    if (!isStopPropagation\n      && isBubble\n      && (BUBBLE_EVENTS.indexOf(type) !== -1)\n      && this.parentNode\n      && this.parentNode.fireEvent) {\n      event.currentTarget = this.parentNode\n      this.parentNode.fireEvent(type, event, isBubble) // no options\n    }\n\n    return result\n  }\n\n  /**\n   * Get all styles of current element.\n   * @return {object} style\n   */\n  toStyle () {\n    return Object.assign({}, this.classStyle, this.style)\n  }\n\n  /**\n   * Convert current element to JSON like object.\n   * @return {object} element\n   */\n  toJSON () {\n    const result = {\n      ref: this.ref.toString(),\n      type: this.type,\n      attr: this.attr,\n      style: this.toStyle()\n    }\n    const event = []\n    for (const type in this.event) {\n      const { params } = this.event[type]\n      if (!params) {\n        event.push(type)\n      }\n      else {\n        event.push({ type, params })\n      }\n    }\n    if (event.length) {\n      result.event = event\n    }\n    if (this.pureChildren.length) {\n      result.children = this.pureChildren.map((child) => child.toJSON())\n    }\n    return result\n  }\n\n  /**\n   * Convert to HTML element tag string.\n   * @return {stirng} html\n   */\n  toString () {\n    return '<' + this.type +\n    ' attr=' + JSON.stringify(this.attr) +\n    ' style=' + JSON.stringify(this.toStyle()) + '>' +\n    this.pureChildren.map((child) => child.toString()).join('') +\n    '</' + this.type + '>'\n  }\n}\n\nsetElement(Element)\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CallbackManager from './CallbackManager'\nimport Element from '../vdom/Element'\nimport { typof } from '../shared/utils'\nimport { normalizePrimitive } from './normalize'\n\nlet fallback = function () {}\n\n// The API of TaskCenter would be re-design.\nexport class TaskCenter {\n  constructor (id, sendTasks) {\n    Object.defineProperty(this, 'instanceId', {\n      enumerable: true,\n      value: String(id)\n    })\n    Object.defineProperty(this, 'callbackManager', {\n      enumerable: true,\n      value: new CallbackManager(id)\n    })\n    fallback = sendTasks || function () {}\n  }\n\n  callback (callbackId, data, ifKeepAlive) {\n    return this.callbackManager.consume(callbackId, data, ifKeepAlive)\n  }\n\n  registerHook (...args) {\n    return this.callbackManager.registerHook(...args)\n  }\n\n  triggerHook (...args) {\n    return this.callbackManager.triggerHook(...args)\n  }\n\n  updateData (componentId, newData, callback) {\n    this.send('module', {\n      module: 'dom',\n      method: 'updateComponentData'\n    }, [componentId, newData, callback])\n  }\n\n  destroyCallback () {\n    return this.callbackManager.close()\n  }\n\n  /**\n   * Normalize a value. Specially, if the value is a function, then generate a function id\n   * and save it to `CallbackManager`, at last return the function id.\n   * @param  {any}        v\n   * @return {primitive}\n   */\n  normalize (v) {\n    const type = typof(v)\n    if (v && v instanceof Element) {\n      return v.ref\n    }\n    if (v && v._isVue && v.$el instanceof Element) {\n      return v.$el.ref\n    }\n    if (type === 'Function') {\n      return this.callbackManager.add(v).toString()\n    }\n    return normalizePrimitive(v)\n  }\n\n  send (type, params, args, options) {\n    const { action, component, ref, module, method } = params\n\n    args = args.map(arg => this.normalize(arg))\n\n    switch (type) {\n      case 'dom':\n        return this[action](this.instanceId, args)\n      case 'component':\n        return this.componentHandler(this.instanceId, ref, method, args, Object.assign({ component }, options))\n      default:\n        return this.moduleHandler(this.instanceId, module, method, args, options)\n    }\n  }\n\n  callDOM (action, args) {\n    return this[action](this.instanceId, args)\n  }\n\n  callComponent (ref, method, args, options) {\n    return this.componentHandler(this.instanceId, ref, method, args, options)\n  }\n\n  callModule (module, method, args, options) {\n    return this.moduleHandler(this.instanceId, module, method, args, options)\n  }\n}\n\nexport function init () {\n  const DOM_METHODS = {\n    createFinish: global.callCreateFinish,\n    updateFinish: global.callUpdateFinish,\n    refreshFinish: global.callRefreshFinish,\n\n    createBody: global.callCreateBody,\n\n    addElement: global.callAddElement,\n    removeElement: global.callRemoveElement,\n    moveElement: global.callMoveElement,\n    updateAttrs: global.callUpdateAttrs,\n    updateStyle: global.callUpdateStyle,\n\n    addEvent: global.callAddEvent,\n    removeEvent: global.callRemoveEvent\n  }\n  const proto = TaskCenter.prototype\n\n  for (const name in DOM_METHODS) {\n    const method = DOM_METHODS[name]\n    proto[name] = method ?\n      (id, args) => method(id, ...args) :\n      (id, args) => fallback(id, [{ module: 'dom', method: name, args }], '-1')\n  }\n\n  proto.componentHandler = global.callNativeComponent ||\n    ((id, ref, method, args, options) =>\n      fallback(id, [{ component: options.component, ref, method, args }]))\n\n  proto.moduleHandler = global.callNativeModule ||\n    ((id, module, method, args) =>\n      fallback(id, [{ module, method, args }]))\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getDoc } from '../vdom/operation'\n\nfunction fireEvent (document, nodeId, type, event, domChanges, params) {\n  const el = document.getRef(nodeId)\n  if (el) {\n    return document.fireEvent(el, type, event, domChanges, params)\n  }\n  return new Error(`invalid element reference \"${nodeId}\"`)\n}\n\nfunction callback (document, callbackId, data, ifKeepAlive) {\n  return document.taskCenter.callback(callbackId, data, ifKeepAlive)\n}\n\nfunction componentHook (document, componentId, type, hook, options) {\n  if (!document || !document.taskCenter) {\n    console.error(`[JS Framework] Can't find \"document\" or \"taskCenter\".`)\n    return null\n  }\n  let result = null\n  try {\n    result = document.taskCenter.triggerHook(componentId, type, hook, options)\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to trigger the \"${type}@${hook}\" hook on ${componentId}.`)\n  }\n  return result\n}\n\n/**\n * Accept calls from native (event or callback).\n *\n * @param  {string} id\n * @param  {array} tasks list with `method` and `args`\n */\nexport function receiveTasks (id, tasks) {\n  const document = getDoc(id)\n  if (!document) {\n    return new Error(`[JS Framework] Failed to receiveTasks, `\n      + `instance (${id}) is not available.`)\n  }\n  if (Array.isArray(tasks)) {\n    return tasks.map(task => {\n      switch (task.method) {\n        case 'callback': return callback(document, ...task.args)\n        case 'fireEventSync':\n        case 'fireEvent': return fireEvent(document, ...task.args)\n        case 'componentHook': return componentHook(document, ...task.args)\n      }\n    })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nconst weexModules = {}\n\n/**\n * Register native modules information.\n * @param {object} newModules\n */\nexport function registerModules (newModules) {\n  for (const name in newModules) {\n    if (!weexModules[name]) {\n      weexModules[name] = {}\n    }\n    newModules[name].forEach(method => {\n      if (typeof method === 'string') {\n        weexModules[name][method] = true\n      }\n      else {\n        weexModules[name][method.name] = method.args\n      }\n    })\n  }\n}\n\n/**\n * Check whether the module or the method has been registered.\n * @param {String} module name\n * @param {String} method name (optional)\n */\nexport function isRegisteredModule (name, method) {\n  if (typeof method === 'string') {\n    return !!(weexModules[name] && weexModules[name][method])\n  }\n  return !!weexModules[name]\n}\n\nexport function getModuleDescription (name) {\n  return weexModules[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { registerElement } from '../vdom/WeexElement'\n\nconst weexComponents = {}\n\n/**\n * Register native components information.\n * @param {array} newComponents\n */\nexport function registerComponents (newComponents) {\n  if (Array.isArray(newComponents)) {\n    newComponents.forEach(component => {\n      if (!component) {\n        return\n      }\n      if (typeof component === 'string') {\n        weexComponents[component] = true\n      }\n      else if (typeof component === 'object' && typeof component.type === 'string') {\n        weexComponents[component.type] = component\n        registerElement(component.type, component.methods)\n      }\n    })\n  }\n}\n\n/**\n * Check whether the component has been registered.\n * @param {String} component name\n */\nexport function isRegisteredComponent (name) {\n  return !!weexComponents[name]\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// JS Services\n\nexport const services = []\n\n/**\n * Register a JavaScript service.\n * A JavaScript service options could have a set of lifecycle methods\n * for each Weex instance. For example: create, refresh, destroy.\n * For the JS framework maintainer if you want to supply some features\n * which need to work well in different Weex instances, even in different\n * frameworks separately. You can make a JavaScript service to init\n * its variables or classes for each Weex instance when it's created\n * and recycle them when it's destroyed.\n * @param {object} options Could have { create, refresh, destroy }\n *                         lifecycle methods. In create method it should\n *                         return an object of what variables or classes\n *                         would be injected into the Weex instance.\n */\nexport function register (name, options) {\n  if (has(name)) {\n    console.warn(`Service \"${name}\" has been registered already!`)\n  }\n  else {\n    options = Object.assign({}, options)\n    services.push({ name, options })\n  }\n}\n\n/**\n * Unregister a JavaScript service by name\n * @param {string} name\n */\nexport function unregister (name) {\n  services.some((service, index) => {\n    if (service.name === name) {\n      services.splice(index, 1)\n      return true\n    }\n  })\n}\n\n/**\n * Check if a JavaScript service with a certain name existed.\n * @param  {string}  name\n * @return {Boolean}\n */\nexport function has (name) {\n  return indexOf(name) >= 0\n}\n\n/**\n * Find the index of a JavaScript service by name\n * @param  {string} name\n * @return {number}\n */\nfunction indexOf (name) {\n  return services.map(service => service.name).indexOf(name)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Node from './Node'\nimport { uniqueId } from '../shared/utils'\n\nexport default class Comment extends Node {\n  constructor (value) {\n    super()\n\n    this.nodeType = 8\n    this.nodeId = uniqueId()\n    this.ref = this.nodeId\n    this.type = 'comment'\n    this.value = value\n    this.children = []\n    this.pureChildren = []\n  }\n\n  /**\n  * Convert to HTML comment string.\n  * @return {stirng} html\n  */\n  toString () {\n    return '<!-- ' + this.value + ' -->'\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n* Create the action object.\n* @param {string} name\n* @param {array} arguments\n* @return {object} action\n*/\nfunction createAction (name, args = []) {\n  return { module: 'dom', method: name, args: args }\n}\n\nexport default class Listener {\n  constructor (id, handler) {\n    this.id = id\n    this.batched = false\n    this.updates = []\n    if (typeof handler === 'function') {\n      Object.defineProperty(this, 'handler', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: handler\n      })\n    }\n    else {\n      console.error('[JS Runtime] invalid parameter, handler must be a function')\n    }\n  }\n\n  /**\n   * Send the \"createFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  createFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('createFinish')], callback)\n  }\n\n  /**\n   * Send the \"updateFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  updateFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('updateFinish')], callback)\n  }\n\n  /**\n   * Send the \"refreshFinish\" signal.\n   * @param {function} callback\n   * @return {undefined | number} the signal sent by native\n   */\n  refreshFinish (callback) {\n    const handler = this.handler\n    return handler([createAction('refreshFinish')], callback)\n  }\n\n  /**\n   * Send the \"createBody\" signal.\n   * @param {object} element\n   * @return {undefined | number} the signal sent by native\n   */\n  createBody (element) {\n    const body = element.toJSON()\n    const children = body.children\n    delete body.children\n    const actions = [createAction('createBody', [body])]\n    if (children) {\n      actions.push.apply(actions, children.map(child => {\n        return createAction('addElement', [body.ref, child, -1])\n      }))\n    }\n    return this.addActions(actions)\n  }\n\n  /**\n   * Send the \"addElement\" signal.\n   * @param {object} element\n   * @param {stirng} reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  addElement (element, ref, index) {\n    if (!(index >= 0)) {\n      index = -1\n    }\n    return this.addActions(createAction('addElement', [ref, element.toJSON(), index]))\n  }\n\n  /**\n   * Send the \"removeElement\" signal.\n   * @param {stirng} reference id\n   * @return {undefined | number} the signal sent by native\n   */\n  removeElement (ref) {\n    if (Array.isArray(ref)) {\n      const actions = ref.map((r) => createAction('removeElement', [r]))\n      return this.addActions(actions)\n    }\n    return this.addActions(createAction('removeElement', [ref]))\n  }\n\n  /**\n   * Send the \"moveElement\" signal.\n   * @param {stirng} target reference id\n   * @param {stirng} parent reference id\n   * @param {number} index\n   * @return {undefined | number} the signal sent by native\n   */\n  moveElement (targetRef, parentRef, index) {\n    return this.addActions(createAction('moveElement', [targetRef, parentRef, index]))\n  }\n\n  /**\n   * Send the \"updateAttrs\" signal.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setAttr (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateAttrs', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal, update a sole style.\n   * @param {stirng} reference id\n   * @param {stirng} key\n   * @param {stirng} value\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyle (ref, key, value) {\n    const result = {}\n    result[key] = value\n    return this.addActions(createAction('updateStyle', [ref, result]))\n  }\n\n  /**\n   * Send the \"updateStyle\" signal.\n   * @param {stirng} reference id\n   * @param {object} style\n   * @return {undefined | number} the signal sent by native\n   */\n  setStyles (ref, style) {\n    return this.addActions(createAction('updateStyle', [ref, style]))\n  }\n\n  /**\n   * Send the \"addEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  addEvent (ref, type) {\n    return this.addActions(createAction('addEvent', [ref, type]))\n  }\n\n  /**\n   * Send the \"removeEvent\" signal.\n   * @param {stirng} reference id\n   * @param {string} event type\n   * @return {undefined | number} the signal sent by native\n   */\n  removeEvent (ref, type) {\n    return this.addActions(createAction('removeEvent', [ref, type]))\n  }\n\n  /**\n   * Default handler.\n   * @param {object | array} actions\n   * @param {function} callback\n   * @return {} anything returned by callback function\n   */\n  handler (actions, cb) {\n    return cb && cb()\n  }\n\n  /**\n   * Add actions into updates.\n   * @param {object | array} actions\n   * @return {undefined | number} the signal sent by native\n   */\n  addActions (actions) {\n    const updates = this.updates\n    const handler = this.handler\n\n    if (!Array.isArray(actions)) {\n      actions = [actions]\n    }\n\n    if (this.batched) {\n      updates.push.apply(updates, actions)\n    }\n    else {\n      return handler(actions)\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * Task handler for communication between javascript and native.\n */\n\nconst handlerMap = {\n  createBody: 'callCreateBody',\n  addElement: 'callAddElement',\n  removeElement: 'callRemoveElement',\n  moveElement: 'callMoveElement',\n  updateAttrs: 'callUpdateAttrs',\n  updateStyle: 'callUpdateStyle',\n  addEvent: 'callAddEvent',\n  removeEvent: 'callRemoveEvent'\n}\n\n/**\n * Create a task handler.\n * @param {string} id\n * @param {function} handler\n * @return {function} taskHandler\n */\nexport function createHandler (id, handler) {\n  const defaultHandler = handler || global.callNative\n\n  /* istanbul ignore if */\n  if (typeof defaultHandler !== 'function') {\n    console.error('[JS Runtime] no default handler')\n  }\n\n  return function taskHandler (tasks) {\n    /* istanbul ignore if */\n    if (!Array.isArray(tasks)) {\n      tasks = [tasks]\n    }\n    for (let i = 0; i < tasks.length; i++) {\n      const returnValue = dispatchTask(id, tasks[i], defaultHandler)\n      if (returnValue === -1) {\n        return returnValue\n      }\n    }\n  }\n}\n\n/**\n * Check if there is a corresponding available handler in the environment.\n * @param {string} module\n * @param {string} method\n * @return {boolean}\n */\nfunction hasAvailableHandler (module, method) {\n  return module === 'dom'\n    && handlerMap[method]\n    && typeof global[handlerMap[method]] === 'function'\n}\n\n/**\n * Dispatch the task to the specified handler.\n * @param {string} id\n * @param {object} task\n * @param {function} defaultHandler\n * @return {number} signal returned from native\n */\nfunction dispatchTask (id, task, defaultHandler) {\n  const { module, method, args } = task\n\n  if (hasAvailableHandler(module, method)) {\n    return global[handlerMap[method]](id, ...args, '-1')\n  }\n\n  return defaultHandler(id, [task], '-1')\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Comment from './Comment'\nimport Element from './Element'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\nimport { createHandler } from '../bridge/Handler'\nimport { addDoc, removeDoc, appendBody, setBody } from './operation'\n\n/**\n * Update all changes for an element.\n * @param {object} element\n * @param {object} changes\n */\nfunction updateElement (el, changes) {\n  const attrs = changes.attrs || {}\n  for (const name in attrs) {\n    el.setAttr(name, attrs[name], true)\n  }\n  const style = changes.style || {}\n  for (const name in style) {\n    el.setStyle(name, style[name], true)\n  }\n}\n\nexport default class Document {\n  constructor (id, url, handler) {\n    id = id ? id.toString() : ''\n    this.id = id\n    this.URL = url\n\n    addDoc(id, this)\n    this.nodeMap = {}\n    const L = Document.Listener || Listener\n    this.listener = new L(id, handler || createHandler(id, Document.handler)) // deprecated\n    this.taskCenter = new TaskCenter(id, handler ? (id, ...args) => handler(...args) : Document.handler)\n    this.createDocumentElement()\n  }\n\n  /**\n  * Get the node from nodeMap.\n  * @param {string} reference id\n  * @return {object} node\n  */\n  getRef (ref) {\n    return this.nodeMap[ref]\n  }\n\n  /**\n  * Turn on batched updates.\n  */\n  open () {\n    this.listener.batched = false\n  }\n\n  /**\n  * Turn off batched updates.\n  */\n  close () {\n    this.listener.batched = true\n  }\n\n  /**\n  * Create the document element.\n  * @return {object} documentElement\n  */\n  createDocumentElement () {\n    if (!this.documentElement) {\n      const el = new Element('document')\n      el.docId = this.id\n      el.ownerDocument = this\n      el.role = 'documentElement'\n      el.depth = 0\n      el.ref = '_documentElement'\n      this.nodeMap._documentElement = el\n      this.documentElement = el\n\n      Object.defineProperty(el, 'appendChild', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node) => {\n          appendBody(this, node)\n        }\n      })\n\n      Object.defineProperty(el, 'insertBefore', {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: (node, before) => {\n          appendBody(this, node, before)\n        }\n      })\n    }\n\n    return this.documentElement\n  }\n\n  /**\n  * Create the body element.\n  * @param {string} type\n  * @param {objct} props\n  * @return {object} body element\n  */\n  createBody (type, props) {\n    if (!this.body) {\n      const el = new Element(type, props)\n      setBody(this, el)\n    }\n\n    return this.body\n  }\n\n  /**\n  * Create an element.\n  * @param {string} tagName\n  * @param {objct} props\n  * @return {object} element\n  */\n  createElement (tagName, props) {\n    return new Element(tagName, props)\n  }\n\n  /**\n  * Create an comment.\n  * @param {string} text\n  * @return {object} comment\n  */\n  createComment (text) {\n    return new Comment(text)\n  }\n\n  /**\n  * Fire an event on specified element manually.\n  * @param {object} element\n  * @param {string} event type\n  * @param {object} event object\n  * @param {object} dom changes\n  * @param {object} options\n  * @return {} anything returned by handler function\n  */\n  fireEvent (el, type, event, domChanges, options) {\n    if (!el) {\n      return\n    }\n    event = event || {}\n    event.type = event.type || type\n    event.target = el\n    event.currentTarget = el\n    event.timestamp = Date.now()\n    if (domChanges) {\n      updateElement(el, domChanges)\n    }\n    const isBubble = this.getRef('_root').attr['bubble'] === 'true'\n    return el.fireEvent(type, event, isBubble, options)\n  }\n\n  /**\n  * Destroy current document, and remove itself form docMap.\n  */\n  destroy () {\n    this.taskCenter.destroyCallback()\n    delete this.listener\n    delete this.nodeMap\n    delete this.taskCenter\n    removeDoc(this.id)\n  }\n}\n\n// default task handler\nDocument.handler = null\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Document from '../vdom/Document'\nimport { isRegisteredModule, getModuleDescription } from './module'\nimport { isRegisteredComponent } from './component'\nimport { getTaskCenter } from '../vdom/operation'\n\nconst moduleProxies = {}\n\nfunction setId (weex, id) {\n  Object.defineProperty(weex, '[[CurrentInstanceId]]', { value: id })\n}\n\nfunction getId (weex) {\n  return weex['[[CurrentInstanceId]]']\n}\n\nfunction moduleGetter (id, module, method) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  return (...args) => taskCenter.send('module', { module, method }, args)\n}\n\nfunction moduleSetter (id, module, method, fn) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to find taskCenter (${id}).`)\n    return null\n  }\n  if (typeof fn !== 'function') {\n    console.error(`[JS Framework] ${module}.${method} must be assigned as a function.`)\n    return null\n  }\n  return fn => taskCenter.send('module', { module, method }, [fn])\n}\n\nexport default class WeexInstance {\n  constructor (id, config) {\n    setId(this, String(id))\n    this.config = config || {}\n    this.document = new Document(id, this.config.bundleUrl)\n    this.requireModule = this.requireModule.bind(this)\n    this.isRegisteredModule = isRegisteredModule\n    this.isRegisteredComponent = isRegisteredComponent\n  }\n\n  requireModule (moduleName) {\n    const id = getId(this)\n    if (!(id && this.document && this.document.taskCenter)) {\n      console.error(`[JS Framework] Failed to requireModule(\"${moduleName}\"), `\n        + `instance (${id}) doesn't exist anymore.`)\n      return\n    }\n\n    // warn for unknown module\n    if (!isRegisteredModule(moduleName)) {\n      console.warn(`[JS Framework] using unregistered weex module \"${moduleName}\"`)\n      return\n    }\n\n    // create new module proxy\n    const proxyName = `${moduleName}#${id}`\n    if (!moduleProxies[proxyName]) {\n      // create registered module apis\n      const moduleDefine = getModuleDescription(moduleName)\n      const moduleApis = {}\n      for (const methodName in moduleDefine) {\n        Object.defineProperty(moduleApis, methodName, {\n          enumerable: true,\n          configurable: true,\n          get: () => moduleGetter(id, moduleName, methodName),\n          set: fn => moduleSetter(id, moduleName, methodName, fn)\n        })\n      }\n\n      // create module Proxy\n      if (typeof Proxy === 'function') {\n        moduleProxies[proxyName] = new Proxy(moduleApis, {\n          get (target, methodName) {\n            if (methodName in target) {\n              return target[methodName]\n            }\n            console.warn(`[JS Framework] using unregistered method \"${moduleName}.${methodName}\"`)\n            return moduleGetter(id, moduleName, methodName)\n          }\n        })\n      }\n      else {\n        moduleProxies[proxyName] = moduleApis\n      }\n    }\n\n    return moduleProxies[proxyName]\n  }\n\n  supports (condition) {\n    if (typeof condition !== 'string') return null\n\n    const res = condition.match(/^@(\\w+)\\/(\\w+)(\\.(\\w+))?$/i)\n    if (res) {\n      const type = res[1]\n      const name = res[2]\n      const method = res[4]\n      switch (type) {\n        case 'module': return isRegisteredModule(name, method)\n        case 'component': return isRegisteredComponent(name)\n      }\n    }\n\n    return null\n  }\n\n  // registerStyleSheet (styles) {\n  //   if (this.document) {\n  //     this.document.registerStyleSheet(styles)\n  //   }\n  // }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { init as initTaskHandler } from '../bridge/TaskCenter'\nimport { receiveTasks } from '../bridge/receiver'\nimport { registerModules } from './module'\nimport { registerComponents } from './component'\nimport { services, register, unregister } from './service'\nimport { track } from '../bridge/debug'\nimport WeexInstance from './WeexInstance'\nimport { getDoc } from '../vdom/operation'\n\nlet frameworks\nlet runtimeConfig\n\nconst versionRegExp = /^\\s*\\/\\/ *(\\{[^}]*\\}) *\\r?\\n/\n\n/**\n * Detect a JS Bundle code and make sure which framework it's based to. Each JS\n * Bundle should make sure that it starts with a line of JSON comment and is\n * more that one line.\n * @param  {string} code\n * @return {object}\n */\nfunction getBundleType (code) {\n  const result = versionRegExp.exec(code)\n  if (result) {\n    try {\n      const info = JSON.parse(result[1])\n      return info.framework\n    }\n    catch (e) {}\n  }\n\n  // default bundle type\n  return 'Weex'\n}\n\nfunction createServices (id, env, config) {\n  // Init JavaScript services for this instance.\n  const serviceMap = Object.create(null)\n  serviceMap.service = Object.create(null)\n  services.forEach(({ name, options }) => {\n    if (process.env.NODE_ENV === 'development') {\n      console.debug(`[JS Runtime] create service ${name}.`)\n    }\n    const create = options.create\n    if (create) {\n      try {\n        const result = create(id, env, config)\n        Object.assign(serviceMap.service, result)\n        Object.assign(serviceMap, result.instance)\n      }\n      catch (e) {\n        console.error(`[JS Runtime] Failed to create service ${name}.`)\n      }\n    }\n  })\n  delete serviceMap.service.instance\n  Object.freeze(serviceMap.service)\n  return serviceMap\n}\n\nconst instanceTypeMap = {}\nfunction getFrameworkType (id) {\n  return instanceTypeMap[id]\n}\n\nfunction createInstanceContext (id, options = {}, data) {\n  const weex = new WeexInstance(id, options)\n  Object.freeze(weex)\n\n  const bundleType = options.bundleType || 'Vue'\n  instanceTypeMap[id] = bundleType\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  track(id, 'bundleType', bundleType)\n\n  // prepare js service\n  const services = createServices(id, {\n    weex,\n    config: options,\n    created: Date.now(),\n    framework: bundleType,\n    bundleType\n  }, runtimeConfig)\n  Object.freeze(services)\n\n  // prepare runtime context\n  const runtimeContext = Object.create(null)\n  Object.assign(runtimeContext, services, {\n    weex,\n    services // Temporary compatible with some legacy APIs in Rax\n  })\n  Object.freeze(runtimeContext)\n\n  // prepare instance context\n  const instanceContext = Object.assign({}, runtimeContext)\n  if (typeof framework.createInstanceContext === 'function') {\n    Object.assign(instanceContext, framework.createInstanceContext(id, runtimeContext, data))\n  }\n  Object.freeze(instanceContext)\n  return instanceContext\n}\n\n/**\n * Check which framework a certain JS Bundle code based to. And create instance\n * by this framework.\n * @param {string} id\n * @param {string} code\n * @param {object} config\n * @param {object} data\n */\nfunction createInstance (id, code, config, data) {\n  if (instanceTypeMap[id]) {\n    return new Error(`The instance id \"${id}\" has already been used!`)\n  }\n\n  // Init instance info.\n  const bundleType = getBundleType(code)\n  instanceTypeMap[id] = bundleType\n\n  // Init instance config.\n  config = JSON.parse(JSON.stringify(config || {}))\n  config.env = JSON.parse(JSON.stringify(global.WXEnvironment || {}))\n  config.bundleType = bundleType\n\n  const framework = runtimeConfig.frameworks[bundleType]\n  if (!framework) {\n    return new Error(`[JS Framework] Invalid bundle type \"${bundleType}\".`)\n  }\n  if (bundleType === 'Weex') {\n    console.error(`[JS Framework] COMPATIBILITY WARNING: `\n      + `Weex DSL 1.0 (.we) framework is no longer supported! `\n      + `It will be removed in the next version of WeexSDK, `\n      + `your page would be crash if you still using the \".we\" framework. `\n      + `Please upgrade it to Vue.js or Rax.`)\n  }\n\n  const instanceContext = createInstanceContext(id, config, data)\n  if (typeof framework.createInstance === 'function') {\n    // Temporary compatible with some legacy APIs in Rax,\n    // some Rax page is using the legacy \".we\" framework.\n    if (bundleType === 'Rax' || bundleType === 'Weex') {\n      const raxInstanceContext = Object.assign({\n        config,\n        created: Date.now(),\n        framework: bundleType\n      }, instanceContext)\n      return framework.createInstance(id, code, config, data, raxInstanceContext)\n    }\n    return framework.createInstance(id, code, config, data, instanceContext)\n  }\n  // console.error(`[JS Framework] Can't find available \"createInstance\" method in ${bundleType}!`)\n  runInContext(code, instanceContext)\n}\n\n/**\n * Run js code in a specific context.\n * @param {string} code\n * @param {object} context\n */\nfunction runInContext (code, context) {\n  const keys = []\n  const args = []\n  for (const key in context) {\n    keys.push(key)\n    args.push(context[key])\n  }\n\n  const bundle = `\n    (function (global) {\n      ${code}\n    })(Object.create(this))\n  `\n\n  return (new Function(...keys, bundle))(...args)\n}\n\n/**\n * Get the JSON object of the root element.\n * @param {string} instanceId\n */\nfunction getRoot (instanceId) {\n  const document = getDoc(instanceId)\n  try {\n    if (document && document.body) {\n      return document.body.toJSON()\n    }\n  }\n  catch (e) {\n    console.error(`[JS Framework] Failed to get the virtual dom tree.`)\n    return\n  }\n}\n\nconst methods = {\n  createInstance,\n  createInstanceContext,\n  getRoot,\n  getDocument: getDoc,\n  registerService: register,\n  unregisterService: unregister,\n  callJS (id, tasks) {\n    const framework = frameworks[getFrameworkType(id)]\n    if (framework && typeof framework.receiveTasks === 'function') {\n      return framework.receiveTasks(id, tasks)\n    }\n    return receiveTasks(id, tasks)\n  }\n}\n\n/**\n * Register methods which will be called for each instance.\n * @param {string} methodName\n */\nfunction genInstance (methodName) {\n  methods[methodName] = function (...args) {\n    const id = args[0]\n    const type = getFrameworkType(id)\n    if (type && frameworks[type]) {\n      const result = frameworks[type][methodName](...args)\n      const info = { framework: type }\n\n      // Lifecycle methods\n      if (methodName === 'refreshInstance') {\n        services.forEach(service => {\n          const refresh = service.options.refresh\n          if (refresh) {\n            refresh(id, { info, runtime: runtimeConfig })\n          }\n        })\n      }\n      else if (methodName === 'destroyInstance') {\n        services.forEach(service => {\n          const destroy = service.options.destroy\n          if (destroy) {\n            destroy(id, { info, runtime: runtimeConfig })\n          }\n        })\n        delete instanceTypeMap[id]\n      }\n\n      return result\n    }\n    return new Error(`[JS Framework] Using invalid instance id `\n      + `\"${id}\" when calling ${methodName}.`)\n  }\n}\n\n/**\n * Register methods which init each frameworks.\n * @param {string} methodName\n * @param {function} sharedMethod\n */\nfunction adaptMethod (methodName, sharedMethod) {\n  methods[methodName] = function (...args) {\n    if (typeof sharedMethod === 'function') {\n      sharedMethod(...args)\n    }\n\n    // TODO: deprecated\n    for (const name in runtimeConfig.frameworks) {\n      const framework = runtimeConfig.frameworks[name]\n      if (framework && framework[methodName]) {\n        framework[methodName](...args)\n      }\n    }\n  }\n}\n\nexport default function init (config) {\n  runtimeConfig = config || {}\n  frameworks = runtimeConfig.frameworks || {}\n  initTaskHandler()\n\n  // Init each framework by `init` method and `config` which contains three\n  // virtual-DOM Class: `Document`, `Element` & `Comment`, and a JS bridge method:\n  // `sendTasks(...args)`.\n  for (const name in frameworks) {\n    const framework = frameworks[name]\n    if (typeof framework.init === 'function') {\n      try {\n        framework.init(config)\n      }\n      catch (e) {}\n    }\n  }\n\n  adaptMethod('registerComponents', registerComponents)\n  adaptMethod('registerModules', registerModules)\n  adaptMethod('registerMethods')\n\n  ; ['destroyInstance', 'refreshInstance'].forEach(genInstance)\n\n  return methods\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { getTaskCenter } from '../vdom/operation'\nimport { isRegisteredModule } from '../api/module'\n\nexport function track (id, type, value) {\n  const taskCenter = getTaskCenter(id)\n  if (!taskCenter || typeof taskCenter.send !== 'function') {\n    console.error(`[JS Framework] Failed to create tracker!`)\n    return\n  }\n  if (!type || !value) {\n    console.warn(`[JS Framework] Invalid track type (${type}) or value (${value})`)\n    return\n  }\n  const label = `jsfm.${type}.${value}`\n  try {\n    if (isRegisteredModule('userTrack', 'addPerfPoint')) {\n      const message = Object.create(null)\n      message[label] = '4'\n      taskCenter.send('module', {\n        module: 'userTrack',\n        method: 'addPerfPoint'\n      }, [message])\n    }\n  }\n  catch (err) {\n    console.error(`[JS Framework] Failed to trace \"${label}\"!`)\n  }\n}\n\nexport function error (...messages) {\n  if (typeof console.error === 'function') {\n    console.error(`[JS Framework] `, ...messages)\n  }\n}\n\nexport function handleException (err) {\n  if (typeof console.error === 'function') {\n    try {\n      console.error(err.toString())\n    }\n    catch (e) {}\n  }\n  if (process.env.NODE_ENV !== 'production') {\n    throw err\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Document, Element, Comment } from '../vdom'\nimport Listener from '../bridge/Listener'\nimport { TaskCenter } from '../bridge/TaskCenter'\n\nconst config = {\n  Document, Element, Comment, Listener,\n  TaskCenter,\n  sendTasks (...args) {\n    if (typeof callNative === 'function') {\n      return callNative(...args)\n    }\n    return (global.callNative || (() => {}))(...args)\n  }\n}\n\nDocument.handler = config.sendTasks\n\nexport default config\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport init from './init'\nimport config from './config'\nimport { register, unregister, has } from './service'\n\n/* istanbul ignore next */\nfunction freezePrototype () {\n  // Object.freeze(config.Element)\n  Object.freeze(config.Comment)\n  Object.freeze(config.Listener)\n  Object.freeze(config.Document.prototype)\n  // Object.freeze(config.Element.prototype)\n  Object.freeze(config.Comment.prototype)\n  Object.freeze(config.Listener.prototype)\n}\n\nexport default {\n  service: { register, unregister, has },\n  freezePrototype,\n  init,\n  config\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Mock MessageEvent type\n * @param {string} type\n * @param {object} dict { data, origin, source, ports }\n *\n * This type has been simplified.\n * https://html.spec.whatwg.org/multipage/comms.html#messageevent\n * https://dom.spec.whatwg.org/#interface-event\n */\nexport function MessageEvent (type, dict = {}) {\n  this.type = type || 'message'\n\n  this.data = dict.data || null\n  this.origin = dict.origin || ''\n  this.source = dict.source || null\n  this.ports = dict.ports || []\n\n  // inherit properties\n  this.target = null\n  this.timeStamp = Date.now()\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * @fileOverview\n * The polyfill of BroadcastChannel API.\n * This api can be used to achieve inter-instance communications.\n *\n * https://html.spec.whatwg.org/multipage/comms.html#broadcasting-to-other-browsing-contexts\n */\n\nimport { MessageEvent } from './message-event'\n\nconst channels = {}\nconst instances = {}\n\n/**\n * An empty constructor for BroadcastChannel polyfill.\n * The real constructor will be defined when a Weex instance created because\n * we need to track the channel by Weex instance id.\n */\nfunction BroadcastChannel () {}\n\n/**\n * Sends the given message to other BroadcastChannel objects set up for this channel.\n * @param {any} message\n */\nBroadcastChannel.prototype.postMessage = function (message) {\n  if (this._closed) {\n    throw new Error(`BroadcastChannel \"${this.name}\" is closed.`)\n  }\n\n  const subscribers = channels[this.name]\n  if (subscribers && subscribers.length) {\n    for (let i = 0; i < subscribers.length; ++i) {\n      const member = subscribers[i]\n\n      if (member._closed || member === this) continue\n\n      if (typeof member.onmessage === 'function') {\n        member.onmessage(new MessageEvent('message', { data: message }))\n      }\n    }\n  }\n}\n\n/**\n * Closes the BroadcastChannel object, opening it up to garbage collection.\n */\nBroadcastChannel.prototype.close = function () {\n  if (this._closed) {\n    return\n  }\n\n  this._closed = true\n\n  // remove itself from channels.\n  if (channels[this.name]) {\n    const subscribers = channels[this.name].filter(x => x !== this)\n    if (subscribers.length) {\n      channels[this.name] = subscribers\n    }\n    else {\n      delete channels[this.name]\n    }\n  }\n}\n\nexport default {\n  create: (id, env, config) => {\n    instances[id] = []\n    if (typeof global.BroadcastChannel === 'function') {\n      return {}\n    }\n    const serviceObject = {\n      /**\n       * Returns a new BroadcastChannel object via which messages for the given\n       * channel name can be sent and received.\n       * @param {string} name\n       */\n      BroadcastChannel: function (name) {\n        // the name property is readonly\n        Object.defineProperty(this, 'name', {\n          configurable: false,\n          enumerable: true,\n          writable: false,\n          value: String(name)\n        })\n\n        this._closed = false\n        this.onmessage = null\n\n        if (!channels[this.name]) {\n          channels[this.name] = []\n        }\n        channels[this.name].push(this)\n        instances[id].push(this)\n      }\n    }\n    serviceObject.BroadcastChannel.prototype = BroadcastChannel.prototype\n    return {\n      instance: serviceObject\n    }\n  },\n  destroy: (id, env) => {\n    instances[id].forEach(channel => channel.close())\n    delete instances[id]\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview The api for invoking with \"$\" prefix\n */\n\n/**\n * @deprecated use $vm instead\n * find the vm by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Vm}\n */\nexport function $ (id) {\n  console.warn('[JS Framework] Vm#$ is deprecated, please use Vm#$vm instead')\n  const info = this._ids[id]\n  if (info) {\n    return info.vm\n  }\n}\n\n/**\n * find the element by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Element}\n */\nexport function $el (id) {\n  const info = this._ids[id]\n  if (info) {\n    return info.el\n  }\n}\n\n/**\n * find the vm of the custom component by id\n * Note: there is only one id in whole component\n * @param  {string} id\n * @return {Vm}\n */\nexport function $vm (id) {\n  const info = this._ids[id]\n  if (info) {\n    return info.vm\n  }\n}\n\n/**\n * Fire when differ rendering finished\n *\n * @param  {Function} fn\n */\nexport function $renderThen (fn) {\n  const app = this._app\n  const differ = app.differ\n  return differ.then(() => {\n    fn()\n  })\n}\n\n/**\n * scroll an element specified by id into view,\n * moreover specify a number of offset optionally\n * @param  {string} id\n * @param  {number} offset\n */\nexport function $scrollTo (id, offset) {\n  console.warn('[JS Framework] Vm#$scrollTo is deprecated, ' +\n          'please use \"require(\\'@weex-module/dom\\')' +\n          '.scrollTo(el, options)\" instead')\n  const el = this.$el(id)\n  if (el) {\n    const dom = this._app.requireModule('dom')\n    dom.scrollToElement(el.ref, { offset: offset })\n  }\n}\n\n/**\n * perform transition animation on an element specified by id\n * @param  {string}   id\n * @param  {object}   options\n * @param  {object}   options.styles\n * @param  {object}   options.duration(ms)\n * @param  {object}   [options.timingFunction]\n * @param  {object}   [options.delay=0(ms)]\n * @param  {Function} callback\n */\nexport function $transition (id, options, callback) {\n  const el = this.$el(id)\n  if (el && options && options.styles) {\n    const animation = this._app.requireModule('animation')\n    animation.transition(el.ref, options, (...args) => {\n      this._setStyle(el, options.styles)\n      callback && callback(...args)\n    })\n  }\n}\n\n/**\n * get some config\n * @return {object} some config for app instance\n * @property {string} bundleUrl\n * @property {boolean} debug\n * @property {object} env\n * @property {string} env.weexVersion(ex. 1.0.0)\n * @property {string} env.appName(ex. TB/TM)\n * @property {string} env.appVersion(ex. 5.0.0)\n * @property {string} env.platform(ex. iOS/Android)\n * @property {string} env.osVersion(ex. 7.0.0)\n * @property {string} env.deviceModel **native only**\n * @property {number} env.[deviceWidth=750]\n * @property {number} env.deviceHeight\n */\nexport function $getConfig (callback) {\n  const config = this._app.options\n  if (typeof callback === 'function') {\n    console.warn('[JS Framework] the callback of Vm#$getConfig(callback) is deprecated, ' +\n      'this api now can directly RETURN config info.')\n    callback(config)\n  }\n  return config\n}\n\n/**\n * @deprecated\n * request network via http protocol\n * @param  {object}   params\n * @param  {Function} callback\n */\nexport function $sendHttp (params, callback) {\n  console.warn('[JS Framework] Vm#$sendHttp is deprecated, ' +\n          'please use \"require(\\'@weex-module/stream\\')' +\n          '.sendHttp(params, callback)\" instead')\n  const stream = this._app.requireModule('stream')\n  stream.sendHttp(params, callback)\n}\n\n/**\n * @deprecated\n * open a url\n * @param  {string} url\n */\nexport function $openURL (url) {\n  console.warn('[JS Framework] Vm#$openURL is deprecated, ' +\n          'please use \"require(\\'@weex-module/event\\')' +\n          '.openURL(url)\" instead')\n  const event = this._app.requireModule('event')\n  event.openURL(url)\n}\n\n/**\n * @deprecated\n * set a title for page\n * @param  {string} title\n */\nexport function $setTitle (title) {\n  console.warn('[JS Framework] Vm#$setTitle is deprecated, ' +\n          'please use \"require(\\'@weex-module/pageInfo\\')' +\n          '.setTitle(title)\" instead')\n  const pageInfo = this._app.requireModule('pageInfo')\n  pageInfo.setTitle(title)\n}\n\n/**\n * @deprecated use \"require('@weex-module/moduleName') instead\"\n * invoke a native method by specifing the name of module and method\n * @param  {string} moduleName\n * @param  {string} methodName\n * @param  {...*} the rest arguments\n */\nexport function $call (moduleName, methodName, ...args) {\n  console.warn('[JS Framework] Vm#$call is deprecated, ' +\n    'please use \"require(\\'@weex-module/moduleName\\')\" instead')\n  const module = this._app.requireModule(moduleName)\n  if (module && module[methodName]) {\n    module[methodName](...args)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * Mix properties into target object.\n *\n * @param {Object} to\n * @param {Object} from\n */\n\nfunction extend (target, ...src) {\n  /* istanbul ignore else */\n  if (typeof Object.assign === 'function') {\n    Object.assign(target, ...src)\n  }\n  else {\n    const first = src.shift()\n    for (const key in first) {\n      target[key] = first[key]\n    }\n    if (src.length) {\n      extend(target, ...src)\n    }\n  }\n  return target\n}\n\n/**\n * Define a property.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n * @param {Boolean} [enumerable]\n */\n\nfunction def (obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}\n\n/**\n * Remove an item from an array\n *\n * @param {Array} arr\n * @param {*} item\n */\n\nfunction remove (arr, item) {\n  if (arr.length) {\n    const index = arr.indexOf(item)\n    if (index > -1) {\n      return arr.splice(index, 1)\n    }\n  }\n}\n\n/**\n * Check whether the object has the property.\n *\n * @param {Object} obj\n * @param {String} key\n * @return {Boolean}\n */\nconst hasOwnProperty = Object.prototype.hasOwnProperty\nfunction hasOwn (obj, key) {\n  return hasOwnProperty.call(obj, key)\n}\n\n/**\n * Simple bind, faster than native\n *\n * @param {Function} fn\n * @param {Object} ctx\n * @return {Function}\n */\n\nfunction bind (fn, ctx) {\n  return function (a) {\n    const l = arguments.length\n    return l\n      ? l > 1\n        ? fn.apply(ctx, arguments)\n        : fn.call(ctx, a)\n      : fn.call(ctx)\n  }\n}\n\n/**\n * Convert an Array-like object to a real Array.\n *\n * @param {Array-like} list\n * @param {Number} [start] - start index\n * @return {Array}\n */\n\nfunction toArray (list, start) {\n  start = start || 0\n  let i = list.length - start\n  const ret = new Array(i)\n  while (i--) {\n    ret[i] = list[i + start]\n  }\n  return ret\n}\n\n/**\n * Quick object check - this is primarily used to tell\n * Objects from primitive values when we know the value\n * is a JSON-compliant type.\n *\n * @param {*} obj\n * @return {Boolean}\n */\n\nfunction isObject (obj) {\n  return obj !== null && typeof obj === 'object'\n}\n\n/**\n * Strict object type check. Only returns true\n * for plain JavaScript objects.\n *\n * @param {*} obj\n * @return {Boolean}\n */\n\nconst toString = Object.prototype.toString\nconst OBJECT_STRING = '[object Object]'\nfunction isPlainObject (obj) {\n  return toString.call(obj) === OBJECT_STRING\n}\n\nexport {\n  extend,\n  def,\n  remove,\n  hasOwn,\n  bind,\n  toArray,\n  isObject,\n  isPlainObject\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport {\n  extend,\n  def,\n  remove,\n  hasOwn,\n  bind,\n  toArray,\n  isObject,\n  isPlainObject\n} from './shared'\n\n/**\n * Check if a string starts with $ or _\n *\n * @param {String} str\n * @return {Boolean}\n */\n\nexport function isReserved (str) {\n  const c = (str + '').charCodeAt(0)\n  return c === 0x24 || c === 0x5F\n}\n\n// can we use __proto__?\nexport const hasProto = '__proto__' in {}\n\nlet _Set\n/* istanbul ignore next */\nif (typeof Set !== 'undefined' && Set.toString().match(/native code/)) {\n  // use native Set when available.\n  _Set = Set\n}\nelse {\n  // a non-standard Set polyfill that only works with primitive keys.\n  _Set = function () {\n    this.set = Object.create(null)\n  }\n  _Set.prototype.has = function (key) {\n    return this.set[key] !== undefined\n  }\n  _Set.prototype.add = function (key) {\n    if (key == null || this.set[key]) {\n      return\n    }\n    this.set[key] = 1\n  }\n  _Set.prototype.clear = function () {\n    this.set = Object.create(null)\n  }\n}\n\nexport { _Set }\n\n/**\n * Polyfill in iOS7 by native because the JavaScript polyfill has memory problem.\n * @return {object}\n */\n\nexport function createNewSet () {\n  /* istanbul ignore next */\n  /* eslint-disable */\n  if (typeof nativeSet === 'object') {\n    return nativeSet.create()\n  }\n  /* eslint-enable */\n  return new _Set()\n}\n\n/**\n * Create a cached version of a pure function.\n *\n * @param {Function} fn\n * @return {Function}\n */\n\nexport function cached (fn) {\n  const cache = Object.create(null)\n  return function cachedFn (str) {\n    const hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  }\n}\n\n/**\n * Camelize a hyphen-delmited string.\n *\n * @param {String} str\n * @return {String}\n */\n\nconst camelizeRE = /-(\\w)/g\nexport const camelize = cached(str => {\n  return str.replace(camelizeRE, toUpper)\n})\n\nfunction toUpper (_, c) {\n  return c ? c.toUpperCase() : ''\n}\n\n/**\n * Hyphenate a camelCase string.\n *\n * @param {String} str\n * @return {String}\n */\n\nconst hyphenateRE = /([a-z\\d])([A-Z])/g\nexport const hyphenate = cached(str => {\n  return str\n    .replace(hyphenateRE, '$1-$2')\n    .toLowerCase()\n})\n\nexport function typof (v) {\n  const s = Object.prototype.toString.call(v)\n  return s.substring(8, s.length - 1).toLowerCase()\n}\n\n// weex name rules\n\nconst WEEX_COMPONENT_REG = /^@weex-component\\//\nconst WEEX_MODULE_REG = /^@weex-module\\//\nconst NORMAL_MODULE_REG = /^\\.{1,2}\\//\nconst JS_SURFIX_REG = /\\.js$/\n\nexport const isWeexComponent = name => !!name.match(WEEX_COMPONENT_REG)\nexport const isWeexModule = name => !!name.match(WEEX_MODULE_REG)\nexport const isNormalModule = name => !!name.match(NORMAL_MODULE_REG)\nexport const isNpmModule = name => !isWeexComponent(name) && !isWeexModule(name) && !isNormalModule(name)\n\nexport function removeWeexPrefix (str) {\n  const result = str.replace(WEEX_COMPONENT_REG, '').replace(WEEX_MODULE_REG, '')\n  return result\n}\n\nexport function removeJSSurfix (str) {\n  return str.replace(JS_SURFIX_REG, '')\n}\n","/* eslint-disable */\n\n\nimport { remove } from '../util/index'\n\nlet uid = 0\n\n/**\n * A dep is an observable that can have multiple\n * directives subscribing to it.\n *\n * @constructor\n */\n\nexport default function Dep () {\n  this.id = uid++\n  this.subs = []\n}\n\n// the current target watcher being evaluated.\n// this is globally unique because there could be only one\n// watcher being evaluated at any time.\nDep.target = null\nlet targetStack = []\n\nexport function pushTarget (_target) {\n  if (Dep.target) targetStack.push(Dep.target)\n  Dep.target = _target\n}\n\nexport function popTarget () {\n  Dep.target = targetStack.pop()\n}\n\nexport function resetTarget () {\n  Dep.target = null\n  targetStack = []\n}\n\n/**\n * Add a directive subscriber.\n *\n * @param {Directive} sub\n */\n\nDep.prototype.addSub = function (sub) {\n  this.subs.push(sub)\n}\n\n/**\n * Remove a directive subscriber.\n *\n * @param {Directive} sub\n */\n\nDep.prototype.removeSub = function (sub) {\n  remove(this.subs, sub)\n}\n\n/**\n * Add self as a dependency to the target watcher.\n */\n\nDep.prototype.depend = function () {\n  if (Dep.target) {\n    Dep.target.addDep(this)\n  }\n}\n\n/**\n * Notify all subscribers of a new value.\n */\n\nDep.prototype.notify = function () {\n  // stablize the subscriber list first\n  const subs = this.subs.slice()\n  for (let i = 0, l = subs.length; i < l; i++) {\n    subs[i].update()\n  }\n}\n","/* eslint-disable */\n\n\nimport Dep, { pushTarget, popTarget } from './dep'\n// import { pushWatcher } from './batcher'\nimport {\n  remove,\n  extend,\n  isObject,\n  createNewSet\n  // _Set as Set\n} from '../util/index'\n\nlet uid = 0\n\n/**\n * A watcher parses an expression, collects dependencies,\n * and fires callback when the expression value changes.\n * This is used for both the $watch() api and directives.\n *\n * @param {Vue} vm\n * @param {String|Function} expOrFn\n * @param {Function} cb\n * @param {Object} options\n *                 - {Array} filters\n *                 - {Boolean} twoWay\n *                 - {Boolean} deep\n *                 - {Boolean} user\n *                 - {Boolean} sync\n *                 - {Boolean} lazy\n *                 - {Function} [preProcess]\n *                 - {Function} [postProcess]\n * @constructor\n */\n\nexport default function Watcher (vm, expOrFn, cb, options) {\n  // mix in options\n  if (options) {\n    extend(this, options)\n  }\n  const isFn = typeof expOrFn === 'function'\n  this.vm = vm\n  vm._watchers.push(this)\n  this.expression = expOrFn\n  this.cb = cb\n  this.id = ++uid // uid for batching\n  this.active = true\n  this.dirty = this.lazy // for lazy watchers\n  this.deps = []\n  this.newDeps = []\n  this.depIds = createNewSet() // new Set()\n  this.newDepIds = createNewSet() // new Set()\n  // parse expression for getter\n  if (isFn) {\n    this.getter = expOrFn\n  }\n  this.value = this.lazy\n    ? undefined\n    : this.get()\n  // state for avoiding false triggers for deep and Array\n  // watchers during vm._digest()\n  this.queued = this.shallow = false\n}\n\n/**\n * Evaluate the getter, and re-collect dependencies.\n */\n\nWatcher.prototype.get = function () {\n  pushTarget(this)\n  const value = this.getter.call(this.vm, this.vm)\n  // \"touch\" every property so they are all tracked as\n  // dependencies for deep watching\n  if (this.deep) {\n    traverse(value)\n  }\n  popTarget()\n  this.cleanupDeps()\n  return value\n}\n\n/**\n * Add a dependency to this directive.\n *\n * @param {Dep} dep\n */\n\nWatcher.prototype.addDep = function (dep) {\n  const id = dep.id\n  if (!this.newDepIds.has(id)) {\n    this.newDepIds.add(id)\n    this.newDeps.push(dep)\n    if (!this.depIds.has(id)) {\n      dep.addSub(this)\n    }\n  }\n}\n\n/**\n * Clean up for dependency collection.\n */\n\nWatcher.prototype.cleanupDeps = function () {\n  let i = this.deps.length\n  while (i--) {\n    const dep = this.deps[i]\n    if (!this.newDepIds.has(dep.id)) {\n      dep.removeSub(this)\n    }\n  }\n  let tmp = this.depIds\n  this.depIds = this.newDepIds\n  this.newDepIds = tmp\n  this.newDepIds.clear()\n  tmp = this.deps\n  this.deps = this.newDeps\n  this.newDeps = tmp\n  this.newDeps.length = 0\n}\n\n/**\n * Subscriber interface.\n * Will be called when a dependency changes.\n *\n * @param {Boolean} shallow\n */\n\nWatcher.prototype.update = function (shallow) {\n  if (this.lazy) {\n    this.dirty = true\n  } else {\n    this.run()\n  }\n  // } else if (this.sync) {\n  //   this.run()\n  // } else {\n  //   // if queued, only overwrite shallow with non-shallow,\n  //   // but not the other way around.\n  //   this.shallow = this.queued\n  //     ? shallow\n  //       ? this.shallow\n  //       : false\n  //     : !!shallow\n  //   this.queued = true\n  //   pushWatcher(this)\n  // }\n}\n\n/**\n * Batcher job interface.\n * Will be called by the batcher.\n */\n\nWatcher.prototype.run = function () {\n  if (this.active) {\n    const value = this.get()\n    if (\n      value !== this.value ||\n      // Deep watchers and watchers on Object/Arrays should fire even\n      // when the value is the same, because the value may\n      // have mutated; but only do so if this is a\n      // non-shallow update (caused by a vm digest).\n      ((isObject(value) || this.deep) && !this.shallow)\n    ) {\n      // set new value\n      const oldValue = this.value\n      this.value = value\n      this.cb.call(this.vm, value, oldValue)\n    }\n    this.queued = this.shallow = false\n  }\n}\n\n/**\n * Evaluate the value of the watcher.\n * This only gets called for lazy watchers.\n */\n\nWatcher.prototype.evaluate = function () {\n  this.value = this.get()\n  this.dirty = false\n}\n\n/**\n * Depend on all deps collected by this watcher.\n */\n\nWatcher.prototype.depend = function () {\n  let i = this.deps.length\n  while (i--) {\n    this.deps[i].depend()\n  }\n}\n\n/**\n * Remove self from all dependencies' subcriber list.\n */\n\nWatcher.prototype.teardown = function () {\n  if (this.active) {\n    // remove self from vm's watcher list\n    // this is a somewhat expensive operation so we skip it\n    // if the vm is being destroyed or is performing a v-for\n    // re-render (the watcher list is then filtered by v-for).\n    if (!this.vm._isBeingDestroyed && !this.vm._vForRemoving) {\n      remove(this.vm._watchers, this)\n    }\n    let i = this.deps.length\n    while (i--) {\n      this.deps[i].removeSub(this)\n    }\n    this.active = false\n    this.vm = this.cb = this.value = null\n  }\n}\n\n/**\n * Recrusively traverse an object to evoke all converted\n * getters, so that every nested property inside the object\n * is collected as a \"deep\" dependency.\n *\n * @param {*} val\n * @param {Set} seen\n */\n\nconst seenObjects = createNewSet() // new Set()\n/* istanbul ignore next */\nfunction traverse (val, seen) {\n  let i, keys, isA, isO\n  if (!seen) {\n    seen = seenObjects\n    seen.clear()\n  }\n  isA = Array.isArray(val)\n  isO = isObject(val)\n  if (isA || isO) {\n    if (val.__ob__) {\n      const depId = val.__ob__.dep.id\n      if (seen.has(depId)) {\n        return\n      } else {\n        seen.add(depId)\n      }\n    }\n    if (isA) {\n      i = val.length\n      while (i--) traverse(val[i], seen)\n    } else if (isO) {\n      keys = Object.keys(val)\n      i = keys.length\n      while (i--) traverse(val[keys[i]], seen)\n    }\n  }\n}\n","/* eslint-disable */\n\n\nimport { def } from '../util/index'\n\nconst arrayProto = Array.prototype\nexport const arrayMethods = Object.create(arrayProto)\n\n/**\n * Intercept mutating methods and emit events\n */\n\n;[\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n]\n.forEach(function (method) {\n  // cache original method\n  const original = arrayProto[method]\n  def(arrayMethods, method, function mutator () {\n    // avoid leaking arguments:\n    // http://jsperf.com/closure-with-arguments\n    let i = arguments.length\n    const args = new Array(i)\n    while (i--) {\n      args[i] = arguments[i]\n    }\n    const result = original.apply(this, args)\n    const ob = this.__ob__\n    let inserted\n    switch (method) {\n      case 'push':\n        inserted = args\n        break\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n    }\n    if (inserted) ob.observeArray(inserted)\n    // notify change\n    ob.dep.notify()\n    return result\n  })\n})\n\n/**\n * Swap the element at the given index with a new value\n * and emits corresponding event.\n *\n * @param {Number} index\n * @param {*} val\n * @return {*} - replaced element\n */\n\ndef(\n  arrayProto,\n  '$set',\n  function $set (index, val) {\n    console.warn(`[JS Framework] \"Array.prototype.$set\" is not a standard API,`\n      + ` it will be removed in the next version.`)\n    if (index >= this.length) {\n      this.length = index + 1\n    }\n    return this.splice(index, 1, val)[0]\n  }\n)\n\n/**\n * Convenience method to remove the element at given index.\n *\n * @param {Number} index\n * @param {*} val\n */\n\ndef(\n  arrayProto,\n  '$remove',\n  function $remove (index) {\n    console.warn(`[JS Framework] \"Array.prototype.$remove\" is not a standard API,`\n      + ` it will be removed in the next version.`)\n    /* istanbul ignore if */\n    if (!this.length) return\n    /* istanbul ignore else */\n    if (typeof index !== 'number') {\n      index = this.indexOf(index)\n    }\n    /* istanbul ignore else */\n    if (index > -1) {\n      this.splice(index, 1)\n    }\n  }\n)\n","/* eslint-disable */\n\n\nimport Dep from './dep'\nimport { arrayMethods } from './array'\nimport {\n  def,\n  remove,\n  isObject,\n  isPlainObject,\n  hasProto,\n  hasOwn,\n  isReserved\n} from '../util/index'\n\nconst arrayKeys = Object.getOwnPropertyNames(arrayMethods)\n\n/**\n * Observer class that are attached to each observed\n * object. Once attached, the observer converts target\n * object's property keys into getter/setters that\n * collect dependencies and dispatches updates.\n *\n * @param {Array|Object} value\n * @constructor\n */\n\nexport function Observer (value) {\n  this.value = value\n  this.dep = new Dep()\n  def(value, '__ob__', this)\n  if (Array.isArray(value)) {\n    const augment = hasProto\n      ? protoAugment\n      : copyAugment\n    augment(value, arrayMethods, arrayKeys)\n    this.observeArray(value)\n  } else {\n    this.walk(value)\n  }\n}\n\n// Instance methods\n\n/**\n * Walk through each property and convert them into\n * getter/setters. This method should only be called when\n * value type is Object.\n *\n * @param {Object} obj\n */\n\nObserver.prototype.walk = function (obj) {\n  for (let key in obj) {\n    this.convert(key, obj[key])\n  }\n}\n\n/**\n * Observe a list of Array items.\n *\n * @param {Array} items\n */\n\nObserver.prototype.observeArray = function (items) {\n  for (let i = 0, l = items.length; i < l; i++) {\n    observe(items[i])\n  }\n}\n\n/**\n * Convert a property into getter/setter so we can emit\n * the events when the property is accessed/changed.\n *\n * @param {String} key\n * @param {*} val\n */\n\nObserver.prototype.convert = function (key, val) {\n  defineReactive(this.value, key, val)\n}\n\n/**\n * Add an owner vm, so that when $set/$delete mutations\n * happen we can notify owner vms to proxy the keys and\n * digest the watchers. This is only called when the object\n * is observed as an instance's root $data.\n *\n * @param {Vue} vm\n */\n\nObserver.prototype.addVm = function (vm) {\n  (this.vms || (this.vms = [])).push(vm)\n}\n\n/**\n * Remove an owner vm. This is called when the object is\n * swapped out as an instance's $data object.\n *\n * @param {Vue} vm\n */\n\n/* istanbul ignore next */\nObserver.prototype.removeVm = function (vm) {\n  remove(this.vms, vm)\n}\n\n// helpers\n\n/**\n * Augment an target Object or Array by intercepting\n * the prototype chain using __proto__\n *\n * @param {Object|Array} target\n * @param {Object} src\n */\n\nfunction protoAugment (target, src) {\n  /* eslint-disable no-proto */\n  target.__proto__ = src\n  /* eslint-enable no-proto */\n}\n\n/**\n * Augment an target Object or Array by defining\n * hidden properties.\n *\n * @param {Object|Array} target\n * @param {Object} proto\n */\n\n/* istanbul ignore next */\nfunction copyAugment (target, src, keys) {\n  for (let i = 0, l = keys.length; i < l; i++) {\n    const key = keys[i]\n    def(target, key, src[key])\n  }\n}\n\n/**\n * Attempt to create an observer instance for a value,\n * returns the new observer if successfully observed,\n * or the existing observer if the value already has one.\n *\n * @param {*} value\n * @param {Vue} [vm]\n * @return {Observer|undefined}\n * @static\n */\n\nexport function observe (value, vm) {\n  if (!isObject(value)) {\n    return\n  }\n  let ob\n  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {\n    ob = value.__ob__\n  } else if (\n    (Array.isArray(value) || isPlainObject(value)) &&\n    Object.isExtensible(value) &&\n    !value._isVue\n  ) {\n    ob = new Observer(value)\n  }\n  if (ob && vm) {\n    ob.addVm(vm)\n  }\n  return ob\n}\n\n/**\n * Define a reactive property on an Object.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n */\n\nexport function defineReactive (obj, key, val) {\n  const dep = new Dep()\n\n  const property = Object.getOwnPropertyDescriptor(obj, key)\n  if (property && property.configurable === false) {\n    return\n  }\n\n  // cater for pre-defined getter/setters\n  const getter = property && property.get\n  const setter = property && property.set\n\n  let childOb = observe(val)\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      if (Dep.target) {\n        dep.depend()\n        if (childOb) {\n          childOb.dep.depend()\n        }\n        if (Array.isArray(value)) {\n          for (let e, i = 0, l = value.length; i < l; i++) {\n            e = value[i]\n            e && e.__ob__ && e.__ob__.dep.depend()\n          }\n        }\n      }\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      const value = getter ? getter.call(obj) : val\n      if (newVal === value) {\n        return\n      }\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      childOb = observe(newVal)\n      dep.notify()\n    }\n  })\n}\n\n/**\n * Set a property on an object. Adds the new property and\n * triggers change notification if the property doesn't\n * already exist.\n *\n * @param {Object} obj\n * @param {String} key\n * @param {*} val\n * @public\n */\n\n/* istanbul ignore next */\nexport function set (obj, key, val) {\n  if (Array.isArray(obj)) {\n    return obj.splice(key, 1, val)\n  }\n  if (hasOwn(obj, key)) {\n    obj[key] = val\n    return\n  }\n  if (obj._isVue) {\n    set(obj._data, key, val)\n    return\n  }\n  const ob = obj.__ob__\n  if (!ob) {\n    obj[key] = val\n    return\n  }\n  ob.convert(key, val)\n  ob.dep.notify()\n  if (ob.vms) {\n    let i = ob.vms.length\n    while (i--) {\n      const vm = ob.vms[i]\n      proxy(vm, key)\n      // vm.$forceUpdate()\n    }\n  }\n  return val\n}\n\n/**\n * Delete a property and trigger change if necessary.\n *\n * @param {Object} obj\n * @param {String} key\n */\n\n/* istanbul ignore next */\nexport function del (obj, key) {\n  if (!hasOwn(obj, key)) {\n    return\n  }\n  delete obj[key]\n  const ob = obj.__ob__\n\n  if (!ob) {\n    if (obj._isVue) {\n      delete obj._data[key]\n      // obj.$forceUpdate()\n    }\n    return\n  }\n  ob.dep.notify()\n  if (ob.vms) {\n    let i = ob.vms.length\n    while (i--) {\n      const vm = ob.vms[i]\n      unproxy(vm, key)\n      // vm.$forceUpdate()\n    }\n  }\n}\n\nconst KEY_WORDS = ['$index', '$value', '$event']\nexport function proxy (vm, key) {\n  if (KEY_WORDS.indexOf(key) > -1 || !isReserved(key)) {\n    Object.defineProperty(vm, key, {\n      configurable: true,\n      enumerable: true,\n      get: function proxyGetter () {\n        return vm._data[key]\n      },\n      set: function proxySetter (val) {\n        vm._data[key] = val\n      }\n    })\n  }\n}\n\n/* istanbul ignore next */\nexport function unproxy (vm, key) {\n  if (!isReserved(key)) {\n    delete vm[key]\n  }\n}\n","/* eslint-disable */\n\n\nimport Watcher from './watcher'\nimport Dep from './dep'\nimport {\n  observe,\n  proxy,\n  unproxy\n} from './observer'\nimport {\n  isPlainObject,\n  bind\n} from '../util/index'\n\nexport function initState (vm) {\n  vm._watchers = []\n  initData(vm)\n  initComputed(vm)\n  initMethods(vm)\n}\n\nexport function initData (vm) {\n  let data = vm._data\n\n  if (!isPlainObject(data)) {\n    data = {}\n  }\n  // proxy data on instance\n  const keys = Object.keys(data)\n  let i = keys.length\n  while (i--) {\n    proxy(vm, keys[i])\n  }\n  // observe data\n  observe(data, vm)\n}\n\n/* istanbul ignore next */\nfunction noop () {\n}\n\nexport function initComputed (vm) {\n  const computed = vm._computed\n  if (computed) {\n    for (let key in computed) {\n      const userDef = computed[key]\n      const def = {\n        enumerable: true,\n        configurable: true\n      }\n      if (typeof userDef === 'function') {\n        def.get = makeComputedGetter(userDef, vm)\n        def.set = noop\n      } else {\n        def.get = userDef.get\n          ? userDef.cache !== false\n            ? makeComputedGetter(userDef.get, vm)\n            : bind(userDef.get, vm)\n          : noop\n        def.set = userDef.set\n          ? bind(userDef.set, vm)\n          : noop\n      }\n      Object.defineProperty(vm, key, def)\n    }\n  }\n}\n\nfunction makeComputedGetter (getter, owner) {\n  const watcher = new Watcher(owner, getter, null, {\n    lazy: true\n  })\n  return function computedGetter () {\n    if (watcher.dirty) {\n      watcher.evaluate()\n    }\n    if (Dep.target) {\n      watcher.depend()\n    }\n    return watcher.value\n  }\n}\n\nexport function initMethods (vm) {\n  const methods = vm._methods\n  if (methods) {\n    for (let key in methods) {\n      vm[key] = methods[key]\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// @todo: It should be registered by native from `registerComponents()`.\n\nexport default {\n  nativeComponentMap: {\n    text: true,\n    image: true,\n    container: true,\n    slider: {\n      type: 'slider',\n      append: 'tree'\n    },\n    cell: {\n      type: 'cell',\n      append: 'tree'\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Directive Parser\n */\n\nimport { bind, typof } from '../util/index'\nimport Watcher from '../core/watcher'\nimport config from '../config'\n\nconst { nativeComponentMap } = config\n\nconst SETTERS = {\n  attr: 'setAttr',\n  style: 'setStyle',\n  event: 'addEvent'\n}\n\n/**\n * apply the native component's options(specified by template.type)\n * to the template\n */\nexport function applyNaitveComponentOptions (template) {\n  const { type } = template\n  const options = nativeComponentMap[type]\n\n  if (typeof options === 'object') {\n    for (const key in options) {\n      if (template[key] == null) {\n        template[key] = options[key]\n      }\n      else if (typof(template[key]) === 'object' &&\n        typof(options[key]) === 'object') {\n        for (const subkey in options[key]) {\n          if (template[key][subkey] == null) {\n            template[key][subkey] = options[key][subkey]\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * bind all id, attr, classnames, style, events to an element\n */\nexport function bindElement (vm, el, template) {\n  setId(vm, el, template.id, vm)\n  setAttr(vm, el, template.attr)\n  setClass(vm, el, template.classList)\n  setStyle(vm, el, template.style)\n  bindEvents(vm, el, template.events)\n}\n\n/**\n * bind all props to sub vm and bind all style, events to the root element\n * of the sub vm if it doesn't have a replaced multi-node fragment\n */\nexport function bindSubVm (vm, subVm, template, repeatItem) {\n  subVm = subVm || {}\n  template = template || {}\n\n  const options = subVm._options || {}\n\n  // bind props\n  let props = options.props\n\n  if (Array.isArray(props)) {\n    props = props.reduce((result, value) => {\n      result[value] = true\n      return result\n    }, {})\n  }\n\n  mergeProps(repeatItem, props, vm, subVm)\n  mergeProps(template.attr, props, vm, subVm)\n}\n\n/**\n * merge class and styles from vm to sub vm.\n */\nexport function bindSubVmAfterInitialized (vm, subVm, template, target = {}) {\n  mergeClassStyle(template.classList, vm, subVm)\n  mergeStyle(template.style, vm, subVm)\n\n  // bind subVm to the target element\n  if (target.children) {\n    target.children[target.children.length - 1]._vm = subVm\n  }\n  else {\n    target._vm = subVm\n  }\n}\n\n/**\n * Bind props from vm to sub vm and watch their updates.\n */\nfunction mergeProps (target, props, vm, subVm) {\n  if (!target) {\n    return\n  }\n  for (const key in target) {\n    if (!props || props[key]) {\n      const value = target[key]\n      if (typeof value === 'function') {\n        const returnValue = watch(vm, value, function (v) {\n          subVm[key] = v\n        })\n        subVm[key] = returnValue\n      }\n      else {\n        subVm[key] = value\n      }\n    }\n  }\n}\n\n/**\n * Bind style from vm to sub vm and watch their updates.\n */\nfunction mergeStyle (target, vm, subVm) {\n  for (const key in target) {\n    const value = target[key]\n    if (typeof value === 'function') {\n      const returnValue = watch(vm, value, function (v) {\n        if (subVm._rootEl) {\n          subVm._rootEl.setStyle(key, v)\n        }\n      })\n      subVm._rootEl.setStyle(key, returnValue)\n    }\n    else {\n      if (subVm._rootEl) {\n        subVm._rootEl.setStyle(key, value)\n      }\n    }\n  }\n}\n\n/**\n * Bind class & style from vm to sub vm and watch their updates.\n */\nfunction mergeClassStyle (target, vm, subVm) {\n  const css = vm._options && vm._options.style || {}\n\n  /* istanbul ignore if */\n  if (!subVm._rootEl) {\n    return\n  }\n\n  const className = '@originalRootEl'\n  css[className] = subVm._rootEl.classStyle\n\n  function addClassName (list, name) {\n    if (typof(list) === 'array') {\n      list.unshift(name)\n    }\n  }\n\n  if (typeof target === 'function') {\n    const value = watch(vm, target, v => {\n      addClassName(v, className)\n      setClassStyle(subVm._rootEl, css, v)\n    })\n    addClassName(value, className)\n    setClassStyle(subVm._rootEl, css, value)\n  }\n  else if (target != null) {\n    addClassName(target, className)\n    setClassStyle(subVm._rootEl, css, target)\n  }\n}\n\n/**\n * bind id to an element\n * each id is unique in a whole vm\n */\nexport function setId (vm, el, id, target) {\n  const map = Object.create(null)\n\n  Object.defineProperties(map, {\n    vm: {\n      value: target,\n      writable: false,\n      configurable: false\n    },\n    el: {\n      get: () => el || target._rootEl,\n      configurable: false\n    }\n  })\n\n  if (typeof id === 'function') {\n    const handler = id\n    id = handler.call(vm)\n    if (id || id === 0) {\n      vm._ids[id] = map\n    }\n    watch(vm, handler, (newId) => {\n      if (newId) {\n        vm._ids[newId] = map\n      }\n    })\n  }\n  else if (id && typeof id === 'string') {\n    vm._ids[id] = map\n  }\n}\n\n/**\n * bind attr to an element\n */\nfunction setAttr (vm, el, attr) {\n  bindDir(vm, el, 'attr', attr)\n}\n\nfunction setClassStyle (el, css, classList) {\n  if (typeof classList === 'string') {\n    classList = classList.split(/\\s+/)\n  }\n  classList.forEach((name, i) => {\n    classList.splice(i, 1, ...name.split(/\\s+/))\n  })\n  const classStyle = {}\n  const length = classList.length\n\n  for (let i = 0; i < length; i++) {\n    const style = css[classList[i]]\n    if (style) {\n      Object.keys(style).forEach((key) => {\n        classStyle[key] = style[key]\n      })\n    }\n  }\n  el.setClassStyle(classStyle)\n}\n\n/**\n * bind classnames to an element\n */\nfunction setClass (vm, el, classList) {\n  if (typeof classList !== 'function' && !Array.isArray(classList)) {\n    return\n  }\n  if (Array.isArray(classList) && !classList.length) {\n    el.setClassStyle({})\n    return\n  }\n\n  const style = vm._options && vm._options.style || {}\n  if (typeof classList === 'function') {\n    const value = watch(vm, classList, v => {\n      setClassStyle(el, style, v)\n    })\n    setClassStyle(el, style, value)\n  }\n  else {\n    setClassStyle(el, style, classList)\n  }\n}\n\n/**\n * bind style to an element\n */\nfunction setStyle (vm, el, style) {\n  bindDir(vm, el, 'style', style)\n}\n\n/**\n * add an event type and handler to an element and generate a dom update\n */\nfunction setEvent (vm, el, type, handler) {\n  el.addEvent(type, bind(handler, vm))\n}\n\n/**\n * add all events of an element\n */\nfunction bindEvents (vm, el, events) {\n  if (!events) {\n    return\n  }\n  const keys = Object.keys(events)\n  let i = keys.length\n  while (i--) {\n    const key = keys[i]\n    let handler = events[key]\n    if (typeof handler === 'string') {\n      handler = vm[handler]\n      /* istanbul ignore if */\n      if (!handler) {\n        console.warn(`[JS Framework] The event handler \"${handler}\" is not defined.`)\n      }\n    }\n    setEvent(vm, el, key, handler)\n  }\n}\n\n/**\n * set a series of members as a kind of an element\n * for example: style, attr, ...\n * if the value is a function then bind the data changes\n */\nfunction bindDir (vm, el, name, data) {\n  if (!data) {\n    return\n  }\n  const keys = Object.keys(data)\n  let i = keys.length\n  while (i--) {\n    const key = keys[i]\n    const value = data[key]\n    if (typeof value === 'function') {\n      bindKey(vm, el, name, key, value)\n    }\n    else {\n      el[SETTERS[name]](key, value)\n    }\n  }\n}\n\n/**\n * bind data changes to a certain key to a name series in an element\n */\nfunction bindKey (vm, el, name, key, calc) {\n  const methodName = SETTERS[name]\n  // watch the calc, and returns a value by calc.call()\n  const value = watch(vm, calc, (value) => {\n    function handler () {\n      el[methodName](key, value)\n    }\n    const differ = vm && vm._app && vm._app.differ\n    if (differ) {\n      differ.append('element', el.depth || 0, el.ref, handler)\n    }\n    else {\n      handler()\n    }\n  })\n\n  el[methodName](key, value)\n}\n\n/**\n * watch a calc function and callback if the calc value changes\n */\nexport function watch (vm, calc, callback) {\n  if (vm._static) {\n    return calc.call(vm, vm)\n  }\n  const watcher = new Watcher(vm, calc, function (value, oldValue) {\n    /* istanbul ignore if */\n    if (typeof value !== 'object' && value === oldValue) {\n      return\n    }\n    callback(value)\n  })\n\n  return watcher.value\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview Document & Element Helpers.\n *\n * required:\n * Document#: createElement, createComment, getRef\n * Element#: appendChild, insertBefore, removeChild, nextSibling\n */\n\n/**\n * Create a body by type\n * Using this._app.doc\n *\n * @param  {string} type\n */\nexport function createBody (vm, type) {\n  const doc = vm._app.doc\n  return doc.createBody(type)\n}\n\n/**\n * Create an element by type\n * Using this._app.doc\n *\n * @param  {string} type\n */\nexport function createElement (vm, type) {\n  const doc = vm._app.doc\n  return doc.createElement(type)\n}\n\n/**\n * Create and return a frag block for an element.\n * The frag block has a starter, ender and the element itself.\n *\n * @param  {object} element\n */\nexport function createBlock (vm, element) {\n  const start = createBlockStart(vm)\n  const end = createBlockEnd(vm)\n  const blockId = lastestBlockId++\n  if (element.element) {\n    let updateMark = element.updateMark\n    if (updateMark) {\n      if (updateMark.element) {\n        updateMark = updateMark.end\n      }\n      element.element.insertAfter(end, updateMark)\n      element.element.insertAfter(start, updateMark)\n      element.updateMark = end\n    }\n    else {\n      element.element.insertBefore(start, element.end)\n      element.element.insertBefore(end, element.end)\n    }\n    element = element.element\n  }\n  else {\n    element.appendChild(start)\n    element.appendChild(end)\n  }\n  return { start, end, element, blockId }\n}\n\nlet lastestBlockId = 1\n\n/**\n * Create and return a block starter.\n * Using this._app.doc\n */\nfunction createBlockStart (vm) {\n  const doc = vm._app.doc\n  const anchor = doc.createComment('start')\n  return anchor\n}\n\n/**\n * Create and return a block ender.\n * Using this._app.doc\n */\nfunction createBlockEnd (vm) {\n  const doc = vm._app.doc\n  const anchor = doc.createComment('end')\n  return anchor\n}\n\n/**\n * Attach target to a certain dest using appendChild by default.\n * If the dest is a frag block then insert before the ender.\n * If the target is a frag block then attach the starter and ender in order.\n *\n * @param  {object} target\n * @param  {object} dest\n */\nexport function attachTarget (vm, target, dest) {\n  if (dest.element) {\n    const before = dest.end\n    const after = dest.updateMark\n    // push new target for watch list update later\n    if (dest.children) {\n      dest.children.push(target)\n    }\n    // for check repeat case\n    if (after) {\n      const signal = moveTarget(vm, target, after)\n      dest.updateMark = target.element ? target.end : target\n      return signal\n    }\n    else if (target.element) {\n      dest.element.insertBefore(target.start, before)\n      dest.element.insertBefore(target.end, before)\n    }\n    else {\n      return dest.element.insertBefore(target, before)\n    }\n  }\n  else {\n    if (target.element) {\n      dest.appendChild(target.start)\n      dest.appendChild(target.end)\n    }\n    else {\n      return dest.appendChild(target)\n    }\n  }\n}\n\n/**\n * Move target before a certain element. The target maybe block or element.\n *\n * @param  {object} target\n * @param  {object} before\n */\nexport function moveTarget (vm, target, after) {\n  if (target.element) {\n    return moveBlock(target, after)\n  }\n  return moveElement(target, after)\n}\n\n/**\n * Move element before a certain element.\n *\n * @param  {object} element\n * @param  {object} before\n */\nfunction moveElement (element, after) {\n  const parent = after.parentNode\n  if (parent) {\n    return parent.insertAfter(element, after)\n  }\n}\n\n/**\n * Move all elements of the block before a certain element.\n *\n * @param  {object} fragBlock\n * @param  {object} before\n */\nfunction moveBlock (fragBlock, after) {\n  const parent = after.parentNode\n\n  if (parent) {\n    let el = fragBlock.start\n    let signal\n    const group = [el]\n\n    while (el && el !== fragBlock.end) {\n      el = el.nextSibling\n      group.push(el)\n    }\n\n    let temp = after\n    group.every((el) => {\n      signal = parent.insertAfter(el, temp)\n      temp = el\n      return signal !== -1\n    })\n\n    return signal\n  }\n}\n\n/**\n * Remove target from DOM tree.\n * If the target is a frag block then call _removeBlock\n *\n * @param  {object} target\n */\nexport function removeTarget (vm, target, preserveBlock = false) {\n  if (target.element) {\n    removeBlock(target, preserveBlock)\n  }\n  else {\n    removeElement(target)\n  }\n  if (target._vm) {\n    target._vm.$emit('hook:destroyed')\n  }\n}\n\n/**\n * Remove a certain element.\n * Using this._app.doc\n *\n * @param  {object} target\n */\nfunction removeElement (target) {\n  const parent = target.parentNode\n\n  if (parent) {\n    parent.removeChild(target)\n  }\n}\n\n/**\n * Remove a frag block.\n * The second param decides whether the block self should be removed too.\n *\n * @param  {object}  fragBlock\n * @param  {Boolean} preserveBlock=false\n */\nfunction removeBlock (fragBlock, preserveBlock = false) {\n  const result = []\n  let el = fragBlock.start.nextSibling\n\n  while (el && el !== fragBlock.end) {\n    result.push(el)\n    el = el.nextSibling\n  }\n\n  if (!preserveBlock) {\n    removeElement(fragBlock.start)\n  }\n  result.forEach((el) => {\n    removeElement(el)\n  })\n  if (!preserveBlock) {\n    removeElement(fragBlock.end)\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * ViewModel template parser & data-binding process\n */\n\nimport {\n  extend,\n  isObject,\n  bind\n} from '../util/index'\nimport {\n  initData,\n  initComputed\n} from '../core/state'\nimport {\n  bindElement,\n  setId,\n  bindSubVm,\n  bindSubVmAfterInitialized,\n  applyNaitveComponentOptions,\n  watch\n} from './directive'\nimport {\n  createBlock,\n  createBody,\n  createElement,\n  attachTarget,\n  moveTarget,\n  removeTarget\n} from './dom-helper'\n\n/**\n * build()\n *   compile(template, parentNode)\n *     if (type is content) create contentNode\n *     else if (dirs have v-for) foreach -> create context\n *       -> compile(templateWithoutFor, parentNode): diff(list) onchange\n *     else if (dirs have v-if) assert\n *       -> compile(templateWithoutIf, parentNode): toggle(shown) onchange\n *     else if (type is dynamic)\n *       -> compile(templateWithoutDynamicType, parentNode): watch(type) onchange\n *     else if (type is custom)\n *       addChildVm(vm, parentVm)\n *       build(externalDirs)\n *       foreach childNodes -> compile(childNode, template)\n *     else if (type is native)\n *       set(dirs): update(id/attr/style/class) onchange\n *       append(template, parentNode)\n *       foreach childNodes -> compile(childNode, template)\n */\nexport function build (vm) {\n  const opt = vm._options || {}\n  const template = opt.template || {}\n\n  if (opt.replace) {\n    if (template.children && template.children.length === 1) {\n      compile(vm, template.children[0], vm._parentEl)\n    }\n    else {\n      compile(vm, template.children, vm._parentEl)\n    }\n  }\n  else {\n    compile(vm, template, vm._parentEl)\n  }\n\n  console.debug(`[JS Framework] \"ready\" lifecycle in Vm(${vm._type})`)\n  vm.$emit('hook:ready')\n  vm._ready = true\n}\n\n/**\n * Generate elements by child or children and append to parent elements.\n * Root element info would be merged if has. The first argument may be an array\n * if the root element with options.replace has not only one child.\n *\n * @param {object|array} target\n * @param {object}       dest\n * @param {object}       meta\n */\nfunction compile (vm, target, dest, meta) {\n  const app = vm._app || {}\n\n  if (app.lastSignal === -1) {\n    return\n  }\n\n  if (target.attr && target.attr.hasOwnProperty('static')) {\n    vm._static = true\n  }\n\n  if (targetIsFragment(target)) {\n    compileFragment(vm, target, dest, meta)\n    return\n  }\n  meta = meta || {}\n  if (targetIsContent(target)) {\n    console.debug('[JS Framework] compile \"content\" block by', target)\n    vm._content = createBlock(vm, dest)\n    return\n  }\n\n  if (targetNeedCheckRepeat(target, meta)) {\n    console.debug('[JS Framework] compile \"repeat\" logic by', target)\n    if (dest.type === 'document') {\n      console.warn('[JS Framework] The root element does\\'t support `repeat` directive!')\n    }\n    else {\n      compileRepeat(vm, target, dest)\n    }\n    return\n  }\n  if (targetNeedCheckShown(target, meta)) {\n    console.debug('[JS Framework] compile \"if\" logic by', target)\n    if (dest.type === 'document') {\n      console.warn('[JS Framework] The root element does\\'t support `if` directive!')\n    }\n    else {\n      compileShown(vm, target, dest, meta)\n    }\n    return\n  }\n  const typeGetter = meta.type || target.type\n  if (targetNeedCheckType(typeGetter, meta)) {\n    compileType(vm, target, dest, typeGetter, meta)\n    return\n  }\n  const type = typeGetter\n  const component = targetIsComposed(vm, target, type)\n  if (component) {\n    console.debug('[JS Framework] compile composed component by', target)\n    compileCustomComponent(vm, component, target, dest, type, meta)\n    return\n  }\n  console.debug('[JS Framework] compile native component by', target)\n  compileNativeComponent(vm, target, dest, type)\n}\n\n/**\n * Check if target is a fragment (an array).\n *\n * @param  {object}  target\n * @return {boolean}\n */\nfunction targetIsFragment (target) {\n  return Array.isArray(target)\n}\n\n/**\n * Check if target type is content/slot.\n *\n * @param  {object}  target\n * @return {boolean}\n */\nfunction targetIsContent (target) {\n  return target.type === 'content' || target.type === 'slot'\n}\n\n/**\n * Check if target need to compile by a list.\n *\n * @param  {object}  target\n * @param  {object}  meta\n * @return {boolean}\n */\nfunction targetNeedCheckRepeat (target, meta) {\n  return !meta.hasOwnProperty('repeat') && target.repeat\n}\n\n/**\n * Check if target need to compile by a boolean value.\n *\n * @param  {object}  target\n * @param  {object}  meta\n * @return {boolean}\n */\nfunction targetNeedCheckShown (target, meta) {\n  return !meta.hasOwnProperty('shown') && target.shown\n}\n\n/**\n * Check if target need to compile by a dynamic type.\n *\n * @param  {string|function} typeGetter\n * @param  {object}          meta\n * @return {boolean}\n */\nfunction targetNeedCheckType (typeGetter, meta) {\n  return (typeof typeGetter === 'function') && !meta.hasOwnProperty('type')\n}\n\n/**\n * Check if this kind of component is composed.\n *\n * @param  {string}  type\n * @return {boolean}\n */\nfunction targetIsComposed (vm, target, type) {\n  let component\n  if (vm._app && vm._app.customComponentMap) {\n    component = vm._app.customComponentMap[type]\n  }\n  if (vm._options && vm._options.components) {\n    component = vm._options.components[type]\n  }\n  if (target.component) {\n    component = component || {}\n  }\n  return component\n}\n\n/**\n * Compile a list of targets.\n *\n * @param {object} target\n * @param {object} dest\n * @param {object} meta\n */\nfunction compileFragment (vm, target, dest, meta) {\n  const fragBlock = createBlock(vm, dest)\n  target.forEach((child) => {\n    compile(vm, child, fragBlock, meta)\n  })\n}\n\n/**\n * Compile a target with repeat directive.\n *\n * @param {object} target\n * @param {object} dest\n */\nfunction compileRepeat (vm, target, dest) {\n  const repeat = target.repeat\n  const oldStyle = typeof repeat === 'function'\n  let getter = repeat.getter || repeat.expression || repeat\n  if (typeof getter !== 'function') {\n    getter = function () { return [] }\n  }\n  const key = repeat.key || '$index'\n  const value = repeat.value || '$value'\n  const trackBy = repeat.trackBy || target.trackBy ||\n    (target.attr && target.attr.trackBy)\n\n  const fragBlock = createBlock(vm, dest)\n  fragBlock.children = []\n  fragBlock.data = []\n  fragBlock.vms = []\n\n  bindRepeat(vm, target, fragBlock, { getter, key, value, trackBy, oldStyle })\n}\n\n/**\n * Compile a target with if directive.\n *\n * @param {object} target\n * @param {object} dest\n * @param {object} meta\n */\nfunction compileShown (vm, target, dest, meta) {\n  const newMeta = { shown: true }\n  const fragBlock = createBlock(vm, dest)\n\n  if (dest.element && dest.children) {\n    dest.children.push(fragBlock)\n  }\n\n  if (meta.repeat) {\n    newMeta.repeat = meta.repeat\n  }\n\n  bindShown(vm, target, fragBlock, newMeta)\n}\n\n/**\n * Compile a target with dynamic component type.\n *\n * @param {object}   target\n * @param {object}   dest\n * @param {function} typeGetter\n */\nfunction compileType (vm, target, dest, typeGetter, meta) {\n  const type = typeGetter.call(vm)\n  const newMeta = extend({ type }, meta)\n  const fragBlock = createBlock(vm, dest)\n\n  if (dest.element && dest.children) {\n    dest.children.push(fragBlock)\n  }\n\n  watch(vm, typeGetter, (value) => {\n    const newMeta = extend({ type: value }, meta)\n    removeTarget(vm, fragBlock, true)\n    compile(vm, target, fragBlock, newMeta)\n  })\n\n  compile(vm, target, fragBlock, newMeta)\n}\n\n/**\n * Compile a composed component.\n *\n * @param {object} target\n * @param {object} dest\n * @param {string} type\n */\nfunction compileCustomComponent (vm, component, target, dest, type, meta) {\n  const Ctor = vm.constructor\n  const subVm = new Ctor(type, component, vm, dest, undefined, {\n    'hook:init': function () {\n      if (vm._static) {\n        this._static = vm._static\n      }\n      setId(vm, null, target.id, this)\n      // bind template earlier because of lifecycle issues\n      this._externalBinding = {\n        parent: vm,\n        template: target\n      }\n    },\n    'hook:created': function () {\n      bindSubVm(vm, this, target, meta.repeat)\n    },\n    'hook:ready': function () {\n      if (this._content) {\n        compileChildren(vm, target, this._content)\n      }\n    }\n  })\n  bindSubVmAfterInitialized(vm, subVm, target, dest)\n}\n\n/**\n * Generate element from template and attach to the dest if needed.\n * The time to attach depends on whether the mode status is node or tree.\n *\n * @param {object} template\n * @param {object} dest\n * @param {string} type\n */\nfunction compileNativeComponent (vm, template, dest, type) {\n  applyNaitveComponentOptions(template)\n\n  let element\n  if (dest.ref === '_documentElement') {\n    // if its parent is documentElement then it's a body\n    console.debug(`[JS Framework] compile to create body for ${type}`)\n    element = createBody(vm, type)\n  }\n  else {\n    console.debug(`[JS Framework] compile to create element for ${type}`)\n    element = createElement(vm, type)\n  }\n\n  if (!vm._rootEl) {\n    vm._rootEl = element\n    // bind event earlier because of lifecycle issues\n    const binding = vm._externalBinding || {}\n    const target = binding.template\n    const parentVm = binding.parent\n    if (target && target.events && parentVm && element) {\n      for (const type in target.events) {\n        const handler = parentVm[target.events[type]]\n        if (handler) {\n          element.addEvent(type, bind(handler, parentVm))\n        }\n      }\n    }\n  }\n\n  bindElement(vm, element, template)\n\n  if (template.attr && template.attr.append) { // backward, append prop in attr\n    template.append = template.attr.append\n  }\n\n  if (template.append) { // give the append attribute for ios adaptation\n    element.attr = element.attr || {}\n    element.attr.append = template.append\n  }\n\n  const treeMode = template.append === 'tree'\n  const app = vm._app || {}\n  if (app.lastSignal !== -1 && !treeMode) {\n    console.debug('[JS Framework] compile to append single node for', element)\n    app.lastSignal = attachTarget(vm, element, dest)\n  }\n  if (app.lastSignal !== -1) {\n    compileChildren(vm, template, element)\n  }\n  if (app.lastSignal !== -1 && treeMode) {\n    console.debug('[JS Framework] compile to append whole tree for', element)\n    app.lastSignal = attachTarget(vm, element, dest)\n  }\n}\n\n/**\n * Set all children to a certain parent element.\n *\n * @param {object} template\n * @param {object} dest\n */\nfunction compileChildren (vm, template, dest) {\n  const app = vm._app || {}\n  const children = template.children\n  if (children && children.length) {\n    children.every((child) => {\n      compile(vm, child, dest)\n      return app.lastSignal !== -1\n    })\n  }\n}\n\n/**\n * Watch the list update and refresh the changes.\n *\n * @param {object} target\n * @param {object} fragBlock {vms, data, children}\n * @param {object} info      {getter, key, value, trackBy, oldStyle}\n */\nfunction bindRepeat (vm, target, fragBlock, info) {\n  const vms = fragBlock.vms\n  const children = fragBlock.children\n  const { getter, trackBy, oldStyle } = info\n  const keyName = info.key\n  const valueName = info.value\n\n  function compileItem (item, index, context) {\n    let mergedData\n    if (oldStyle) {\n      mergedData = item\n      if (isObject(item)) {\n        mergedData[keyName] = index\n        if (!mergedData.hasOwnProperty('INDEX')) {\n          Object.defineProperty(mergedData, 'INDEX', {\n            value: () => {\n              console.warn('[JS Framework] \"INDEX\" in repeat is deprecated, ' +\n                'please use \"$index\" instead')\n            }\n          })\n        }\n      }\n      else {\n        console.warn('[JS Framework] Each list item must be an object in old-style repeat, '\n          + 'please use `repeat={{v in list}}` instead.')\n        mergedData = {}\n        mergedData[keyName] = index\n        mergedData[valueName] = item\n      }\n    }\n    else {\n      mergedData = {}\n      mergedData[keyName] = index\n      mergedData[valueName] = item\n    }\n    const newContext = mergeContext(context, mergedData)\n    vms.push(newContext)\n    compile(newContext, target, fragBlock, { repeat: item })\n  }\n\n  const list = watchBlock(vm, fragBlock, getter, 'repeat',\n    (data) => {\n      console.debug('[JS Framework] the \"repeat\" item has changed', data)\n      if (!fragBlock || !data) {\n        return\n      }\n\n      const oldChildren = children.slice()\n      const oldVms = vms.slice()\n      const oldData = fragBlock.data.slice()\n      // 1. collect all new refs track by\n      const trackMap = {}\n      const reusedMap = {}\n      data.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        /* istanbul ignore if */\n        if (key == null || key === '') {\n          return\n        }\n        trackMap[key] = item\n      })\n\n      // 2. remove unused element foreach old item\n      const reusedList = []\n      oldData.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        if (trackMap.hasOwnProperty(key)) {\n          reusedMap[key] = {\n            item, index, key,\n            target: oldChildren[index],\n            vm: oldVms[index]\n          }\n          reusedList.push(item)\n        }\n        else {\n          removeTarget(vm, oldChildren[index])\n        }\n      })\n\n      // 3. create new element foreach new item\n      children.length = 0\n      vms.length = 0\n      fragBlock.data = data.slice()\n      fragBlock.updateMark = fragBlock.start\n\n      data.forEach((item, index) => {\n        const key = trackBy ? item[trackBy] : (oldStyle ? item[keyName] : index)\n        const reused = reusedMap[key]\n        if (reused) {\n          if (reused.item === reusedList[0]) {\n            reusedList.shift()\n          }\n          else {\n            reusedList.$remove(reused.item)\n            moveTarget(vm, reused.target, fragBlock.updateMark, true)\n          }\n          children.push(reused.target)\n          vms.push(reused.vm)\n          if (oldStyle) {\n            reused.vm = item\n          }\n          else {\n            reused.vm[valueName] = item\n          }\n          reused.vm[keyName] = index\n          fragBlock.updateMark = reused.target\n        }\n        else {\n          compileItem(item, index, vm)\n        }\n      })\n\n      delete fragBlock.updateMark\n    }\n  )\n\n  fragBlock.data = list.slice(0)\n  list.forEach((item, index) => {\n    compileItem(item, index, vm)\n  })\n}\n\n/**\n * Watch the display update and add/remove the element.\n *\n * @param  {object} target\n * @param  {object} fragBlock\n * @param  {object} context\n */\nfunction bindShown (vm, target, fragBlock, meta) {\n  const display = watchBlock(vm, fragBlock, target.shown, 'shown',\n    (display) => {\n      console.debug('[JS Framework] the \"if\" item was changed', display)\n\n      if (!fragBlock || !!fragBlock.display === !!display) {\n        return\n      }\n      fragBlock.display = !!display\n      if (display) {\n        compile(vm, target, fragBlock, meta)\n      }\n      else {\n        removeTarget(vm, fragBlock, true)\n      }\n    }\n  )\n\n  fragBlock.display = !!display\n  if (display) {\n    compile(vm, target, fragBlock, meta)\n  }\n}\n\n/**\n * Watch calc value changes and append certain type action to differ.\n * It is used for if or repeat data-binding generator.\n *\n * @param  {object}   fragBlock\n * @param  {function} calc\n * @param  {string}   type\n * @param  {function} handler\n * @return {any}      init value of calc\n */\nfunction watchBlock (vm, fragBlock, calc, type, handler) {\n  const differ = vm && vm._app && vm._app.differ\n  const config = {}\n  const depth = (fragBlock.element.depth || 0) + 1\n\n  return watch(vm, calc, (value) => {\n    config.latestValue = value\n    if (differ && !config.recorded) {\n      differ.append(type, depth, fragBlock.blockId, () => {\n        const latestValue = config.latestValue\n        handler(latestValue)\n        config.recorded = false\n        config.latestValue = undefined\n      })\n    }\n    config.recorded = true\n  })\n}\n\n/**\n * Clone a context and merge certain data.\n *\n * @param  {object} mergedData\n * @return {object}\n */\nfunction mergeContext (context, mergedData) {\n  const newContext = Object.create(context)\n  newContext._data = mergedData\n  initData(newContext)\n  initComputed(newContext)\n  newContext._realParent = context\n  if (context._static) {\n    newContext._static = context._static\n  }\n  return newContext\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Everything about component event which includes event object, event listener,\n * event emitter and lifecycle hooks.\n */\n\n/**\n * Event object definition. An event object has `type`, `timestamp` and\n * `detail` from which a component emit. The event object could be dispatched to\n * parents or broadcasted to children except `this.stop()` is called.\n * @param {string} type\n * @param {any}    detail\n */\nfunction Evt (type, detail) {\n  if (detail instanceof Evt) {\n    return detail\n  }\n\n  this.timestamp = Date.now()\n  this.detail = detail\n  this.type = type\n\n  let shouldStop = false\n\n  /**\n   * stop dispatch and broadcast\n   */\n  this.stop = function () {\n    shouldStop = true\n  }\n\n  /**\n   * check if it can't be dispatched or broadcasted\n   */\n  this.hasStopped = function () {\n    return shouldStop\n  }\n}\n\n/**\n * Emit an event but not broadcast down or dispatch up.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $emit (type, detail) {\n  const events = this._vmEvents\n  const handlerList = events[type]\n  if (handlerList) {\n    const evt = new Evt(type, detail)\n    handlerList.forEach((handler) => {\n      handler.call(this, evt)\n    })\n  }\n}\n\n/**\n * Emit an event and dispatch it up.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $dispatch (type, detail) {\n  const evt = new Evt(type, detail)\n  this.$emit(type, evt)\n\n  if (!evt.hasStopped() && this._parent && this._parent.$dispatch) {\n    this._parent.$dispatch(type, evt)\n  }\n}\n\n/**\n * Emit an event and broadcast it down.\n * @param  {string} type\n * @param  {any}    detail\n */\nexport function $broadcast (type, detail) {\n  const evt = new Evt(type, detail)\n  this.$emit(type, evt)\n\n  if (!evt.hasStopped() && this._childrenVms) {\n    this._childrenVms.forEach((subVm) => {\n      subVm.$broadcast(type, evt)\n    })\n  }\n}\n\n/**\n * Add event listener.\n * @param  {string}   type\n * @param  {function} handler\n */\nexport function $on (type, handler) {\n  if (!type || typeof handler !== 'function') {\n    return\n  }\n  const events = this._vmEvents\n  const handlerList = events[type] || []\n  handlerList.push(handler)\n  events[type] = handlerList\n\n  // fixed old version lifecycle design\n  /* istanbul ignore if */\n  if (type === 'hook:ready' && this._ready) {\n    this.$emit('hook:ready')\n  }\n}\n\n/**\n * Remove event listener.\n * @param  {string}   type\n * @param  {function} handler\n */\nexport function $off (type, handler) {\n  if (!type) {\n    return\n  }\n  const events = this._vmEvents\n  if (!handler) {\n    delete events[type]\n    return\n  }\n  const handlerList = events[type]\n  if (!handlerList) {\n    return\n  }\n  handlerList.$remove(handler)\n}\n\nconst LIFE_CYCLE_TYPES = ['init', 'created', 'ready', 'destroyed']\n\n/**\n * Init events:\n * 1. listen `events` in component options & `externalEvents`.\n * 2. bind lifecycle hooks.\n * @param  {Vm}     vm\n * @param  {object} externalEvents\n */\nexport function initEvents (vm, externalEvents) {\n  const options = vm._options || {}\n  const events = options.events || {}\n  for (const type1 in events) {\n    vm.$on(type1, events[type1])\n  }\n  for (const type2 in externalEvents) {\n    vm.$on(type2, externalEvents[type2])\n  }\n  LIFE_CYCLE_TYPES.forEach((type) => {\n    vm.$on(`hook:${type}`, options[type])\n  })\n}\n\n/**\n * Bind event related methods to ViewModel instance.\n * @param  {Vm} vm\n */\nexport function mixinEvents (vm) {\n  vm.$emit = $emit\n  vm.$dispatch = $dispatch\n  vm.$broadcast = $broadcast\n  vm.$on = $on\n  vm.$off = $off\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * ViewModel Constructor & definition\n */\n\nimport { extend } from '../util/index'\nimport {\n  initState\n} from '../core/state'\nimport {\n  build\n} from './compiler'\nimport {\n  set,\n  del\n} from '../core/observer'\nimport {\n  watch\n} from './directive'\nimport {\n  initEvents,\n  mixinEvents\n} from './events'\n\n/**\n * ViewModel constructor\n *\n * @param {string} type\n * @param {object} options    component options\n * @param {object} parentVm   which contains _app\n * @param {object} parentEl   root element or frag block\n * @param {object} mergedData external data\n * @param {object} externalEvents external events\n */\nexport default function Vm (\n  type,\n  options,\n  parentVm,\n  parentEl,\n  mergedData,\n  externalEvents\n) {\n  parentVm = parentVm || {}\n  this._parent = parentVm._realParent ? parentVm._realParent : parentVm\n  this._app = parentVm._app || {}\n  parentVm._childrenVms && parentVm._childrenVms.push(this)\n\n  if (!options && this._app.customComponentMap) {\n    options = this._app.customComponentMap[type]\n  }\n  options = options || {}\n\n  const data = options.data || {}\n\n  this._options = options\n  this._methods = options.methods || {}\n  this._computed = options.computed || {}\n  this._css = options.style || {}\n  this._ids = {}\n  this._vmEvents = {}\n  this._childrenVms = []\n  this._type = type\n\n  // bind events and lifecycles\n  initEvents(this, externalEvents)\n\n  console.debug(`[JS Framework] \"init\" lifecycle in Vm(${this._type})`)\n  this.$emit('hook:init')\n  this._inited = true\n\n  // proxy data and methods\n  // observe data and add this to vms\n  this._data = typeof data === 'function' ? data() : data\n  if (mergedData) {\n    extend(this._data, mergedData)\n  }\n  initState(this)\n\n  console.debug(`[JS Framework] \"created\" lifecycle in Vm(${this._type})`)\n  this.$emit('hook:created')\n  this._created = true\n\n  // backward old ready entry\n  if (options.methods && options.methods.ready) {\n    console.warn('\"exports.methods.ready\" is deprecated, ' +\n      'please use \"exports.created\" instead')\n    options.methods.ready.call(this)\n  }\n\n  if (!this._app.doc) {\n    return\n  }\n\n  // if no parentElement then specify the documentElement\n  this._parentEl = parentEl || this._app.doc.documentElement\n  build(this)\n}\n\nmixinEvents(Vm.prototype)\n\n/**\n * Watch an function and bind all the data appeared in it. When the related\n * data changes, the callback will be called with new value as 1st param.\n *\n * @param {Function} fn\n * @param {Function} callback\n */\nVm.prototype.$watch = function (fn, callback) {\n  watch(this, fn, callback)\n}\n\nVm.set = set\nVm.delete = del\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nlet nativeModules = {}\n\n// for testing\n\n/**\n * for testing\n */\nexport function getModule (moduleName) {\n  return nativeModules[moduleName]\n}\n\n/**\n * for testing\n */\nexport function clearModules () {\n  nativeModules = {}\n}\n\n// for framework\n\n/**\n * init modules for an app instance\n * the second param determines whether to replace an existed method\n */\nexport function initModules (modules, ifReplace) {\n  for (const moduleName in modules) {\n    // init `modules[moduleName][]`\n    let methods = nativeModules[moduleName]\n    if (!methods) {\n      methods = {}\n      nativeModules[moduleName] = methods\n    }\n\n    // push each non-existed new method\n    modules[moduleName].forEach(function (method) {\n      if (typeof method === 'string') {\n        method = {\n          name: method\n        }\n      }\n\n      if (!methods[method.name] || ifReplace) {\n        methods[method.name] = method\n      }\n    })\n  }\n}\n\n/**\n * init app methods\n */\nexport function initMethods (Vm, apis) {\n  const p = Vm.prototype\n\n  for (const apiName in apis) {\n    if (!p.hasOwnProperty(apiName)) {\n      p[apiName] = apis[apiName]\n    }\n  }\n}\n\n/**\n * get a module of methods for an app instance\n */\nexport function requireModule (app, name) {\n  const methods = nativeModules[name]\n  const target = {}\n  for (const methodName in methods) {\n    Object.defineProperty(target, methodName, {\n      configurable: true,\n      enumerable: true,\n      get: function moduleGetter () {\n        return (...args) => app.callTasks({\n          module: name,\n          method: methodName,\n          args: args\n        })\n      },\n      set: function moduleSetter (value) {\n        if (typeof value === 'function') {\n          return app.callTasks({\n            module: name,\n            method: methodName,\n            args: [value]\n          })\n        }\n      }\n    })\n  }\n  return target\n}\n\n/**\n * get a custom component options\n */\nexport function requireCustomComponent (app, name) {\n  const { customComponentMap } = app\n  return customComponentMap[name]\n}\n\n/**\n * register a custom component options\n */\nexport function registerCustomComponent (app, name, def) {\n  const { customComponentMap } = app\n\n  if (customComponentMap[name]) {\n    console.error(`[JS Framework] define a component(${name}) that already exists`)\n    return\n  }\n\n  customComponentMap[name] = def\n}\n","exports = module.exports = SemVer;\n\n// The debug function is excluded entirely from the minified version.\n/* nomin */ var debug;\n/* nomin */ if (typeof process === 'object' &&\n    /* nomin */ process.env &&\n    /* nomin */ process.env.NODE_DEBUG &&\n    /* nomin */ /\\bsemver\\b/i.test(process.env.NODE_DEBUG))\n  /* nomin */ debug = function() {\n    /* nomin */ var args = Array.prototype.slice.call(arguments, 0);\n    /* nomin */ args.unshift('SEMVER');\n    /* nomin */ console.log.apply(console, args);\n    /* nomin */ };\n/* nomin */ else\n  /* nomin */ debug = function() {};\n\n// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nexports.SEMVER_SPEC_VERSION = '2.0.0';\n\nvar MAX_LENGTH = 256;\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\n\n// The actual regexps go on exports.re\nvar re = exports.re = [];\nvar src = exports.src = [];\nvar R = 0;\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\nvar NUMERICIDENTIFIER = R++;\nsrc[NUMERICIDENTIFIER] = '0|[1-9]\\\\d*';\nvar NUMERICIDENTIFIERLOOSE = R++;\nsrc[NUMERICIDENTIFIERLOOSE] = '[0-9]+';\n\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\nvar NONNUMERICIDENTIFIER = R++;\nsrc[NONNUMERICIDENTIFIER] = '\\\\d*[a-zA-Z-][a-zA-Z0-9-]*';\n\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\nvar MAINVERSION = R++;\nsrc[MAINVERSION] = '(' + src[NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[NUMERICIDENTIFIER] + ')';\n\nvar MAINVERSIONLOOSE = R++;\nsrc[MAINVERSIONLOOSE] = '(' + src[NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[NUMERICIDENTIFIERLOOSE] + ')';\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n\nvar PRERELEASEIDENTIFIER = R++;\nsrc[PRERELEASEIDENTIFIER] = '(?:' + src[NUMERICIDENTIFIER] +\n                            '|' + src[NONNUMERICIDENTIFIER] + ')';\n\nvar PRERELEASEIDENTIFIERLOOSE = R++;\nsrc[PRERELEASEIDENTIFIERLOOSE] = '(?:' + src[NUMERICIDENTIFIERLOOSE] +\n                                 '|' + src[NONNUMERICIDENTIFIER] + ')';\n\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\nvar PRERELEASE = R++;\nsrc[PRERELEASE] = '(?:-(' + src[PRERELEASEIDENTIFIER] +\n                  '(?:\\\\.' + src[PRERELEASEIDENTIFIER] + ')*))';\n\nvar PRERELEASELOOSE = R++;\nsrc[PRERELEASELOOSE] = '(?:-?(' + src[PRERELEASEIDENTIFIERLOOSE] +\n                       '(?:\\\\.' + src[PRERELEASEIDENTIFIERLOOSE] + ')*))';\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\nvar BUILDIDENTIFIER = R++;\nsrc[BUILDIDENTIFIER] = '[0-9A-Za-z-]+';\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\nvar BUILD = R++;\nsrc[BUILD] = '(?:\\\\+(' + src[BUILDIDENTIFIER] +\n             '(?:\\\\.' + src[BUILDIDENTIFIER] + ')*))';\n\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\nvar FULL = R++;\nvar FULLPLAIN = 'v?' + src[MAINVERSION] +\n                src[PRERELEASE] + '?' +\n                src[BUILD] + '?';\n\nsrc[FULL] = '^' + FULLPLAIN + '$';\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\nvar LOOSEPLAIN = '[v=\\\\s]*' + src[MAINVERSIONLOOSE] +\n                 src[PRERELEASELOOSE] + '?' +\n                 src[BUILD] + '?';\n\nvar LOOSE = R++;\nsrc[LOOSE] = '^' + LOOSEPLAIN + '$';\n\nvar GTLT = R++;\nsrc[GTLT] = '((?:<|>)?=?)';\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\nvar XRANGEIDENTIFIERLOOSE = R++;\nsrc[XRANGEIDENTIFIERLOOSE] = src[NUMERICIDENTIFIERLOOSE] + '|x|X|\\\\*';\nvar XRANGEIDENTIFIER = R++;\nsrc[XRANGEIDENTIFIER] = src[NUMERICIDENTIFIER] + '|x|X|\\\\*';\n\nvar XRANGEPLAIN = R++;\nsrc[XRANGEPLAIN] = '[v=\\\\s]*(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[XRANGEIDENTIFIER] + ')' +\n                   '(?:' + src[PRERELEASE] + ')?' +\n                   src[BUILD] + '?' +\n                   ')?)?';\n\nvar XRANGEPLAINLOOSE = R++;\nsrc[XRANGEPLAINLOOSE] = '[v=\\\\s]*(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:' + src[PRERELEASELOOSE] + ')?' +\n                        src[BUILD] + '?' +\n                        ')?)?';\n\nvar XRANGE = R++;\nsrc[XRANGE] = '^' + src[GTLT] + '\\\\s*' + src[XRANGEPLAIN] + '$';\nvar XRANGELOOSE = R++;\nsrc[XRANGELOOSE] = '^' + src[GTLT] + '\\\\s*' + src[XRANGEPLAINLOOSE] + '$';\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\nvar LONETILDE = R++;\nsrc[LONETILDE] = '(?:~>?)';\n\nvar TILDETRIM = R++;\nsrc[TILDETRIM] = '(\\\\s*)' + src[LONETILDE] + '\\\\s+';\nre[TILDETRIM] = new RegExp(src[TILDETRIM], 'g');\nvar tildeTrimReplace = '$1~';\n\nvar TILDE = R++;\nsrc[TILDE] = '^' + src[LONETILDE] + src[XRANGEPLAIN] + '$';\nvar TILDELOOSE = R++;\nsrc[TILDELOOSE] = '^' + src[LONETILDE] + src[XRANGEPLAINLOOSE] + '$';\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\nvar LONECARET = R++;\nsrc[LONECARET] = '(?:\\\\^)';\n\nvar CARETTRIM = R++;\nsrc[CARETTRIM] = '(\\\\s*)' + src[LONECARET] + '\\\\s+';\nre[CARETTRIM] = new RegExp(src[CARETTRIM], 'g');\nvar caretTrimReplace = '$1^';\n\nvar CARET = R++;\nsrc[CARET] = '^' + src[LONECARET] + src[XRANGEPLAIN] + '$';\nvar CARETLOOSE = R++;\nsrc[CARETLOOSE] = '^' + src[LONECARET] + src[XRANGEPLAINLOOSE] + '$';\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\nvar COMPARATORLOOSE = R++;\nsrc[COMPARATORLOOSE] = '^' + src[GTLT] + '\\\\s*(' + LOOSEPLAIN + ')$|^$';\nvar COMPARATOR = R++;\nsrc[COMPARATOR] = '^' + src[GTLT] + '\\\\s*(' + FULLPLAIN + ')$|^$';\n\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\nvar COMPARATORTRIM = R++;\nsrc[COMPARATORTRIM] = '(\\\\s*)' + src[GTLT] +\n                      '\\\\s*(' + LOOSEPLAIN + '|' + src[XRANGEPLAIN] + ')';\n\n// this one has to use the /g flag\nre[COMPARATORTRIM] = new RegExp(src[COMPARATORTRIM], 'g');\nvar comparatorTrimReplace = '$1$2$3';\n\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\nvar HYPHENRANGE = R++;\nsrc[HYPHENRANGE] = '^\\\\s*(' + src[XRANGEPLAIN] + ')' +\n                   '\\\\s+-\\\\s+' +\n                   '(' + src[XRANGEPLAIN] + ')' +\n                   '\\\\s*$';\n\nvar HYPHENRANGELOOSE = R++;\nsrc[HYPHENRANGELOOSE] = '^\\\\s*(' + src[XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s+-\\\\s+' +\n                        '(' + src[XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s*$';\n\n// Star ranges basically just allow anything at all.\nvar STAR = R++;\nsrc[STAR] = '(<|>)?=?\\\\s*\\\\*';\n\n// Compile to actual regexp objects.\n// All are flag-free, unless they were created above with a flag.\nfor (var i = 0; i < R; i++) {\n  debug(i, src[i]);\n  if (!re[i])\n    re[i] = new RegExp(src[i]);\n}\n\nexports.parse = parse;\nfunction parse(version, loose) {\n  if (version instanceof SemVer)\n    return version;\n\n  if (typeof version !== 'string')\n    return null;\n\n  if (version.length > MAX_LENGTH)\n    return null;\n\n  var r = loose ? re[LOOSE] : re[FULL];\n  if (!r.test(version))\n    return null;\n\n  try {\n    return new SemVer(version, loose);\n  } catch (er) {\n    return null;\n  }\n}\n\nexports.valid = valid;\nfunction valid(version, loose) {\n  var v = parse(version, loose);\n  return v ? v.version : null;\n}\n\n\nexports.clean = clean;\nfunction clean(version, loose) {\n  var s = parse(version.trim().replace(/^[=v]+/, ''), loose);\n  return s ? s.version : null;\n}\n\nexports.SemVer = SemVer;\n\nfunction SemVer(version, loose) {\n  if (version instanceof SemVer) {\n    if (version.loose === loose)\n      return version;\n    else\n      version = version.version;\n  } else if (typeof version !== 'string') {\n    throw new TypeError('Invalid Version: ' + version);\n  }\n\n  if (version.length > MAX_LENGTH)\n    throw new TypeError('version is longer than ' + MAX_LENGTH + ' characters')\n\n  if (!(this instanceof SemVer))\n    return new SemVer(version, loose);\n\n  debug('SemVer', version, loose);\n  this.loose = loose;\n  var m = version.trim().match(loose ? re[LOOSE] : re[FULL]);\n\n  if (!m)\n    throw new TypeError('Invalid Version: ' + version);\n\n  this.raw = version;\n\n  // these are actually numbers\n  this.major = +m[1];\n  this.minor = +m[2];\n  this.patch = +m[3];\n\n  if (this.major > MAX_SAFE_INTEGER || this.major < 0)\n    throw new TypeError('Invalid major version')\n\n  if (this.minor > MAX_SAFE_INTEGER || this.minor < 0)\n    throw new TypeError('Invalid minor version')\n\n  if (this.patch > MAX_SAFE_INTEGER || this.patch < 0)\n    throw new TypeError('Invalid patch version')\n\n  // numberify any prerelease numeric ids\n  if (!m[4])\n    this.prerelease = [];\n  else\n    this.prerelease = m[4].split('.').map(function(id) {\n      if (/^[0-9]+$/.test(id)) {\n        var num = +id;\n        if (num >= 0 && num < MAX_SAFE_INTEGER)\n          return num;\n      }\n      return id;\n    });\n\n  this.build = m[5] ? m[5].split('.') : [];\n  this.format();\n}\n\nSemVer.prototype.format = function() {\n  this.version = this.major + '.' + this.minor + '.' + this.patch;\n  if (this.prerelease.length)\n    this.version += '-' + this.prerelease.join('.');\n  return this.version;\n};\n\nSemVer.prototype.toString = function() {\n  return this.version;\n};\n\nSemVer.prototype.compare = function(other) {\n  debug('SemVer.compare', this.version, this.loose, other);\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  return this.compareMain(other) || this.comparePre(other);\n};\n\nSemVer.prototype.compareMain = function(other) {\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  return compareIdentifiers(this.major, other.major) ||\n         compareIdentifiers(this.minor, other.minor) ||\n         compareIdentifiers(this.patch, other.patch);\n};\n\nSemVer.prototype.comparePre = function(other) {\n  if (!(other instanceof SemVer))\n    other = new SemVer(other, this.loose);\n\n  // NOT having a prerelease is > having one\n  if (this.prerelease.length && !other.prerelease.length)\n    return -1;\n  else if (!this.prerelease.length && other.prerelease.length)\n    return 1;\n  else if (!this.prerelease.length && !other.prerelease.length)\n    return 0;\n\n  var i = 0;\n  do {\n    var a = this.prerelease[i];\n    var b = other.prerelease[i];\n    debug('prerelease compare', i, a, b);\n    if (a === undefined && b === undefined)\n      return 0;\n    else if (b === undefined)\n      return 1;\n    else if (a === undefined)\n      return -1;\n    else if (a === b)\n      continue;\n    else\n      return compareIdentifiers(a, b);\n  } while (++i);\n};\n\n// preminor will bump the version up to the next minor release, and immediately\n// down to pre-release. premajor and prepatch work the same way.\nSemVer.prototype.inc = function(release, identifier) {\n  switch (release) {\n    case 'premajor':\n      this.prerelease.length = 0;\n      this.patch = 0;\n      this.minor = 0;\n      this.major++;\n      this.inc('pre', identifier);\n      break;\n    case 'preminor':\n      this.prerelease.length = 0;\n      this.patch = 0;\n      this.minor++;\n      this.inc('pre', identifier);\n      break;\n    case 'prepatch':\n      // If this is already a prerelease, it will bump to the next version\n      // drop any prereleases that might already exist, since they are not\n      // relevant at this point.\n      this.prerelease.length = 0;\n      this.inc('patch', identifier);\n      this.inc('pre', identifier);\n      break;\n    // If the input is a non-prerelease version, this acts the same as\n    // prepatch.\n    case 'prerelease':\n      if (this.prerelease.length === 0)\n        this.inc('patch', identifier);\n      this.inc('pre', identifier);\n      break;\n\n    case 'major':\n      // If this is a pre-major version, bump up to the same major version.\n      // Otherwise increment major.\n      // 1.0.0-5 bumps to 1.0.0\n      // 1.1.0 bumps to 2.0.0\n      if (this.minor !== 0 || this.patch !== 0 || this.prerelease.length === 0)\n        this.major++;\n      this.minor = 0;\n      this.patch = 0;\n      this.prerelease = [];\n      break;\n    case 'minor':\n      // If this is a pre-minor version, bump up to the same minor version.\n      // Otherwise increment minor.\n      // 1.2.0-5 bumps to 1.2.0\n      // 1.2.1 bumps to 1.3.0\n      if (this.patch !== 0 || this.prerelease.length === 0)\n        this.minor++;\n      this.patch = 0;\n      this.prerelease = [];\n      break;\n    case 'patch':\n      // If this is not a pre-release version, it will increment the patch.\n      // If it is a pre-release it will bump up to the same patch version.\n      // 1.2.0-5 patches to 1.2.0\n      // 1.2.0 patches to 1.2.1\n      if (this.prerelease.length === 0)\n        this.patch++;\n      this.prerelease = [];\n      break;\n    // This probably shouldn't be used publicly.\n    // 1.0.0 \"pre\" would become 1.0.0-0 which is the wrong direction.\n    case 'pre':\n      if (this.prerelease.length === 0)\n        this.prerelease = [0];\n      else {\n        var i = this.prerelease.length;\n        while (--i >= 0) {\n          if (typeof this.prerelease[i] === 'number') {\n            this.prerelease[i]++;\n            i = -2;\n          }\n        }\n        if (i === -1) // didn't increment anything\n          this.prerelease.push(0);\n      }\n      if (identifier) {\n        // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n        // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n        if (this.prerelease[0] === identifier) {\n          if (isNaN(this.prerelease[1]))\n            this.prerelease = [identifier, 0];\n        } else\n          this.prerelease = [identifier, 0];\n      }\n      break;\n\n    default:\n      throw new Error('invalid increment argument: ' + release);\n  }\n  this.format();\n  this.raw = this.version;\n  return this;\n};\n\nexports.inc = inc;\nfunction inc(version, release, loose, identifier) {\n  if (typeof(loose) === 'string') {\n    identifier = loose;\n    loose = undefined;\n  }\n\n  try {\n    return new SemVer(version, loose).inc(release, identifier).version;\n  } catch (er) {\n    return null;\n  }\n}\n\nexports.diff = diff;\nfunction diff(version1, version2) {\n  if (eq(version1, version2)) {\n    return null;\n  } else {\n    var v1 = parse(version1);\n    var v2 = parse(version2);\n    if (v1.prerelease.length || v2.prerelease.length) {\n      for (var key in v1) {\n        if (key === 'major' || key === 'minor' || key === 'patch') {\n          if (v1[key] !== v2[key]) {\n            return 'pre'+key;\n          }\n        }\n      }\n      return 'prerelease';\n    }\n    for (var key in v1) {\n      if (key === 'major' || key === 'minor' || key === 'patch') {\n        if (v1[key] !== v2[key]) {\n          return key;\n        }\n      }\n    }\n  }\n}\n\nexports.compareIdentifiers = compareIdentifiers;\n\nvar numeric = /^[0-9]+$/;\nfunction compareIdentifiers(a, b) {\n  var anum = numeric.test(a);\n  var bnum = numeric.test(b);\n\n  if (anum && bnum) {\n    a = +a;\n    b = +b;\n  }\n\n  return (anum && !bnum) ? -1 :\n         (bnum && !anum) ? 1 :\n         a < b ? -1 :\n         a > b ? 1 :\n         0;\n}\n\nexports.rcompareIdentifiers = rcompareIdentifiers;\nfunction rcompareIdentifiers(a, b) {\n  return compareIdentifiers(b, a);\n}\n\nexports.major = major;\nfunction major(a, loose) {\n  return new SemVer(a, loose).major;\n}\n\nexports.minor = minor;\nfunction minor(a, loose) {\n  return new SemVer(a, loose).minor;\n}\n\nexports.patch = patch;\nfunction patch(a, loose) {\n  return new SemVer(a, loose).patch;\n}\n\nexports.compare = compare;\nfunction compare(a, b, loose) {\n  return new SemVer(a, loose).compare(new SemVer(b, loose));\n}\n\nexports.compareLoose = compareLoose;\nfunction compareLoose(a, b) {\n  return compare(a, b, true);\n}\n\nexports.rcompare = rcompare;\nfunction rcompare(a, b, loose) {\n  return compare(b, a, loose);\n}\n\nexports.sort = sort;\nfunction sort(list, loose) {\n  return list.sort(function(a, b) {\n    return exports.compare(a, b, loose);\n  });\n}\n\nexports.rsort = rsort;\nfunction rsort(list, loose) {\n  return list.sort(function(a, b) {\n    return exports.rcompare(a, b, loose);\n  });\n}\n\nexports.gt = gt;\nfunction gt(a, b, loose) {\n  return compare(a, b, loose) > 0;\n}\n\nexports.lt = lt;\nfunction lt(a, b, loose) {\n  return compare(a, b, loose) < 0;\n}\n\nexports.eq = eq;\nfunction eq(a, b, loose) {\n  return compare(a, b, loose) === 0;\n}\n\nexports.neq = neq;\nfunction neq(a, b, loose) {\n  return compare(a, b, loose) !== 0;\n}\n\nexports.gte = gte;\nfunction gte(a, b, loose) {\n  return compare(a, b, loose) >= 0;\n}\n\nexports.lte = lte;\nfunction lte(a, b, loose) {\n  return compare(a, b, loose) <= 0;\n}\n\nexports.cmp = cmp;\nfunction cmp(a, op, b, loose) {\n  var ret;\n  switch (op) {\n    case '===':\n      if (typeof a === 'object') a = a.version;\n      if (typeof b === 'object') b = b.version;\n      ret = a === b;\n      break;\n    case '!==':\n      if (typeof a === 'object') a = a.version;\n      if (typeof b === 'object') b = b.version;\n      ret = a !== b;\n      break;\n    case '': case '=': case '==': ret = eq(a, b, loose); break;\n    case '!=': ret = neq(a, b, loose); break;\n    case '>': ret = gt(a, b, loose); break;\n    case '>=': ret = gte(a, b, loose); break;\n    case '<': ret = lt(a, b, loose); break;\n    case '<=': ret = lte(a, b, loose); break;\n    default: throw new TypeError('Invalid operator: ' + op);\n  }\n  return ret;\n}\n\nexports.Comparator = Comparator;\nfunction Comparator(comp, loose) {\n  if (comp instanceof Comparator) {\n    if (comp.loose === loose)\n      return comp;\n    else\n      comp = comp.value;\n  }\n\n  if (!(this instanceof Comparator))\n    return new Comparator(comp, loose);\n\n  debug('comparator', comp, loose);\n  this.loose = loose;\n  this.parse(comp);\n\n  if (this.semver === ANY)\n    this.value = '';\n  else\n    this.value = this.operator + this.semver.version;\n\n  debug('comp', this);\n}\n\nvar ANY = {};\nComparator.prototype.parse = function(comp) {\n  var r = this.loose ? re[COMPARATORLOOSE] : re[COMPARATOR];\n  var m = comp.match(r);\n\n  if (!m)\n    throw new TypeError('Invalid comparator: ' + comp);\n\n  this.operator = m[1];\n  if (this.operator === '=')\n    this.operator = '';\n\n  // if it literally is just '>' or '' then allow anything.\n  if (!m[2])\n    this.semver = ANY;\n  else\n    this.semver = new SemVer(m[2], this.loose);\n};\n\nComparator.prototype.toString = function() {\n  return this.value;\n};\n\nComparator.prototype.test = function(version) {\n  debug('Comparator.test', version, this.loose);\n\n  if (this.semver === ANY)\n    return true;\n\n  if (typeof version === 'string')\n    version = new SemVer(version, this.loose);\n\n  return cmp(version, this.operator, this.semver, this.loose);\n};\n\nComparator.prototype.intersects = function(comp, loose) {\n  if (!(comp instanceof Comparator)) {\n    throw new TypeError('a Comparator is required');\n  }\n\n  var rangeTmp;\n\n  if (this.operator === '') {\n    rangeTmp = new Range(comp.value, loose);\n    return satisfies(this.value, rangeTmp, loose);\n  } else if (comp.operator === '') {\n    rangeTmp = new Range(this.value, loose);\n    return satisfies(comp.semver, rangeTmp, loose);\n  }\n\n  var sameDirectionIncreasing =\n    (this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '>=' || comp.operator === '>');\n  var sameDirectionDecreasing =\n    (this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '<=' || comp.operator === '<');\n  var sameSemVer = this.semver.version === comp.semver.version;\n  var differentDirectionsInclusive =\n    (this.operator === '>=' || this.operator === '<=') &&\n    (comp.operator === '>=' || comp.operator === '<=');\n  var oppositeDirectionsLessThan =\n    cmp(this.semver, '<', comp.semver, loose) &&\n    ((this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '<=' || comp.operator === '<'));\n  var oppositeDirectionsGreaterThan =\n    cmp(this.semver, '>', comp.semver, loose) &&\n    ((this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '>=' || comp.operator === '>'));\n\n  return sameDirectionIncreasing || sameDirectionDecreasing ||\n    (sameSemVer && differentDirectionsInclusive) ||\n    oppositeDirectionsLessThan || oppositeDirectionsGreaterThan;\n};\n\n\nexports.Range = Range;\nfunction Range(range, loose) {\n  if (range instanceof Range) {\n    if (range.loose === loose) {\n      return range;\n    } else {\n      return new Range(range.raw, loose);\n    }\n  }\n\n  if (range instanceof Comparator) {\n    return new Range(range.value, loose);\n  }\n\n  if (!(this instanceof Range))\n    return new Range(range, loose);\n\n  this.loose = loose;\n\n  // First, split based on boolean or ||\n  this.raw = range;\n  this.set = range.split(/\\s*\\|\\|\\s*/).map(function(range) {\n    return this.parseRange(range.trim());\n  }, this).filter(function(c) {\n    // throw out any that are not relevant for whatever reason\n    return c.length;\n  });\n\n  if (!this.set.length) {\n    throw new TypeError('Invalid SemVer Range: ' + range);\n  }\n\n  this.format();\n}\n\nRange.prototype.format = function() {\n  this.range = this.set.map(function(comps) {\n    return comps.join(' ').trim();\n  }).join('||').trim();\n  return this.range;\n};\n\nRange.prototype.toString = function() {\n  return this.range;\n};\n\nRange.prototype.parseRange = function(range) {\n  var loose = this.loose;\n  range = range.trim();\n  debug('range', range, loose);\n  // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n  var hr = loose ? re[HYPHENRANGELOOSE] : re[HYPHENRANGE];\n  range = range.replace(hr, hyphenReplace);\n  debug('hyphen replace', range);\n  // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n  range = range.replace(re[COMPARATORTRIM], comparatorTrimReplace);\n  debug('comparator trim', range, re[COMPARATORTRIM]);\n\n  // `~ 1.2.3` => `~1.2.3`\n  range = range.replace(re[TILDETRIM], tildeTrimReplace);\n\n  // `^ 1.2.3` => `^1.2.3`\n  range = range.replace(re[CARETTRIM], caretTrimReplace);\n\n  // normalize spaces\n  range = range.split(/\\s+/).join(' ');\n\n  // At this point, the range is completely trimmed and\n  // ready to be split into comparators.\n\n  var compRe = loose ? re[COMPARATORLOOSE] : re[COMPARATOR];\n  var set = range.split(' ').map(function(comp) {\n    return parseComparator(comp, loose);\n  }).join(' ').split(/\\s+/);\n  if (this.loose) {\n    // in loose mode, throw out any that are not valid comparators\n    set = set.filter(function(comp) {\n      return !!comp.match(compRe);\n    });\n  }\n  set = set.map(function(comp) {\n    return new Comparator(comp, loose);\n  });\n\n  return set;\n};\n\nRange.prototype.intersects = function(range, loose) {\n  if (!(range instanceof Range)) {\n    throw new TypeError('a Range is required');\n  }\n\n  return this.set.some(function(thisComparators) {\n    return thisComparators.every(function(thisComparator) {\n      return range.set.some(function(rangeComparators) {\n        return rangeComparators.every(function(rangeComparator) {\n          return thisComparator.intersects(rangeComparator, loose);\n        });\n      });\n    });\n  });\n};\n\n// Mostly just for testing and legacy API reasons\nexports.toComparators = toComparators;\nfunction toComparators(range, loose) {\n  return new Range(range, loose).set.map(function(comp) {\n    return comp.map(function(c) {\n      return c.value;\n    }).join(' ').trim().split(' ');\n  });\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nfunction parseComparator(comp, loose) {\n  debug('comp', comp);\n  comp = replaceCarets(comp, loose);\n  debug('caret', comp);\n  comp = replaceTildes(comp, loose);\n  debug('tildes', comp);\n  comp = replaceXRanges(comp, loose);\n  debug('xrange', comp);\n  comp = replaceStars(comp, loose);\n  debug('stars', comp);\n  return comp;\n}\n\nfunction isX(id) {\n  return !id || id.toLowerCase() === 'x' || id === '*';\n}\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0\nfunction replaceTildes(comp, loose) {\n  return comp.trim().split(/\\s+/).map(function(comp) {\n    return replaceTilde(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceTilde(comp, loose) {\n  var r = loose ? re[TILDELOOSE] : re[TILDE];\n  return comp.replace(r, function(_, M, m, p, pr) {\n    debug('tilde', comp, _, M, m, p, pr);\n    var ret;\n\n    if (isX(M))\n      ret = '';\n    else if (isX(m))\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    else if (isX(p))\n      // ~1.2 == >=1.2.0 <1.3.0\n      ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n    else if (pr) {\n      debug('replaceTilde pr', pr);\n      if (pr.charAt(0) !== '-')\n        pr = '-' + pr;\n      ret = '>=' + M + '.' + m + '.' + p + pr +\n            ' <' + M + '.' + (+m + 1) + '.0';\n    } else\n      // ~1.2.3 == >=1.2.3 <1.3.0\n      ret = '>=' + M + '.' + m + '.' + p +\n            ' <' + M + '.' + (+m + 1) + '.0';\n\n    debug('tilde return', ret);\n    return ret;\n  });\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0\n// ^1.2.3 --> >=1.2.3 <2.0.0\n// ^1.2.0 --> >=1.2.0 <2.0.0\nfunction replaceCarets(comp, loose) {\n  return comp.trim().split(/\\s+/).map(function(comp) {\n    return replaceCaret(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceCaret(comp, loose) {\n  debug('caret', comp, loose);\n  var r = loose ? re[CARETLOOSE] : re[CARET];\n  return comp.replace(r, function(_, M, m, p, pr) {\n    debug('caret', comp, _, M, m, p, pr);\n    var ret;\n\n    if (isX(M))\n      ret = '';\n    else if (isX(m))\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    else if (isX(p)) {\n      if (M === '0')\n        ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n      else\n        ret = '>=' + M + '.' + m + '.0 <' + (+M + 1) + '.0.0';\n    } else if (pr) {\n      debug('replaceCaret pr', pr);\n      if (pr.charAt(0) !== '-')\n        pr = '-' + pr;\n      if (M === '0') {\n        if (m === '0')\n          ret = '>=' + M + '.' + m + '.' + p + pr +\n                ' <' + M + '.' + m + '.' + (+p + 1);\n        else\n          ret = '>=' + M + '.' + m + '.' + p + pr +\n                ' <' + M + '.' + (+m + 1) + '.0';\n      } else\n        ret = '>=' + M + '.' + m + '.' + p + pr +\n              ' <' + (+M + 1) + '.0.0';\n    } else {\n      debug('no pr');\n      if (M === '0') {\n        if (m === '0')\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + m + '.' + (+p + 1);\n        else\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + (+m + 1) + '.0';\n      } else\n        ret = '>=' + M + '.' + m + '.' + p +\n              ' <' + (+M + 1) + '.0.0';\n    }\n\n    debug('caret return', ret);\n    return ret;\n  });\n}\n\nfunction replaceXRanges(comp, loose) {\n  debug('replaceXRanges', comp, loose);\n  return comp.split(/\\s+/).map(function(comp) {\n    return replaceXRange(comp, loose);\n  }).join(' ');\n}\n\nfunction replaceXRange(comp, loose) {\n  comp = comp.trim();\n  var r = loose ? re[XRANGELOOSE] : re[XRANGE];\n  return comp.replace(r, function(ret, gtlt, M, m, p, pr) {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr);\n    var xM = isX(M);\n    var xm = xM || isX(m);\n    var xp = xm || isX(p);\n    var anyX = xp;\n\n    if (gtlt === '=' && anyX)\n      gtlt = '';\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0';\n      } else {\n        // nothing is forbidden\n        ret = '*';\n      }\n    } else if (gtlt && anyX) {\n      // replace X with 0\n      if (xm)\n        m = 0;\n      if (xp)\n        p = 0;\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        // >1.2.3 => >= 1.2.4\n        gtlt = '>=';\n        if (xm) {\n          M = +M + 1;\n          m = 0;\n          p = 0;\n        } else if (xp) {\n          m = +m + 1;\n          p = 0;\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<';\n        if (xm)\n          M = +M + 1;\n        else\n          m = +m + 1;\n      }\n\n      ret = gtlt + M + '.' + m + '.' + p;\n    } else if (xm) {\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0';\n    } else if (xp) {\n      ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0';\n    }\n\n    debug('xRange return', ret);\n\n    return ret;\n  });\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nfunction replaceStars(comp, loose) {\n  debug('replaceStars', comp, loose);\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp.trim().replace(re[STAR], '');\n}\n\n// This function is passed to string.replace(re[HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0\nfunction hyphenReplace($0,\n                       from, fM, fm, fp, fpr, fb,\n                       to, tM, tm, tp, tpr, tb) {\n\n  if (isX(fM))\n    from = '';\n  else if (isX(fm))\n    from = '>=' + fM + '.0.0';\n  else if (isX(fp))\n    from = '>=' + fM + '.' + fm + '.0';\n  else\n    from = '>=' + from;\n\n  if (isX(tM))\n    to = '';\n  else if (isX(tm))\n    to = '<' + (+tM + 1) + '.0.0';\n  else if (isX(tp))\n    to = '<' + tM + '.' + (+tm + 1) + '.0';\n  else if (tpr)\n    to = '<=' + tM + '.' + tm + '.' + tp + '-' + tpr;\n  else\n    to = '<=' + to;\n\n  return (from + ' ' + to).trim();\n}\n\n\n// if ANY of the sets match ALL of its comparators, then pass\nRange.prototype.test = function(version) {\n  if (!version)\n    return false;\n\n  if (typeof version === 'string')\n    version = new SemVer(version, this.loose);\n\n  for (var i = 0; i < this.set.length; i++) {\n    if (testSet(this.set[i], version))\n      return true;\n  }\n  return false;\n};\n\nfunction testSet(set, version) {\n  for (var i = 0; i < set.length; i++) {\n    if (!set[i].test(version))\n      return false;\n  }\n\n  if (version.prerelease.length) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (var i = 0; i < set.length; i++) {\n      debug(set[i].semver);\n      if (set[i].semver === ANY)\n        continue;\n\n      if (set[i].semver.prerelease.length > 0) {\n        var allowed = set[i].semver;\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch)\n          return true;\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false;\n  }\n\n  return true;\n}\n\nexports.satisfies = satisfies;\nfunction satisfies(version, range, loose) {\n  try {\n    range = new Range(range, loose);\n  } catch (er) {\n    return false;\n  }\n  return range.test(version);\n}\n\nexports.maxSatisfying = maxSatisfying;\nfunction maxSatisfying(versions, range, loose) {\n  var max = null;\n  var maxSV = null;\n  try {\n    var rangeObj = new Range(range, loose);\n  } catch (er) {\n    return null;\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) { // satisfies(v, range, loose)\n      if (!max || maxSV.compare(v) === -1) { // compare(max, v, true)\n        max = v;\n        maxSV = new SemVer(max, loose);\n      }\n    }\n  })\n  return max;\n}\n\nexports.minSatisfying = minSatisfying;\nfunction minSatisfying(versions, range, loose) {\n  var min = null;\n  var minSV = null;\n  try {\n    var rangeObj = new Range(range, loose);\n  } catch (er) {\n    return null;\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) { // satisfies(v, range, loose)\n      if (!min || minSV.compare(v) === 1) { // compare(min, v, true)\n        min = v;\n        minSV = new SemVer(min, loose);\n      }\n    }\n  })\n  return min;\n}\n\nexports.validRange = validRange;\nfunction validRange(range, loose) {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, loose).range || '*';\n  } catch (er) {\n    return null;\n  }\n}\n\n// Determine if version is less than all the versions possible in the range\nexports.ltr = ltr;\nfunction ltr(version, range, loose) {\n  return outside(version, range, '<', loose);\n}\n\n// Determine if version is greater than all the versions possible in the range.\nexports.gtr = gtr;\nfunction gtr(version, range, loose) {\n  return outside(version, range, '>', loose);\n}\n\nexports.outside = outside;\nfunction outside(version, range, hilo, loose) {\n  version = new SemVer(version, loose);\n  range = new Range(range, loose);\n\n  var gtfn, ltefn, ltfn, comp, ecomp;\n  switch (hilo) {\n    case '>':\n      gtfn = gt;\n      ltefn = lte;\n      ltfn = lt;\n      comp = '>';\n      ecomp = '>=';\n      break;\n    case '<':\n      gtfn = lt;\n      ltefn = gte;\n      ltfn = gt;\n      comp = '<';\n      ecomp = '<=';\n      break;\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"');\n  }\n\n  // If it satisifes the range it is not outside\n  if (satisfies(version, range, loose)) {\n    return false;\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (var i = 0; i < range.set.length; ++i) {\n    var comparators = range.set[i];\n\n    var high = null;\n    var low = null;\n\n    comparators.forEach(function(comparator) {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator;\n      low = low || comparator;\n      if (gtfn(comparator.semver, high.semver, loose)) {\n        high = comparator;\n      } else if (ltfn(comparator.semver, low.semver, loose)) {\n        low = comparator;\n      }\n    });\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false;\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false;\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexports.prerelease = prerelease;\nfunction prerelease(version, loose) {\n  var parsed = parse(version, loose);\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null;\n}\n\nexports.intersects = intersects;\nfunction intersects(r1, r2, loose) {\n  r1 = new Range(r1, loose)\n  r2 = new Range(r2, loose)\n  return r1.intersects(r2)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport semver from 'semver'\nimport { isPlainObject, typof } from '../util/index'\n\n/**\n * Normalize a version string.\n * @param  {String} Version. ie: 1, 1.0, 1.0.0\n * @return {String} Version\n */\nexport function normalizeVersion (v) {\n  const isValid = semver.valid(v)\n  if (isValid) {\n    return v\n  }\n\n  v = typeof (v) === 'string' ? v : ''\n  const split = v.split('.')\n  let i = 0\n  const result = []\n\n  while (i < 3) {\n    const s = typeof (split[i]) === 'string' && split[i] ? split[i] : '0'\n    result.push(s)\n    i++\n  }\n\n  return result.join('.')\n}\n\n/**\n * Get informations from different error key. Like:\n * - code\n * - errorMessage\n * - errorType\n * - isDowngrade\n * @param  {string} key\n * @param  {string} val\n * @param  {string} criteria\n * @return {object}\n */\nexport function getError (key, val, criteria) {\n  const result = {\n    isDowngrade: true,\n    errorType: 1,\n    code: 1000\n  }\n  const getMsg = function (key, val, criteria) {\n    return 'Downgrade[' + key + '] :: deviceInfo '\n      + val + ' matched criteria ' + criteria\n  }\n  const _key = key.toLowerCase()\n\n  result.errorMessage = getMsg(key, val, criteria)\n\n  if (_key.indexOf('osversion') >= 0) {\n    result.code = 1001\n  }\n  else if (_key.indexOf('appversion') >= 0) {\n    result.code = 1002\n  }\n  else if (_key.indexOf('weexversion') >= 0) {\n    result.code = 1003\n  }\n  else if (_key.indexOf('devicemodel') >= 0) {\n    result.code = 1004\n  }\n\n  return result\n}\n\n/**\n * WEEX framework input(deviceInfo)\n * {\n *   platform: 'iOS' or 'android'\n *   osVersion: '1.0.0' or '1.0' or '1'\n *   appVersion: '1.0.0' or '1.0' or '1'\n *   weexVersion: '1.0.0' or '1.0' or '1'\n *   dDeviceModel: 'MODEL_NAME'\n * }\n *\n * downgrade config(config)\n * {\n *   ios: {\n *     osVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     appVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     weexVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     deviceModel: ['modelA', 'modelB', ...]\n *   },\n *   android: {\n *     osVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     appVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     weexVersion: '>1.0.0' or '>=1.0.0' or '<1.0.0' or '<=1.0.0' or '1.0.0'\n *     deviceModel: ['modelA', 'modelB', ...]\n *   }\n * }\n *\n *\n * @param  {object} deviceInfo Weex SDK framework input\n * @param  {object} config     user input\n * @return {Object}            { isDowngrade: true/false, errorMessage... }\n */\nexport function check (config, deviceInfo) {\n  deviceInfo = deviceInfo || global.WXEnvironment\n  deviceInfo = isPlainObject(deviceInfo) ? deviceInfo : {}\n\n  let result = {\n    isDowngrade: false // defautl is pass\n  }\n\n  if (typof(config) === 'function') {\n    let customDowngrade = config.call(this, deviceInfo, {\n      semver: semver,\n      normalizeVersion\n    })\n\n    customDowngrade = !!customDowngrade\n\n    result = customDowngrade ? getError('custom', '', 'custom params') : result\n  }\n  else {\n    config = isPlainObject(config) ? config : {}\n\n    const platform = deviceInfo.platform || 'unknow'\n    const dPlatform = platform.toLowerCase()\n    const cObj = config[dPlatform] || {}\n\n    for (const i in deviceInfo) {\n      const key = i\n      const keyLower = key.toLowerCase()\n      const val = deviceInfo[i]\n      const isVersion = keyLower.indexOf('version') >= 0\n      const isDeviceModel = keyLower.indexOf('devicemodel') >= 0\n      const criteria = cObj[i]\n\n      if (criteria && isVersion) {\n        const c = normalizeVersion(criteria)\n        const d = normalizeVersion(deviceInfo[i])\n\n        if (semver.satisfies(d, c)) {\n          result = getError(key, val, criteria)\n          break\n        }\n      }\n      else if (isDeviceModel) {\n        const _criteria = typof(criteria) === 'array' ? criteria : [criteria]\n        if (_criteria.indexOf(val) >= 0) {\n          result = getError(key, val, criteria)\n          break\n        }\n      }\n    }\n  }\n\n  return result\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport semver from 'semver'\nimport Vm from '../../vm/index'\nimport * as downgrade from '../downgrade'\nimport { setViewport } from '../viewport'\nimport {\n  requireCustomComponent\n} from '../register'\nimport {\n  isPlainObject,\n  isWeexComponent,\n  isNpmModule,\n  removeWeexPrefix,\n  removeJSSurfix\n} from '../../util/index'\n\n/**\n * bootstrap app from a certain custom component with config & data\n */\nexport function bootstrap (app, name, config, data) {\n  console.debug(`[JS Framework] bootstrap for ${name}`)\n\n  // 1. validate custom component name first\n  let cleanName\n  if (isWeexComponent(name)) {\n    cleanName = removeWeexPrefix(name)\n  }\n  else if (isNpmModule(name)) {\n    cleanName = removeJSSurfix(name)\n    // check if define by old 'define' method\n    /* istanbul ignore if */\n    if (!requireCustomComponent(app, cleanName)) {\n      return new Error(`It's not a component: ${name}`)\n    }\n  }\n  else {\n    return new Error(`Wrong component name: ${name}`)\n  }\n\n  // 2. validate configuration\n  config = isPlainObject(config) ? config : {}\n  // 2.1 transformer version check\n  if (typeof config.transformerVersion === 'string' &&\n    typeof global.transformerVersion === 'string' &&\n    !semver.satisfies(config.transformerVersion,\n      global.transformerVersion)) {\n    return new Error(`JS Bundle version: ${config.transformerVersion} ` +\n      `not compatible with ${global.transformerVersion}`)\n  }\n  // 2.2 downgrade version check\n  const downgradeResult = downgrade.check(config.downgrade)\n  /* istanbul ignore if */\n  if (downgradeResult.isDowngrade) {\n    app.callTasks([{\n      module: 'instanceWrap',\n      method: 'error',\n      args: [\n        downgradeResult.errorType,\n        downgradeResult.code,\n        downgradeResult.errorMessage\n      ]\n    }])\n    return new Error(`Downgrade[${downgradeResult.code}]: ${downgradeResult.errorMessage}`)\n  }\n\n  // set viewport\n  if (config.viewport) {\n    setViewport(app, config.viewport)\n  }\n\n  // 3. create a new Vm with custom component name and data\n  app.vm = new Vm(cleanName, null, { _app: app }, null, data)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport function setViewport (app, configs = {}) {\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV === 'development') {\n    console.debug(`[JS Framework] Set viewport (width: ${configs.width}) for app#${app.id}.`)\n    validateViewport(configs)\n  }\n\n  // Send viewport configs to native\n  if (app && app.callTasks) {\n    return app.callTasks([{\n      module: 'meta',\n      method: 'setViewport',\n      args: [configs]\n    }])\n  }\n\n  /* istanbul ignore next */\n  else if (process.env.NODE_ENV === 'development') {\n    console.warn(`[JS Framework] Can't find \"callTasks\" method on current app.`)\n  }\n}\n\n/**\n * Validate the viewport config.\n * @param {Object} configs\n */\nexport function validateViewport (configs = {}) {\n  const { width } = configs\n  if (width) {\n    if (typeof width !== 'number' && width !== 'device-width') {\n      console.warn(`[JS Framework] Not support to use ${width} as viewport width.`)\n      return false\n    }\n    return true\n  }\n  console.warn('[JS Framework] the viewport config should contain the \"width\" property.')\n  return false\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isWeexComponent,\n  isWeexModule,\n  isNormalModule,\n  isNpmModule,\n  removeWeexPrefix,\n  removeJSSurfix\n} from '../../util/index'\nimport {\n  registerCustomComponent,\n  requireCustomComponent,\n  initModules\n} from '../register'\n\n/**\n * define(name, factory) for primary usage\n * or\n * define(name, deps, factory) for compatibility\n * Notice: DO NOT use function define() {},\n * it will cause error after builded by webpack\n */\nexport const defineFn = function (app, name, ...args) {\n  console.debug(`[JS Framework] define a component ${name}`)\n\n  // adapt args:\n  // 1. name, deps[], factory()\n  // 2. name, factory()\n  // 3. name, definition{}\n  let factory, definition\n  if (args.length > 1) {\n    definition = args[1]\n  }\n  else {\n    definition = args[0]\n  }\n  if (typeof definition === 'function') {\n    factory = definition\n    definition = null\n  }\n\n  // resolve definition from factory\n  if (factory) {\n    const r = (name) => {\n      if (isWeexComponent(name)) {\n        const cleanName = removeWeexPrefix(name)\n        return requireCustomComponent(app, cleanName)\n      }\n      if (isWeexModule(name)) {\n        const cleanName = removeWeexPrefix(name)\n        return app.requireModule(cleanName)\n      }\n      if (isNormalModule(name) || isNpmModule(name)) {\n        const cleanName = removeJSSurfix(name)\n        return app.commonModules[cleanName]\n      }\n    }\n    const m = { exports: {}}\n    factory(r, m.exports, m)\n    definition = m.exports\n  }\n\n  // apply definition\n  if (isWeexComponent(name)) {\n    const cleanName = removeWeexPrefix(name)\n    registerCustomComponent(app, cleanName, definition)\n  }\n  else if (isWeexModule(name)) {\n    const cleanName = removeWeexPrefix(name)\n    initModules({ [cleanName]: definition })\n  }\n  else if (isNormalModule(name)) {\n    const cleanName = removeJSSurfix(name)\n    app.commonModules[cleanName] = definition\n  }\n  else if (isNpmModule(name)) {\n    const cleanName = removeJSSurfix(name)\n    if (definition.template ||\n        definition.style ||\n        definition.methods) {\n      // downgrade to old define method (define('componentName', factory))\n      // the exports contain one key of template, style or methods\n      // but it has risk!!!\n      registerCustomComponent(app, cleanName, definition)\n    }\n    else {\n      app.commonModules[cleanName] = definition\n    }\n  }\n}\n\n/**\n * @deprecated\n */\nexport function register (app, type, options) {\n  console.warn('[JS Framework] Register is deprecated, please install lastest transformer.')\n  registerCustomComponent(app, type, options)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * instance controls from native\n *\n * - fire event\n * - callback\n * - refresh\n * - destroy\n *\n * corresponded with the API of instance manager (framework.js)\n */\nimport { extend, typof } from '../../util/index'\n\n/**\n * Refresh an app with data to its root component options.\n * @param  {object} app\n * @param  {any}    data\n */\nexport function refresh (app, data) {\n  console.debug(`[JS Framework] Refresh with`, data, `in instance[${app.id}]`)\n  const vm = app.vm\n  if (vm && data) {\n    if (typeof vm.refreshData === 'function') {\n      vm.refreshData(data)\n    }\n    else {\n      extend(vm, data)\n    }\n    app.differ.flush()\n    app.doc.taskCenter.send('dom', { action: 'refreshFinish' }, [])\n    return\n  }\n  return new Error(`invalid data \"${data}\"`)\n}\n\n/**\n * Destroy an app.\n * @param  {object} app\n */\nexport function destroy (app) {\n  console.debug(`[JS Framework] Destory an instance(${app.id})`)\n\n  if (app.vm) {\n    destroyVm(app.vm)\n  }\n\n  app.id = ''\n  app.options = null\n  app.blocks = null\n  app.vm = null\n  app.doc.taskCenter.destroyCallback()\n  app.doc.destroy()\n  app.doc = null\n  app.customComponentMap = null\n  app.commonModules = null\n}\n\n/**\n * Destroy an Vm.\n * @param {object} vm\n */\nexport function destroyVm (vm) {\n  delete vm._app\n  delete vm._computed\n  delete vm._css\n  delete vm._data\n  delete vm._ids\n  delete vm._methods\n  delete vm._options\n  delete vm._parent\n  delete vm._parentEl\n  delete vm._rootEl\n\n  // remove all watchers\n  if (vm._watchers) {\n    let watcherCount = vm._watchers.length\n    while (watcherCount--) {\n      vm._watchers[watcherCount].teardown()\n    }\n    delete vm._watchers\n  }\n\n  // destroy child vms recursively\n  if (vm._childrenVms) {\n    let vmCount = vm._childrenVms.length\n    while (vmCount--) {\n      destroyVm(vm._childrenVms[vmCount])\n    }\n    delete vm._childrenVms\n  }\n\n  console.debug(`[JS Framework] \"destroyed\" lifecycle in Vm(${vm._type})`)\n  vm.$emit('hook:destroyed')\n\n  delete vm._type\n  delete vm._vmEvents\n}\n\n/**\n * Get a JSON object to describe the document body.\n * @param  {object} app\n * @return {object}\n */\nexport function getRootElement (app) {\n  const doc = app.doc || {}\n  const body = doc.body || {}\n  return body.toJSON ? body.toJSON() : {}\n}\n\n/**\n * Fire an event from renderer. The event has type, an event object and an\n * element ref. If the event comes with some virtual-DOM changes, it should\n * have one more parameter to describe the changes.\n * @param  {object} app\n * @param  {string} ref\n * @param  {type}   type\n * @param  {object} e\n * @param  {object} domChanges\n */\nexport function fireEvent (app, ref, type, e, domChanges) {\n  console.debug(`[JS Framework] Fire a \"${type}\" event on an element(${ref}) in instance(${app.id})`)\n  if (Array.isArray(ref)) {\n    ref.some((ref) => {\n      return fireEvent(app, ref, type, e) !== false\n    })\n    return\n  }\n  const el = app.doc.getRef(ref)\n  if (el) {\n    const result = app.doc.fireEvent(el, type, e, domChanges)\n    app.differ.flush()\n    app.doc.taskCenter.send('dom', { action: 'updateFinish' }, [])\n    return result\n  }\n  return new Error(`invalid element reference \"${ref}\"`)\n}\n\n/**\n * Make a callback for a certain app.\n * @param  {object}   app\n * @param  {number}   callbackId\n * @param  {any}      data\n * @param  {boolean}  ifKeepAlive\n */\nexport function callback (app, callbackId, data, ifKeepAlive) {\n  console.debug(`[JS Framework] Invoke a callback(${callbackId}) with`, data, `in instance(${app.id})`)\n  const result = app.doc.taskCenter.callback(callbackId, data, ifKeepAlive)\n  updateActions(app)\n  app.doc.taskCenter.send('dom', { action: 'updateFinish' }, [])\n  return result\n}\n\n/**\n * Collect all virtual-DOM mutations together and send them to renderer.\n * @param  {object} app\n */\nexport function updateActions (app) {\n  app.differ.flush()\n}\n\n/**\n * Call all tasks from an app to renderer (native).\n * @param  {object} app\n * @param  {array}  tasks\n */\nexport function callTasks (app, tasks) {\n  let result\n\n  /* istanbul ignore next */\n  if (typof(tasks) !== 'array') {\n    tasks = [tasks]\n  }\n\n  tasks.forEach(task => {\n    result = app.doc.taskCenter.send(\n      'module',\n      {\n        module: task.module,\n        method: task.method\n      },\n      task.args\n    )\n  })\n\n  return result\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * instance controls from native\n *\n * - init bundle\n *\n * corresponded with the API of instance manager (framework.js)\n */\n\nimport Vm from '../../vm/index'\nimport { removeWeexPrefix } from '../../util/index'\nimport {\n  defineFn,\n  bootstrap,\n  register\n} from '../bundle/index'\nimport { updateActions } from './misc'\n\n/**\n * Init an app by run code witgh data\n * @param  {object} app\n * @param  {string} code\n * @param  {object} data\n */\nexport function init (app, code, data, services) {\n  console.debug('[JS Framework] Intialize an instance with:\\n', data)\n  let result\n\n  // prepare app env methods\n  const bundleDefine = (...args) => defineFn(app, ...args)\n  const bundleBootstrap = (name, config, _data) => {\n    result = bootstrap(app, name, config, _data || data)\n    updateActions(app)\n    app.doc.listener.createFinish()\n    console.debug(`[JS Framework] After intialized an instance(${app.id})`)\n  }\n  const bundleVm = Vm\n  /* istanbul ignore next */\n  const bundleRegister = (...args) => register(app, ...args)\n  /* istanbul ignore next */\n  const bundleRender = (name, _data) => {\n    result = bootstrap(app, name, {}, _data)\n  }\n  /* istanbul ignore next */\n  const bundleRequire = name => _data => {\n    result = bootstrap(app, name, {}, _data)\n  }\n  const bundleDocument = app.doc\n  /* istanbul ignore next */\n  const bundleRequireModule = name => app.requireModule(removeWeexPrefix(name))\n\n  const weexGlobalObject = {\n    config: app.options,\n    define: bundleDefine,\n    bootstrap: bundleBootstrap,\n    requireModule: bundleRequireModule,\n    document: bundleDocument,\n    Vm: bundleVm\n  }\n\n  Object.freeze(weexGlobalObject)\n\n  // prepare code\n  let functionBody\n  /* istanbul ignore if */\n  if (typeof code === 'function') {\n    // `function () {...}` -> `{...}`\n    // not very strict\n    functionBody = code.toString().substr(12)\n  }\n  /* istanbul ignore next */\n  else if (code) {\n    functionBody = code.toString()\n  }\n  // wrap IFFE and use strict mode\n  functionBody = `(function(global){\\n\\n\"use strict\";\\n\\n ${functionBody} \\n\\n})(Object.create(this))`\n\n  // run code and get result\n  const { WXEnvironment } = global\n  const timerAPIs = {}\n\n  /* istanbul ignore if */\n  if (WXEnvironment && WXEnvironment.platform !== 'Web') {\n    // timer APIs polyfill in native\n    const timer = app.requireModule('timer')\n    Object.assign(timerAPIs, {\n      setTimeout: (...args) => {\n        const handler = function () {\n          args[0](...args.slice(2))\n        }\n        timer.setTimeout(handler, args[1])\n        return app.doc.taskCenter.callbackManager.lastCallbackId.toString()\n      },\n      setInterval: (...args) => {\n        const handler = function () {\n          args[0](...args.slice(2))\n        }\n        timer.setInterval(handler, args[1])\n        return app.doc.taskCenter.callbackManager.lastCallbackId.toString()\n      },\n      clearTimeout: (n) => {\n        timer.clearTimeout(n)\n      },\n      clearInterval: (n) => {\n        timer.clearInterval(n)\n      }\n    })\n  }\n  // run code and get result\n  const globalObjects = Object.assign({\n    define: bundleDefine,\n    require: bundleRequire,\n    bootstrap: bundleBootstrap,\n    register: bundleRegister,\n    render: bundleRender,\n    __weex_define__: bundleDefine, // alias for define\n    __weex_bootstrap__: bundleBootstrap, // alias for bootstrap\n    __weex_document__: bundleDocument,\n    __weex_require__: bundleRequireModule,\n    __weex_viewmodel__: bundleVm,\n    weex: weexGlobalObject\n  }, timerAPIs, services)\n  if (!callFunctionNative(globalObjects, functionBody)) {\n    // If failed to compile functionBody on native side,\n    // fallback to callFunction.\n    callFunction(globalObjects, functionBody)\n  }\n\n  return result\n}\n\n/**\n * Call a new function body with some global objects.\n * @param  {object} globalObjects\n * @param  {string} code\n * @return {any}\n */\nfunction callFunction (globalObjects, body) {\n  const globalKeys = []\n  const globalValues = []\n  for (const key in globalObjects) {\n    globalKeys.push(key)\n    globalValues.push(globalObjects[key])\n  }\n  globalKeys.push(body)\n\n  const result = new Function(...globalKeys)\n  return result(...globalValues)\n}\n\n/**\n * Call a new function generated on the V8 native side.\n * @param  {object} globalObjects\n * @param  {string} body\n * @return {boolean} return true if no error occurred.\n */\nfunction callFunctionNative (globalObjects, body) {\n  if (typeof compileAndRunBundle !== 'function') {\n    return false\n  }\n\n  let fn = void 0\n  let isNativeCompileOk = false\n  let script = '(function ('\n  const globalKeys = []\n  const globalValues = []\n  for (const key in globalObjects) {\n    globalKeys.push(key)\n    globalValues.push(globalObjects[key])\n  }\n  for (let i = 0; i < globalKeys.length - 1; ++i) {\n    script += globalKeys[i]\n    script += ','\n  }\n  script += globalKeys[globalKeys.length - 1]\n  script += ') {'\n  script += body\n  script += '} )'\n\n  try {\n    const weex = globalObjects.weex || {}\n    const config = weex.config || {}\n    fn = compileAndRunBundle(script, config.bundleUrl, config.bundleDigest, config.codeCachePath)\n    if (fn && typeof fn === 'function') {\n      fn(...globalValues)\n      isNativeCompileOk = true\n    }\n  }\n  catch (e) {\n    console.error(e)\n  }\n\n  return isNativeCompileOk\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default class Differ {\n  constructor (id) {\n    this.id = id\n    this.map = []\n    this.hooks = []\n  }\n  isEmpty () {\n    return this.map.length === 0\n  }\n  append (type, depth = 0, ref, handler) {\n    if (!this.hasTimer) {\n      this.hasTimer = true\n      setTimeout(() => {\n        this.hasTimer = false\n        this.flush(true)\n      }, 0)\n    }\n    const map = this.map\n    if (!map[depth]) {\n      map[depth] = {}\n    }\n    const group = map[depth]\n    if (!group[type]) {\n      group[type] = {}\n    }\n    if (type === 'element') {\n      if (!group[type][ref]) {\n        group[type][ref] = []\n      }\n      group[type][ref].push(handler)\n    }\n    else {\n      group[type][ref] = handler\n    }\n  }\n  flush (isTimeout) {\n    const map = this.map.slice()\n    this.map.length = 0\n    map.forEach((group) => {\n      callTypeMap(group, 'repeat')\n      callTypeMap(group, 'shown')\n      callTypeList(group, 'element')\n    })\n\n    const hooks = this.hooks.slice()\n    this.hooks.length = 0\n    hooks.forEach((fn) => {\n      fn()\n    })\n\n    if (!this.isEmpty()) {\n      this.flush()\n    }\n  }\n  then (fn) {\n    this.hooks.push(fn)\n  }\n}\n\nfunction callTypeMap (group, type) {\n  const map = group[type]\n  for (const ref in map) {\n    map[ref]()\n  }\n}\n\nfunction callTypeList (group, type) {\n  const map = group[type]\n  for (const ref in map) {\n    const list = map[ref]\n    list.forEach((handler) => { handler() })\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Weex App constructor & definition\n */\n\nimport Differ from './differ'\nimport renderer from '../config'\n\n/**\n * App constructor for Weex framework.\n * @param {string} id\n * @param {object} options\n */\nexport default function App (id, options) {\n  this.id = id\n  this.options = options || {}\n  this.vm = null\n  this.customComponentMap = {}\n  this.commonModules = {}\n\n  // document\n  this.doc = new renderer.Document(\n    id,\n    this.options.bundleUrl,\n    null,\n    renderer.Listener\n  )\n  this.differ = new Differ(id)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview\n * Weex instance constructor & definition\n */\n\nimport { requireModule } from './register'\nimport { updateActions, callTasks } from './ctrl/index'\nimport App from './instance'\n\n/**\n * @deprecated\n */\nApp.prototype.requireModule = function (name) {\n  return requireModule(this, name)\n}\n\n/**\n * @deprecated\n */\nApp.prototype.updateActions = function () {\n  return updateActions(this)\n}\n\n/**\n * @deprecated\n */\nApp.prototype.callTasks = function (tasks) {\n  return callTasks(this, tasks)\n}\n\n/**\n * Prevent modification of App and App.prototype\n */\nObject.freeze(App)\nObject.freeze(App.prototype)\n\nexport default App\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const instanceMap = {}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Vm from '../vm/index'\nimport config from '../config'\nimport {\n  initModules,\n  initMethods\n} from '../app/register'\n\nconst {\n  nativeComponentMap\n} = config\n\n/**\n * Register the name of each native component.\n * @param  {array} components array of name\n */\nexport function registerComponents (components) {\n  if (Array.isArray(components)) {\n    components.forEach(function register (name) {\n      /* istanbul ignore if */\n      if (!name) {\n        return\n      }\n      if (typeof name === 'string') {\n        nativeComponentMap[name] = true\n      }\n      /* istanbul ignore else */\n      else if (typeof name === 'object' && typeof name.type === 'string') {\n        nativeComponentMap[name.type] = name\n      }\n    })\n  }\n}\n\n/**\n * Register the name and methods of each module.\n * @param  {object} modules a object of modules\n */\nexport function registerModules (modules) {\n  /* istanbul ignore else */\n  if (typeof modules === 'object') {\n    initModules(modules)\n  }\n}\n\n/**\n * Register the name and methods of each api.\n * @param  {object} apis a object of apis\n */\nexport function registerMethods (methods) {\n  /* istanbul ignore else */\n  if (typeof methods === 'object') {\n    initMethods(Vm, methods)\n  }\n}\n\n// @todo: Hack for this framework only. Will be re-designed or removed later.\nglobal.registerMethods = registerMethods\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { instanceMap } from './map'\nimport {\n  fireEvent,\n  callback\n} from '../app/ctrl/index'\n\nconst jsHandlers = {\n  fireEvent: (id, ...args) => {\n    return fireEvent(instanceMap[id], ...args)\n  },\n  callback: (id, ...args) => {\n    return callback(instanceMap[id], ...args)\n  }\n}\n\n/**\n * Accept calls from native (event or callback).\n *\n * @param  {string} id\n * @param  {array} tasks list with `method` and `args`\n */\nexport function receiveTasks (id, tasks) {\n  const instance = instanceMap[id]\n  if (instance && Array.isArray(tasks)) {\n    const results = []\n    tasks.forEach((task) => {\n      const handler = jsHandlers[task.method]\n      const args = [...task.args]\n      /* istanbul ignore else */\n      if (typeof handler === 'function') {\n        args.unshift(id)\n        results.push(handler(...args))\n      }\n    })\n    return results\n  }\n  return new Error(`invalid instance id \"${id}\" or tasks`)\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * @fileOverview Weex framework entry.\n */\n\nimport * as methods from './api/methods'\n\nimport Vm from './vm'\nexport { createInstance } from './static/create'\nexport { init, refreshInstance, destroyInstance } from './static/life'\nimport { registerComponents, registerModules, registerMethods } from './static/register'\nexport { receiveTasks } from './static/bridge'\nexport { getRoot } from './static/misc'\n\n// register special methods for Weex framework\nregisterMethods(methods)\n\n/**\n * Prevent modification of Vm and Vm.prototype\n */\nObject.freeze(Vm)\n\nexport { registerComponents, registerModules, registerMethods }\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { subversion } from '../../package.json'\nimport runtime from '../api'\nimport services from '../services'\n\n/**\n * Setup frameworks with runtime.\n * You can package more frameworks by\n *  passing them as arguments.\n */\nexport default function (frameworks) {\n  const { init, config } = runtime\n  config.frameworks = frameworks\n  const { native, transformer } = subversion\n\n  for (const serviceName in services) {\n    runtime.service.register(serviceName, services[serviceName])\n  }\n\n  runtime.freezePrototype()\n\n  // register framework meta info\n  global.frameworkVersion = native\n  global.transformerVersion = transformer\n\n  // init frameworks\n  const globalMethods = init(config)\n\n  // set global methods\n  for (const methodName in globalMethods) {\n    global[methodName] = (...args) => {\n      const ret = globalMethods[methodName](...args)\n      if (ret instanceof Error) {\n        console.error(ret.toString())\n      }\n      return ret\n    }\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport setup from './setup'\nimport * as Weex from '../frameworks/legacy/index'\n\nsetup({ Weex })\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport App from '../app/index'\nimport { instanceMap } from './map'\nimport { init as initApp } from '../app/ctrl/index'\nimport { resetTarget } from '../core/dep'\n\n/**\n * Create a Weex instance.\n *\n * @param  {string} id\n * @param  {string} code\n * @param  {object} options\n *         option `HAS_LOG` enable print log\n * @param  {object} data\n * @param  {object} info { created, ... services }\n */\nexport function createInstance (id, code, options, data, info) {\n  const { services } = info || {}\n  resetTarget()\n  let instance = instanceMap[id]\n  /* istanbul ignore else */\n  options = options || {}\n  let result\n  /* istanbul ignore else */\n  if (!instance) {\n    instance = new App(id, options)\n    instanceMap[id] = instance\n    result = initApp(instance, code, data, services)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return (result instanceof Error) ? result : instance\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport config from '../config'\nimport {\n  refresh,\n  destroy\n} from '../app/ctrl/index'\nimport { instanceMap } from './map'\nimport { resetTarget } from '../core/dep'\n\n/**\n * Init config informations for Weex framework\n * @param  {object} cfg\n */\nexport function init (cfg) {\n  config.Document = cfg.Document\n  config.Element = cfg.Element\n  config.Comment = cfg.Comment\n  config.sendTasks = cfg.sendTasks\n  config.Listener = cfg.Listener\n}\n\n/**\n * Refresh a Weex instance with data.\n *\n * @param  {string} id\n * @param  {object} data\n */\nexport function refreshInstance (id, data) {\n  const instance = instanceMap[id]\n  let result\n  /* istanbul ignore else */\n  if (instance) {\n    result = refresh(instance, data)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return result\n}\n\n/**\n * Destroy a Weex instance.\n * @param  {string} id\n */\nexport function destroyInstance (id) {\n  // Markup some global state in native side\n  if (typeof markupState === 'function') {\n    markupState()\n  }\n\n  resetTarget()\n  const instance = instanceMap[id]\n  /* istanbul ignore else */\n  if (!instance) {\n    return new Error(`invalid instance id \"${id}\"`)\n  }\n  destroy(instance)\n  delete instanceMap[id]\n  // notifyContextDisposed is used to tell v8 to do a full GC,\n  // but this would have a negative performance impact on weex,\n  // because all the inline cache in v8 would get cleared\n  // during a full GC.\n  // To take care of both memory and performance, just tell v8\n  // to do a full GC every eighteen times.\n  const idNum = Math.round(id)\n  const round = 18\n  if (idNum > 0) {\n    const remainder = idNum % round\n    if (!remainder && typeof notifyTrimMemory === 'function') {\n      notifyTrimMemory()\n    }\n  }\n  return instanceMap\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { instanceMap } from './map'\nimport {\n  getRootElement\n} from '../app/ctrl/index'\n\n/**\n * Get a whole element tree of an instance for debugging.\n * @param  {string} id\n * @return {object} a virtual dom tree\n */\nexport function getRoot (id) {\n  const instance = instanceMap[id]\n  let result\n  /* istanbul ignore else */\n  if (instance) {\n    result = getRootElement(instance)\n  }\n  else {\n    result = new Error(`invalid instance id \"${id}\"`)\n  }\n  return result\n}\n"],"names":["nextNodeRef","uniqueId","toString","typof","v","s","Object","prototype","call","substring","length","bufferToBase64","buffer","btoa","string","Array","map","Uint8Array","code","String","fromCharCode","join","isEmpty","any","key","hasOwnProperty","decodePrimitive","data","base64","atob","ArrayBuffer","array","forEach","ch","i","charCodeAt","base64ToBuffer","realData","getHookKey","componentId","type","hookName","CallbackManager","[object Object]","instanceId","this","lastCallbackId","callbacks","hooks","callback","callbackId","hookFunction","console","warn","options","error","result","apply","args","e","ifKeepAlive","Error","docMap","getDoc","id","getTaskCenter","doc","taskCenter","appendBody","node","before","documentElement","pureChildren","parentNode","children","beforeIndex","indexOf","push","splice","nodeType","role","docId","ownerDocument","linkParent","child","setBody","nodeMap","nodeId","body","toJSON","send","action","sendBody","ref","el","depth","_root","parent","nextElement","nextSibling","previousElement","previousSibling","insertIndex","target","list","newIndex","changeSibling","after","moveIndex","index","newIndexAfter","beforeNew","afterNew","removeIndex","Node","destroy","Element","registeredElements","DEFAULT_TAG_NAME","BUBBLE_EVENTS","registerNode","props","isExtended","super","WeexElement","attr","style","classStyle","event","pureBefore","preserved","value","silent","batchedAttrs","mutations","batchedStyles","assign","toStyle","handler","params","isBubble","isStopPropagation","eventDesc","stopPropagation","fireEvent","currentTarget","JSON","stringify","fallback","TaskCenter","sendTasks","defineProperty","enumerable","callbackManager","consume","registerHook","triggerHook","newData","module","method","close","_isVue","$el","add","toISOString","@type","dataType","normalizePrimitive","component","arg","normalize","componentHandler","moduleHandler","receiveTasks","tasks","document","isArray","task","domChanges","getRef","hook","componentHook","weexModules","registerModules","newModules","name","isRegisteredModule","weexComponents","registerComponents","newComponents","methods","methodName","registerElement","isRegisteredComponent","services","register","has","unregister","some","service","Comment","createAction","Listener","batched","updates","configurable","writable","element","actions","addActions","r","targetRef","parentRef","cb","handlerMap","createBody","addElement","removeElement","moveElement","updateAttrs","updateStyle","addEvent","removeEvent","dispatchTask","defaultHandler","global","Document","url","URL","L","listener","callNative","returnValue","createHandler","createDocumentElement","_documentElement","tagName","text","timestamp","Date","now","changes","attrs","setAttr","setStyle","updateElement","destroyCallback","moduleProxies","moduleGetter","moduleSetter","fn","WeexInstance","config","weex","bundleUrl","requireModule","bind","moduleName","proxyName","moduleDefine","moduleApis","get","set","Proxy","condition","res","match","frameworks","runtimeConfig","versionRegExp","instanceTypeMap","getFrameworkType","createInstanceContext","freeze","bundleType","framework","label","message","create","err","track","env","serviceMap","instance","createServices","created","runtimeContext","instanceContext","createInstance","exec","parse","getBundleType","WXEnvironment","raxInstanceContext","context","keys","bundle","Function","runInContext","getRoot","getDocument","registerService","unregisterService","genInstance","info","refresh","runtime","adaptMethod","sharedMethod","freezePrototype","DOM_METHODS","createFinish","callCreateFinish","updateFinish","callUpdateFinish","refreshFinish","callRefreshFinish","callCreateBody","callAddElement","callRemoveElement","callMoveElement","callUpdateAttrs","callUpdateStyle","callAddEvent","callRemoveEvent","proto","callNativeComponent","callNativeModule","initTaskHandler","init","MessageEvent","dict","origin","source","ports","timeStamp","channels","instances","BroadcastChannel","postMessage","_closed","subscribers","member","onmessage","filter","x","serviceObject","channel","_ids","vm","_app","differ","then","offset","scrollToElement","styles","transition","_setStyle","sendHttp","openURL","title","setTitle","extend","src","first","shift","def","obj","val","remove","arr","item","hasOwn","ctx","a","l","arguments","isObject","OBJECT_STRING","isPlainObject","isReserved","str","c","hasProto","_Set","Set","undefined","clear","createNewSet","nativeSet","toLowerCase","WEEX_COMPONENT_REG","WEEX_MODULE_REG","NORMAL_MODULE_REG","JS_SURFIX_REG","isWeexComponent","isWeexModule","isNormalModule","isNpmModule","removeWeexPrefix","replace","removeJSSurfix","uid","Dep","subs","targetStack","resetTarget","addSub","sub","removeSub","depend","addDep","notify","slice","update","Watcher","expOrFn","isFn","_watchers","expression","active","dirty","lazy","deps","newDeps","depIds","newDepIds","getter","queued","shallow","_target","deep","traverse","seen","isA","isO","seenObjects","__ob__","depId","dep","pop","cleanupDeps","tmp","run","oldValue","evaluate","teardown","_isBeingDestroyed","_vForRemoving","arrayProto","arrayMethods","original","ob","inserted","observeArray","arrayKeys","getOwnPropertyNames","Observer","protoAugment","copyAugment","walk","convert","items","observe","property","getOwnPropertyDescriptor","setter","childOb","newVal","defineReactive","addVm","vms","removeVm","__proto__","isExtensible","KEY_WORDS","proxy","_data","initData","noop","initComputed","computed","_computed","userDef","makeComputedGetter","cache","owner","watcher","nativeComponentMap","image","container","slider","append","cell","SETTERS","bindElement","template","setId","bindDir","classList","setClassStyle","_options","watch","setClass","events","bindEvents","bindSubVmAfterInitialized","subVm","css","_rootEl","className","addClassName","unshift","mergeClassStyle","mergeStyle","_vm","mergeProps","defineProperties","newId","split","bindKey","calc","_static","createBlock","start","createComment","end","blockId","lastestBlockId","updateMark","insertAfter","insertBefore","appendChild","attachTarget","dest","signal","moveTarget","fragBlock","group","temp","every","moveBlock","removeTarget","preserveBlock","removeBlock","$emit","removeChild","compile","meta","lastSignal","compileFragment","debug","_content","repeat","oldStyle","trackBy","keyName","valueName","compileItem","mergedData","newContext","_realParent","mergeContext","watchBlock","oldChildren","oldVms","oldData","trackMap","reusedMap","reusedList","reused","$remove","bindRepeat","compileRepeat","shown","newMeta","display","bindShown","compileShown","typeGetter","compileType","customComponentMap","components","targetIsComposed","Ctor","constructor","hook:init","_externalBinding","hook:created","repeatItem","reduce","bindSubVm","hook:ready","compileChildren","compileCustomComponent","subkey","applyNaitveComponentOptions","createElement","binding","parentVm","treeMode","app","compileNativeComponent","latestValue","recorded","Evt","detail","shouldStop","stop","hasStopped","handlerList","_vmEvents","evt","$dispatch","_parent","$broadcast","_childrenVms","$on","_ready","$off","LIFE_CYCLE_TYPES","Vm","parentEl","externalEvents","_methods","_css","_type","type1","type2","initEvents","_inited","initMethods","_created","ready","_parentEl","opt","build","$watch","delete","nativeModules","initModules","modules","ifReplace","requireCustomComponent","registerCustomComponent","exports","SemVer","MAX_LENGTH","MAX_SAFE_INTEGER","Number","re","R","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","MAINVERSION","MAINVERSIONLOOSE","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","PRERELEASE","PRERELEASELOOSE","BUILDIDENTIFIER","BUILD","FULL","FULLPLAIN","LOOSEPLAIN","LOOSE","GTLT","XRANGEIDENTIFIERLOOSE","XRANGEIDENTIFIER","XRANGEPLAIN","XRANGEPLAINLOOSE","XRANGE","XRANGELOOSE","LONETILDE","TILDETRIM","RegExp","TILDE","TILDELOOSE","LONECARET","CARETTRIM","CARET","CARETLOOSE","COMPARATORLOOSE","COMPARATOR","COMPARATORTRIM","HYPHENRANGE","HYPHENRANGELOOSE","STAR","version","loose","test","er","trim","TypeError","m","raw","major","minor","patch","prerelease","num","format","compare","other","compareMain","comparePre","compareIdentifiers","b","inc","release","identifier","isNaN","version1","version2","eq","v1","v2","numeric","anum","bnum","sort","rcompare","gt","lt","neq","gte","lte","cmp","op","ret","Comparator","comp","semver","ANY","operator","intersects","rangeTmp","Range","satisfies","sameDirectionIncreasing","sameDirectionDecreasing","sameSemVer","differentDirectionsInclusive","oppositeDirectionsLessThan","oppositeDirectionsGreaterThan","range","parseRange","comps","hr","hyphenReplace","compRe","_","M","p","pr","isX","charAt","replaceCaret","replaceTilde","gtlt","xM","xm","xp","anyX","replaceXRange","parseComparator","thisComparators","thisComparator","rangeComparators","rangeComparator","$0","from","fM","fm","fp","fpr","fb","to","tM","tm","tp","tpr","tb","testSet","allowed","versions","max","maxSV","rangeObj","min","minSV","outside","hilo","gtfn","ltefn","ltfn","ecomp","high","low","comparator","parsed","r1","r2","normalizeVersion","valid","getError","criteria","isDowngrade","errorType","_key","errorMessage","bootstrap","cleanName","transformerVersion","downgradeResult","deviceInfo","customDowngrade","cObj","platform","keyLower","isVersion","isDeviceModel","d","downgrade.check","downgrade","callTasks","viewport","configs","setViewport","defineFn","factory","definition","commonModules","destroyVm","watcherCount","vmCount","blocks","updateActions","flush","bundleDefine","bundleBootstrap","bundleVm","bundleDocument","bundleRequireModule","weexGlobalObject","define","functionBody","substr","timerAPIs","timer","setTimeout","setInterval","clearTimeout","n","clearInterval","globalObjects","require","render","__weex_define__","__weex_bootstrap__","__weex_document__","__weex_require__","__weex_viewmodel__","compileAndRunBundle","isNativeCompileOk","script","globalKeys","globalValues","bundleDigest","codeCachePath","callFunctionNative","callFunction","Differ","hasTimer","isTimeout","callTypeMap","callTypeList","App","renderer","instanceMap","registerMethods","apis","apiName","jsHandlers","native","transformer","subversion","serviceName","frameworkVersion","globalMethods","setup","Weex","initApp","cfg","refreshData","markupState","idNum","Math","round","notifyTrimMemory","results","getRootElement"],"mappings":"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"}